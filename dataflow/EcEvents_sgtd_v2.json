{
	"name": "EcEvents_sgtd_v2",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"linkedService": {
						"referenceName": "linkedService1",
						"type": "LinkedServiceReference"
					},
					"name": "CSV"
				}
			],
			"sinks": [
				{
					"linkedService": {
						"referenceName": "linkedService1",
						"type": "LinkedServiceReference"
					},
					"name": "sink1"
				}
			],
			"transformations": [
				{
					"name": "DataTypeConversion"
				},
				{
					"name": "AlterRow1"
				},
				{
					"name": "Select1"
				},
				{
					"name": "Filter1"
				}
			],
			"script": "source(output(\n\t\tECEVENTGKEY as string,\n\t\tYARDGKEY as integer,\n\t\tYARDID as string,\n\t\tFCYID as string,\n\t\tCHEKIND as string,\n\t\tCHE_NAME as string,\n\t\tCHE_ID as short,\n\t\tTIMESTAMP as string,\n\t\tEVENTTYPE as short,\n\t\tEVENTSUBTYPE as short,\n\t\tEVENTTYPEDESCRIPTION as string,\n\t\tFROMCHEIDNAME as boolean,\n\t\tTOCHEIDNAME as boolean,\n\t\tUNIT as string,\n\t\tPOW as string,\n\t\tPOOL as string,\n\t\tWORKQUEUE as string,\n\t\tTRAVELDISTANCE as short,\n\t\tMOVEKIND as string,\n\t\tISTWIN as boolean,\n\t\tSTARTDISTANCE as short,\n\t\tWORKASSIGNMENT as long,\n\t\tUNITREF as string,\n\t\tTRAN_ID as string,\n\t\tLOCTYPE as string,\n\t\tLOCID as string,\n\t\tLOCSLOT as string,\n\t\tOPSPOSID as string,\n\t\tUNLADENLOCTYPE as string,\n\t\tUNLADENLOCID as string,\n\t\tUNLADENLOCSLOT as string,\n\t\tLADENLOCTYPE as string,\n\t\tLADENLOCID as string,\n\t\tLADEN_LOCSLOT as string,\n\t\tLASTESTMOVETIME as string,\n\t\tOPERATOR_NAME as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'sgtd',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(dropRight(TIMESTAMP, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),\n    toTimestamp(concat(substring(TIMESTAMP, 1, 22), ' ', substring(TIMESTAMP, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),\n    toTimestamp(TIMESTAMP, 'MM/dd/yyyy HH:mm:ss'),\n    toTimestamp(TIMESTAMP, 'dd-MM-yy HH:mm:ss'),\n    toTimestamp(TIMESTAMP, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\n    toTimestamp(TIMESTAMP, 'yyyy-MM-dd HH:mm:ss.SSS'),\n    toTimestamp(TIMESTAMP, 'dd/MM/yyyy HH:mm:ss'),\n    toTimestamp(TIMESTAMP, 'dd-MM-yyyy HH:mm:ss')\n),\n\t\tecEventGkey = toLong(ECEVENTGKEY),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(dropRight(TIMESTAMP, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),\n    toTimestamp(concat(substring(TIMESTAMP, 1, 22), ' ', substring(TIMESTAMP, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),\n    toTimestamp(TIMESTAMP, 'MM/dd/yyyy HH:mm:ss'),\n    toTimestamp(TIMESTAMP, 'dd-MM-yy HH:mm:ss'),\n    toTimestamp(TIMESTAMP, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\n    toTimestamp(TIMESTAMP, 'yyyy-MM-dd HH:mm:ss.SSS'),\n    toTimestamp(TIMESTAMP, 'dd/MM/yyyy HH:mm:ss'),\n    toTimestamp(TIMESTAMP, 'dd-MM-yyyy HH:mm:ss')\n))),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(dropRight(TIMESTAMP, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),\n    toTimestamp(concat(substring(TIMESTAMP, 1, 22), ' ', substring(TIMESTAMP, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),\n    toTimestamp(TIMESTAMP, 'MM/dd/yyyy HH:mm:ss'),\n    toTimestamp(TIMESTAMP, 'dd-MM-yy HH:mm:ss'),\n    toTimestamp(TIMESTAMP, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\n    toTimestamp(TIMESTAMP, 'yyyy-MM-dd HH:mm:ss.SSS'),\n    toTimestamp(TIMESTAMP, 'dd/MM/yyyy HH:mm:ss'),\n    toTimestamp(TIMESTAMP, 'dd-MM-yyyy HH:mm:ss')\n))),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(dropRight(TIMESTAMP, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),\n    toTimestamp(concat(substring(TIMESTAMP, 1, 22), ' ', substring(TIMESTAMP, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),\n    toTimestamp(TIMESTAMP, 'MM/dd/yyyy HH:mm:ss'),\n    toTimestamp(TIMESTAMP, 'dd-MM-yy HH:mm:ss'),\n    toTimestamp(TIMESTAMP, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\n    toTimestamp(TIMESTAMP, 'yyyy-MM-dd HH:mm:ss.SSS'),\n    toTimestamp(TIMESTAMP, 'dd/MM/yyyy HH:mm:ss'),\n    toTimestamp(TIMESTAMP, 'dd-MM-yyyy HH:mm:ss')\n)))) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey = DataTypeConversion@ecEventGkey,\n\t\tyardGkey = YARDGKEY,\n\t\tYardID = YARDID,\n\t\tFcyID = FCYID,\n\t\tcheKind = CHEKIND,\n\t\tCHE_Name = CHE_NAME,\n\t\tcheID,\n\t\teventType = EVENTTYPE,\n\t\teventSubType = EVENTSUBTYPE,\n\t\teventTypeDescription = EVENTTYPEDESCRIPTION,\n\t\tfromCheIdName = FROMCHEIDNAME,\n\t\tToCheIdName = TOCHEIDNAME,\n\t\tunit = UNIT,\n\t\tpow = POW,\n\t\tpool = POOL,\n\t\tworkQueue = WORKQUEUE,\n\t\ttravelDistance = TRAVELDISTANCE,\n\t\tmoveKind = MOVEKIND,\n\t\tisTwin = ISTWIN,\n\t\tstartDistance = STARTDISTANCE,\n\t\tworkAssignment = WORKASSIGNMENT,\n\t\tunitRef = UNITREF,\n\t\ttran_ID = TRAN_ID,\n\t\tlocType = LOCTYPE,\n\t\tlocID = LOCID,\n\t\tlocSlot = LOCSLOT,\n\t\topsPosID = OPSPOSID,\n\t\tunladenLocType = UNLADENLOCTYPE,\n\t\tunladenLocID = UNLADENLOCID,\n\t\tunladenLocSlot = UNLADENLOCSLOT,\n\t\tladenLocType = LADENLOCTYPE,\n\t\tladenLocID = LADENLOCID,\n\t\tladen_LocSlot = LADEN_LOCSLOT,\n\t\tlastEstMoveTime = LASTESTMOVETIME,\n\t\toperator_name = OPERATOR_NAME,\n\t\tEcEventTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false() && not(isNull(Year)) && not(isNull(Month))) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as integer,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as boolean,\n\t\tToCheIdName as boolean,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignment as long,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tEcEventTime as timestamp,\n\t\tcheID as long,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\toperator_name as string\n\t),\n\tformat: 'delta',\n\tfileSystem: 'sgtd',\n\tfolderPath: 'silver/ecevents_v2',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: false,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
		}
	}
}