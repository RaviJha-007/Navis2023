{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"workspaceName": {
			"type": "string",
			"metadata": "Workspace name",
			"defaultValue": "navispowerbidata2"
		},
		"linkedService1_accountKey": {
			"type": "secureString",
			"metadata": "Secure string for 'accountKey' of 'linkedService1'"
		},
		"linkedService2_accountKey": {
			"type": "secureString",
			"metadata": "Secure string for 'accountKey' of 'linkedService2'"
		},
		"navispowerbidata-WorkspaceDefaultSqlServer_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'navispowerbidata-WorkspaceDefaultSqlServer'",
			"defaultValue": "Integrated Security=False;Encrypt=True;Connection Timeout=30;Data Source=tcp:navispowerbidata.sql.azuresynapse.net,1433;Initial Catalog=@{linkedService().DBName}"
		},
		"navispowerbidata2-WorkspaceDefaultSqlServer_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'navispowerbidata2-WorkspaceDefaultSqlServer'",
			"defaultValue": "Integrated Security=False;Encrypt=True;Connection Timeout=30;Data Source=tcp:navispowerbidata2.sql.azuresynapse.net,1433;Initial Catalog=@{linkedService().DBName}"
		},
		"powerbianalyticsdata-WorkspaceDefaultSqlServer_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'powerbianalyticsdata-WorkspaceDefaultSqlServer'",
			"defaultValue": "Integrated Security=False;Encrypt=True;Connection Timeout=30;Data Source=tcp:powerbianalyticsdata.sql.azuresynapse.net,1433;Initial Catalog=@{linkedService().DBName}"
		},
		"linkedService1_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://navispowerbidatastorage2.dfs.core.windows.net/"
		},
		"linkedService2_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://navispowerbidatastorage2.dfs.core.windows.net/"
		},
		"navispowerbidata2-WorkspaceDefaultStorage_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://navispowerbidatastorage2.dfs.core.windows.net"
		},
		"powerbianalyticsdata-WorkspaceDefaultStorage_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://navispowerbidatastorage2.dfs.core.windows.net/"
		},
		"Trigger 1_properties_typeProperties_scope": {
			"type": "string",
			"defaultValue": "/subscriptions/095c0f82-6a29-4db3-9f53-6808ff55fa13/resourceGroups/NavisBIAnalyticsPowerBiData2/providers/Microsoft.Storage/storageAccounts/navispowerbidatastorage2"
		},
		"sc_trigger_properties_typeProperties_scope": {
			"type": "string",
			"defaultValue": "/subscriptions/095c0f82-6a29-4db3-9f53-6808ff55fa13/resourceGroups/NavisBIAnalyticsPowerBiData2/providers/Microsoft.Storage/storageAccounts/navispowerbidatastorage2"
		},
		"sc_trigger_agct_properties_typeProperties_scope": {
			"type": "string",
			"defaultValue": "/subscriptions/095c0f82-6a29-4db3-9f53-6808ff55fa13/resourceGroups/NavisBIAnalyticsPowerBiData2/providers/Microsoft.Storage/storageAccounts/navispowerbidatastorage2"
		},
		"sc_trigger_cmsa_properties_typeProperties_scope": {
			"type": "string",
			"defaultValue": "/subscriptions/095c0f82-6a29-4db3-9f53-6808ff55fa13/resourceGroups/NavisBIAnalyticsPowerBiData2/providers/Microsoft.Storage/storageAccounts/navispowerbidatastorage2"
		},
		"sc_trigger_dpw_peru_properties_typeProperties_scope": {
			"type": "string",
			"defaultValue": "/subscriptions/095c0f82-6a29-4db3-9f53-6808ff55fa13/resourceGroups/NavisBIAnalyticsPowerBiData2/providers/Microsoft.Storage/storageAccounts/navispowerbidatastorage2"
		},
		"sc_trigger_mict_properties_typeProperties_scope": {
			"type": "string",
			"defaultValue": "/subscriptions/095c0f82-6a29-4db3-9f53-6808ff55fa13/resourceGroups/NavisBIAnalyticsPowerBiData2/providers/Microsoft.Storage/storageAccounts/navispowerbidatastorage2"
		},
		"sc_trigger_mnhpi_properties_typeProperties_scope": {
			"type": "string",
			"defaultValue": "/subscriptions/095c0f82-6a29-4db3-9f53-6808ff55fa13/resourceGroups/NavisBIAnalyticsPowerBiData2/providers/Microsoft.Storage/storageAccounts/navispowerbidatastorage2"
		},
		"sc_trigger_rio_properties_typeProperties_scope": {
			"type": "string",
			"defaultValue": "/subscriptions/095c0f82-6a29-4db3-9f53-6808ff55fa13/resourceGroups/NavisBIAnalyticsPowerBiData2/providers/Microsoft.Storage/storageAccounts/navispowerbidatastorage2"
		},
		"sc_trigger_sgtd_properties_typeProperties_scope": {
			"type": "string",
			"defaultValue": "/subscriptions/095c0f82-6a29-4db3-9f53-6808ff55fa13/resourceGroups/NavisBIAnalyticsPowerBiData2/providers/Microsoft.Storage/storageAccounts/navispowerbidatastorage2"
		},
		"tauranga_times_properties_typeProperties_scope": {
			"type": "string",
			"defaultValue": "/subscriptions/095c0f82-6a29-4db3-9f53-6808ff55fa13/resourceGroups/NavisBIAnalyticsPowerBiData2/providers/Microsoft.Storage/storageAccounts/navispowerbidatastorage2"
		},
		"Sc_trigger_CGSA_properties_typeProperties_scope": {
			"type": "string",
			"defaultValue": "/subscriptions/095c0f82-6a29-4db3-9f53-6808ff55fa13/resourceGroups/NavisBIAnalyticsPowerBiData2/providers/Microsoft.Storage/storageAccounts/navispowerbidatastorage2"
		}
	},
	"variables": {
		"workspaceId": "[concat('Microsoft.Synapse/workspaces/', parameters('workspaceName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('workspaceName'), '/AGCT_conformities')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "stack_confirmity_AGCT",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "stack_confirmity_AGCT",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"StackConfirmity": {},
									"StackConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "section_confirmity_AGCT",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "stack_confirmity_AGCT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "section_confirmity_AGCT",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"SectionConfirmity": {},
									"SectionConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/stack_confirmity_AGCT')]",
				"[concat(variables('workspaceId'), '/dataflows/section_confirmity_AGCT')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Adhoc')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "jobstepping_mict",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "jobstepping_mict",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": [],
				"lastPublishTime": "2022-01-19T15:42:35Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/jobstepping_mict')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ApmtAqaba')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "EcEvents_aqaba",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_aqaba",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "MoveSrc_aqaba",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_aqaba",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_aqaba",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"source2": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "VesselVisits_aqaba",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_aqaba",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "VesselVisits_aqaba",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_aqaba",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "VesselVisits_aqaba",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_aqaba",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "QC_Idle_Time_aqaba",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Dual Cycling_aqaba",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "QC_Idle_Time_aqaba",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Rehandle_within_Vessel_aqaba",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "QC_Idle_Time_aqaba",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_within_Vessel_aqaba",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"source2": {},
									"source3": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "TTWaitTime_aqaba",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Rehandle_within_Vessel_aqaba",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "TTWaitTime_aqaba",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_aqaba')]",
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_aqaba')]",
				"[concat(variables('workspaceId'), '/dataflows/VesselVisits_aqaba')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_aqaba')]",
				"[concat(variables('workspaceId'), '/dataflows/QC_Idle_Time_aqaba')]",
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_within_Vessel_aqaba')]",
				"[concat(variables('workspaceId'), '/dataflows/TTWaitTime_aqaba')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/CGSA_confirmities')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "stack_confirmity_CGSA",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "stack_confirmity_CGSA",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"StackConfirmity": {},
									"StackConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "section_confirmity_CGSA",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "stack_confirmity_CGSA",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "section_confirmity_CGSA",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"SectionConfirmity": {},
									"SectionConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/stack_confirmity_CGSA')]",
				"[concat(variables('workspaceId'), '/dataflows/section_confirmity_CGSA')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/CGSA_moves')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Dual Cycling_cgsa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_cgsa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_cgsa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Rehandle_cgsa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_cgsa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_cgsa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "MoveSrc_cgsa",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_cgsa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_cgsa')]",
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_cgsa')]",
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_cgsa')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/CIT_Ivory_Coast_stack_confirmity')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "stack_confirmity_CIT_Ivory_Coast",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "stack_confirmity_CIT_Ivory_Coast",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"StackConfirmity": {},
									"StackConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/stack_confirmity_CIT_Ivory_Coast')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/CMATK_JobStepping')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "EcEvents_CMATK",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_CMATK",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Jobstepping_CMATK",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_CMATK",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "jobstepping_CMATK",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"xpseceuser": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_CMATK')]",
				"[concat(variables('workspaceId'), '/dataflows/jobstepping_CMATK')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/CMATK_Move_Rehandle')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "MoveSrc_CMATK",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_CMATK",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Rehandle_CMATK",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_CMATK",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_CMATK",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_CMATK')]",
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_CMATK')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/CMATK_Violations')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Violations_CMATK",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "violations_CMATK",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"DeckingHistory": {},
									"XpsEcUser": {},
									"violation": {},
									"decking": {},
									"move": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/violations_CMATK')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/CMATK_conformities')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "stack_confirmity_CMATK",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "stack_confirmity_CMATK",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"StackConfirmity": {},
									"StackConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "section_confirmity_CMATK",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "stack_confirmity_CMATK",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "section_confirmity_CMATK",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"SectionConfirmity": {},
									"SectionConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/stack_confirmity_CMATK')]",
				"[concat(variables('workspaceId'), '/dataflows/section_confirmity_CMATK')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/CMSA_rtg_violations')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Moves_CMSA",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Moves_CMSA",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Decking_CMSA",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Decking_CMSA",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/Moves_CMSA')]",
				"[concat(variables('workspaceId'), '/dataflows/Decking_CMSA')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/CMSA_stack_confirmity')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "stack_confirmity_CMSA",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "stack_confirmity_CMSA",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"StackConfirmity": {},
									"StackConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/stack_confirmity_CMSA')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/CWIT_stack_confirmity')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "stack_confirmity_CWIT",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "stack_confirmity_CWIT",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"StackConfirmity": {},
									"StackConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "stack_confirmity_new_CWIT",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "stack_confirmity_new_CWIT",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"StackConfirmity": {},
									"StackConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/stack_confirmity_CWIT')]",
				"[concat(variables('workspaceId'), '/dataflows/stack_confirmity_new_CWIT')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/DPW_LG_stack_confirmity')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "stack_confirmity_DPW_LG",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "stack_confirmity_DPW_LG",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"StackConfirmity": {},
									"StackConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/stack_confirmity_DPW_LG')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/DPW_peru_stack_confirmity')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "stack_confirmity_DPW_peru",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "stack_confirmity_DPW_peru",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"StackConfirmity": {},
									"StackConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/stack_confirmity_DPW_peru')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Eurogate_CTB')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Dual Cycling_SC",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "VesselVisits",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "1.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_SC",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'eurogatectb'"
								},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "QC Idle TIme",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "General Housekeeping_CTB",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "1.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "QC_Idle_Time_CTB",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "MoveSrc_CTB",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_CTB",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "1.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_CTB",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"source2": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "EcEvents_CTB",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "1.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_CTB",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "VesselVisits",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_CTB",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "1.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "VesselVisits_CTB",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "GMPH_CTB",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "FailToDeck_CTB",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "1.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "GMPH_CTB",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"source2": {},
									"source3": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Straddle_Prod",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "GMPH_CTB",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "1.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Straddle_Prod",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {},
									"sink2": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Laden_Unladen_SC",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Straddle_Prod",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "1.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Laden_Unladen_SC",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"source2": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "FailToDeck_CTB",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "QC Idle TIme",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "FailToDeck_CTB",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'eurogatectb'"
								},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "General Housekeeping_CTB",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Dual Cycling_SC",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "General Housekeeping_CTB",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'eurogatectb'"
								},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"parameters": {
					"customer": {
						"type": "string",
						"defaultValue": "eurogatectb"
					}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_SC')]",
				"[concat(variables('workspaceId'), '/dataflows/QC_Idle_Time_CTB')]",
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_CTB')]",
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_CTB')]",
				"[concat(variables('workspaceId'), '/dataflows/VesselVisits_CTB')]",
				"[concat(variables('workspaceId'), '/dataflows/GMPH_CTB')]",
				"[concat(variables('workspaceId'), '/dataflows/Straddle_Prod')]",
				"[concat(variables('workspaceId'), '/dataflows/Laden_Unladen_SC')]",
				"[concat(variables('workspaceId'), '/dataflows/FailToDeck_CTB')]",
				"[concat(variables('workspaceId'), '/dataflows/General Housekeeping_CTB')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/GPA')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "violations_gpa",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "violations_gpa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"DeckingHistory": {},
									"XpsEcUser": {},
									"violation": {},
									"decking": {},
									"move": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/violations_gpa')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/GPATruckTurnTime')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "TrkVstStg_gpa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "FailToDeck_gpa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "TrkVstStg_gpa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Coarse"
						}
					},
					{
						"name": "FailToDeck_gpa",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "FailToDeck_gpa",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'gpa'"
								},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/TrkVstStg_gpa')]",
				"[concat(variables('workspaceId'), '/dataflows/FailToDeck_gpa')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/GPA_AllDataFlow')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "EcEvents_gpa",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_gpa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "MoveSrc_gpa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_gpa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_gpa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "VesselVisits_gpa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_gpa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "VesselVisits_gpa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "QC_Idle_Time_gpa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "FailToDeck_MTY_gpa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "QC_Idle_Time_gpa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "RTG EcEvents_gpa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "QC_Idle_Time_gpa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "RTG EcEvents_gpa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"RTG": {},
									"workhours": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "ITV EcEvents_gpa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "RTG EcEvents_gpa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "ITV EcEvents_gpa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"ITV": {},
									"workhours": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "FailToDeck_gpa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "VesselVisits_gpa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "FailToDeck_gpa",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'gpa'"
								},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Laden_Unladen_fromMoves_gpa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "ITV EcEvents_gpa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Laden_Unladen_fromMoves_gpa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"source2": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Rehandle_gpa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Laden_Unladen_fromMoves_gpa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_gpa",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'gpa'"
								},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "FailToDeck_MTY_gpa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "FailToDeck_gpa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "FailToDeck_MTY_gpa",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'valencia'"
								},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_gpa')]",
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_gpa')]",
				"[concat(variables('workspaceId'), '/dataflows/VesselVisits_gpa')]",
				"[concat(variables('workspaceId'), '/dataflows/QC_Idle_Time_gpa')]",
				"[concat(variables('workspaceId'), '/dataflows/RTG EcEvents_gpa')]",
				"[concat(variables('workspaceId'), '/dataflows/ITV EcEvents_gpa')]",
				"[concat(variables('workspaceId'), '/dataflows/FailToDeck_gpa')]",
				"[concat(variables('workspaceId'), '/dataflows/Laden_Unladen_fromMoves_gpa')]",
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_gpa')]",
				"[concat(variables('workspaceId'), '/dataflows/FailToDeck_MTY_gpa')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/GPA_VslVisits')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Process Vsl Visits only",
				"activities": [
					{
						"name": "VesselVisits_gpa",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "VesselVisits_gpa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "FailToDeck_gpa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "VesselVisits_gpa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "FailToDeck_gpa",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'gpa'"
								},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/VesselVisits_gpa')]",
				"[concat(variables('workspaceId'), '/dataflows/FailToDeck_gpa')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/GPA_Yard')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "YardInventory_gpa",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "YardInventory_gpa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"yardblock": {},
									"vsl": {},
									"invInYard": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/YardInventory_gpa')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/GPA_rdsc_cycle')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "EcEvents_railCycleTime_gpa",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_railCycleTime_gpa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"events": {},
									"rdscMoves": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_railCycleTime_gpa')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/GPA_rehandle')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Rehandle_export_gpa",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_export_gpa",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'gpa'"
								},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Rehandle_rdsc_export_gpa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Rehandle_export_gpa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_rdsc_export_gpa",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'gpa'"
								},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Rehandle_within_stack_rdsc_export_gpa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Rehandle_rdsc_export_gpa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_within_stack_rdsc_export_gpa",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'gpa'"
								},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Rehandle_within_stack_recv_export_gpa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Rehandle_within_stack_rdsc_export_gpa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_within_stack_recv_export_gpa",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'gpa'"
								},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_export_gpa')]",
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_rdsc_export_gpa')]",
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_within_stack_rdsc_export_gpa')]",
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_within_stack_recv_export_gpa')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/GTI')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "EcEvents",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "1.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_GTI",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'eurogatectb'"
								},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "MoveSrc",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "1.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_GTI",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'eurogatectb'"
								},
								"datasetParameters": {
									"CSV": {},
									"source2": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "VesselVisits",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "1.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "VesselVisits_GTI",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'eurogatectb'"
								},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "QC Idle TIme",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Dual Cycling_GTI",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "1.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "QC_Idle_Time_GTI",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'eurogatectb'"
								},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "TTViolation_gti",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "1.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "TTViolation_gti",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "CMPH_GTI",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "QC Idle TIme",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "1.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "CMPH_GTI",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "jobstepping_gti",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "TTViolation_gti",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "1.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "jobstepping_gti",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_GTI",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "VesselVisits",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "1.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_GTI",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": [],
				"lastPublishTime": "2022-01-06T13:02:35Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_GTI')]",
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_GTI')]",
				"[concat(variables('workspaceId'), '/dataflows/VesselVisits_GTI')]",
				"[concat(variables('workspaceId'), '/dataflows/QC_Idle_Time_GTI')]",
				"[concat(variables('workspaceId'), '/dataflows/TTViolation_gti')]",
				"[concat(variables('workspaceId'), '/dataflows/CMPH_GTI')]",
				"[concat(variables('workspaceId'), '/dataflows/jobstepping_gti')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_GTI')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MCT')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "MoveSrc_MCT",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_MCT",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink2": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "EcEvents_MCT",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_MCT",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_MCT",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_MCT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_MCT",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "ladenUnladen_MCT",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_MCT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "ladenUnladen_MCT",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"ecevents": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "SC_idle_time_MCT",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_MCT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "SC_idle_time_MCT",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"ecevents": {},
									"sink5": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "mct_moves_time_delta",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_MCT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "mct_moves_time_delta",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"mct": {},
									"LOAD": {},
									"DSCH": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_MCT')]",
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_MCT')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_MCT')]",
				"[concat(variables('workspaceId'), '/dataflows/ladenUnladen_MCT')]",
				"[concat(variables('workspaceId'), '/dataflows/SC_idle_time_MCT')]",
				"[concat(variables('workspaceId'), '/dataflows/mct_moves_time_delta')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MICT_JobExecution')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Refreshing the mict_moves_time_delta pipeline for JobExecution report.",
				"activities": [
					{
						"name": "MoveSrc_MICT",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_mict",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "mict_moves_time_delta",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_MICT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "mict_moves_time_delta",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"mict": {},
									"sink1": {},
									"sink2": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_mict')]",
				"[concat(variables('workspaceId'), '/dataflows/mict_moves_time_delta')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MICT_confirmities')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "section_confirmity_MICT",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "stack_confirmity_MICT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "section_confirmity_MICT",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"SectionConfirmity": {},
									"SectionConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "stack_confirmity_MICT",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "stack_confirmity_MICT",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"StackConfirmity": {},
									"StackConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/section_confirmity_MICT')]",
				"[concat(variables('workspaceId'), '/dataflows/stack_confirmity_MICT')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MICT_stack_confirmity')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "stack_confirmity_MICT",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "stack_confirmity_MICT",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"StackConfirmity": {},
									"StackConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/stack_confirmity_MICT')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MNHPI_confirmities')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "stack_confirmity_MNHPI",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "stack_confirmity_MNHPI",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"StackConfirmity": {},
									"StackConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "section_confirmity_MNHPI",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "stack_confirmity_MNHPI",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "section_confirmity_MNHPI",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"SectionConfirmity": {},
									"SectionConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/stack_confirmity_MNHPI')]",
				"[concat(variables('workspaceId'), '/dataflows/section_confirmity_MNHPI')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MNHPI_section_confirmity')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "section_confirmity_MNHPI",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "section_confirmity_MNHPI",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"SectionConfirmity": {},
									"SectionConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/section_confirmity_MNHPI')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Malta_stack_confirmity')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "stack_confirmity_Malta",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "stack_confirmity_Malta",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"StackConfirmity": {},
									"StackConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/stack_confirmity_Malta')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Mundra_CT02_stack_confirmity')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "stack_confirmity_Mundra_CT02",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "stack_confirmity_Mundra_CT02",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"StackConfirmity": {},
									"StackConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/stack_confirmity_Mundra_CT02')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Mundra_CT04_stack_confirmity')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "stack_confirmity_Mundra_CT04",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "stack_confirmity_Mundra_CT04",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"StackConfirmity": {},
									"StackConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/stack_confirmity_Mundra_CT04')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Onne')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "MoveSrc_Onne",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "1.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_Onne",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'gti'"
								},
								"datasetParameters": {
									"CSV": {},
									"source2": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "QC_Idle_Time_Onne",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_Onne",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "1.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "QC_Idle_Time_Onne",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'gti'"
								},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_Onne')]",
				"[concat(variables('workspaceId'), '/dataflows/QC_Idle_Time_Onne')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PTP')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Data flow1",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "1.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "RTG EcEvents",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"RTG": {},
									"workhours": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": [],
				"lastPublishTime": "2021-12-16T06:04:48Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/RTG EcEvents')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PTP_violations')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "violations_ptp",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "violations_ptp",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"DeckingHistory": {},
									"violation": {},
									"decking": {},
									"move": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/violations_ptp')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RIO_confirmities')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "section_confirmity_RIO",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "stack_conformity_RIO",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "section_confirmity_RIO",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"SectionConfirmity": {},
									"SectionConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "stack_conformity_RIO",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "stack_conformity_RIO",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"StackConfirmity": {},
									"StackConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/section_confirmity_RIO')]",
				"[concat(variables('workspaceId'), '/dataflows/stack_conformity_RIO')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RemoveDuplicates')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "RemoveDuplicates",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "1.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "RemoveDuplicates",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"Delta": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": [],
				"lastPublishTime": "2021-11-24T21:36:16Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/RemoveDuplicates')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SGTD_dual_cycle_yard')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Dual Cycling_sgtd_yard",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_sgtd_yard",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"source2": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_sgtd_yard')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SGTD_stack_confirmity')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "stack_confirmity_SGTD_new",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "stack_confirmity_SGTD_new",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"StackConfirmity": {},
									"StackConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/stack_confirmity_SGTD_new')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Socar')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "EcEvents_socar",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_socar",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "MoveSrc_socar",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_socar",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink2": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "jobstepping_socar",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_socar",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "jobstepping_socar",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"xpseceuser": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "ladenUnladen_socar",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_socar",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "ladenUnladen_socar",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"ecevents": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_socar",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_socar",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_socar",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "socar_moves_time_delta",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_socar",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "socar_moves_time_delta",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"socar": {},
									"LOAD": {},
									"DSCH": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "TT_Productivity_socar",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_socar",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "TT_Productivity_socar",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_socar')]",
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_socar')]",
				"[concat(variables('workspaceId'), '/dataflows/jobstepping_socar')]",
				"[concat(variables('workspaceId'), '/dataflows/ladenUnladen_socar')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_socar')]",
				"[concat(variables('workspaceId'), '/dataflows/socar_moves_time_delta')]",
				"[concat(variables('workspaceId'), '/dataflows/TT_Productivity_socar')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TEAGTL_ecevents')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "jobstepping_TEAGTL",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_TEAGTL_new",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "jobstepping_TEAGTL",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"source2": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "EcEvents_TEAGTL_new",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_TEAGTL_new",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "ITV_Violations_TEAGTL",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_TEAGTL_new",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "ITV_Violations_TEAGTL",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"source2": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/jobstepping_TEAGTL')]",
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_TEAGTL_new')]",
				"[concat(variables('workspaceId'), '/dataflows/ITV_Violations_TEAGTL')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TEAGTL_moves')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "RTG_violations_teagtl",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_teagtl",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "RTG_violations_teagtl",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"DeckingHistory": {},
									"XpsEcUser": {},
									"violation": {},
									"decking": {},
									"move": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "MoveSrc_teagtl",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_teagtl",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_TEAGTL",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_teagtl",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_TEAGTL",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/RTG_violations_teagtl')]",
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_teagtl')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_TEAGTL')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TEAGTL_stack_confirmity')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "stack_confirmity_TEAGTL",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "stack_confirmity_TEAGTL",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"StackConfirmity": {},
									"StackConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/stack_confirmity_TEAGTL')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/VICT_confirmities')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "stack_confirmity_VICT",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "stack_confirmity_VICT",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"StackConfirmity": {},
									"StackConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "section_confirmity_VICT",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "stack_confirmity_VICT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "section_confirmity_VICT",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"SectionConfirmity": {},
									"SectionConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/stack_confirmity_VICT')]",
				"[concat(variables('workspaceId'), '/dataflows/section_confirmity_VICT')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Violations_CMATK')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Violations_CMATK",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "violations_CMATK",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"DeckingHistory": {},
									"XpsEcUser": {},
									"violation": {},
									"decking": {},
									"move": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/violations_CMATK')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/agct_rehandle')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Rehandle_new_agct",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_new_agct",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_new_agct')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/apmtaarhus')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Dual Cycling_aarhus",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Laden_Unladen_aarhus",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_aarhus",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "EcEvents_aarhus",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_aarhus",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Laden_Unladen_aarhus",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "QC_Idle_Time_aarhus",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Laden_Unladen_aarhus",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"source2": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "MoveSrc_aarhus",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_aarhus",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_aarhus",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"source2": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "QC_Idle_Time_aarhus",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "VesselVisits_aarhus",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "QC_Idle_Time_aarhus",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "VesselVisits_aarhus",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_aarhus",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "VesselVisits_aarhus",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_aarhus')]",
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_aarhus')]",
				"[concat(variables('workspaceId'), '/dataflows/Laden_Unladen_aarhus')]",
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_aarhus')]",
				"[concat(variables('workspaceId'), '/dataflows/QC_Idle_Time_aarhus')]",
				"[concat(variables('workspaceId'), '/dataflows/VesselVisits_aarhus')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/cgsa_ecevents')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "EcEvents_CGSA",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_CGSA",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "jobstepping_cgsa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_CGSA",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "jobstepping_cgsa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"xpseceuser": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_CGSA')]",
				"[concat(variables('workspaceId'), '/dataflows/jobstepping_cgsa')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/chcl_violations')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "violations_chcl",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "violations_chcl",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"DeckingHistory": {},
									"XpsEcUser": {},
									"violation": {},
									"decking": {},
									"move": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/violations_chcl')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/cmsa-violations')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "RTG_violations_CMSA",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "RTG_violations_CMSA",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"DeckingHistory": {},
									"XpsEcUser": {},
									"violation": {},
									"decking": {},
									"move": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/RTG_violations_CMSA')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/cmsa-violations_test_Dh6')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "cmsa_violations_test_DH6",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "cmsa_violations_test_DH6",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"deckingfile": {},
									"MoveHistory": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/cmsa_violations_test_DH6')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/cmsa')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "EcEvents_cmsa",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_cmsa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "MoveSrc_cmsa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_cmsa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_cmsa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"source2": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "VesselVisits_cmsa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_cmsa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "VesselVisits_cmsa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_cmsa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "VesselVisits_cmsa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_cmsa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "TTWaitTime_cmsa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Dual Cycling_cmsa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "TTWaitTime_cmsa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dwell_cmsa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "TTWaitTime_cmsa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dwell_cmsa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "ITV EcEvents_cmsa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Dwell_cmsa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "ITV EcEvents_cmsa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"ITV": {},
									"workhours": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "RTG EcEvents_cmsa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "ITV EcEvents_cmsa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "RTG EcEvents_cmsa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"RTG": {},
									"workhours": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "jobstepping_cmsa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "RTG EcEvents_cmsa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "jobstepping_cmsa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Rehandle_cmsa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "jobstepping_cmsa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_cmsa",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'cmsa'"
								},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Rehandle_within_Vessel_cmsa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Rehandle_cmsa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_within_Vessel_cmsa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"source2": {},
									"source3": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "QC_Idle_Time_cmsa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Rehandle_within_Vessel_cmsa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "QC_Idle_Time_cmsa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_cmsa')]",
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_cmsa')]",
				"[concat(variables('workspaceId'), '/dataflows/VesselVisits_cmsa')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_cmsa')]",
				"[concat(variables('workspaceId'), '/dataflows/TTWaitTime_cmsa')]",
				"[concat(variables('workspaceId'), '/dataflows/Dwell_cmsa')]",
				"[concat(variables('workspaceId'), '/dataflows/ITV EcEvents_cmsa')]",
				"[concat(variables('workspaceId'), '/dataflows/RTG EcEvents_cmsa')]",
				"[concat(variables('workspaceId'), '/dataflows/jobstepping_cmsa')]",
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_cmsa')]",
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_within_Vessel_cmsa')]",
				"[concat(variables('workspaceId'), '/dataflows/QC_Idle_Time_cmsa')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/cmsa_-violations-upto-merge')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "cmsa_violations__upto_merge",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "cmsa_violations__upto_merge",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"deckingfile": {},
									"MoveHistory": {},
									"DHSink": {},
									"MHSink": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/cmsa_violations__upto_merge')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/cmsa_ecevents')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "EcEvents_cmsa",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_cmsa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "jobstepping_cmsa_v2",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_cmsa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "jobstepping_cmsa_v2",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"xpseceuser": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_cmsa')]",
				"[concat(variables('workspaceId'), '/dataflows/jobstepping_cmsa_v2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/cmsa_failToDeck')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "FailToDeck_cmsa",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "FailToDeck_cmsa",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'cmsa'"
								},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/FailToDeck_cmsa')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/cmsa_moves')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Moves_CMSA",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Moves_CMSA",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Rehandle_new_cmsa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Moves_CMSA",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_new_cmsa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_cmsa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Moves_CMSA",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_cmsa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "RTG_violations_CMSA",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Moves_CMSA",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "RTG_violations_CMSA",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"DeckingHistory": {},
									"XpsEcUser": {},
									"violation": {},
									"decking": {},
									"move": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": [],
				"lastPublishTime": "2023-05-25T03:09:56Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/Moves_CMSA')]",
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_new_cmsa')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_cmsa')]",
				"[concat(variables('workspaceId'), '/dataflows/RTG_violations_CMSA')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/cmsa_moves_copy1')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Rehandle_new_cmsa",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_new_cmsa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_new_cmsa')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/cwit_moves')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "MoveSrc_CWIT",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_CWIT",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "TT_Productivity_CWIT",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_CWIT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "TT_Productivity_CWIT",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_CWIT_new",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_CWIT",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_CWIT_new",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_CWIT')]",
				"[concat(variables('workspaceId'), '/dataflows/TT_Productivity_CWIT')]",
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_CWIT_new')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/delete_pipeline_mnhpi')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "delete_flow_mnhpi",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "delete_flow_mnhpi",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"violation": {},
									"moves": {},
									"decking": {},
									"rehandle": {},
									"ttprod": {},
									"movesrc": {},
									"sink1": {},
									"sink2": {},
									"sink3": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/delete_flow_mnhpi')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/dpw-lg')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Dual Cycling_dpw_lg",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_dpw_lg",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_dpw_lg",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "MoveSrc_dpw_lg",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_dpw_lg",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "EcEvents_dpw_lg",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_dpw_lg",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "ladenUnladen_dpw_lg",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_dpw_lg",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "ladenUnladen_dpw_lg",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"ecevents": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_dpw_lg')]",
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_dpw_lg')]",
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_dpw_lg')]",
				"[concat(variables('workspaceId'), '/dataflows/ladenUnladen_dpw_lg')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/dpw_peru_ecevents')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "jobstepping_dpw_peru",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_dpw_peru_new",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "jobstepping_dpw_peru",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"xpseceuser": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "EcEvents_dpw_peru_new",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_dpw_peru_new",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "ladenUnladen_dpw_peru",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_dpw_peru_new",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "ladenUnladen_dpw_peru",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"ecevents": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/jobstepping_dpw_peru')]",
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_dpw_peru_new')]",
				"[concat(variables('workspaceId'), '/dataflows/ladenUnladen_dpw_peru')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/dpw_peru_moves')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Dual Cycling_dpw_peru",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_dpw_peru",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_dpw_peru",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "TT_Productivity_dpw_peru",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_dpw_peru",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "TT_Productivity_dpw_peru",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "dpw_peru_moves_time_delta",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_dpw_peru",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "dpw_peru_moves_time_delta",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"dpw": {},
									"sink1": {},
									"sink2": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "MoveSrc_dpw_peru",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_dpw_peru",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_dpw_peru')]",
				"[concat(variables('workspaceId'), '/dataflows/TT_Productivity_dpw_peru')]",
				"[concat(variables('workspaceId'), '/dataflows/dpw_peru_moves_time_delta')]",
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_dpw_peru')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/dpw_peru_violations')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "violations_DPW_peru",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "violations_DPW_peru",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"DeckingHistory": {},
									"ShiftData": {},
									"ShiftInfo": {},
									"XpsEcUser": {},
									"violation": {},
									"decking": {},
									"move": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/violations_DPW_peru')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ennore_ecevents')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "EcEvents_Ennore",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_Ennore",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "jobstepping_ennore",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_Ennore",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "jobstepping_ennore",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "ladenUnladen_ennore",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_Ennore",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "ladenUnladen_ennore",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"ecevents": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_Ennore')]",
				"[concat(variables('workspaceId'), '/dataflows/jobstepping_ennore')]",
				"[concat(variables('workspaceId'), '/dataflows/ladenUnladen_ennore')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ennore_moves')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "MoveSrc_Ennore",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_Ennore",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_Ennore",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_Ennore",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_Ennore",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_Ennore')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_Ennore')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/haifa')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "MoveSrc_haifa",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_haifa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"source2": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "EcEvents_haifa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_haifa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_haifa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "VesselVisits_haifa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_haifa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "VesselVisits_haifa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "QC_Idle_Time_haifa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "VesselVisits_haifa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "QC_Idle_Time_haifa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_haifa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "QC_Idle_Time_haifa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_haifa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Laden_Unladen_haifa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Dual Cycling_haifa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Laden_Unladen_haifa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"source2": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "ITV EcEvents_haifa",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Laden_Unladen_haifa",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "ITV EcEvents_haifa",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"ITV": {},
									"workhours": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_haifa')]",
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_haifa')]",
				"[concat(variables('workspaceId'), '/dataflows/VesselVisits_haifa')]",
				"[concat(variables('workspaceId'), '/dataflows/QC_Idle_Time_haifa')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_haifa')]",
				"[concat(variables('workspaceId'), '/dataflows/Laden_Unladen_haifa')]",
				"[concat(variables('workspaceId'), '/dataflows/ITV EcEvents_haifa')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/hazira_conformities')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "stack_confirmity_hazira",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "stack_confirmity_hazira",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"StackConfirmity": {},
									"StackConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "section_confirmity_hazira",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "stack_confirmity_hazira",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "section_confirmity_hazira",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"SectionConfirmity": {},
									"SectionConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/stack_confirmity_hazira')]",
				"[concat(variables('workspaceId'), '/dataflows/section_confirmity_hazira')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/hazira_ecevents')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "jobstepping_hazira",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_hazira",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "jobstepping_hazira",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "EcEvents_hazira",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_hazira",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "ladenUnladen_hazira",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_hazira",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "ladenUnladen_hazira",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"ecevents": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/jobstepping_hazira')]",
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_hazira')]",
				"[concat(variables('workspaceId'), '/dataflows/ladenUnladen_hazira')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/hazira_moves')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "hazira_moves_time_delta",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_hazira",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "hazira_moves_time_delta",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"hazira": {},
									"sink1": {},
									"sink2": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "TT_Productivity_hazira",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_hazira",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "TT_Productivity_hazira",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_hazira",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_hazira",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_hazira",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "MoveSrc_hazira",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_hazira",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine",
							"continuationSettings": {
								"customizedCheckpointKey": "e2483d7c-639d-4bfd-8bbd-75cdca2e7d74"
							}
						}
					},
					{
						"name": "violations_hazira",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_hazira",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "violations_hazira",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"DeckingHistory": {},
									"XpsEcUser": {},
									"violation": {},
									"decking": {},
									"move": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/hazira_moves_time_delta')]",
				"[concat(variables('workspaceId'), '/dataflows/TT_Productivity_hazira')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_hazira')]",
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_hazira')]",
				"[concat(variables('workspaceId'), '/dataflows/violations_hazira')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/kattupalli_ecevents')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "EcEvents_kattupalli",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_kattupalli",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "jobstepping_kattupalli",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_kattupalli",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "jobstepping_kattupalli",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "ladenUnladen_kattupalli",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_kattupalli",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "ladenUnladen_kattupalli",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"ecevents": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_kattupalli')]",
				"[concat(variables('workspaceId'), '/dataflows/jobstepping_kattupalli')]",
				"[concat(variables('workspaceId'), '/dataflows/ladenUnladen_kattupalli')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/kattupalli_moves')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "MoveSrc_kattupalli",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_kattupalli",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_kattupalli",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_kattupalli",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_kattupalli",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_kattupalli')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_kattupalli')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/kssp')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "QC_Idle_Time_kssp",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_kssp",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "QC_Idle_Time_kssp",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "MoveSrc_kssp",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_kssp",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"source2": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "EcEvents_kssp",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_kssp",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'kssp'"
								},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "TTViolation_kssp",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_kssp",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "TTViolation_kssp",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "jobstepping_kssp",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "TTViolation_kssp",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "jobstepping_kssp",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_kssp",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "QC_Idle_Time_kssp",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_kssp",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Laden_Unladen_kssp",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Dual Cycling_kssp",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Laden_Unladen_kssp",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "ITV EcEvents_kssp",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "jobstepping_kssp",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "ITV EcEvents_kssp",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"ITV": {},
									"workhours": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/QC_Idle_Time_kssp')]",
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_kssp')]",
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_kssp')]",
				"[concat(variables('workspaceId'), '/dataflows/TTViolation_kssp')]",
				"[concat(variables('workspaceId'), '/dataflows/jobstepping_kssp')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_kssp')]",
				"[concat(variables('workspaceId'), '/dataflows/Laden_Unladen_kssp')]",
				"[concat(variables('workspaceId'), '/dataflows/ITV EcEvents_kssp')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/malta')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "ladenUnladen_malta",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_malta",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "ladenUnladen_malta",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"ecevents": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "EcEvents_malta",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_malta",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "MoveSrc_malta",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_malta",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink2": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_malta",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_malta",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_malta",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "malta_moves_time_delta",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_malta",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "malta_moves_time_delta",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"malta": {},
									"LOAD": {},
									"DSCH": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "jobstepping_malta",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_malta",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "jobstepping_malta",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"xpseceuser": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/ladenUnladen_malta')]",
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_malta')]",
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_malta')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_malta')]",
				"[concat(variables('workspaceId'), '/dataflows/malta_moves_time_delta')]",
				"[concat(variables('workspaceId'), '/dataflows/jobstepping_malta')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/malta_violations')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "jobstepping_malta",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "jobstepping_malta",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"xpseceuser": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/jobstepping_malta')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/mict')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "EcEvents_mict",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_mict",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "ladenUnladen_mict",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "ladenUnladen_mict",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"ecevents": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_mict')]",
				"[concat(variables('workspaceId'), '/dataflows/ladenUnladen_mict')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/mict_ecevents_RTG')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "RTG EcEvents_mict",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "RTG EcEvents_mict",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"RTG": {},
									"Workhours": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/RTG EcEvents_mict')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/mict_moves')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "TT_Productivity_mict",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_mict",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "TT_Productivity_mict",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "MoveSrc_mict",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_mict",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_mict",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_mict",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_mict",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "mict_moves_time_delta",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_mict",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "mict_moves_time_delta",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"mict": {},
									"sink1": {},
									"sink2": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Rehandle_new_mict",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_mict",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_new_mict",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "violations_mict",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_mict",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "violations_mict",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"DeckingHistory": {},
									"ShiftData": {},
									"ShiftInfo": {},
									"XpsEcUser": {},
									"violation": {},
									"decking": {},
									"move": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/TT_Productivity_mict')]",
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_mict')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_mict')]",
				"[concat(variables('workspaceId'), '/dataflows/mict_moves_time_delta')]",
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_new_mict')]",
				"[concat(variables('workspaceId'), '/dataflows/violations_mict')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/mict_rehandle')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Rehandle_new_mict",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_new_mict",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_new_mict')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/mict_violations')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "violations_mict",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "violations_mict",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"DeckingHistory": {},
									"ShiftData": {},
									"ShiftInfo": {},
									"XpsEcUser": {},
									"violation": {},
									"decking": {},
									"move": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/violations_mict')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/mnhpi')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Manila North Harbor Port Inc",
				"activities": [
					{
						"name": "EcEvents_mnhpi",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_mnhpi",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "MoveSrc_mnhpi",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_mnhpi",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_mnhpi",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "VesselVisits_mnhpi",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_mnhpi",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "VesselVisits_mnhpi",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_mnhpi",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "VesselVisits_mnhpi",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_mnhpi",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "TTWaitTime_mnhpi",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "QC_Idle_Time_mnhpi",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "TTWaitTime_mnhpi",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dwell_mnhpi",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "TTWaitTime_mnhpi",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dwell_mnhpi",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "ITV EcEvents_mnhpi",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Dwell_mnhpi",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "ITV EcEvents_mnhpi",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"ITV": {},
									"workhours": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "RTG EcEvents_mnhpi",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "ITV EcEvents_mnhpi",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "RTG EcEvents_mnhpi",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"RTG": {},
									"workhours": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "jobstepping_mnhpi",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "RTG EcEvents_mnhpi",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "jobstepping_mnhpi",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Rehandle_within_Vessel_mnhpi",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Rehandle_mnhpi",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_within_Vessel_mnhpi",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"source2": {},
									"source3": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Rehandle_mnhpi",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "jobstepping_mnhpi",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_mnhpi",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'cmsa'"
								},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "QC_Idle_Time_mnhpi",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Dual Cycling_mnhpi",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "QC_Idle_Time_mnhpi",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_mnhpi')]",
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_mnhpi')]",
				"[concat(variables('workspaceId'), '/dataflows/VesselVisits_mnhpi')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_mnhpi')]",
				"[concat(variables('workspaceId'), '/dataflows/TTWaitTime_mnhpi')]",
				"[concat(variables('workspaceId'), '/dataflows/Dwell_mnhpi')]",
				"[concat(variables('workspaceId'), '/dataflows/ITV EcEvents_mnhpi')]",
				"[concat(variables('workspaceId'), '/dataflows/RTG EcEvents_mnhpi')]",
				"[concat(variables('workspaceId'), '/dataflows/jobstepping_mnhpi')]",
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_within_Vessel_mnhpi')]",
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_mnhpi')]",
				"[concat(variables('workspaceId'), '/dataflows/QC_Idle_Time_mnhpi')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/mnhpi_moves')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Manila North Harbor Port Inc",
				"activities": [
					{
						"name": "MoveSrc_mnhpi",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_mnhpi",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "TT_Productivity_mnhpi",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_mnhpi",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "TT_Productivity_mnhpi",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Rehandle_new_mnhpi",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_mnhpi",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_new_mnhpi",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "violations_mnhpi",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_mnhpi",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "violations_mnhpi",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"DeckingHistory": {},
									"ShiftData": {},
									"ShiftInfo": {},
									"XpsEcUser": {},
									"violation": {},
									"decking": {},
									"move": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_mnhpi')]",
				"[concat(variables('workspaceId'), '/dataflows/TT_Productivity_mnhpi')]",
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_new_mnhpi')]",
				"[concat(variables('workspaceId'), '/dataflows/violations_mnhpi')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/mnhpi_rehandle')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Rehandle_new_mnhpi",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_new_mnhpi",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_new_mnhpi')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/mnhpi_tt_productivity')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "tt_productivity_mnhpi",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "TT_Productivity_mnhpi",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/TT_Productivity_mnhpi')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/mnhpi_violations')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "violations_mnhpi",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "violations_mnhpi",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"DeckingHistory": {},
									"ShiftData": {},
									"ShiftInfo": {},
									"XpsEcUser": {},
									"violation": {},
									"decking": {},
									"move": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/violations_mnhpi')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/mnhpi_yard_che_productivity')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Yard_che_productivity_mnhpi",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Yard_che_productivity_mnhpi",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/Yard_che_productivity_mnhpi')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/mundra_ct02_ecevents')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "EcEvents_mundra_ct02",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_mundra_ct02",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "ladenUnladen_mundra_ct02",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_mundra_ct02",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "ladenUnladen_mundra_ct02",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"ecevents": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_mundra_ct02')]",
				"[concat(variables('workspaceId'), '/dataflows/ladenUnladen_mundra_ct02')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/mundra_ct02_moves')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "MoveSrc_mundra_ct02",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_mundra_ct02",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_mundra_ct02",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_mundra_ct02",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_mundra_ct02",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_mundra_ct02')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_mundra_ct02')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/mundra_ct04_ecevents')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "EcEvents_mundra_ct04",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_mundra_ct04",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "ladenUnladen_mundra_ct04",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_mundra_ct04",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "ladenUnladen_mundra_ct04",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"ecevents": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_mundra_ct04')]",
				"[concat(variables('workspaceId'), '/dataflows/ladenUnladen_mundra_ct04')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/mundra_ct04_moves')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "MoveSrc_mundra_ct04",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_mundra_ct04",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_mundra_ct04",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_mundra_ct04",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_mundra_ct04",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_mundra_ct04')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_mundra_ct04')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/mundra_ct04_violations')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "violations_mundra_ct04",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "violations_mundra_ct04",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"DeckingHistory": {},
									"XpsEcUser": {},
									"violation": {},
									"decking": {},
									"move": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/violations_mundra_ct04')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/rio')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "EcEvents_rio",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_rio",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "MoveSrc_rio",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_rio",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_rio",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_rio",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_rio",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "rio_moves_time_delta",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_rio",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "rio_moves_time_delta",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"rio": {},
									"LOAD": {},
									"DSCH": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "jobstepping_rio",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_rio",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "jobstepping_rio",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"xpseceuser": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "ladenUnladen_rio",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_rio",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "ladenUnladen_rio",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"ecevents": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_rio')]",
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_rio')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_rio')]",
				"[concat(variables('workspaceId'), '/dataflows/rio_moves_time_delta')]",
				"[concat(variables('workspaceId'), '/dataflows/jobstepping_rio')]",
				"[concat(variables('workspaceId'), '/dataflows/ladenUnladen_rio')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/rio_violations')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "violations_rio",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "violations_rio",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"DeckingHistory": {},
									"ShiftData": {},
									"ShiftInfo": {},
									"XpsEcUser": {},
									"violation": {},
									"decking": {},
									"move": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/violations_rio')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/seayard_ecevents')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "EcEvents_seayard",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_seayard",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "SC_idle_time_seayard",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_seayard",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "SC_idle_time_seayard",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"ecevents": {},
									"sink5": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "SC_Productivity_seayard",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_seayard",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "SC_Productivity_seayard",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "SC_Productivity_seayard_new",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_seayard",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "SC_Productivity_seayard_new",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_seayard')]",
				"[concat(variables('workspaceId'), '/dataflows/SC_idle_time_seayard')]",
				"[concat(variables('workspaceId'), '/dataflows/SC_Productivity_seayard')]",
				"[concat(variables('workspaceId'), '/dataflows/SC_Productivity_seayard_new')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/seayard_moves')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Dual Cycling_seayard",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_seayard",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_seayard",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Rehandle_seayard",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_seayard",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_seayard",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "TT_Productivity_seayard",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_seayard",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "TT_Productivity_seayard",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "MoveSrc_seayard",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_seayard",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_seayard')]",
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_seayard')]",
				"[concat(variables('workspaceId'), '/dataflows/TT_Productivity_seayard')]",
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_seayard')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/sgtd')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Dual Cycling_sgtd",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_sgtd",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_sgtd",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "MoveSrc_sgtd",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_sgtd",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Rehandle_sgtd",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_sgtd",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_sgtd",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "violations_sgtd",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_sgtd",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "violations_sgtd",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"DeckingHistory": {},
									"ShiftData": {},
									"ShiftInfo": {},
									"XpsEcUser": {},
									"violation": {},
									"decking": {},
									"move": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "renomination_sgtd",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_sgtd",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "renomination_sgtd",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"source2": {},
									"RenominationHkDone": {},
									"RenominationHkNotDone": {},
									"RenominationLoadMoves": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_sgtd_yard",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_sgtd",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_sgtd_yard",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"source2": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "TT_Productivity_sgtd",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_sgtd",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "TT_Productivity_sgtd",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "sgtd_moves_time_delta_new",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_sgtd",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "sgtd_moves_time_delta_new",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"sgtd": {},
									"sink1": {},
									"sink2": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "EcEvents_sgtd_v2",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_sgtd_v2",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "jobstepping_sgtd_v2",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_sgtd_v2",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "jobstepping_sgtd_v2",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"source2": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "stack_confirmity_SGTD_new",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "stack_confirmity_SGTD_new",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"StackConfirmity": {},
									"StackConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_sgtd')]",
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_sgtd')]",
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_sgtd')]",
				"[concat(variables('workspaceId'), '/dataflows/violations_sgtd')]",
				"[concat(variables('workspaceId'), '/dataflows/renomination_sgtd')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_sgtd_yard')]",
				"[concat(variables('workspaceId'), '/dataflows/TT_Productivity_sgtd')]",
				"[concat(variables('workspaceId'), '/dataflows/sgtd_moves_time_delta_new')]",
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_sgtd_v2')]",
				"[concat(variables('workspaceId'), '/dataflows/jobstepping_sgtd_v2')]",
				"[concat(variables('workspaceId'), '/dataflows/stack_confirmity_SGTD_new')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/sgtd_delete')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "delete_flow_sgtd",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "delete_flow_sgtd",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"violation": {},
									"moves": {},
									"decking": {},
									"sink1": {},
									"sink2": {},
									"sink3": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "delete_flow_sgtd_ecevents",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "delete_flow_sgtd_ecevents",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"moves": {},
									"ecevents": {},
									"sink2": {},
									"sink3": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/delete_flow_sgtd')]",
				"[concat(variables('workspaceId'), '/dataflows/delete_flow_sgtd_ecevents')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/sgtd_ecevents')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "EcEvents_sgtd_v2",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_sgtd_v2",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "jobstepping_sgtd_v2",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_sgtd_v2",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "jobstepping_sgtd_v2",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"source2": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_sgtd_v2')]",
				"[concat(variables('workspaceId'), '/dataflows/jobstepping_sgtd_v2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/sgtd_renomination')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "renomination_sgtd",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "renomination_sgtd",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"source2": {},
									"RenominationHkDone": {},
									"RenominationHkNotDone": {},
									"RenominationLoadMoves": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/renomination_sgtd')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/sgtd_test')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Dual Cycling_sgtd",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_sgtd",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_sgtd",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "MoveSrc_sgtd",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_sgtd",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Rehandle_sgtd",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_sgtd",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_sgtd",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "violations_sgtd",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_sgtd",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "violations_sgtd",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"DeckingHistory": {},
									"ShiftData": {},
									"ShiftInfo": {},
									"XpsEcUser": {},
									"violation": {},
									"decking": {},
									"move": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "jobstepping_sgtd",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_sgtd",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "jobstepping_sgtd",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "EcEvents_sgtd",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_sgtd",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "stack_confirmity_SGTD",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_sgtd",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "stack_confirmity_SGTD",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"StackConfirmity": {},
									"StackConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_sgtd_yard",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_sgtd",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_sgtd_yard",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"source2": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_sgtd')]",
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_sgtd')]",
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_sgtd')]",
				"[concat(variables('workspaceId'), '/dataflows/violations_sgtd')]",
				"[concat(variables('workspaceId'), '/dataflows/jobstepping_sgtd')]",
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_sgtd')]",
				"[concat(variables('workspaceId'), '/dataflows/stack_confirmity_SGTD')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_sgtd_yard')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/sgtd_violations')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "violations_sgtd",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "violations_sgtd",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"DeckingHistory": {},
									"ShiftData": {},
									"ShiftInfo": {},
									"XpsEcUser": {},
									"violation": {},
									"decking": {},
									"move": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/violations_sgtd')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/tauranga')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "MoveSrc_tauranga",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_tauranga",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_tauranga",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_tauranga",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_tauranga",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "QC_Idle_Time_tauranga",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_tauranga",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "QC_Idle_Time_tauranga",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "TT_Productivity_tauranga",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_tauranga",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "TT_Productivity_tauranga",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "EcEvents_tauranga",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_tauranga",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "SC_laden_unladen_time_dist_tauranga",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_tauranga",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "SC_laden_unladen_time_dist_tauranga",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"ecevents": {},
									"sink1": {},
									"sink2": {},
									"sink3": {},
									"sink4": {},
									"sink5": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_tauranga')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_tauranga')]",
				"[concat(variables('workspaceId'), '/dataflows/QC_Idle_Time_tauranga')]",
				"[concat(variables('workspaceId'), '/dataflows/TT_Productivity_tauranga')]",
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_tauranga')]",
				"[concat(variables('workspaceId'), '/dataflows/SC_laden_unladen_time_dist_tauranga')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/tauranga_dist_times_sc')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "SC_laden_unladen_time_dist_tauranga",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_tauranga",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "SC_laden_unladen_time_dist_tauranga",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"ecevents": {},
									"sink1": {},
									"sink2": {},
									"sink3": {},
									"sink4": {},
									"sink5": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "EcEvents_tauranga",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_tauranga",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/SC_laden_unladen_time_dist_tauranga')]",
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_tauranga')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/tauranga_ecevents')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "EcEvents_tauranga",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_tauranga",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "SC_laden_unladen_time_dist_tauranga",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_tauranga",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "SC_laden_unladen_time_dist_tauranga",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"ecevents": {},
									"sink1": {},
									"sink2": {},
									"sink3": {},
									"sink4": {},
									"sink5": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_tauranga')]",
				"[concat(variables('workspaceId'), '/dataflows/SC_laden_unladen_time_dist_tauranga')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/tauranga_moves')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "MoveSrc_tauranga",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_tauranga",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_tauranga",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_tauranga",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_tauranga",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "QC_Idle_Time_tauranga",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_tauranga",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "QC_Idle_Time_tauranga",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "TT_Productivity_tauranga",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_tauranga",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "TT_Productivity_tauranga",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_tauranga')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_tauranga')]",
				"[concat(variables('workspaceId'), '/dataflows/QC_Idle_Time_tauranga')]",
				"[concat(variables('workspaceId'), '/dataflows/TT_Productivity_tauranga')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/tauranga_rehandle')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Rehandle_tauranga",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_tauranga",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"MoveHistory": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_tauranga')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/tauranga_times_sc')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "SC_load_dsch_tauranga_new",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_tauranga",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "SC_load_dsch_tauranga_new",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"ecevents": {},
									"sink1": {},
									"sink2": {},
									"sink3": {},
									"sink4": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "EcEvents_tauranga",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_tauranga",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/SC_load_dsch_tauranga_new')]",
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_tauranga')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/tdt')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "MoveSrc_tdt",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_tdt",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"source2": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "EcEvents_tdt",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_tdt",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_tdt",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "VesselVisits_tdt",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "EcEvents_tdt",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "VesselVisits_tdt",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "QC_Idle_Time_tdt",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "VesselVisits_tdt",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "QC_Idle_Time_tdt",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Dual Cycling_tdt",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "QC_Idle_Time_tdt",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_tdt",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Laden_Unladen_tdt",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Dual Cycling_tdt",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Laden_Unladen_tdt",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"source2": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "ITV EcEvents_tdt",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Laden_Unladen_tdt",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "ITV EcEvents_tdt",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"ITV": {},
									"workhours": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_tdt')]",
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_tdt')]",
				"[concat(variables('workspaceId'), '/dataflows/VesselVisits_tdt')]",
				"[concat(variables('workspaceId'), '/dataflows/QC_Idle_Time_tdt')]",
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_tdt')]",
				"[concat(variables('workspaceId'), '/dataflows/Laden_Unladen_tdt')]",
				"[concat(variables('workspaceId'), '/dataflows/ITV EcEvents_tdt')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/tdt_exportRehandle')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Rehandle_ufv_tdt",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Rehandle_export_tdt",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_ufv_tdt",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'tdt'"
								},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Rehandle_export_tdt",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Rehandle_export_tdt",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'tdt'"
								},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_ufv_tdt')]",
				"[concat(variables('workspaceId'), '/dataflows/Rehandle_export_tdt')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/tdt_moves')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "to process moves data alone",
				"activities": [
					{
						"name": "MoveSrc_tdt",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_tdt",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"source2": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_tdt')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/tp_angamos_moves')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Dual Cycling_tp_angamos",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_tp_angamos",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_tp_angamos",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "MoveSrc_tp_angamos",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_tp_angamos",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_tp_angamos')]",
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_tp_angamos')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/transnet_baseData')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "MoveSrc_transnet",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_transnet",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"vslvisit": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "EcEvents_transnet",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_transnet",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "EcEvents_transnet",
								"type": "DataFlowReference",
								"parameters": {
									"customer": "'transnet'"
								},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_transnet')]",
				"[concat(variables('workspaceId'), '/dataflows/EcEvents_transnet')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/transnet_silverLevel')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Dual Cycling_transnet",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_transnet",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "ITV EcEvents_transnet_ctct",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Dual Cycling_transnet",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "ITV EcEvents_transnet_ctct",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"ITV": {},
									"workhours": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "SC EcEvents_transnet_dct",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "ITV EcEvents_transnet_ctct",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "SC EcEvents_transnet_dct",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"SC": {},
									"workhours": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_transnet')]",
				"[concat(variables('workspaceId'), '/dataflows/ITV EcEvents_transnet_ctct')]",
				"[concat(variables('workspaceId'), '/dataflows/SC EcEvents_transnet_dct')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/vizingham_moves')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Dual Cycling_vizingham",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_vizingham",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "Dual Cycling_vizingham",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "MoveSrc_vizingham",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "MoveSrc_vizingham",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"CSV": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "TT_Productivity_vizingham",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "MoveSrc_vizingham",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "TT_Productivity_vizingham",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"source1": {},
									"sink1": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/Dual Cycling_vizingham')]",
				"[concat(variables('workspaceId'), '/dataflows/MoveSrc_vizingham')]",
				"[concat(variables('workspaceId'), '/dataflows/TT_Productivity_vizingham')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/vizingham_stack_confirmity')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "stack_confirmity_vizingham",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "stack_confirmity_vizingham",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"StackConfirmity": {},
									"StackConformity": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/stack_confirmity_vizingham')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Congo RVM')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "PowerBIWorkspace",
				"typeProperties": {
					"workspaceID": "e7ebb428-b726-46e9-b50f-5da90c81c2a1",
					"tenantID": "b354a388-081f-4fa2-a05b-33a065dbfc75"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/linkedService1')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobFS",
				"typeProperties": {
					"url": "[parameters('linkedService1_properties_typeProperties_url')]",
					"accountKey": {
						"type": "SecureString",
						"value": "[parameters('linkedService1_accountKey')]"
					}
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/linkedService2')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobFS",
				"typeProperties": {
					"url": "[parameters('linkedService2_properties_typeProperties_url')]",
					"accountKey": {
						"type": "SecureString",
						"value": "[parameters('linkedService2_accountKey')]"
					}
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/navispowerbidata-WorkspaceDefaultSqlServer')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"parameters": {
					"DBName": {
						"type": "String"
					}
				},
				"annotations": [],
				"type": "AzureSqlDW",
				"typeProperties": {
					"connectionString": "[parameters('navispowerbidata-WorkspaceDefaultSqlServer_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/navispowerbidata2-WorkspaceDefaultSqlServer')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"parameters": {
					"DBName": {
						"type": "String"
					}
				},
				"annotations": [],
				"type": "AzureSqlDW",
				"typeProperties": {
					"connectionString": "[parameters('navispowerbidata2-WorkspaceDefaultSqlServer_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/navispowerbidata2-WorkspaceDefaultStorage')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobFS",
				"typeProperties": {
					"url": "[parameters('navispowerbidata2-WorkspaceDefaultStorage_properties_typeProperties_url')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/powerbianalyticsdata-WorkspaceDefaultSqlServer')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"parameters": {
					"DBName": {
						"type": "String"
					}
				},
				"annotations": [],
				"type": "AzureSqlDW",
				"typeProperties": {
					"connectionString": "[parameters('powerbianalyticsdata-WorkspaceDefaultSqlServer_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/powerbianalyticsdata-WorkspaceDefaultStorage')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobFS",
				"typeProperties": {
					"url": "[parameters('powerbianalyticsdata-WorkspaceDefaultStorage_properties_typeProperties_url')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Trigger 1')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "vizingham_stack_confirmity",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "BlobEventsTrigger",
				"typeProperties": {
					"blobPathBeginsWith": "/vizingham/blobs/bronze/stackconformity/load/",
					"blobPathEndsWith": ".txt",
					"ignoreEmptyBlobs": true,
					"scope": "[parameters('Trigger 1_properties_typeProperties_scope')]",
					"events": [
						"Microsoft.Storage.BlobCreated"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/vizingham_stack_confirmity')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/sc_trigger')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "TEAGTL_stack_confirmity",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "BlobEventsTrigger",
				"typeProperties": {
					"blobPathBeginsWith": "/teagtl/blobs/bronze/stackconformity/load/",
					"blobPathEndsWith": ".txt",
					"ignoreEmptyBlobs": true,
					"scope": "[parameters('sc_trigger_properties_typeProperties_scope')]",
					"events": [
						"Microsoft.Storage.BlobCreated"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/TEAGTL_stack_confirmity')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/sc_trigger_agct')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "AGCT_conformities",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "BlobEventsTrigger",
				"typeProperties": {
					"blobPathBeginsWith": "/agct/blobs/bronze/stackconformity/load/",
					"blobPathEndsWith": ".csv",
					"ignoreEmptyBlobs": true,
					"scope": "[parameters('sc_trigger_agct_properties_typeProperties_scope')]",
					"events": [
						"Microsoft.Storage.BlobCreated"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/AGCT_conformities')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/sc_trigger_cmsa')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "CMSA_stack_confirmity",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "BlobEventsTrigger",
				"typeProperties": {
					"blobPathBeginsWith": "/cmsa/blobs/bronze/stackconformity/load/",
					"blobPathEndsWith": ".txt",
					"ignoreEmptyBlobs": true,
					"scope": "[parameters('sc_trigger_cmsa_properties_typeProperties_scope')]",
					"events": [
						"Microsoft.Storage.BlobCreated"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/CMSA_stack_confirmity')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/sc_trigger_dpw_peru')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "DPW_peru_stack_confirmity",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "BlobEventsTrigger",
				"typeProperties": {
					"blobPathBeginsWith": "/dpw-peru/blobs/bronze/stackconformity/load/",
					"blobPathEndsWith": ".txt",
					"ignoreEmptyBlobs": true,
					"scope": "[parameters('sc_trigger_dpw_peru_properties_typeProperties_scope')]",
					"events": [
						"Microsoft.Storage.BlobCreated"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/DPW_peru_stack_confirmity')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/sc_trigger_mict')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "MICT_confirmities",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "BlobEventsTrigger",
				"typeProperties": {
					"blobPathBeginsWith": "/mict/blobs/bronze/stackconformity/load/",
					"blobPathEndsWith": ".txt",
					"ignoreEmptyBlobs": true,
					"scope": "[parameters('sc_trigger_mict_properties_typeProperties_scope')]",
					"events": [
						"Microsoft.Storage.BlobCreated"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/MICT_confirmities')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/sc_trigger_mnhpi')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "MNHPI_confirmities",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "BlobEventsTrigger",
				"typeProperties": {
					"blobPathBeginsWith": "/mnhpi/blobs/bronze/stackconformity/load/",
					"blobPathEndsWith": ".txt",
					"ignoreEmptyBlobs": true,
					"scope": "[parameters('sc_trigger_mnhpi_properties_typeProperties_scope')]",
					"events": [
						"Microsoft.Storage.BlobCreated"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/MNHPI_confirmities')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/sc_trigger_rio')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "RIO_confirmities",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "BlobEventsTrigger",
				"typeProperties": {
					"blobPathBeginsWith": "/rio/blobs/bronze/stackconformity/load/",
					"blobPathEndsWith": ".txt",
					"ignoreEmptyBlobs": true,
					"scope": "[parameters('sc_trigger_rio_properties_typeProperties_scope')]",
					"events": [
						"Microsoft.Storage.BlobCreated"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/RIO_confirmities')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/sc_trigger_sgtd')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "SGTD_stack_confirmity",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "BlobEventsTrigger",
				"typeProperties": {
					"blobPathBeginsWith": "/sgtd/blobs/bronze/stackconformity/load/",
					"blobPathEndsWith": ".txt",
					"ignoreEmptyBlobs": true,
					"scope": "[parameters('sc_trigger_sgtd_properties_typeProperties_scope')]",
					"events": [
						"Microsoft.Storage.BlobCreated"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/SGTD_stack_confirmity')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/schedule_trigger')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "mict",
							"type": "PipelineReference"
						},
						"parameters": {}
					},
					{
						"pipelineReference": {
							"referenceName": "mnhpi_moves",
							"type": "PipelineReference"
						},
						"parameters": {}
					},
					{
						"pipelineReference": {
							"referenceName": "sgtd",
							"type": "PipelineReference"
						},
						"parameters": {}
					},
					{
						"pipelineReference": {
							"referenceName": "malta",
							"type": "PipelineReference"
						},
						"parameters": {}
					},
					{
						"pipelineReference": {
							"referenceName": "rio",
							"type": "PipelineReference"
						},
						"parameters": {}
					},
					{
						"pipelineReference": {
							"referenceName": "MCT",
							"type": "PipelineReference"
						},
						"parameters": {}
					},
					{
						"pipelineReference": {
							"referenceName": "TEAGTL_moves",
							"type": "PipelineReference"
						},
						"parameters": {}
					},
					{
						"pipelineReference": {
							"referenceName": "TEAGTL_ecevents",
							"type": "PipelineReference"
						},
						"parameters": {}
					},
					{
						"pipelineReference": {
							"referenceName": "cmsa_moves",
							"type": "PipelineReference"
						},
						"parameters": {}
					},
					{
						"pipelineReference": {
							"referenceName": "cmsa_ecevents",
							"type": "PipelineReference"
						},
						"parameters": {}
					},
					{
						"pipelineReference": {
							"referenceName": "cwit_moves",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Day",
						"interval": 2,
						"startTime": "2024-09-04T04:45:00",
						"timeZone": "India Standard Time",
						"schedule": {
							"minutes": [
								59
							],
							"hours": [
								6
							]
						}
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/mict')]",
				"[concat(variables('workspaceId'), '/pipelines/mnhpi_moves')]",
				"[concat(variables('workspaceId'), '/pipelines/sgtd')]",
				"[concat(variables('workspaceId'), '/pipelines/malta')]",
				"[concat(variables('workspaceId'), '/pipelines/rio')]",
				"[concat(variables('workspaceId'), '/pipelines/MCT')]",
				"[concat(variables('workspaceId'), '/pipelines/TEAGTL_moves')]",
				"[concat(variables('workspaceId'), '/pipelines/TEAGTL_ecevents')]",
				"[concat(variables('workspaceId'), '/pipelines/cmsa_moves')]",
				"[concat(variables('workspaceId'), '/pipelines/cmsa_ecevents')]",
				"[concat(variables('workspaceId'), '/pipelines/cwit_moves')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/tauranga_times')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Stopped",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "tauranga_ecevents",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "BlobEventsTrigger",
				"typeProperties": {
					"blobPathBeginsWith": "/tauranga/blobs/bronze/ecevents/load/",
					"blobPathEndsWith": ".csv",
					"ignoreEmptyBlobs": true,
					"scope": "[parameters('tauranga_times_properties_typeProperties_scope')]",
					"events": [
						"Microsoft.Storage.BlobCreated"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/tauranga_ecevents')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AutoResolveIntegrationRuntime')]",
			"type": "Microsoft.Synapse/workspaces/integrationRuntimes",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "Managed",
				"typeProperties": {
					"computeProperties": {
						"location": "AutoResolve",
						"dataFlowProperties": {
							"computeType": "General",
							"coreCount": 8,
							"timeToLive": 0
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/CMPH_GTI')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gti',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(Event_Type_Id==\"UNIT_DISCH\" || Event_Type_Id == \"UNIT_LOAD\") ~> Filter1\nFilter1 derive(Time_Completed_Date_Time = iif(Event_Type_Id== \"UNIT_LOAD\", iifNull(t_put,t_carry_complete),iifNull(t_fetch,t_discharge))) ~> DerivedColumn1\nDerivedColumn1 derive(Time = toString(Time_Completed_Date_Time,'HH:mm:ss'),\n\t\tDate = toDate(toString(Time_Completed_Date_Time,'yyyy-MM-dd'))) ~> DerivedColumn2\nDerivedColumn2 aggregate(groupBy(Carrier_Visit_Key,\n\t\tpow,\n\t\tDate),\n\tFirst_Lift = min(Time_Completed_Date_Time),\n\t\tLast_Lift = max(Time_Completed_Date_Time),\n\t\tMove_Count = countDistinct(mve_gkey)) ~> Aggregate1\nAggregate1 derive(WorkTime = Last_Lift-First_Lift,\n\t\tYear = iifNull(year(Date),0),\n\t\tMonth = iifNull(month(Date),0),\n\t\tWeek = iifNull(weekOfYear(Date),0)) ~> DerivedColumn4\nDerivedColumn4 alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gti',\n\tfolderPath: 'gold/qc_cmph',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Carrier_Visit_Key','pow','Date'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/CWIT_LadenUnladen')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ecevents"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as short,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          workAssignment as double,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          EcEventTime as timestamp,",
						"          cheID as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer,",
						"          OPERATOR_ID as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'cwit',",
						"     folderPath: 'silver/ecevents') ~> ecevents",
						"ecevents filter(cheKind == 'ITV' && (moveKind == 'DSCH' || moveKind == 'LOAD') && (eventTypeDescription == 'TVCO' || eventTypeDescription == 'TYCO')) ~> filter1",
						"filter1 derive(Date = toDate(EcEventTime),",
						"          Day_of_Week = dayOfWeek(EcEventTime)) ~> derivedColumn1",
						"derivedColumn1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          cheName = CHE_Name,",
						"          cheID,",
						"          EcEventTime,",
						"          type = eventType,",
						"          subType = eventSubType,",
						"          typeDescription = eventTypeDescription,",
						"          fromCheIdName,",
						"          ToCheIdName,",
						"          unitIdName = unit,",
						"          powName = pow,",
						"          poolName = pool,",
						"          workQueue,",
						"          Laden = travelDistance,",
						"          moveKind,",
						"          isTwinMove = isTwin,",
						"          UnLaden = startDistance,",
						"          unitReference = unitRef,",
						"          tranId = tran_ID,",
						"          locType,",
						"          locId = locID,",
						"          locSlot,",
						"          opsPosId = opsPosID,",
						"          unladenLoctype,",
						"          unladenLocid = unladenLocID,",
						"          unladenLocSlot,",
						"          ladenLoctype,",
						"          ladenLocid = ladenLocID,",
						"          ladenLocSlot = laden_LocSlot,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          Date,",
						"          Day_of_Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 alterRow(upsertIf(true()),",
						"     insertIf(true())) ~> alterRow1",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cwit',",
						"     folderPath: 'gold/laden_unladen',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/CWIT_moves_time_delta')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "cwit"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "LOAD"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "DSCH"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "split1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as integer,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as short,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as integer,",
						"          dist_start as short,",
						"          Twin_Fetch as string,",
						"          Twin_Carry as string,",
						"          Twin_Put as string,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as string,",
						"          OOG_Flag as string,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'cwit',",
						"     folderPath: 'silver/moves') ~> cwit",
						"filter1 derive(exec_delta_15 = iif(:exec_time > 15, true(), false()),",
						"          t_execution_delta = :exec_time,",
						"          Event_Type_Id = iif(Event_Type_Id=='UNIT_YARD_MOVE' && Move_Kind=='DSCH', 'UNIT_DISCH', Event_Type_Id),",
						"          exec_time := (t_carry_complete - t_fetch)/60000) ~> derivedColumn1",
						"cwit filter(Carry_CHE_Kind==\"ITV\" && not(isNull(t_fetch)) && not(isNull(t_carry_complete))) ~> filter1",
						"derivedColumn1 select(mapColumn(",
						"          mve_gkey,",
						"          Unit_Nbr,",
						"          Facility_Id,",
						"          Yard_Id,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Location,",
						"          To_Location,",
						"          From_Position_Name,",
						"          To_Position_Name,",
						"          Carry_CHE_Kind,",
						"          t_carry_complete,",
						"          t_put,",
						"          t_fetch,",
						"          Category_Id,",
						"          Freight_Kind_Id,",
						"          pow,",
						"          Commodity_Id,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          exec_delta_16 = exec_delta_15,",
						"          t_execution_delta",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"filter2 alterRow(upsertIf(true())) ~> alterRow1",
						"select1 filter((t_execution_delta >= 0.0) && (t_execution_delta >= 0) && not(isNull(t_execution_delta))) ~> filter2",
						"alterRow1 split(Event_Type_Id == \"UNIT_LOAD\",",
						"     Event_Type_Id == \"UNIT_DISCH\",",
						"     disjoint: true) ~> split1@(load, discharge)",
						"split1@load sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cwit',",
						"     folderPath: 'gold/load_time_delta',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> LOAD",
						"split1@discharge sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cwit',",
						"     folderPath: 'gold/dsch_time_delta',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> DSCH"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/CraneDelays_mict')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "parameters{\n\tcustomer as string (\"mict\")\n}\nsource(output(\n\t\tFacilityId as string,\n\t\t{Yard Id} as string,\n\t\tCarrierVisitId as string,\n\t\tCarrierVisitKey as integer,\n\t\tCraneServiceGkey as short,\n\t\t{Crane DelayTypeId} as string,\n\t\tDelayCategory as string,\n\t\tDelayDurationSec as short,\n\t\tDelayStartTime as string,\n\t\tCraneDelayGkey as short,\n\t\tCHEId as short,\n\t\tCHEShortName as string,\n\t\tSrcTable as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: true,\n\tmoveFiles: ['bronze/cranedelay','/bronze/cranedelay/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'mict',\n\tfolderPath: 'bronze/cranedelays/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source1\nsource1 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nSelect1 aggregate(groupBy(CraneDelayGkey),\n\teach(match(name!='CraneDelayGkey'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'silver/cranedelays',\n\toverwrite: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['CraneDelayGkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Decking_CMSA')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "filter1"
						}
					],
					"script": "source(output(\n\t\tgkey as integer,\n\t\tuyv_gkey as integer,\n\t\tunit_id as string,\n\t\ttime_stamp as string,\n\t\tdecking_type as string,\n\t\tnode_id as string,\n\t\tyard as boolean,\n\t\tfrom_pos_loctype as string,\n\t\tfrom_pos_locid as string,\n\t\tfrom_pos_loc_gkey as integer,\n\t\tfrom_pos_slot as string,\n\t\tfrom_pos_name as string,\n\t\tfrom_pos_bin as string,\n\t\tfrom_pos_tier as short,\n\t\tto_pos_loctype as string,\n\t\tto_pos_locid as string,\n\t\tto_pos_loc_gkey as boolean,\n\t\tto_pos_slot as string,\n\t\tto_pos_name as string,\n\t\tto_pos_bin as string,\n\t\tto_pos_tier as boolean,\n\t\ttotal_score as short,\n\t\texecution_time as short,\n\t\tdetails as string,\n\t\tphase as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: true,\n\tmoveFiles: ['bronze/moves/load','bronze/movehistory/load'],\n\tformat: 'delimited',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'bronze/deckinghistory/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\''],\n\tmode: 'read') ~> CSV\nAggregate1 derive(time_stamp = :timestamp,\n\t\tYear = year(:timestamp),\n\t\tMonth = month(:timestamp),\n\t\tWeek = weekOfYear(:timestamp),\n\t\ttimestamp := coalesce(toTimestamp(split(time_stamp,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(time_stamp,\".\")[1],'yyyy-MM-dd HH:mm'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(gkey),\n\teach(match(name!='gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\tgkey,\n\t\tuyv_gkey,\n\t\tunit_id,\n\t\ttime_stamp,\n\t\tdecking_type,\n\t\tnode_id,\n\t\tyard,\n\t\tfrom_pos_loctype,\n\t\tfrom_pos_locid,\n\t\tfrom_pos_loc_gkey,\n\t\tfrom_pos_slot,\n\t\tfrom_pos_name,\n\t\tfrom_pos_bin,\n\t\tfrom_pos_tier,\n\t\tto_pos_loctype,\n\t\tto_pos_locid,\n\t\tto_pos_loc_gkey,\n\t\tto_pos_slot,\n\t\tto_pos_name,\n\t\tto_pos_bin,\n\t\tto_pos_tier,\n\t\ttotal_score,\n\t\texecution_time,\n\t\tdetails,\n\t\tphase\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nfilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion filter(not(isNull(gkey)) && not(isNull(time_stamp))) ~> filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tATD as timestamp,\n\t\tATA as timestamp,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'silver/deckings',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: false,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Delays')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "parameters{\n\tcustomer as string (\"valencia\")\n}\nsource(output(\n\t\tFacilityId as string,\n\t\t{Yard Id} as string,\n\t\tCarrierVisitId as string,\n\t\tCarrierVisitKey as integer,\n\t\tCraneServiceGkey as short,\n\t\t{Crane DelayTypeId} as string,\n\t\tDelayCategory as string,\n\t\tDelayDurationSec as integer,\n\t\tDelayStartTime as string,\n\t\tCraneDelayGkey as integer,\n\t\tCHEId as short,\n\t\tCHEShortName as string,\n\t\tSrcTable as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/cranedelay','/bronze/cranedelay/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'valencia',\n\tfolderPath: 'bronze/cranedelay',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source1\nsource1 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nSelect1 aggregate(groupBy(CraneDelayGkey),\n\teach(match(name!='CraneDelayGkey'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'silver/cranedelays',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['CraneDelayGkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Delays_CTB')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Select2"
						}
					],
					"script": "source(output(\n\t\t{date of gang} as string,\n\t\t{gang (1st/2nd/3rd/4th)} as short,\n\t\t{Call Sign} as string,\n\t\t{Vessel name} as string,\n\t\t{Imp Voy} as string,\n\t\t{Exp Voy} as string,\n\t\t{Quay Crane} as short,\n\t\t{vessel Ops} as string,\n\t\tZeile as short,\n\t\tCategory as string,\n\t\t{Category description} as string,\n\t\tSite as string,\n\t\tID as integer,\n\t\t{von Call Sign} as string,\n\t\t{von Brcke} as short,\n\t\tTeam as string,\n\t\tCode as string,\n\t\tStart as string,\n\t\tStop as string,\n\t\tAccounting as string,\n\t\t{Aktiv Stunden} as double,\n\t\tZeitsteuerung as string,\n\t\tVerz as string,\n\t\t{Labour No} as integer,\n\t\tDuration as double,\n\t\tTDR as string,\n\t\t{Operation Report} as integer,\n\t\tSystem as string,\n\t\tReise as integer,\n\t\t{aktiv von} as string,\n\t\t{aktiv bis} as string,\n\t\tStatus as string,\n\t\t{Stapler B} as boolean,\n\t\t{Std Stapler B} as boolean,\n\t\t{Letzte nderung} as string,\n\t\tVA as short,\n\t\tAR as short,\n\t\tCB as boolean,\n\t\tVC as short,\n\t\tZM as boolean,\n\t\tST as boolean,\n\t\tRS as boolean,\n\t\tSpr as short,\n\t\t{Std VA} as double,\n\t\t{Std AR} as double,\n\t\t{Std CB} as double,\n\t\t{Std VC} as double,\n\t\t{Std ZM} as boolean,\n\t\t{Std RS} as boolean,\n\t\t{ST Std} as boolean,\n\t\t{Std Spr} as double,\n\t\tBemerkung as string,\n\t\t{Brutto Zeit} as short,\n\t\t{Netto Zeit} as boolean,\n\t\tStammcode as string,\n\t\tTerminal as string,\n\t\t{Dokument Nr} as boolean,\n\t\t{new category} as string,\n\t\t{desription of activity} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delimited',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'bronze/delays',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source1\nSelect2 derive(Start = toString(toTimestamp(Start,'HH:mm'),'HH:mm:ss'),\n\t\tStop = toString(toTimestamp(Stop,'HH:mm'),'HH:mm:ss'),\n\t\tYear = year(toDate(date_of_gang, 'dd.MM.yyyy')),\n\t\tMonth = month(toDate(date_of_gang, 'dd.MM.yyyy')),\n\t\tWeek = weekOfYear(toDate(date_of_gang, 'dd.MM.yyyy')),\n\t\tdate_of_gang = toDate(date_of_gang, 'dd.MM.yyyy')) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 select(mapColumn(\n\t\tdate_of_gang,\n\t\tGang = {gang_(1st/2nd/3rd/4th)},\n\t\tCall_Sign,\n\t\tVessel_name,\n\t\tImp_Voy,\n\t\tExp_Voy,\n\t\tQuay_Crane,\n\t\tvessel_Ops,\n\t\tZeile,\n\t\tCategory,\n\t\tCategory_description,\n\t\tSite,\n\t\tID,\n\t\tvon_Call_Sign,\n\t\t{von_Brcke},\n\t\tTeam,\n\t\tCode,\n\t\tStart,\n\t\tStop,\n\t\tAccounting,\n\t\tAktiv_Stunden,\n\t\tZeitsteuerung,\n\t\tVerz,\n\t\tLabour_No,\n\t\tDuration,\n\t\tTDR,\n\t\tOperation_Report,\n\t\tSystem,\n\t\tReise,\n\t\taktiv_von,\n\t\taktiv_bis,\n\t\tStatus,\n\t\tStapler_B,\n\t\tStd_Stapler_B,\n\t\t{Letzte_nderung},\n\t\tVA,\n\t\tAR,\n\t\tCB,\n\t\tVC,\n\t\tZM,\n\t\tST,\n\t\tRS,\n\t\tSpr,\n\t\tStd_VA,\n\t\tStd_AR,\n\t\tStd_CB,\n\t\tStd_VC,\n\t\tStd_ZM,\n\t\tStd_RS,\n\t\tST_Std,\n\t\tStd_Spr,\n\t\tBemerkung,\n\t\tBrutto_Zeit,\n\t\tNetto_Zeit,\n\t\tStammcode,\n\t\tTerminal,\n\t\tDokument_Nr,\n\t\tnew_category,\n\t\tdesription_of_activity\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDerivedColumn1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'silver/delays',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Double Cycling_pdports')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'pdports',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nderivedColumn1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'pdports',\n\tfolderPath: 'gold/double_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Double Cycling_salalah')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'salalah',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nderivedColumn1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'salalah',\n\tfolderPath: 'gold/double_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_CWIT')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "select1"
						},
						{
							"name": "derivedColumn2"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'cwit',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_put),false()) && (Event_Type_Id=='UNIT_YARD_MOVE' || Event_Type_Id=='UNIT_DISCH' || Event_Type_Id=='UNIT_LOAD')) ~> filter1\nderivedColumn2 window(asc(Carry_CHE_Id, true),\n\tasc(t_put, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_put_PREV = lag(t_put)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_put)==dayOfYear(t_put_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tt_put,\n\t\tt_carry_complete,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nfilter1 derive(Event_Type_Id = iif(Event_Type_Id=='UNIT_YARD_MOVE' && Move_Kind=='DSCH', 'UNIT_DISCH', Event_Type_Id)) ~> derivedColumn2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'cwit',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_CWIT_new')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "select1"
						},
						{
							"name": "split1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter3"
						},
						{
							"name": "union1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'cwit',\n\tfolderPath: 'silver/moves') ~> source1\nsplit1@LOAD filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_put),false()) && Event_Type_Id=='UNIT_LOAD') ~> filter1\nunion1 window(asc(Carry_CHE_Id, true),\n\tasc(t_put, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_put_PREV = lag(t_put)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_put)==dayOfYear(t_put_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tt_put,\n\t\tt_carry_complete,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nsource1 split(Event_Type_Id==\"UNIT_LOAD\",\n\tdisjoint: true) ~> split1@(LOAD, DSCH)\nsplit1@DSCH filter(equals(Put_CHE_Kind,'ITV') && equals(isNull(Put_CHE_Id),false()) && equals(isNull(t_put),false())) ~> filter2\nfilter2 derive(Event_Type_Id = iif(Move_Kind=='YARD' && like(From_Position_Name, 'Y-CWIT-Q%') && not(like(To_Position_Name, 'Y-CWIT-Q%')), 'UNIT_DISCH', Event_Type_Id)) ~> derivedColumn3\nderivedColumn3 filter(Event_Type_Id=='UNIT_DISCH') ~> filter3\nfilter3, filter1 union(byName: true)~> union1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'cwit',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_DSCHTOLOAD')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gti',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false())) ~> filter1\nfilter1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: 1L,\n\tendRowOffset: 1L,\n\tCarry_CHE_Id_nxt = lead(Carry_CHE_Id),\n\t\tEvent_Type_Id_nxt = lead(Event_Type_Id)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_nxt,iif(Event_Type_Id=='UNIT_LOAD',iif(Event_Type_Id_nxt=='UNIT_LOAD','Half Load Cycle',iif(Event_Type_Id_nxt=='UNIT_DISCH','Other Cycle','Other Cycle')),iif(Event_Type_Id=='UNIT_DISCH',iif(Event_Type_Id_nxt=='UNIT_DISCH','Half Discharge Cycle',iif(Event_Type_Id_nxt=='UNIT_LOAD','Disch to Load Cycle','Other Cycle')),'Other Cycle')),'Other Cycle')) ~> derivedColumn1\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nderivedColumn1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gti',\n\tfolderPath: 'gold/dual_cycling_dtol',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_Ennore')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'ennore',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'ennore',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_GTI')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gti',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nderivedColumn1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gti',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_MCT')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as boolean,\n\t\tTwin_Carry as boolean,\n\t\tTwin_Put as boolean,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as integer,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as boolean,\n\t\tOOG_Flag as boolean,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tATA as timestamp,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'mct',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'SC') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tpow,\n\t\tRehandles,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tt_carry_complete_PREV,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mct',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_SC')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('eurogatectb')\n}\nsource(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: ($customer),\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 filter(equals(Carry_CHE_Kind,'SC') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false())) ~> Filter1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tmve_gkey,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nFilter1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id)) ~> Window1\nWindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV,\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD',\r\n'Half Load Cycle',\r\niif(Event_Type_Id_PREV=='UNIT_DISCH',\r\n'Full Cycle','Other Cycle')),\r\niif(Event_Type_Id=='UNIT_DISCH',\r\niif(Event_Type_Id_PREV=='UNIT_DISCH',\r\n'Half Discharge Cycle',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD',\r\n'Full Cycle','Other Cycle')),\r\n'Other Cycle')),'Other Cycle')) ~> DerivedColumn1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_SC_aarhus')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('apmtaarhus')\n}\nsource(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: ($customer),\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 filter(equals(Carry_CHE_Kind,'SC') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false())) ~> Filter1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tmve_gkey,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nFilter1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id)) ~> Window1\nWindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV,\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD',\r\n'Half Load Cycle',\r\niif(Event_Type_Id_PREV=='UNIT_DISCH',\r\n'Full Cycle','Other Cycle')),\r\niif(Event_Type_Id=='UNIT_DISCH',\r\niif(Event_Type_Id_PREV=='UNIT_DISCH',\r\n'Half Discharge Cycle',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD',\r\n'Full Cycle','Other Cycle')),\r\n'Other Cycle')),'Other Cycle')) ~> DerivedColumn1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'apmtaarhus',\n\tfolderPath: 'gold/dual_cycling',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_TEAGTL')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'teagtl',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tpow,\n\t\tCommodity_Id,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'teagtl',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_aarhus')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'apmtaarhus',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'apmtaarhus',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_aqaba')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'apmtaqaba',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'apmtaqaba',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_cgsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						},
						{
							"name": "MapDrifted1",
							"description": "Creates an explicit mapping for each drifted column"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'cgsa',\n\tfolderPath: 'silver/moves') ~> source1\nMapDrifted1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nsource1 derive(ATA = toTimestamp(byName('ATA'))) ~> MapDrifted1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'cgsa',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_cmsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as long,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tpow as string,\n\t\tufv_gkey as long,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tATD as timestamp,\n\t\tATA as timestamp,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tpow,\n\t\tufv_gkey,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tATD,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as long,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tpow as string,\n\t\tufv_gkey as long,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tATD as timestamp,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tCarry_CHE_Id_PREV as long,\n\t\tEvent_Type_Id_PREV as string,\n\t\tCycle_Type as string\n\t),\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tpow,\n\t\tufv_gkey,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tATD,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_dpw_lg')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'dpw-lg',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind, \"SC\") && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'dpw-lg',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_dpw_peru')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'tp-angamos',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'dpw-peru',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_haifa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'haifa',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'haifa',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_hazira')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'hazira',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tpow,\n\t\tCommodity_Id,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'hazira',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_kattupalli')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'kattupalli',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'kattupalli',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_kssp')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'kssp',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'kssp',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_malta')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as string,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as string,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as string,\n\t\tdist_start as string,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as string,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as string,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tATA as timestamp,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'malta',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'malta',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_mict')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						},
						{
							"name": "MapDrifted1",
							"description": "Creates an explicit mapping for each drifted column"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'silver/moves') ~> source1\nMapDrifted1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nsource1 derive(ATA = toTimestamp(byName('ATA'))) ~> MapDrifted1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_mnhpi')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_mundra_ct02')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'mundra-ct02',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tpow,\n\t\tCommodity_Id,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mundra-ct02',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_mundra_ct04')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'mundra-ct04',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tpow,\n\t\tCommodity_Id,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mundra-ct04',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_rio')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as integer,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as boolean,\n\t\tTwin_Carry as boolean,\n\t\tTwin_Put as boolean,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as boolean,\n\t\tOOG_Flag as boolean,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as short,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'rio',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'rio',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_seayard')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as short,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as string,\n\t\tdist_start as string,\n\t\tTwin_Fetch as boolean,\n\t\tTwin_Carry as boolean,\n\t\tTwin_Put as boolean,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as boolean,\n\t\tOOG_Flag as boolean,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'seayard',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'SC') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'seayard',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: false,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_sgtd')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'sgtd',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && equals(isNull(t_put),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'sgtd',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_sgtd_yard')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "lookup1"
						},
						{
							"name": "lookup2"
						},
						{
							"name": "select2"
						},
						{
							"name": "select3"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "derivedColumn5"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'sgtd',\n\tfolderPath: 'silver/moves') ~> source1\nsource(output(\n\t\tWaterside_Yard_Block as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delimited',\n\tfileSystem: 'sgtd',\n\tfolderPath: 'bronze/yardblocks',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\'',\n\tcolumnNamesAsHeader: true) ~> source2\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_YARD_MOVE')) ~> filter1\nderivedColumn5 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tYard_Event_Type_PREV = lag(Yard_Event_Type),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id == Carry_CHE_Id_PREV && (dayOfYear(t_carry_complete) >= dayOfYear(t_carry_complete_PREV) && (dayOfYear(t_carry_complete) -1) <= dayOfYear(t_carry_complete_PREV)),\r\niif((Yard_Event_Type == 'Land To Water' && Yard_Event_Type_PREV == 'Water To Land') ||\r\n\t(Yard_Event_Type == 'Water To Land' && Yard_Event_Type_PREV == 'Land To Water') ||\r\n\t(Yard_Event_Type == 'Land To Water' && Yard_Event_Type_PREV == 'Land To Land') ||\r\n\t(Yard_Event_Type == 'Water To Land' && Yard_Event_Type_PREV == 'Water To Water'),\r\n\t'Full Cycle',\r\n\t'Half Cycle'),\r\n    'Half Cycle')) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tpow,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tFrom_Yard_Block,\n\t\tTo_Yard_Block,\n\t\tFrom_Yard_Type,\n\t\tTo_Yard_Type,\n\t\tYard_Event_Type,\n\t\tCarry_CHE_Id_PREV,\n\t\tYard_Event_Type_PREV,\n\t\tt_carry_complete_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\naggregate1 derive(From_Yard_Block = left(split(From_Position_Name, \"-\")[3], 3),\n\t\tTo_Yard_Block = left(split(To_Position_Name, \"-\")[3], 3)) ~> derivedColumn2\nderivedColumn2, source2 lookup(From_Yard_Block == Waterside_Yard_Block,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> lookup1\nselect2, source2 lookup(To_Yard_Block == Waterside_Yard_Block,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> lookup2\nlookup1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tFrom_Yard_Block,\n\t\tTo_Yard_Block,\n\t\tFrom_Yard_Type = Waterside_Yard_Block\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select2\nlookup2 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tFrom_Yard_Block,\n\t\tTo_Yard_Block,\n\t\tFrom_Yard_Type,\n\t\tTo_Yard_Type = Waterside_Yard_Block\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select3\nselect3 derive(From_Yard_Type = iif(isNull(From_Yard_Type), \"Land\", \"Water\"),\n\t\tTo_Yard_Type = iif(isNull(To_Yard_Type), \"Land\", \"Water\")) ~> derivedColumn4\nderivedColumn4 derive(Yard_Event_Type = iif(From_Yard_Type==\"Land\",\r\n    iif(To_Yard_Type==\"Land\", \r\n        \"Land To Land\", \r\n        \"Land To Water\"),\r\n        iif(To_Yard_Type==\"Water\", \r\n            \"Water To Water\", \r\n            \"Water To Land\")\r\n    )) ~> derivedColumn5\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'sgtd',\n\tfolderPath: 'gold/dual_cycling_yard',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]",
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_socar')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as boolean,\n\t\tTwin_Carry as boolean,\n\t\tTwin_Put as boolean,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as integer,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as boolean,\n\t\tOOG_Flag as boolean,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tATA as timestamp,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'socar',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tpow,\n\t\tRehandles,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tt_carry_complete_PREV,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'socar',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_tauranga')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'tauranga',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'SC') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'tauranga',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_tdt')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'tdt',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'tdt',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_tp_angamos')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'tp-angamos',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'tp-angamos',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_transnet')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'transnet',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_carry_complete),false()) && (Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_DISCH')) ~> filter1\naggregate1 window(asc(Carry_CHE_Id, true),\n\tasc(t_carry_complete, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_carry_complete_PREV = lag(t_carry_complete)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_carry_complete)==dayOfYear(t_carry_complete_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATD,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCarry_CHE_Id_PREV,\n\t\tEvent_Type_Id_PREV,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'transnet',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual Cycling_vizingham')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "select1"
						},
						{
							"name": "derivedColumn2"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'vizingham',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && equals(isNull(Carry_CHE_Id),false()) && equals(isNull(t_put),false()) && (Event_Type_Id=='UNIT_YARD_MOVE' || Event_Type_Id=='UNIT_DISCH' || Event_Type_Id=='UNIT_LOAD')) ~> filter1\nderivedColumn2 window(asc(Carry_CHE_Id, true),\n\tasc(t_put, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tCarry_CHE_Id_PREV = lag(Carry_CHE_Id),\n\t\tEvent_Type_Id_PREV = lag(Event_Type_Id),\n\t\tt_put_PREV = lag(t_put)) ~> window1\nwindow1 derive(Cycle_Type = iif(Carry_CHE_Id==Carry_CHE_Id_PREV && dayOfYear(t_put)==dayOfYear(t_put_PREV),\r\n(\r\niif(Event_Type_Id=='UNIT_LOAD',\r\niif(Event_Type_Id_PREV=='UNIT_LOAD','Half Load Cycle','Discharge to Load Cycle'),\r\niif(Event_Type_Id_PREV=='UNIT_DISCH','Half Discharge Cycle','Load to Discharge Cycle'))\r\n),\r\niif(Event_Type_Id=='UNIT_LOAD','Half Load Cycle','Half Discharge Cycle'))) ~> derivedColumn1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tt_put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tCycle_Type\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nfilter1 derive(Event_Type_Id = iif(Event_Type_Id=='UNIT_YARD_MOVE' && Move_Kind=='DSCH', 'UNIT_DISCH', Event_Type_Id)) ~> derivedColumn2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'vizingham',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dual_Cycling_GTI')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as integer,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gti',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 filter(equals(Carry_CHE_Kind,'ITV')) ~> Filter1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tmve_gkey,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nFilter1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gti',\n\tfolderPath: 'gold/dual_cycling',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dwell_cmsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "dwell time of import full cntrs",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "filter3"
						},
						{
							"name": "AlterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as integer,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as short,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as integer,",
						"          dist_start as short,",
						"          Twin_Fetch as string,",
						"          Twin_Carry as string,",
						"          Twin_Put as string,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as string,",
						"          OOG_Flag as string,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmsa',",
						"     folderPath: 'silver/moves') ~> source1",
						"source1 filter(Category_Id=='IMPRT'&&Freight_Kind_Id=='FCL'&&(Event_Type_Id=='UNIT_DISCH' || Event_Type_Id=='UNIT_DELIVER')) ~> filter1",
						"filter1 window(asc(Unit_Nbr, true),",
						"     asc(t_put, true),",
						"     Unit_Nbr_prev = lag(Unit_Nbr),",
						"          Event_Type_Id_prev = lag(Event_Type_Id),",
						"          t_put_prev = lag(t_put)) ~> window1",
						"window1 derive(Dwell_Time = iif(Unit_Nbr==Unit_Nbr_prev && Event_Type_Id=='UNIT_DELIVER' && Event_Type_Id_prev=='UNIT_DISCH',dayOfYear(t_put)-dayOfYear(t_put_prev),toInteger(null()))) ~> derivedColumn1",
						"filter3 derive(Dwell_Range = iif(Dwell_Time<=6, '0 to 6 Days', '> 6 Days')) ~> derivedColumn2",
						"derivedColumn1 filter(isNull(Dwell_Time)==false()) ~> filter3",
						"derivedColumn2 alterRow(upsertIf(true())) ~> AlterRow1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmsa',",
						"     folderPath: 'gold/dwell',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dwell_mict')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "filter3"
						},
						{
							"name": "AlterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as integer,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as short,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as integer,",
						"          dist_start as short,",
						"          Twin_Fetch as string,",
						"          Twin_Carry as string,",
						"          Twin_Put as string,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as string,",
						"          OOG_Flag as string,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'mict',",
						"     folderPath: 'silver/moves') ~> source1",
						"source1 filter(Category_Id=='IMPRT'&&Freight_Kind_Id=='FCL'&&(Event_Type_Id=='UNIT_DISCH' || Event_Type_Id=='UNIT_DELIVER')) ~> filter1",
						"filter1 window(asc(Unit_Nbr, true),",
						"     asc(t_put, true),",
						"     Unit_Nbr_prev = lag(Unit_Nbr),",
						"          Event_Type_Id_prev = lag(Event_Type_Id),",
						"          t_put_prev = lag(t_put)) ~> window1",
						"window1 derive(Dwell_Time = iif(Unit_Nbr==Unit_Nbr_prev && Event_Type_Id=='UNIT_DELIVER' && Event_Type_Id_prev=='UNIT_DISCH',dayOfYear(t_put)-dayOfYear(t_put_prev),toInteger(null()))) ~> derivedColumn1",
						"filter3 derive(Dwell_Range = iif(Dwell_Time<=6, '0 to 6 Days', '> 6 Days')) ~> derivedColumn2",
						"derivedColumn1 filter(isNull(Dwell_Time)==false()) ~> filter3",
						"derivedColumn2 alterRow(upsertIf(true())) ~> AlterRow1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mict',",
						"     folderPath: 'gold/dwell',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Dwell_mnhpi')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "dwell time of import full cntrs",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "filter3"
						},
						{
							"name": "AlterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as integer,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as short,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as integer,",
						"          dist_start as short,",
						"          Twin_Fetch as string,",
						"          Twin_Carry as string,",
						"          Twin_Put as string,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as string,",
						"          OOG_Flag as string,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'silver/moves') ~> source1",
						"source1 filter(Category_Id=='IMPRT'&&Freight_Kind_Id=='FCL'&&(Event_Type_Id=='UNIT_DISCH' || Event_Type_Id=='UNIT_DELIVER')) ~> filter1",
						"filter1 window(asc(Unit_Nbr, true),",
						"     asc(t_put, true),",
						"     Unit_Nbr_prev = lag(Unit_Nbr),",
						"          Event_Type_Id_prev = lag(Event_Type_Id),",
						"          t_put_prev = lag(t_put)) ~> window1",
						"window1 derive(Dwell_Time = iif(Unit_Nbr==Unit_Nbr_prev && Event_Type_Id=='UNIT_DELIVER' && Event_Type_Id_prev=='UNIT_DISCH',dayOfYear(t_put)-dayOfYear(t_put_prev),toInteger(null()))) ~> derivedColumn1",
						"filter3 derive(Dwell_Range = iif(Dwell_Time<=6, '0 to 6 Days', '> 6 Days')) ~> derivedColumn2",
						"derivedColumn1 filter(isNull(Dwell_Time)==false()) ~> filter3",
						"derivedColumn2 alterRow(upsertIf(true())) ~> AlterRow1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'gold/dwell',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "powerbianalyticsdata-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "powerbianalyticsdata-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as integer,\n\t\tYARDID as string,\n\t\tFCYID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as string,\n\t\tstartDistance as short,\n\t\tworkAssignment as long,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'malta',\n\tfolderPath: 'bronze/ecevents',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYARDID,\n\t\tFCYID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tworkAssignment,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\tEcEventTime,\n\t\tcheID,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as short,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as boolean,\n\t\tToCheIdName as boolean,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'malta',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID = YARDID,\n\t\tFcyID = FCYID,\n\t\tcheKind,\n\t\tcheName = CHE_Name,\n\t\tcheID,\n\t\tEcEventTime,\n\t\ttype = eventType,\n\t\tsubType = eventSubType,\n\t\ttypeDescription = eventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunitIdName = unit,\n\t\tpowName = pow,\n\t\tpoolName = pool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwinMove = isTwin,\n\t\tstartDistance,\n\t\tworkAssignmentId = workAssignment,\n\t\tunitReference = unitRef,\n\t\ttranId = tran_ID,\n\t\tlocType,\n\t\tlocId = locID,\n\t\tlocSlot,\n\t\topsPosId = opsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocid = unladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocid = ladenLocID,\n\t\tladenLocSlot = laden_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/powerbianalyticsdata-WorkspaceDefaultStorage')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_CGSA')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as boolean,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as boolean,\n\t\tToCheIdName as boolean,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as boolean,\n\t\tmoveKind as string,\n\t\tisTwin as short,\n\t\tstartDistance as boolean,\n\t\tworkAssignment as double,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tOPERATOR_NAME as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'cgsa',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = :time_stamp,\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(:time_stamp),0),\n\t\tMonth = iifNull(month(:time_stamp),0),\n\t\tWeek = iifNull(weekOfYear(:time_stamp),0),\n\t\ttime_stamp := coalesce(toTimestamp(split(TimeStamp, \".\")[1],'yyyy-MM-dd HH:mm:ss'), toTimestamp(split(TimeStamp, \".\")[1],'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\tEcEventTime,\n\t\tcheID,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tOPERATOR_ID = OPERATOR_NAME\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'cgsa',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: false,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_CMATK')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1",
							"rejectedDataLinkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							}
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as string,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as string,\n\t\tTimeStamp as string,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as string,\n\t\tmoveKind as string,\n\t\tisTwin as string,\n\t\tstartDistance as short,\n\t\tworkAssignment as string,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\toperator_name as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'cmatk',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp, 'dd/MM/yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp, 'dd/MM/yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp, 'dd/MM/yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp, 'dd/MM/yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tclient_id = \"CMATK\",\n\t\ttimestamp := coalesce(toTimestamp(split(TimeStamp, \".\")[1],'yyyy-MM-dd HH:mm:ss'), toTimestamp(split(TimeStamp, \".\")[1],'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\tOPERATOR_ID = operator_name,\n\t\tEcEventTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tclient_id\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as string,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as string,\n\t\tTimeStamp as string,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as string,\n\t\tmoveKind as string,\n\t\tisTwin as string,\n\t\tstartDistance as string,\n\t\tworkAssignment as string,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\toperator_name as string,\n\t\tclient_id as string,\n\t\tEcEventTime as timestamp,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'cmatk',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_CTB')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "aggregateEcEventGkey"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as string,\n\t\tyardGkey as short,\n\t\tYARDID as string,\n\t\tFCYID as string,\n\t\tcheKind as string,\n\t\tcheShortName as string,\n\t\tcheID as short,\n\t\tEcEventTime as string,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as long,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ';',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source1\nsource1 derive(EcEventTime = coalesce(toTimestamp(EcEventTime,'dd-MM-yy HH:mm:ss'),toTimestamp(EcEventTime,'dd.MM.yy HH:mm:ss'),toTimestamp(concatWS(' ',substringIndex(EcEventTime,'.',3),right(EcEventTime, 2)),'dd-MMM-yy hh.mm.ss a'),toTimestamp(EcEventTime,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(EcEventTime,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(EcEventTime,'dd/MM/yyyy HH:mm:ss'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm:ss')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(cheID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(EcEventTime,'dd-MM-yy HH:mm:ss'),toTimestamp(EcEventTime,'dd.MM.yy HH:mm:ss'),toTimestamp(concatWS(' ',substringIndex(EcEventTime,'.',3),right(EcEventTime, 2)),'dd-MMM-yy hh.mm.ss a'),toTimestamp(EcEventTime,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(EcEventTime,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(EcEventTime,'dd/MM/yyyy HH:mm:ss'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(EcEventTime,'dd-MM-yy HH:mm:ss'),toTimestamp(EcEventTime,'dd.MM.yy HH:mm:ss'),toTimestamp(concatWS(' ',substringIndex(EcEventTime,'.',3),right(EcEventTime, 2)),'dd-MMM-yy hh.mm.ss a'),toTimestamp(EcEventTime,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(EcEventTime,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(EcEventTime,'dd/MM/yyyy HH:mm:ss'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(EcEventTime,'dd-MM-yy HH:mm:ss'),toTimestamp(EcEventTime,'dd.MM.yy HH:mm:ss'),toTimestamp(concatWS(' ',substringIndex(EcEventTime,'.',3),right(EcEventTime, 2)),'dd-MMM-yy hh.mm.ss a'),toTimestamp(EcEventTime,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(EcEventTime,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(EcEventTime,'dd/MM/yyyy HH:mm:ss'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm:ss'))),0)) ~> DataTypeConversion\naggregateEcEventGkey alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID = YARDID,\n\t\tFcyID = FCYID,\n\t\tcheKind,\n\t\tcheName = cheShortName,\n\t\tcheID,\n\t\tEcEventTime,\n\t\ttype,\n\t\tsubType,\n\t\ttypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunitIdName,\n\t\tpowName,\n\t\tpoolName,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwinMove,\n\t\tstartDistance,\n\t\tworkAssignmentId,\n\t\tunitReference,\n\t\ttranId,\n\t\tlocType,\n\t\tlocId,\n\t\tlocSlot,\n\t\topsPosId,\n\t\tunladenLoctype,\n\t\tunladenLocid,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocid,\n\t\tladenLocSlot,\n\t\tlastEstMoveTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> aggregateEcEventGkey\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as short,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as boolean,\n\t\tToCheIdName as boolean,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tcheName,\n\t\tcheID,\n\t\tEcEventTime,\n\t\ttype,\n\t\tsubType,\n\t\ttypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunitIdName,\n\t\tpowName,\n\t\tpoolName,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwinMove,\n\t\tstartDistance,\n\t\tworkAssignmentId,\n\t\tunitReference,\n\t\ttranId,\n\t\tlocType,\n\t\tlocId,\n\t\tlocSlot,\n\t\topsPosId,\n\t\tunladenLoctype,\n\t\tunladenLocid,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocid,\n\t\tladenLocSlot,\n\t\tlastEstMoveTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_CWIT')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as short,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignment as double,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\toperator_name as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'cwit',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tworkAssignment,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\tEcEventTime,\n\t\tcheID,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tOPERATOR_ID = operator_name\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'cwit',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: true,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_Ennore')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as short,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignment as double,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\toperator_name as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'ennore',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\tEcEventTime,\n\t\tcheID,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tOPERATOR_ID = operator_name\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as short,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignment as double,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tEcEventTime as timestamp,\n\t\tcheID as long,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tOPERATOR_ID as string\n\t),\n\tformat: 'delta',\n\tfileSystem: 'ennore',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: false,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_GTI')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('gti')\n}\nsource(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as short,\n\t\tYARDID as string,\n\t\tFCYID as string,\n\t\tcheKind as string,\n\t\tcheShortName as string,\n\t\tcheID as short,\n\t\tEcEventTime as string,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as boolean,\n\t\tToCheIdName as boolean,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'gti',\n\tfolderPath: 'bronze/ecevents',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(EcEventTime,'dd-MM-yy HH:mm:ss'),toTimestamp(EcEventTime,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm'),toTimestamp(EcEventTime,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(EcEventTime,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(EcEventTime,'dd/MM/yyyy HH:mm:ss'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm:ss')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(cheID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(EcEventTime,'dd-MM-yy HH:mm:ss'),toTimestamp(EcEventTime,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm'),toTimestamp(EcEventTime,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(EcEventTime,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(EcEventTime,'dd/MM/yyyy HH:mm:ss'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(EcEventTime,'dd-MM-yy HH:mm:ss'),toTimestamp(EcEventTime,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm'),toTimestamp(EcEventTime,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(EcEventTime,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(EcEventTime,'dd/MM/yyyy HH:mm:ss'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(EcEventTime,'dd-MM-yy HH:mm:ss'),toTimestamp(EcEventTime,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm'),toTimestamp(EcEventTime,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(EcEventTime,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(EcEventTime,'dd/MM/yyyy HH:mm:ss'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm:ss'))),0)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID = YARDID,\n\t\tFcyID = FCYID,\n\t\tcheKind,\n\t\tcheName = cheShortName,\n\t\tcheID,\n\t\tEcEventTime,\n\t\ttype,\n\t\tsubType,\n\t\ttypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunitIdName,\n\t\tpowName,\n\t\tpoolName,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwinMove,\n\t\tstartDistance,\n\t\tworkAssignmentId,\n\t\tunitReference,\n\t\ttranId,\n\t\tlocType,\n\t\tlocId,\n\t\tlocSlot,\n\t\topsPosId,\n\t\tunladenLoctype,\n\t\tunladenLocid,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocid,\n\t\tladenLocSlot,\n\t\tlastEstMoveTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\naggregate1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nSelect1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gti',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_MCT')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as integer,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as boolean,\n\t\tToCheIdName as boolean,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignment as string,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\toperator_name as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: true,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'mct',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yy HH:mm'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yy HH:mm'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')))),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yy HH:mm'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')))),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yy HH:mm'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')))),\n\t\tecEventGkey = toLong(ecEventGkey)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tworkAssignment,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\tlastEstMoveTime,\n\t\toperator_name,\n\t\tEcEventTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(not(isNull(ecEventGkey))) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mct',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_SLPA')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('gti')\n}\nsource(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheShortName as string,\n\t\tcheID as short,\n\t\tEcEventTime as string,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as long,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'slpa',\n\tfolderPath: 'bronze/ecevents',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(EcEventTime,'dd-MM-yy HH:mm:ss'),toTimestamp(EcEventTime,'dd.MM.yy HH:mm:ss'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm'),toTimestamp(EcEventTime,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(EcEventTime,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(EcEventTime,'dd/MM/yyyy HH:mm:ss'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm:ss')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(cheID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(EcEventTime,'dd-MM-yy HH:mm:ss'),toTimestamp(EcEventTime,'dd.MM.yy HH:mm:ss'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm'),toTimestamp(EcEventTime,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(EcEventTime,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(EcEventTime,'dd/MM/yyyy HH:mm:ss'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(EcEventTime,'dd-MM-yy HH:mm:ss'),toTimestamp(EcEventTime,'dd.MM.yy HH:mm:ss'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm'),toTimestamp(EcEventTime,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(EcEventTime,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(EcEventTime,'dd/MM/yyyy HH:mm:ss'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(EcEventTime,'dd-MM-yy HH:mm:ss'),toTimestamp(EcEventTime,'dd.MM.yy HH:mm:ss'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm'),toTimestamp(EcEventTime,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(EcEventTime,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(EcEventTime,'dd/MM/yyyy HH:mm:ss'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm:ss'))),0)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tcheName = cheShortName,\n\t\tcheID,\n\t\tEcEventTime,\n\t\ttype,\n\t\tsubType,\n\t\ttypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunitIdName,\n\t\tpowName,\n\t\tpoolName,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwinMove,\n\t\tstartDistance,\n\t\tworkAssignmentId,\n\t\tunitReference,\n\t\ttranId,\n\t\tlocType,\n\t\tlocId,\n\t\tlocSlot,\n\t\topsPosId,\n\t\tunladenLoctype,\n\t\tunladenLocid,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocid,\n\t\tladenLocSlot,\n\t\tlastEstMoveTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'slpa',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_TEAGTL')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as boolean,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as boolean,\n\t\ttoCheIdName as boolean,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as integer,\n\t\tmoveKind as string,\n\t\tisTwin as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignment as long,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\toperator as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'teagtl',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp ,'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(concat(substring(TimeStamp, 1, 22), ' ', substring(TimeStamp, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),\r\n    toTimestamp(TimeStamp, 'MM/dd/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm:ss')\r\n),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(dropRight(TimeStamp, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(concat(substring(TimeStamp, 1, 22), ' ', substring(TimeStamp, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),\r\n    toTimestamp(TimeStamp, 'MM/dd/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm:ss')\r\n))),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(dropRight(TimeStamp, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(concat(substring(TimeStamp, 1, 22), ' ', substring(TimeStamp, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),\r\n    toTimestamp(TimeStamp, 'MM/dd/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm:ss')\r\n))),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(dropRight(TimeStamp, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(concat(substring(TimeStamp, 1, 22), ' ', substring(TimeStamp, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),\r\n    toTimestamp(TimeStamp, 'MM/dd/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm:ss')\r\n)))) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName = toCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tworkAssignment,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\tlastEstMoveTime,\n\t\tEcEventTime,\n\t\tcheID,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'teagtl',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: false,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_TEAGTL_new')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as boolean,\n\t\ttoCheIdName as boolean,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as integer,\n\t\tmoveKind as string,\n\t\tisTwin as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignment as long,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\toperator as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: true,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'teagtl',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(:timestamp ,'yyyy-MM-dd HH:mm:ss'),\r\n    toTimestamp(:timestamp, 'MM/dd/yyyy HH:mm:ss'),\r\n    toTimestamp(:timestamp, 'dd-MM-yy HH:mm:ss'),\r\n    toTimestamp(:timestamp, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\r\n    toTimestamp(:timestamp, 'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(:timestamp, 'dd/MM/yyyy HH:mm:ss'),\r\n    toTimestamp(:timestamp, 'dd-MM-yyyy HH:mm:ss')\r\n),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(:timestamp ,'yyyy-MM-dd HH:mm:ss'),\r\n    toTimestamp(:timestamp, 'MM/dd/yyyy HH:mm:ss'),\r\n    toTimestamp(:timestamp, 'dd-MM-yy HH:mm:ss'),\r\n    toTimestamp(:timestamp, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\r\n    toTimestamp(:timestamp, 'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(:timestamp, 'dd/MM/yyyy HH:mm:ss'),\r\n    toTimestamp(:timestamp, 'dd-MM-yyyy HH:mm:ss')\r\n))),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(:timestamp ,'yyyy-MM-dd HH:mm:ss'),\r\n    toTimestamp(:timestamp, 'MM/dd/yyyy HH:mm:ss'),\r\n    toTimestamp(:timestamp, 'dd-MM-yy HH:mm:ss'),\r\n    toTimestamp(:timestamp, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\r\n    toTimestamp(:timestamp, 'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(:timestamp, 'dd/MM/yyyy HH:mm:ss'),\r\n    toTimestamp(:timestamp, 'dd-MM-yyyy HH:mm:ss')\r\n))),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(:timestamp ,'yyyy-MM-dd HH:mm:ss'),\r\n    toTimestamp(:timestamp, 'MM/dd/yyyy HH:mm:ss'),\r\n    toTimestamp(:timestamp, 'dd-MM-yy HH:mm:ss'),\r\n    toTimestamp(:timestamp, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\r\n    toTimestamp(:timestamp, 'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(:timestamp, 'dd/MM/yyyy HH:mm:ss'),\r\n    toTimestamp(:timestamp, 'dd-MM-yyyy HH:mm:ss')\r\n))),\n\t\ttimestamp := split(TimeStamp, \".\")[1]) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName = toCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\toperator,\n\t\tEcEventTime,\n\t\tcheID,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'teagtl',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: false,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_Valencia')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "removeDupEcEventGkey"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as string,\n\t\tstartDistance as short,\n\t\tworkAssignment as double,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'valencia',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0)) ~> DataTypeConversion\nremoveDupEcEventGkey alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tcheName = CHE_Name,\n\t\tcheID,\n\t\tEcEventTime,\n\t\ttype = eventType,\n\t\tsubType = eventSubType,\n\t\ttypeDescription = eventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunitIdName = unit,\n\t\tpowName = pow,\n\t\tpoolName = pool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwinMove = isTwin,\n\t\tstartDistance,\n\t\tworkAssignmentId = workAssignment,\n\t\tunitReference = unitRef,\n\t\ttranId = tran_ID,\n\t\tlocType,\n\t\tlocId = locID,\n\t\tlocSlot,\n\t\topsPosId = opsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocid = unladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocid = ladenLocID,\n\t\tladenLocSlot = laden_LocSlot,\n\t\tlastEstMoveTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> removeDupEcEventGkey\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_aarhus')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as string,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as string,\n\t\tstartDistance as short,\n\t\tworkAssignment as double,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'apmtaarhus',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tcheName = CHE_Name,\n\t\tcheID,\n\t\tEcEventTime,\n\t\ttype = eventType,\n\t\tsubType = eventSubType,\n\t\ttypeDescription = eventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunitIdName = unit,\n\t\tpowName = pow,\n\t\tpoolName = pool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwinMove = isTwin,\n\t\tstartDistance,\n\t\tworkAssignmentId = workAssignment,\n\t\tunitReference = unitRef,\n\t\ttranId = tran_ID,\n\t\tlocType,\n\t\tlocId = locID,\n\t\tlocSlot,\n\t\topsPosId = opsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocid = unladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocid = ladenLocID,\n\t\tladenLocSlot = laden_LocSlot,\n\t\tlastEstMoveTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'apmtaarhus',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_aqaba')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as string,\n\t\tstartDistance as short,\n\t\tworkAssignment as double,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'apmtaqaba',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tcheName = CHE_Name,\n\t\tcheID,\n\t\tEcEventTime,\n\t\ttype = eventType,\n\t\tsubType = eventSubType,\n\t\ttypeDescription = eventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunitIdName = unit,\n\t\tpowName = pow,\n\t\tpoolName = pool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwinMove = isTwin,\n\t\tstartDistance,\n\t\tworkAssignmentId = workAssignment,\n\t\tunitReference = unitRef,\n\t\ttranId = tran_ID,\n\t\tlocType,\n\t\tlocId = locID,\n\t\tlocSlot,\n\t\topsPosId = opsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocid = unladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocid = ladenLocID,\n\t\tladenLocSlot = laden_LocSlot,\n\t\tlastEstMoveTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'apmtaqaba',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_cmsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1",
							"rejectedDataLinkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							}
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as string,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as string,\n\t\tTimeStamp as string,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as string,\n\t\tmoveKind as string,\n\t\tisTwin as string,\n\t\tstartDistance as string,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\toperator as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = :timestamp,\n\t\tYear = iifNull(year(:timestamp),0),\n\t\tMonth = iifNull(month(:timestamp),0),\n\t\tWeek = iifNull(weekOfYear(:timestamp),0),\n\t\tclient_id = \"CMSA\",\n\t\ttimestamp := coalesce(toTimestamp(split(TimeStamp, \".\")[1],'yyyy-MM-dd HH:mm:ss'), toTimestamp(split(TimeStamp, \".\")[1],'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\toperator,\n\t\tEcEventTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tclient_id\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as string,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as string,\n\t\tTimeStamp as string,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as string,\n\t\tmoveKind as string,\n\t\tisTwin as string,\n\t\tstartDistance as string,\n\t\tworkAssignment as string,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\toperator_name as string,\n\t\tclient_id as string,\n\t\tEcEventTime as timestamp,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\tlastEstMoveTime = TimeStamp,\n\t\toperator_name = operator,\n\t\tclient_id,\n\t\tEcEventTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_dpw_lg')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as boolean,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as boolean,\n\t\tToCheIdName as boolean,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignment as string,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\toperator_name as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'dpw-lg',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(concat(\r\n        substring(replace(TimeStamp, ',', ':'), 0, 21), \r\n        ' ',\r\n        right(TimeStamp, 2)\r\n    ), 'dd/MM/yy hh:mm:ss:SSS a'), \r\n    toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(concat(\r\n        substring(replace(TimeStamp, ',', ':'), 0, 21), \r\n        ' ',\r\n        right(TimeStamp, 2)\r\n    ), 'dd/MM/yy hh:mm:ss:SSS a'), \r\n    toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(concat(\r\n        substring(replace(TimeStamp, ',', ':'), 0, 21), \r\n        ' ',\r\n        right(TimeStamp, 2)\r\n    ), 'dd/MM/yy hh:mm:ss:SSS a'), \r\n    toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(concat(\r\n        substring(replace(TimeStamp, ',', ':'), 0, 21), \r\n        ' ',\r\n        right(TimeStamp, 2)\r\n    ), 'dd/MM/yy hh:mm:ss:SSS a'), \r\n    toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm'))),0)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\tEcEventTime,\n\t\tcheID,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tOPERATOR_ID = operator_name\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'dpw-lg',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: true,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_dpw_peru_new')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as integer,\n\t\tYARDID as string,\n\t\tFCYID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as boolean,\n\t\tToCheIdName as boolean,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as boolean,\n\t\tstartDistance as short,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tOPERATOR_NAME as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'dpw-peru',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(concat(\r\n        substring(replace(TimeStamp, ',', ':'), 0, 21), \r\n        ' ',\r\n        right(TimeStamp, 2)\r\n    ), 'dd/MM/yy hh:mm:ss:SSS a')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(concat(\r\n        substring(replace(TimeStamp, ',', ':'), 0, 21), \r\n        ' ',\r\n        right(TimeStamp, 2)\r\n    ), 'dd/MM/yy hh:mm:ss:SSS a'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(concat(\r\n        substring(replace(TimeStamp, ',', ':'), 0, 21), \r\n        ' ',\r\n        right(TimeStamp, 2)\r\n    ), 'dd/MM/yy hh:mm:ss:SSS a'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(concat(\r\n        substring(replace(TimeStamp, ',', ':'), 0, 21), \r\n        ' ',\r\n        right(TimeStamp, 2)\r\n    ), 'dd/MM/yy hh:mm:ss:SSS a'))),0)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID = YARDID,\n\t\tFcyID = FCYID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\tEcEventTime,\n\t\tcheID,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tOPERATOR_ID = OPERATOR_NAME\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'dpw-peru',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: true,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_gpa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as string,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as string,\n\t\tstartDistance as short,\n\t\tworkAssignment as double,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'gpa',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tcheName = CHE_Name,\n\t\tcheID,\n\t\tEcEventTime,\n\t\ttype = eventType,\n\t\tsubType = eventSubType,\n\t\ttypeDescription = eventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunitIdName = unit,\n\t\tpowName = pow,\n\t\tpoolName = pool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwinMove = isTwin,\n\t\tstartDistance,\n\t\tworkAssignmentId = workAssignment,\n\t\tunitReference = unitRef,\n\t\ttranId = tran_ID,\n\t\tlocType,\n\t\tlocId = locID,\n\t\tlocSlot,\n\t\topsPosId = opsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocid = unladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocid = ladenLocID,\n\t\tladenLocSlot = laden_LocSlot,\n\t\tlastEstMoveTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_haifa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as string,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as string,\n\t\tstartDistance as short,\n\t\tworkAssignment as double,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'haifa',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tcheName = CHE_Name,\n\t\tcheID,\n\t\tEcEventTime,\n\t\ttype = eventType,\n\t\tsubType = eventSubType,\n\t\ttypeDescription = eventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunitIdName = unit,\n\t\tpowName = pow,\n\t\tpoolName = pool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwinMove = isTwin,\n\t\tstartDistance,\n\t\tworkAssignmentId = workAssignment,\n\t\tunitReference = unitRef,\n\t\ttranId = tran_ID,\n\t\tlocType,\n\t\tlocId = locID,\n\t\tlocSlot,\n\t\topsPosId = opsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocid = unladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocid = ladenLocID,\n\t\tladenLocSlot = laden_LocSlot,\n\t\tlastEstMoveTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'haifa',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_hazira')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as boolean,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as boolean,\n\t\tToCheIdName as boolean,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as integer,\n\t\tmoveKind as string,\n\t\tisTwin as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignment as double,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\toperator_name as integer\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'hazira',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\tEcEventTime,\n\t\tcheID,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tOPERATOR_ID = operator_name\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'hazira',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: true,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_kattupalli')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as short,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignment as double,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\toperator_name as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'kattupalli',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tworkAssignment,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\tEcEventTime,\n\t\tcheID,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tOPERATOR_ID = operator_name\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'kattupalli',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: true,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_kssp')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "derivedColumn1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('kssp')\n}\nsource(output(\n\t\tecEventGkey as string,\n\t\tyardGkey as short,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as string,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as boolean,\n\t\tToCheIdName as boolean,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as boolean,\n\t\tstartDistance as short,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'kssp',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nderivedColumn1 derive(EcEventTime = toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = year(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS')),\n\t\tMonth = month(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss')))) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\tEcEventTime,\n\t\tcheID,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nCSV derive(TimeStamp = substring(TimeStamp,1,23)) ~> derivedColumn1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as short,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as boolean,\n\t\tToCheIdName as boolean,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as long,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'kssp',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tcheName = CHE_Name,\n\t\tcheID,\n\t\tEcEventTime,\n\t\ttype = eventType,\n\t\tsubType = eventSubType,\n\t\ttypeDescription = eventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunitIdName = unit,\n\t\tpowName = pow,\n\t\tpoolName = pool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwinMove = isTwin,\n\t\tstartDistance,\n\t\tlocType,\n\t\tlocId = locID,\n\t\tlocSlot,\n\t\topsPosId = opsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocid = unladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocid = ladenLocID,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_malta')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "derivedColumn1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as integer,\n\t\tYARDID as string,\n\t\tFCYID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as short,\n\t\tToCheIdName as short,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as boolean,\n\t\tstartDistance as short,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tOPERATOR_NAME as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: true,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'malta',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yy HH:mm'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yy HH:mm'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')))),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yy HH:mm'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')))),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yy HH:mm'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))))) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID = YARDID,\n\t\tFcyID = FCYID,\n\t\tcheKind,\n\t\tcheName = CHE_Name,\n\t\tcheID = CHE_ID,\n\t\ttype = eventType,\n\t\tsubType = eventSubType,\n\t\ttypeDescription = eventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunitIdName = unit,\n\t\tpowName = pow,\n\t\tpoolName = pool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tunitReference = unitRef,\n\t\ttranId = tran_ID,\n\t\tlocType,\n\t\tlocId = locID,\n\t\tlocSlot,\n\t\topsPosId = opsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocId = unladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocId = ladenLocID,\n\t\tladen_LocSlot,\n\t\toperatorName = OPERATOR_NAME,\n\t\tEcEventTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nderivedColumn1 filter(not(isNull(ecEventGkey))) ~> Filter1\nSelect1 derive(cheID = toLong(cheID),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tyardGkey = toLong(yardGkey)) ~> derivedColumn1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'malta',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_mict')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as string,\n\t\tstartDistance as short,\n\t\tworkAssignment as float,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\toperator as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'mict',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tworkAssignment,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\tlastEstMoveTime,\n\t\tEcEventTime,\n\t\tcheID,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_mnhpi')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "aggregate1",
							"description": "Aggregating data by 'ecEventGkey' producing columns 'yardGkey, YardID, FcyID, cheKind, cheName, cheID, EcEventTime, type, subType, typeDescription, fromCheIdName, ToCheIdName, unitIdName, powName, poolName, workQueue, travelDistance, moveKind, isTwinMove, startDistance, unitReference, tranId, locType, locId, locSlot, opsPosId, unladenLoctype, unladenLocid, unladenLocSlot, ladenLoctype, ladenLocid, ladenLocSlot, Year, Month, Week'"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as string,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as string,\n\t\tTimeStamp as string,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as string,\n\t\tstartDistance as string,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce( toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'yyyy/MM/dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\ttravelDistance = toInteger(travelDistance),\n\t\tstartDistance = toInteger(startDistance)) ~> DataTypeConversion\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tcheID,\n\t\tEcEventTime,\n\t\ttype = eventType,\n\t\tsubType = eventSubType,\n\t\ttypeDescription = eventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunitIdName = unit,\n\t\tpowName = pow,\n\t\tpoolName = pool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwinMove = isTwin,\n\t\tstartDistance,\n\t\tunitReference = unitRef,\n\t\ttranId = tran_ID,\n\t\tlocType,\n\t\tlocId = locID,\n\t\tlocSlot,\n\t\topsPosId = opsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocid = unladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocid = ladenLocID,\n\t\tladenLocSlot = laden_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tcheID,\n\t\tEcEventTime,\n\t\ttype,\n\t\tsubType,\n\t\ttypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunitIdName,\n\t\tpowName,\n\t\tpoolName,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwinMove,\n\t\tstartDistance,\n\t\tunitReference,\n\t\ttranId,\n\t\tlocType,\n\t\tlocId,\n\t\tlocSlot,\n\t\topsPosId,\n\t\tunladenLoctype,\n\t\tunladenLocid,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocid,\n\t\tladenLocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_mundra_ct02')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as short,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignment as double,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\toperator_name as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'mundra-ct02',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tworkAssignment,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\tEcEventTime,\n\t\tcheID,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tOPERATOR_ID = operator_name\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mundra-ct02',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: true,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_mundra_ct04')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as short,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignment as double,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\toperator_name as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'mundra-ct04',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tworkAssignment,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\tEcEventTime,\n\t\tcheID,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tOPERATOR_ID = operator_name\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mundra-ct04',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: true,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_pdports')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as boolean,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheShortName as string,\n\t\tcheID as short,\n\t\tEcEventTime as string,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as boolean,\n\t\tToCheIdName as boolean,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as long,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'pdports',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(EcEventTime,'dd-MM-yy HH:mm:ss'),toTimestamp(EcEventTime,'dd.MM.yy HH:mm:ss'),toTimestamp(EcEventTime,'MM/dd/yyyy HH:mm:ss'),toTimestamp(EcEventTime,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(EcEventTime,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(EcEventTime,'dd/MM/yyyy HH:mm:ss'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm:ss')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(cheID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(EcEventTime,'dd-MM-yy HH:mm:ss'),toTimestamp(EcEventTime,'dd.MM.yy HH:mm:ss'),toTimestamp(EcEventTime,'MM/dd/yyyy HH:mm:ss'),toTimestamp(EcEventTime,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(EcEventTime,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(EcEventTime,'dd/MM/yyyy HH:mm:ss'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(EcEventTime,'dd-MM-yy HH:mm:ss'),toTimestamp(EcEventTime,'dd.MM.yy HH:mm:ss'),toTimestamp(EcEventTime,'MM/dd/yyyy HH:mm:ss'),toTimestamp(EcEventTime,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(EcEventTime,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(EcEventTime,'dd/MM/yyyy HH:mm:ss'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(EcEventTime,'dd-MM-yy HH:mm:ss'),toTimestamp(EcEventTime,'dd.MM.yy HH:mm:ss'),toTimestamp(EcEventTime,'MM/dd/yyyy HH:mm:ss'),toTimestamp(EcEventTime,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(EcEventTime,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(EcEventTime,'dd/MM/yyyy HH:mm:ss'),toTimestamp(EcEventTime,'dd-MM-yyyy HH:mm:ss'))),0)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tcheName = cheShortName,\n\t\tcheID,\n\t\tEcEventTime,\n\t\ttype,\n\t\tsubType,\n\t\ttypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunitIdName,\n\t\tpowName,\n\t\tpoolName,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwinMove,\n\t\tstartDistance,\n\t\tworkAssignmentId,\n\t\tunitReference,\n\t\ttranId,\n\t\tlocType,\n\t\tlocId,\n\t\tlocSlot,\n\t\topsPosId,\n\t\tunladenLoctype,\n\t\tunladenLocid,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocid,\n\t\tladenLocSlot,\n\t\tlastEstMoveTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tcompressionType: 'snappy',\n\tcompressionLevel: 'Optimal',\n\tfileSystem: 'pdports',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_plipdeco')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as string,\n\t\tstartDistance as short,\n\t\tworkAssignment as double,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'plipdeco',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tcheName = CHE_Name,\n\t\tcheID,\n\t\tEcEventTime,\n\t\ttype = eventType,\n\t\tsubType = eventSubType,\n\t\ttypeDescription = eventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunitIdName = unit,\n\t\tpowName = pow,\n\t\tpoolName = pool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwinMove = isTwin,\n\t\tstartDistance,\n\t\tworkAssignmentId = workAssignment,\n\t\tunitReference = unitRef,\n\t\ttranId = tran_ID,\n\t\tlocType,\n\t\tlocId = locID,\n\t\tlocSlot,\n\t\topsPosId = opsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocid = unladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocid = ladenLocID,\n\t\tladenLocSlot = laden_LocSlot,\n\t\tlastEstMoveTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'plipdeco',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_railCycleTime_gpa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "events"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "rdscMoves"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "alterRow2"
						},
						{
							"name": "select1"
						},
						{
							"name": "filterRDSC"
						},
						{
							"name": "join1"
						},
						{
							"name": "select2"
						},
						{
							"name": "derivedColumn1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/ecevents') ~> events\nsource(output(\n\t\tmve_gkey as long,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as long,\n\t\tdist_start as long,\n\t\tTwin_Fetch as boolean,\n\t\tTwin_Carry as boolean,\n\t\tTwin_Put as boolean,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tRestow_Reason as string,\n\t\tPOW as string,\n\t\tufv_gkey as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tRequires_Power_Flag as boolean,\n\t\tOOG_Flag as boolean,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as long,\n\t\tComplex_Id as string,\n\t\tCarrier_Visit_Id as string,\n\t\tPhase as string,\n\t\tVisit_Nbr as string,\n\t\tCarrier_Mode as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\tOperator_Line_Id as string,\n\t\tOperator_Line_Role as string,\n\t\tOperator_Line_Name as string,\n\t\tTime_First_Availabilty as string,\n\t\tTime_Discharge_Complete as string,\n\t\tService_Id as string,\n\t\tService_Name as string,\n\t\tVessel_Id as string,\n\t\tIB_VYG as string,\n\t\tOB_VYG as string,\n\t\tCarrier_Name as string,\n\t\tVessel_Class as string,\n\t\tPublished_ETA as string,\n\t\tPublished_ETD as string,\n\t\tStart_Work as string,\n\t\tEnd_Work as string,\n\t\tBegin_Receive_Date as string,\n\t\tCargo_Cutoff_Date as string,\n\t\tHazard_Cutoff_Date as string,\n\t\tReefer_Cutoff_Date as string,\n\t\tLabor_On_Board_Date as string,\n\t\tLabor_Off_Board_Date as string,\n\t\tOff_Port_Arrival_Date as string,\n\t\tOff_Port_Departure as string,\n\t\tPilot_On_Board_Date as string,\n\t\tPilot_Off_Board_Date as string,\n\t\tEst_BBK_Discharge as string,\n\t\tEst_BBK_Load as string,\n\t\tEst_Load as string,\n\t\tEst_Discharge as string,\n\t\tEst_Restow as string,\n\t\tEst_Shift as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\tVessel_Classification as string,\n\t\tVessel_Class_Length_Overall_cm as integer,\n\t\tVessel_Class_Beam_cm as string,\n\t\tVessel_TEU_Capacity as string,\n\t\tLloyds_Code as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/moves') ~> rdscMoves\nevents filter((FcyID=='GCT' && ( (cheKind =='ITV' && moveKind=='YARD' && typeDescription =='TYDR') || ( cheKind =='RTG' && (moveKind=='YARD' || moveKind=='DLVR') && (typeDescription =='LIFT' || typeDescription =='CMPL'||typeDescription =='DROP') ) ) )) ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(EcEventDate = toDate(toString(EcEventTime,'yyyy-MM-dd')),\n\t\tEcEventTimeStr = toString(EcEventTime,'HH:mm:ss'),\n\t\tBlock = left(locSlot,3),\n\t\tunitIdName = rtrim(ltrim(unitIdName))) ~> DerivedColumn3\nSort1 window(asc(unitIdName, true),\n\tasc(EcEventTime, true),\n\tCHE_ID_PREV = lag(cheID),\n\t\tCHE_ID_NXT = lead(cheID),\n\t\tTimeStamp_PREV = lag(EcEventTime),\n\t\tTimeStamp_NXT = lead(EcEventTime),\n\t\teventTypeDescription_PREV = lag(typeDescription),\n\t\teventTypeDescription_NXT = lead(typeDescription),\n\t\tunit_PREV = lag(unitIdName),\n\t\tunit_NXT = lead(unitIdName),\n\t\tcheKind_PREV = lag(cheKind),\n\t\tcheKind_NXT = lead(cheKind),\n\t\teventTypeDescription_NXT2 = lead(typeDescription,2),\n\t\tcheKind_NXT2 = lead(cheKind,2),\n\t\tunit_NXT2 = lead(unitIdName,2),\n\t\tTimestamp_NXT2 = lead(EcEventTime,2),\n\t\tCHE_ID_NXT2 = lead(cheID,2)) ~> Window1\nWindow1 derive(Cycle_Time = toDouble(case( (unitIdName==unit_NXT) && (typeDescription=='TYDR') && (cheKind_NXT=='RTG') && (eventTypeDescription_NXT=='DROP'||eventTypeDescription_NXT=='CMPL'), TimeStamp_NXT-EcEventTime,toLong(0)) /3600000 ),\n\t\tCycleTime2 = case( (unitIdName==unit_NXT) && (typeDescription=='TYDR') && (cheKind_NXT=='RTG') && (eventTypeDescription_NXT=='DROP'||eventTypeDescription_NXT=='CMPL'), TimeStamp_NXT-EcEventTime,toLong(0)),\n\t\tCycleTime_Minute = toDouble(case( (unitIdName==unit_NXT) && (typeDescription=='TYDR') && (cheKind_NXT=='RTG') && (eventTypeDescription_NXT=='DROP'||eventTypeDescription_NXT=='CMPL'), TimeStamp_NXT-EcEventTime,toLong(0)) /60000 )) ~> DerivedColumn4\nselect2 sort(asc(unitIdName, true),\n\tasc(EcEventTime, true)) ~> Sort1\nDerivedColumn4 filter(CycleTime2>0) ~> Filter7\nFilter7 alterRow(upsertIf(true())) ~> alterRow2\nrdscMoves select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tt_put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tufv_gkey,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tCarrier_Visit_Id,\n\t\tCarrier_Mode,\n\t\tService_Id,\n\t\tt_fetch\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nselect1 filter((Facility_Id=='GCT' && Move_Kind=='RDSC' && Category_Id=='EXPRT' && Freight_Kind_Id=='FCL' && (Unit_Nbr=='MRKU7614004' || Unit_Nbr=='CAIU7987177' || Unit_Nbr=='TRHU4433395' || Unit_Nbr=='GLDU7308510')  )) ~> filterRDSC\nDerivedColumn3, derivedColumn1 join(unitIdName == Unit_Nbr\n\t&& EcEventTime >= eventStartTime\n\t&& EcEventTime <= maxEventTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'right')~> join1\njoin1 select(mapColumn(\n\t\tecEventGkey,\n\t\tFcyID,\n\t\tcheKind,\n\t\tcheName,\n\t\tcheID,\n\t\tEcEventTime,\n\t\tsubType,\n\t\ttypeDescription,\n\t\tunitIdName,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tEcEventDate,\n\t\tEcEventTimeStr,\n\t\tBlock,\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tCarrier_Visit_Key,\n\t\tMove_Kind,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tt_put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tufv_gkey,\n\t\tOOG_Flag,\n\t\tCarrier_Visit_Id,\n\t\tCarrier_Mode,\n\t\tService_Id,\n\t\tt_fetch,\n\t\tmaxEventTime,\n\t\teventStartTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select2\nfilterRDSC derive(maxEventTime = addDays(t_put,1),\n\t\teventStartTime = iif(isNull(t_fetch),t_put,t_fetch),\n\t\tufv_gkey = toLong(ufv_gkey),\n\t\tUnit_Nbr = ltrim(rtrim(Unit_Nbr))) ~> derivedColumn1\nalterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'gold/rdsc_cycle_time_test',\n\ttruncate: true,\n\tmergeSchema: false,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tFcyID,\n\t\tcheKind = cheKind_NXT2,\n\t\tcheName,\n\t\tcheID,\n\t\tEcEventTime,\n\t\tsubType,\n\t\ttypeDescription,\n\t\tunitIdName,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tEcEventDate,\n\t\tEcEventTimeStr,\n\t\tBlock,\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tCarrier_Visit_Key,\n\t\tMove_Kind,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tt_put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tufv_gkey,\n\t\tOOG_Flag,\n\t\tCarrier_Visit_Id,\n\t\tCarrier_Mode,\n\t\tService_Id,\n\t\tt_fetch,\n\t\tmaxEventTime,\n\t\teventStartTime,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\teventTypeDescription_PREV,\n\t\teventTypeDescription_NXT,\n\t\tunit_PREV,\n\t\tunit_NXT,\n\t\tcheKind_PREV,\n\t\tcheKind_NXT,\n\t\tCycle_Time,\n\t\tCycleTime2,\n\t\tCycleTime_Minute\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_railCycleTime_test_gpa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "events"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "rdscMoves"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "select1"
						},
						{
							"name": "filterRDSC"
						},
						{
							"name": "join1"
						},
						{
							"name": "select2"
						},
						{
							"name": "derivedColumn1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/ecevents') ~> events\nsource(output(\n\t\tmve_gkey as long,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as long,\n\t\tdist_start as long,\n\t\tTwin_Fetch as boolean,\n\t\tTwin_Carry as boolean,\n\t\tTwin_Put as boolean,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tRestow_Reason as string,\n\t\tPOW as string,\n\t\tufv_gkey as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tRequires_Power_Flag as boolean,\n\t\tOOG_Flag as boolean,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as long,\n\t\tComplex_Id as string,\n\t\tCarrier_Visit_Id as string,\n\t\tPhase as string,\n\t\tVisit_Nbr as string,\n\t\tCarrier_Mode as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\tOperator_Line_Id as string,\n\t\tOperator_Line_Role as string,\n\t\tOperator_Line_Name as string,\n\t\tTime_First_Availabilty as string,\n\t\tTime_Discharge_Complete as string,\n\t\tService_Id as string,\n\t\tService_Name as string,\n\t\tVessel_Id as string,\n\t\tIB_VYG as string,\n\t\tOB_VYG as string,\n\t\tCarrier_Name as string,\n\t\tVessel_Class as string,\n\t\tPublished_ETA as string,\n\t\tPublished_ETD as string,\n\t\tStart_Work as string,\n\t\tEnd_Work as string,\n\t\tBegin_Receive_Date as string,\n\t\tCargo_Cutoff_Date as string,\n\t\tHazard_Cutoff_Date as string,\n\t\tReefer_Cutoff_Date as string,\n\t\tLabor_On_Board_Date as string,\n\t\tLabor_Off_Board_Date as string,\n\t\tOff_Port_Arrival_Date as string,\n\t\tOff_Port_Departure as string,\n\t\tPilot_On_Board_Date as string,\n\t\tPilot_Off_Board_Date as string,\n\t\tEst_BBK_Discharge as string,\n\t\tEst_BBK_Load as string,\n\t\tEst_Load as string,\n\t\tEst_Discharge as string,\n\t\tEst_Restow as string,\n\t\tEst_Shift as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\tVessel_Classification as string,\n\t\tVessel_Class_Length_Overall_cm as integer,\n\t\tVessel_Class_Beam_cm as string,\n\t\tVessel_TEU_Capacity as string,\n\t\tLloyds_Code as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/moves') ~> rdscMoves\nevents filter((FcyID=='GCT' && ( (cheKind =='ITV' && typeDescription =='TYDR') || ( cheKind =='RTG' && (typeDescription =='CMPL'||typeDescription =='DROP') ) )  &&(unitIdName =='OOLU8572843'||unitIdName=='FSCU5045054' ||unitIdName=='TEMU8530430'))) ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(EcEventDate = toDate(toString(EcEventTime,'yyyy-MM-dd')),\n\t\tEcEventTimeStr = toString(EcEventTime,'HH:mm:ss'),\n\t\tBlock = left(locSlot,3),\n\t\tunitIdName = rtrim(ltrim(unitIdName))) ~> DerivedColumn3\nSort1 window(asc(unitIdName, true),\n\tasc(EcEventTime, true),\n\tCHE_ID_PREV = lag(cheID),\n\t\tCHE_ID_NXT = lead(cheID),\n\t\tTimeStamp_PREV = lag(EcEventTime),\n\t\tTimeStamp_NXT = lead(EcEventTime),\n\t\teventTypeDescription_PREV = lag(typeDescription),\n\t\teventTypeDescription_NXT = lead(typeDescription),\n\t\tunit_PREV = lag(unitIdName),\n\t\tunit_NXT = lead(unitIdName),\n\t\tcheKind_PREV = lag(cheKind),\n\t\tcheKind_NXT = lead(cheKind)) ~> Window1\nselect2 sort(asc(unitIdName, true),\n\tasc(EcEventTime, true)) ~> Sort1\nrdscMoves select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tt_put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tufv_gkey,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tCarrier_Visit_Id,\n\t\tCarrier_Mode,\n\t\tService_Id,\n\t\tt_fetch,\n\t\tPOW\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nselect1 filter((Facility_Id=='GCT' && Move_Kind=='RDSC' && Category_Id=='EXPRT' && (Unit_Nbr =='OOLU8572843'|| Unit_Nbr=='FSCU5045054' || Unit_Nbr=='TEMU8530430') )) ~> filterRDSC\nDerivedColumn3, derivedColumn1 join(unitIdName == Unit_Nbr\n\t&& EcEventTime >= eventStartTime\n\t&& EcEventTime <= maxEventTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'right')~> join1\njoin1 select(mapColumn(\n\t\tecEventGkey,\n\t\tFcyID,\n\t\tcheKind,\n\t\tcheName,\n\t\tcheID,\n\t\tEcEventTime,\n\t\ttype,\n\t\tsubType,\n\t\ttypeDescription,\n\t\tunitIdName,\n\t\tpowName,\n\t\tpoolName,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\topsPosId,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tEcEventDate,\n\t\tEcEventTimeStr,\n\t\tBlock,\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tt_put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tufv_gkey,\n\t\tOOG_Flag,\n\t\tCarrier_Visit_Id,\n\t\tCarrier_Mode,\n\t\tService_Id,\n\t\tt_fetch,\n\t\tmaxEventTime,\n\t\teventStartTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select2\nfilterRDSC derive(maxEventTime = addDays(t_put,1),\n\t\teventStartTime = iif(isNull(t_fetch),addDays(t_put,-1),t_fetch),\n\t\tufv_gkey = toLong(ufv_gkey),\n\t\tUnit_Nbr = ltrim(rtrim(Unit_Nbr))) ~> derivedColumn1\nWindow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'gold/rdsc_cycle_time_test',\n\ttruncate: true,\n\tmergeSchema: false,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_rio')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as boolean,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignment as long,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\toperator_name as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'rio',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tworkAssignment,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\tEcEventTime,\n\t\tcheID,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tOPERATOR_ID = operator_name\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'rio',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: false,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_salalah')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as string,\n\t\tstartDistance as short,\n\t\tworkAssignment as long,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'salalah',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tcheName = CHE_Name,\n\t\tcheID,\n\t\tEcEventTime,\n\t\ttype = eventType,\n\t\tsubType = eventSubType,\n\t\ttypeDescription = eventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunitIdName = unit,\n\t\tpowName = pow,\n\t\tpoolName = pool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwinMove = isTwin,\n\t\tstartDistance,\n\t\tworkAssignmentId = workAssignment,\n\t\tunitReference = unitRef,\n\t\ttranId = tran_ID,\n\t\tlocType,\n\t\tlocId = locID,\n\t\tlocSlot,\n\t\topsPosId = opsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocid = unladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocid = ladenLocID,\n\t\tladenLocSlot = laden_LocSlot,\n\t\tlastEstMoveTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tcompressionType: 'snappy',\n\tcompressionLevel: 'Optimal',\n\tfileSystem: 'salalah',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_seayard')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "derivedColumn1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as short,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as boolean,\n\t\tstartDistance as short,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\toperator_name as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: true,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'seayard',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss')),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss')))),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss')))),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'))))) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tcheName = CHE_Name,\n\t\tcheID = CHE_ID,\n\t\tEcEventTime,\n\t\ttype = eventType,\n\t\tsubType = eventSubType,\n\t\ttypeDescription = eventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunitIdName = unit,\n\t\tpowName = pow,\n\t\tpoolName = pool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwinMove = isTwin,\n\t\tstartDistance,\n\t\tunitReference = unitRef,\n\t\ttranId = tran_ID,\n\t\tlocType,\n\t\tlocId = locID,\n\t\tlocSlot,\n\t\topsPosId = opsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocid = unladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocid = ladenLocID,\n\t\tladenLocSlot = laden_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\toperator_id = operator_name\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nderivedColumn1 filter(not(isNull(ecEventGkey))) ~> Filter1\nSelect1 derive(cheID = toLong(cheID),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tyardGkey = toLong(yardGkey)) ~> derivedColumn1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'seayard',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_sgtd')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as integer,\n\t\tYARDID as string,\n\t\tFCYID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as boolean,\n\t\tToCheIdName as boolean,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignment as long,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tOPERATOR_NAME as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'sgtd',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(dropRight(TimeStamp, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(concat(substring(TimeStamp, 1, 22), ' ', substring(TimeStamp, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),\r\n    toTimestamp(TimeStamp, 'MM/dd/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm:ss')\r\n),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(dropRight(TimeStamp, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(concat(substring(TimeStamp, 1, 22), ' ', substring(TimeStamp, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),\r\n    toTimestamp(TimeStamp, 'MM/dd/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm:ss')\r\n))),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(dropRight(TimeStamp, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(concat(substring(TimeStamp, 1, 22), ' ', substring(TimeStamp, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),\r\n    toTimestamp(TimeStamp, 'MM/dd/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm:ss')\r\n))),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(dropRight(TimeStamp, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(concat(substring(TimeStamp, 1, 22), ' ', substring(TimeStamp, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),\r\n    toTimestamp(TimeStamp, 'MM/dd/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm:ss')\r\n)))) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID = YARDID,\n\t\tFcyID = FCYID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tworkAssignment,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\tlastEstMoveTime,\n\t\tEcEventTime,\n\t\tcheID,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'sgtd',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_sgtd_v2')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as integer,\n\t\tYARDID as string,\n\t\tFCYID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as boolean,\n\t\tToCheIdName as boolean,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignment as long,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tOPERATOR_NAME as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'sgtd',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(dropRight(TimeStamp, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(concat(substring(TimeStamp, 1, 22), ' ', substring(TimeStamp, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),\r\n    toTimestamp(TimeStamp, 'MM/dd/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm:ss')\r\n),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(dropRight(TimeStamp, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(concat(substring(TimeStamp, 1, 22), ' ', substring(TimeStamp, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),\r\n    toTimestamp(TimeStamp, 'MM/dd/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm:ss')\r\n))),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(dropRight(TimeStamp, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(concat(substring(TimeStamp, 1, 22), ' ', substring(TimeStamp, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),\r\n    toTimestamp(TimeStamp, 'MM/dd/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm:ss')\r\n))),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(dropRight(TimeStamp, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(concat(substring(TimeStamp, 1, 22), ' ', substring(TimeStamp, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),\r\n    toTimestamp(TimeStamp, 'MM/dd/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'yyyy-MM-dd HH:mm:ss.SSS'),\r\n    toTimestamp(TimeStamp, 'dd/MM/yyyy HH:mm:ss'),\r\n    toTimestamp(TimeStamp, 'dd-MM-yyyy HH:mm:ss')\r\n)))) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID = YARDID,\n\t\tFcyID = FCYID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tworkAssignment,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\tlastEstMoveTime,\n\t\tEcEventTime,\n\t\tcheID,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\toperator_name = OPERATOR_NAME\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false() && not(isNull(Year)) && not(isNull(Month))) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'sgtd',\n\tfolderPath: 'silver/ecevents_v2',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: false,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_socar')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as string,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as string,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as integer,\n\t\tmoveKind as string,\n\t\tisTwin as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignment as long,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\toperator_name as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: true,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'socar',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yy HH:mm'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yy HH:mm'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')))),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yy HH:mm'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')))),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yy HH:mm'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')))),\n\t\tecEventGkey = toLong(ecEventGkey)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tworkAssignment,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\tlastEstMoveTime,\n\t\toperator_name,\n\t\tEcEventTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(not(isNull(ecEventGkey))) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'socar',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_tauranga')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "derivedColumn1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as integer,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as boolean,\n\t\tToCheIdName as boolean,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignment as long,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: true,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'tauranga',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'), toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss')),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'), toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss')))),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'), toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss')))),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'), toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'))))) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tcheName = CHE_Name,\n\t\tcheID = CHE_ID,\n\t\tEcEventTime,\n\t\ttype = eventType,\n\t\tsubType = eventSubType,\n\t\ttypeDescription = eventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunitIdName = unit,\n\t\tpowName = pow,\n\t\tpoolName = pool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwinMove = isTwin,\n\t\tstartDistance,\n\t\tworkAssignmentId = workAssignment,\n\t\tunitReference = unitRef,\n\t\ttranId = tran_ID,\n\t\tlocType,\n\t\tlocId = locID,\n\t\tlocSlot,\n\t\topsPosId = opsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocid = unladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocid = ladenLocID,\n\t\tladenLocSlot = laden_LocSlot,\n\t\tlastEstMoveTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nderivedColumn1 filter(not(isNull(ecEventGkey))) ~> Filter1\nSelect1 derive(cheID = toLong(cheID),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tyardGkey = toLong(yardGkey)) ~> derivedColumn1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'tauranga',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_tdt')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as string,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as string,\n\t\tstartDistance as short,\n\t\tworkAssignment as double,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'tdt',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tcheName = CHE_Name,\n\t\tcheID,\n\t\tEcEventTime,\n\t\ttype = eventType,\n\t\tsubType = eventSubType,\n\t\ttypeDescription = eventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunitIdName = unit,\n\t\tpowName = pow,\n\t\tpoolName = pool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwinMove = isTwin,\n\t\tstartDistance,\n\t\tworkAssignmentId = workAssignment,\n\t\tunitReference = unitRef,\n\t\ttranId = tran_ID,\n\t\tlocType,\n\t\tlocId = locID,\n\t\tlocSlot,\n\t\topsPosId = opsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocid = unladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocid = ladenLocID,\n\t\tladenLocSlot = laden_LocSlot,\n\t\tlastEstMoveTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'tdt',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_transnet')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('transnet')\n}\nsource(output(\n\t\tecEventGkey as string,\n\t\tyardGkey as short,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as string,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as boolean,\n\t\tToCheIdName as boolean,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as boolean,\n\t\tstartDistance as short,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'transnet',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ';',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nderivedColumn1 derive(EcEventTime = toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),\n\t\tecEventGkey = toInteger(ecEventGkey),\n\t\tcheID = toInteger(CHE_ID),\n\t\tYear = year(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS')),\n\t\tMonth = month(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd-MM-yy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss')))) ~> DataTypeConversion\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\tEcEventTime,\n\t\tcheID,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nCSV derive(TimeStamp = substring(TimeStamp,1,23)) ~> derivedColumn1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'transnet',\n\tfolderPath: 'silver/ecevents',\n\tmergeSchema: false,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\tEcEventTime,\n\t\tcheID,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/EcEvents_v2_mict')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Filter1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as short,\n\t\teventSubType as short,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwin as string,\n\t\tstartDistance as short,\n\t\tworkAssignment as float,\n\t\tunitRef as string,\n\t\ttran_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\toperator as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/ecevents/load','bronze/ecevents/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'mict',\n\tfolderPath: 'bronze/ecevents/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(EcEventTime = coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss')),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tcheID = toLong(CHE_ID),\n\t\tYear = iifNull(year(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tMonth = iifNull(month(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0),\n\t\tWeek = iifNull(weekOfYear(coalesce(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss'),toTimestamp(TimeStamp,'dd.MM.yy HH:mm:ss'),toTimestamp(TimeStamp,'MM/dd/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(TimeStamp,'dd/MM/yyyy HH:mm:ss'),toTimestamp(TimeStamp,'dd-MM-yyyy HH:mm:ss'))),0)) ~> DataTypeConversion\nFilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwin,\n\t\tstartDistance,\n\t\tworkAssignment,\n\t\tunitRef,\n\t\ttran_ID,\n\t\tlocType,\n\t\tlocID,\n\t\tlocSlot,\n\t\topsPosID,\n\t\tunladenLoctype,\n\t\tunladenLocID,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocID,\n\t\tladen_LocSlot,\n\t\tlastEstMoveTime,\n\t\tEcEventTime,\n\t\tcheID,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\toperator\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 filter(isNull(ecEventGkey)==false()) ~> Filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'silver/ecevents_v2',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/FailToDeck')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1",
							"description": "Creating/updating the columns 'gkey, uyv_gkey, unit_id, time_stamp, decking_type, node_id, yard, from_pos_loctype, from_pos_locid, from_pos_loc_gkey, from_pos_slot, from_pos_name, from_pos_bin, from_pos_tier, to_pos_loctype, to_pos_locid, to_pos_loc_gkey, to_pos_slot, to_pos_name, to_pos_bin, to_pos_tier, total_score, execution_time, details, phase, TIME_STAMP, Year, Month, Week' "
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('valencia')\n}\nsource(output(\n\t\tgkey as integer,\n\t\tuyv_gkey as integer,\n\t\tunit_id as string,\n\t\ttime_stamp as string,\n\t\tdecking_type as string,\n\t\tnode_id as string,\n\t\tyard as string,\n\t\tfrom_pos_loctype as string,\n\t\tfrom_pos_locid as string,\n\t\tfrom_pos_loc_gkey as integer,\n\t\tfrom_pos_slot as string,\n\t\tfrom_pos_name as string,\n\t\tfrom_pos_bin as string,\n\t\tfrom_pos_tier as short,\n\t\tto_pos_loctype as string,\n\t\tto_pos_locid as string,\n\t\tto_pos_loc_gkey as string,\n\t\tto_pos_slot as string,\n\t\tto_pos_name as string,\n\t\tto_pos_bin as string,\n\t\tto_pos_tier as string,\n\t\ttotal_score as short,\n\t\texecution_time as short,\n\t\tdetails as string,\n\t\tphase as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delimited',\n\tfileSystem: ($customer),\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> CSV\nCSV derive(TIME_STAMP = toTimestamp(time_stamp,'dd.MM.yy HH:mm:ss'),\n\t\tYear = year(toTimestamp(time_stamp,'dd.MM.yy HH:mm:ss')),\n\t\tMonth = month(toTimestamp(time_stamp,'dd.MM.yy HH:mm:ss')),\n\t\tWeek = weekOfYear(toTimestamp(time_stamp,'dd.MM.yy HH:mm:ss'))) ~> DerivedColumn1\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nDerivedColumn1 aggregate(groupBy(GKEY = gkey),\n\teach(match(name!='GKEY'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'silver/failtodeck',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['GKEY'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/FailToDeck_CTB')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('eurogatectb')\n}\nsource(output(\n\t\tGKEY as long,\n\t\tUYV_GKEY as long,\n\t\tUNIT_ID as string,\n\t\tTIME_STAMP as string,\n\t\tDECKING_TYPE as string,\n\t\tNODE_ID as string,\n\t\tYARD as short,\n\t\tFROM_POS_LOCTYPE as string,\n\t\tFROM_POS_LOCID as string,\n\t\tFROM_POS_LOC_GKEY as long,\n\t\tFROM_POS_SLOT as string,\n\t\tFROM_POS_NAME as string,\n\t\tFROM_POS_BIN as integer,\n\t\tFROM_POS_TIER as short,\n\t\tTO_POS_LOCTYPE as string,\n\t\tTO_POS_LOCID as string,\n\t\tTO_POS_LOC_GKEY as short,\n\t\tTO_POS_SLOT as string,\n\t\tTO_POS_NAME as string,\n\t\tTO_POS_BIN as short,\n\t\tTO_POS_TIER as boolean,\n\t\tTOTAL_SCORE as short,\n\t\tEXECUTION_TIME as short,\n\t\tDETAILS as string,\n\t\tPHASE as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/failtodeck/load','bronze/failtodeck/archive'],\n\tformat: 'delimited',\n\tfileSystem: ($customer),\n\tfolderPath: 'bronze/failtodeck/load',\n\tcolumnDelimiter: ';',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> CSV\nCSV derive(TIME_STAMP = toTimestamp(TIME_STAMP,'dd.MM.yy HH:mm:ss'),\n\t\tYear = year(toTimestamp(TIME_STAMP,'dd.MM.yy HH:mm:ss')),\n\t\tMonth = month(toTimestamp(TIME_STAMP,'dd.MM.yy HH:mm:ss')),\n\t\tWeek = weekOfYear(toTimestamp(TIME_STAMP,'dd.MM.yy HH:mm:ss'))) ~> DerivedColumn1\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nDerivedColumn1 aggregate(groupBy(GKEY),\n\teach(match(name!='GKEY'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'silver/failtodeck',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['GKEY'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/FailToDeck_MTY')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "AlterRow1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "select2"
						},
						{
							"name": "aggregate2"
						}
					],
					"script": "parameters{\n\tcustomer as string ('valencia')\n}\nsource(output(\n\t\tgkey as integer,\n\t\tuyv_gkey as integer,\n\t\tunit_id as string,\n\t\ttime_stamp as timestamp,\n\t\tdecking_type as string,\n\t\tnode_id as string,\n\t\tyard as string,\n\t\tfrom_pos_loctype as string,\n\t\tfrom_pos_locid as string,\n\t\tfrom_pos_loc_gkey as integer,\n\t\tfrom_pos_slot as string,\n\t\tfrom_pos_name as string,\n\t\tfrom_pos_bin as string,\n\t\tfrom_pos_tier as short,\n\t\tto_pos_loctype as string,\n\t\tto_pos_locid as string,\n\t\tto_pos_loc_gkey as string,\n\t\tto_pos_slot as string,\n\t\tto_pos_name as string,\n\t\tto_pos_bin as string,\n\t\tto_pos_tier as string,\n\t\ttotal_score as short,\n\t\texecution_time as short,\n\t\tdetails as string,\n\t\tphase as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'silver/failtodeck') ~> CSV\nsource(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'silver/moves') ~> source1\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nsource1 filter(Freight_Kind_Id=='MTY') ~> filter1\nCSV, aggregate2 join(unit_id == Unit_Nbr\n\t&& time_stamp >= ATA\n\t&& time_stamp <= ATD,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'right')~> join1\njoin1 select(skipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nfilter1 select(mapColumn(\n\t\tUnit_Nbr,\n\t\tFreight_Kind_Id,\n\t\tATA,\n\t\tATD\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select2\nselect2 aggregate(groupBy(Unit_Nbr,\n\t\tFreight_Kind_Id,\n\t\tATA,\n\t\tATD),\n\teach(match(name!='Unit_Nbr'&&name!='ATD'&&name!='ATA'&&name!='Freight_Kind_Id'), $$ = first($$))) ~> aggregate2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'silver/failtodeck_mty',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/FailToDeck_MTY_gpa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "AlterRow1"
						},
						{
							"name": "select1"
						},
						{
							"name": "filter1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('gpa')\n}\nsource(output(\n\t\tGKEY as long,\n\t\tCATEGORY as string,\n\t\tFREIGHT_KIND as string,\n\t\tBASIC_LENGTH as string,\n\t\tEQUIPMENT_TYPE_ID as string,\n\t\tISO_GROUP as string,\n\t\tUNIT_ID as string,\n\t\tTIME_STAMP as timestamp,\n\t\tDECKING_TYPE as string,\n\t\tNODE_ID as string,\n\t\tYARD as string,\n\t\tFROM_POS_LOCTYPE as string,\n\t\tFROM_POS_LOCID as string,\n\t\tFROM_POS_LOC_GKEY as string,\n\t\tFROM_POS_SLOT as string,\n\t\tFROM_POS_NAME as string,\n\t\tFROM_POS_BIN as integer,\n\t\tFROM_POS_TIER as string,\n\t\tTO_POS_LOCTYPE as string,\n\t\tTO_POS_LOCID as string,\n\t\tTO_POS_LOC_GKEY as string,\n\t\tTO_POS_SLOT as string,\n\t\tTO_POS_NAME as string,\n\t\tTO_POS_BIN as string,\n\t\tTO_POS_TIER as string,\n\t\tTOTAL_SCORE as short,\n\t\tEXECUTION_TIME as short,\n\t\tDETAILS as string,\n\t\tPHASE as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/failtodeck') ~> CSV\nselect1 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 select(skipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nCSV filter(FREIGHT_KIND=='MTY') ~> filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/failtodeck_mty',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/FailToDeck_bySvc_gpa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "ftd joined to moves",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "mvs"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "select1"
						},
						{
							"name": "cast1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as long,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as long,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as string,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as long,",
						"          dist_start as long,",
						"          Twin_Fetch as boolean,",
						"          Twin_Carry as boolean,",
						"          Twin_Put as boolean,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          Restow_Reason as string,",
						"          POW as string,",
						"          ufv_gkey as string,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          Requires_Power_Flag as boolean,",
						"          OOG_Flag as boolean,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as long,",
						"          Complex_Id as string,",
						"          Carrier_Visit_Id as string,",
						"          Phase as string,",
						"          Visit_Nbr as string,",
						"          Carrier_Mode as string,",
						"          ETA as string,",
						"          ETD as string,",
						"          Operator_Line_Id as string,",
						"          Operator_Line_Role as string,",
						"          Operator_Line_Name as string,",
						"          Time_First_Availabilty as string,",
						"          Time_Discharge_Complete as string,",
						"          Service_Id as string,",
						"          Service_Name as string,",
						"          Vessel_Id as string,",
						"          IB_VYG as string,",
						"          OB_VYG as string,",
						"          Carrier_Name as string,",
						"          Vessel_Class as string,",
						"          Published_ETA as string,",
						"          Published_ETD as string,",
						"          Start_Work as string,",
						"          End_Work as string,",
						"          Begin_Receive_Date as string,",
						"          Cargo_Cutoff_Date as string,",
						"          Hazard_Cutoff_Date as string,",
						"          Reefer_Cutoff_Date as string,",
						"          Labor_On_Board_Date as string,",
						"          Labor_Off_Board_Date as string,",
						"          Off_Port_Arrival_Date as string,",
						"          Off_Port_Departure as string,",
						"          Pilot_On_Board_Date as string,",
						"          Pilot_Off_Board_Date as string,",
						"          Est_BBK_Discharge as string,",
						"          Est_BBK_Load as string,",
						"          Est_Load as string,",
						"          Est_Discharge as string,",
						"          Est_Restow as string,",
						"          Est_Shift as string,",
						"          vvFlexString01 as string,",
						"          vvFlexString02 as string,",
						"          vvFlexString03 as string,",
						"          vvFlexString04 as string,",
						"          vvFlexString05 as string,",
						"          vvFlexString06 as string,",
						"          vvFlexString07 as string,",
						"          vvFlexString08 as string,",
						"          vvFlexDate01 as string,",
						"          vvFlexDate02 as string,",
						"          vvFlexDate03 as string,",
						"          vvFlexDate04 as string,",
						"          vvFlexDate05 as string,",
						"          vvFlexDate06 as string,",
						"          vvFlexDate07 as string,",
						"          vvFlexDate08 as string,",
						"          Vessel_Classification as string,",
						"          Vessel_Class_Length_Overall_cm as integer,",
						"          Vessel_Class_Beam_cm as string,",
						"          Vessel_TEU_Capacity as string,",
						"          Lloyds_Code as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'gpa',",
						"     folderPath: 'silver/moves') ~> mvs",
						"mvs select(mapColumn(",
						"          mve_gkey,",
						"          Unit_Nbr,",
						"          Facility_Id,",
						"          Yard_Id,",
						"          Carrier_Visit_Key,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Location,",
						"          To_Location,",
						"          From_Position_Name,",
						"          To_Position_Name,",
						"          Fetch_CHE_Id,",
						"          Fetch_CHE_Kind,",
						"          Carry_CHE_Id,",
						"          Carry_CHE_Kind,",
						"          Put_CHE_Id,",
						"          Put_CHE_Kind,",
						"          QC_CHE_Id,",
						"          QC_CHE_Kind,",
						"          t_carry_complete,",
						"          t_put,",
						"          t_fetch,",
						"          t_dispatch,",
						"          t_discharge,",
						"          t_carry_dispatch,",
						"          t_carry_fetch_ready,",
						"          t_carry_put_ready,",
						"          Category_Id,",
						"          Freight_Kind_Id,",
						"          POW,",
						"          ufv_gkey,",
						"          Requires_Power_Flag,",
						"          OOG_Flag,",
						"          ATD,",
						"          Carrier_Visit_Id,",
						"          Carrier_Mode,",
						"          Service_Id,",
						"          Service_Name,",
						"          Carrier_Name,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          MvDt = t_put",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> select1",
						"select1 cast(output(",
						"          MvDt as date",
						"     ),",
						"     errors: true) ~> cast1",
						"cast1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'gpa',",
						"     folderPath: 'gold/failtodecksvc',",
						"     truncate: true,",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/FailToDeck_cmsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('cmsa')\n}\nsource(output(\n\t\tcategory as string,\n\t\tfreight_Kind as string,\n\t\tbasic_length as string,\n\t\tEquipment_Type_Id as string,\n\t\tiso_group as string,\n\t\tgkey as integer,\n\t\tunit_id as string,\n\t\ttime_stamp as string,\n\t\tdecking_type as string,\n\t\tnode_id as string,\n\t\tyard as short,\n\t\tfrom_pos_loctype as string,\n\t\tfrom_pos_locid as string,\n\t\tfrom_pos_loc_gkey as integer,\n\t\tfrom_pos_slot as string,\n\t\tfrom_pos_name as string,\n\t\tfrom_pos_bin as string,\n\t\tfrom_pos_tier as short,\n\t\tto_pos_loctype as string,\n\t\tto_pos_locid as string,\n\t\tto_pos_loc_gkey as integer,\n\t\tto_pos_slot as string,\n\t\tto_pos_name as string,\n\t\tto_pos_bin as string,\n\t\tto_pos_tier as short,\n\t\ttotal_score as short,\n\t\texecution_time as short,\n\t\tphase as string,\n\t\trequires_power as short,\n\t\tufv_gkey as integer,\n\t\tis_oog as short,\n\t\tHazardous_Flag as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/failtodeck/load','bronze/failtodeck/archive'],\n\tformat: 'delimited',\n\tfileSystem: ($customer),\n\tfolderPath: 'bronze/failtodeck/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> CSV\nCSV derive(time_stamp = toTimestamp(time_stamp,'yyyy-MM-dd HH:mm:ss.SSS'),\n\t\tYear = year(toTimestamp(time_stamp,'yyyy-MM-dd HH:mm:ss.SSS')),\n\t\tMonth = month(toTimestamp(time_stamp,'yyyy-MM-dd HH:mm:ss.SSS')),\n\t\tWeek = weekOfYear(toTimestamp(time_stamp,'yyyy-MM-dd HH:mm:ss.SSS')),\n\t\tgkey = toLong(gkey),\n\t\tufv_gkey = toLong(ufv_gkey)) ~> DerivedColumn1\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nselect1 aggregate(groupBy(gkey),\n\teach(match(name!='gkey'), $$ = first($$))) ~> aggregate1\nDerivedColumn1 select(mapColumn(\n\t\tcategory,\n\t\tfreight_Kind,\n\t\tbasic_length,\n\t\tEquipment_Type_Id,\n\t\tiso_group,\n\t\tgkey,\n\t\tunit_id,\n\t\ttime_stamp,\n\t\tdecking_type,\n\t\tnode_id,\n\t\tyard,\n\t\tfrom_pos_loctype,\n\t\tfrom_pos_locid,\n\t\tfrom_pos_loc_gkey,\n\t\tfrom_pos_slot,\n\t\tfrom_pos_name,\n\t\tfrom_pos_bin,\n\t\tfrom_pos_tier,\n\t\tto_pos_loctype,\n\t\tto_pos_locid,\n\t\tto_pos_loc_gkey,\n\t\tto_pos_slot,\n\t\tto_pos_name,\n\t\tto_pos_bin,\n\t\tto_pos_tier,\n\t\ttotal_score,\n\t\texecution_time,\n\t\tphase,\n\t\trequires_power,\n\t\tufv_gkey,\n\t\tis_oog,\n\t\tHazardous_Flag,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'silver/failtodeck',\n\tmergeSchema: false,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tgkey,\n\t\tcategory,\n\t\tfreight_Kind,\n\t\tbasic_length,\n\t\tEquipment_Type_Id,\n\t\tiso_group,\n\t\tunit_id,\n\t\ttime_stamp,\n\t\tdecking_type,\n\t\tnode_id,\n\t\tyard,\n\t\tfrom_pos_loctype,\n\t\tfrom_pos_locid,\n\t\tfrom_pos_loc_gkey,\n\t\tfrom_pos_slot,\n\t\tfrom_pos_name,\n\t\tfrom_pos_bin,\n\t\tfrom_pos_tier,\n\t\tto_pos_loctype,\n\t\tto_pos_locid,\n\t\tto_pos_loc_gkey,\n\t\tto_pos_slot,\n\t\tto_pos_name,\n\t\tto_pos_bin,\n\t\tto_pos_tier,\n\t\ttotal_score,\n\t\texecution_time,\n\t\tphase,\n\t\trequires_power,\n\t\tufv_gkey,\n\t\tis_oog,\n\t\tHazardous_Flag,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/FailToDeck_gpa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('gpa')\n}\nsource(output(\n\t\tCATEGORY as string,\n\t\tFREIGHT_KIND as string,\n\t\tBASIC_LENGHT as string,\n\t\tEQUIPMENT_TYPE_ID as string,\n\t\tISO_GROUP as string,\n\t\tGKEY as long,\n\t\tUNIT_ID as string,\n\t\tTIME_STAMP as string,\n\t\tDECKING_TYPE as string,\n\t\tNODE_ID as string,\n\t\tYARD as integer,\n\t\tFROM_POS_LOCTYPE as string,\n\t\tFROM_POS_LOCID as string,\n\t\tFROM_POS_LOC_GKEY as long,\n\t\tFROM_POS_SLOT as string,\n\t\tFROM_POS_NAME as string,\n\t\tFROM_POS_BIN as long,\n\t\tFROM_POS_TIER as short,\n\t\tTO_POS_LOCTYPE as string,\n\t\tTO_POS_LOCID as string,\n\t\tTO_POS_LOC_GKEY as integer,\n\t\tTO_POS_SLOT as string,\n\t\tTO_POS_NAME as string,\n\t\tTO_POS_BIN as string,\n\t\tTO_POS_TIER as string,\n\t\tTOTAL_SCORE as short,\n\t\tEXECUTION_TIME as short,\n\t\tDETAILS as string,\n\t\tPHASE as string,\n\t\tREQUIRES_POWER as short\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/failtodeck/load','bronze/failtodeck/archive'],\n\tformat: 'delimited',\n\tfileSystem: ($customer),\n\tfolderPath: 'bronze/failtodeck/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> CSV\nCSV derive(TIME_STAMP = toTimestamp(TIME_STAMP,'MM/dd/yyyy HH:mm'),\n\t\tYear = year(toTimestamp(TIME_STAMP,'MM/dd/yyyy HH:mm')),\n\t\tMonth = month(toTimestamp(TIME_STAMP,'MM/dd/yyyy HH:mm')),\n\t\tWeek = weekOfYear(toTimestamp(TIME_STAMP,'MM/dd/yyyy HH:mm'))) ~> DerivedColumn1\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nselect1 aggregate(groupBy(GKEY),\n\teach(match(name!='GKEY'), $$ = first($$))) ~> aggregate1\nDerivedColumn1 select(mapColumn(\n\t\tCATEGORY,\n\t\tFREIGHT_KIND,\n\t\tBASIC_LENGTH = BASIC_LENGHT,\n\t\tEQUIPMENT_TYPE_ID,\n\t\tISO_GROUP,\n\t\tGKEY,\n\t\tUNIT_ID,\n\t\tTIME_STAMP,\n\t\tDECKING_TYPE,\n\t\tNODE_ID,\n\t\tYARD,\n\t\tFROM_POS_LOCTYPE,\n\t\tFROM_POS_LOCID,\n\t\tFROM_POS_LOC_GKEY,\n\t\tFROM_POS_SLOT,\n\t\tFROM_POS_NAME,\n\t\tFROM_POS_BIN,\n\t\tFROM_POS_TIER,\n\t\tTO_POS_LOCTYPE,\n\t\tTO_POS_LOCID,\n\t\tTO_POS_LOC_GKEY,\n\t\tTO_POS_SLOT,\n\t\tTO_POS_NAME,\n\t\tTO_POS_BIN,\n\t\tTO_POS_TIER,\n\t\tTOTAL_SCORE,\n\t\tEXECUTION_TIME,\n\t\tDETAILS,\n\t\tPHASE,\n\t\tREQUIRES_POWER,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/failtodeck',\n\tmergeSchema: false,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['GKEY'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tGKEY,\n\t\tCATEGORY,\n\t\tFREIGHT_KIND,\n\t\tBASIC_LENGTH,\n\t\tEQUIPMENT_TYPE_ID,\n\t\tISO_GROUP,\n\t\tUNIT_ID,\n\t\tTIME_STAMP,\n\t\tDECKING_TYPE,\n\t\tNODE_ID,\n\t\tYARD,\n\t\tFROM_POS_LOCTYPE,\n\t\tFROM_POS_LOCID,\n\t\tFROM_POS_LOC_GKEY,\n\t\tFROM_POS_SLOT,\n\t\tFROM_POS_NAME,\n\t\tFROM_POS_BIN,\n\t\tFROM_POS_TIER,\n\t\tTO_POS_LOCTYPE,\n\t\tTO_POS_LOCID,\n\t\tTO_POS_LOC_GKEY,\n\t\tTO_POS_SLOT,\n\t\tTO_POS_NAME,\n\t\tTO_POS_BIN,\n\t\tTO_POS_TIER,\n\t\tTOTAL_SCORE,\n\t\tEXECUTION_TIME,\n\t\tDETAILS,\n\t\tPHASE,\n\t\tREQUIRES_POWER,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/FailToDeck_valencia')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('valencia')\n}\nsource(output(\n\t\tgkey as integer,\n\t\tuyv_gkey as integer,\n\t\tunit_id as string,\n\t\ttime_stamp as string,\n\t\tdecking_type as string,\n\t\tnode_id as string,\n\t\tyard as string,\n\t\tfrom_pos_loctype as string,\n\t\tfrom_pos_locid as string,\n\t\tfrom_pos_loc_gkey as integer,\n\t\tfrom_pos_slot as string,\n\t\tfrom_pos_name as string,\n\t\tfrom_pos_bin as string,\n\t\tfrom_pos_tier as short,\n\t\tto_pos_loctype as string,\n\t\tto_pos_locid as string,\n\t\tto_pos_loc_gkey as string,\n\t\tto_pos_slot as string,\n\t\tto_pos_name as string,\n\t\tto_pos_bin as string,\n\t\tto_pos_tier as string,\n\t\ttotal_score as short,\n\t\texecution_time as short,\n\t\tdetails as string,\n\t\tphase as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/failtodeck','bronze/failtodeck/archive'],\n\tformat: 'delimited',\n\tfileSystem: ($customer),\n\tfolderPath: 'bronze/failtodeck',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> CSV\nCSV derive(time_stamp = toTimestamp(time_stamp,'yyyy-MM-dd HH:mm:ss.SSS'),\n\t\tYear = year(toTimestamp(time_stamp,'yyyy-MM-dd HH:mm:ss.SSS')),\n\t\tMonth = month(toTimestamp(time_stamp,'yyyy-MM-dd HH:mm:ss.SSS')),\n\t\tWeek = weekOfYear(toTimestamp(time_stamp,'yyyy-MM-dd HH:mm:ss.SSS'))) ~> DerivedColumn1\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nDerivedColumn1 aggregate(groupBy(gkey),\n\teach(match(name!='gkey'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tgkey as integer,\n\t\tuyv_gkey as integer,\n\t\tunit_id as string,\n\t\ttime_stamp as timestamp,\n\t\tdecking_type as string,\n\t\tnode_id as string,\n\t\tyard as string,\n\t\tfrom_pos_loctype as string,\n\t\tfrom_pos_locid as string,\n\t\tfrom_pos_loc_gkey as integer,\n\t\tfrom_pos_slot as string,\n\t\tfrom_pos_name as string,\n\t\tfrom_pos_bin as string,\n\t\tfrom_pos_tier as short,\n\t\tto_pos_loctype as string,\n\t\tto_pos_locid as string,\n\t\tto_pos_loc_gkey as string,\n\t\tto_pos_slot as string,\n\t\tto_pos_name as string,\n\t\tto_pos_bin as string,\n\t\tto_pos_tier as string,\n\t\ttotal_score as short,\n\t\texecution_time as short,\n\t\tdetails as string,\n\t\tphase as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'silver/failtodeck',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['GKEY'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tgkey,\n\t\tuyv_gkey,\n\t\tunit_id,\n\t\ttime_stamp,\n\t\tdecking_type,\n\t\tnode_id,\n\t\tyard,\n\t\tfrom_pos_loctype,\n\t\tfrom_pos_locid,\n\t\tfrom_pos_loc_gkey,\n\t\tfrom_pos_slot,\n\t\tfrom_pos_name,\n\t\tfrom_pos_bin,\n\t\tfrom_pos_tier,\n\t\tto_pos_loctype,\n\t\tto_pos_locid,\n\t\tto_pos_loc_gkey,\n\t\tto_pos_slot,\n\t\tto_pos_name,\n\t\tto_pos_bin,\n\t\tto_pos_tier,\n\t\ttotal_score,\n\t\texecution_time,\n\t\tdetails,\n\t\tphase,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/GMPH')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(Event_Type_Id==\"UNIT_DISCH\" || Event_Type_Id == \"UNIT_LOAD\") ~> Filter1\nFilter1 derive(Time_Completed_Date_Time = iif(Event_Type_Id== \"UNIT_LOAD\", iifNull(t_put,t_carry_complete),iifNull(t_fetch,t_discharge))) ~> DerivedColumn1\nDerivedColumn1 derive(Time = toString(Time_Completed_Date_Time,'HH:mm:ss'),\n\t\tDate = toDate(toString(Time_Completed_Date_Time,'yyyy-MM-dd'))) ~> DerivedColumn2\nDerivedColumn2 aggregate(groupBy(Carrier_Visit_Key,\n\t\tpow,\n\t\tDate),\n\tFirst_Lift = min(Time_Completed_Date_Time),\n\t\tLast_Lift = max(Time_Completed_Date_Time),\n\t\tMove_Count = countDistinct(mve_gkey)) ~> Aggregate1\nAggregate1 derive(WorkTime = Last_Lift-First_Lift,\n\t\tYear = iifNull(year(Date),0),\n\t\tMonth = iifNull(month(Date),0),\n\t\tWeek = iifNull(weekOfYear(Date),0)) ~> DerivedColumn4\nDerivedColumn4 alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'gold/qc_gmph',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Carrier_Visit_Key','pow','Date'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/GMPH_CTB')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source3"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter3"
						},
						{
							"name": "Filter4"
						},
						{
							"name": "DerivedColumn7"
						},
						{
							"name": "Join2"
						},
						{
							"name": "DerivedColumn8"
						},
						{
							"name": "DerivedColumn9"
						},
						{
							"name": "Select2"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Select3"
						},
						{
							"name": "aggregate2"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'silver/moves') ~> source1\nsource(output(\n\t\tComplex_Id as string,\n\t\tFacility_Id as string,\n\t\tCarrier_Visit_Id as string,\n\t\tPhase as string,\n\t\tVisit_Nbr as string,\n\t\tCarrier_Mode as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tETA as timestamp,\n\t\tETD as timestamp,\n\t\tOperator_Line_Id as string,\n\t\tOperator_Line_Role as string,\n\t\tOperator_Line_Name as string,\n\t\tTime_First_Availabilty as string,\n\t\tTime_Discharge_Complete as string,\n\t\tService_Id as string,\n\t\tService_Name as string,\n\t\tVessel_Id as string,\n\t\tIB_VYG as string,\n\t\tOB_VYG as string,\n\t\tCarrier_Name as string,\n\t\tVessel_Class as string,\n\t\tPublished_ETA as string,\n\t\tPublished_ETD as string,\n\t\tStart_Work as string,\n\t\tEnd_Work as string,\n\t\tBegin_Receive_Date as string,\n\t\tCargo_Cutoff_Date as string,\n\t\tHazard_Cutoff_Date as string,\n\t\tReefer_Cutoff_Date as string,\n\t\tLabor_On_Board_Date as string,\n\t\tLabor_Off_Board_Date as string,\n\t\tOff_Port_Arrival_Date as string,\n\t\tOff_Port_Departure as string,\n\t\tPilot_On_Board_Date as string,\n\t\tPilot_Off_Board_Date as string,\n\t\tEst_BBK_Discharge as string,\n\t\tEst_BBK_Load as string,\n\t\tEst_Load as string,\n\t\tEst_Discharge as string,\n\t\tEst_Restow as string,\n\t\tEst_Shift as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tVessel_Classification as string,\n\t\tVessel_Class_Length_Overall_cm as integer,\n\t\tVessel_Class_Beam_cm as short,\n\t\tVessel_TEU_Capacity as string,\n\t\tLloyds_Code as string,\n\t\tTimeFirstAvailabilty as timestamp,\n\t\tStartWork as timestamp,\n\t\tTimeDischargeComplete as timestamp,\n\t\tEndWork as timestamp,\n\t\tWeek as integer,\n\t\tYear as integer,\n\t\tMonth as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'silver/vessel_visits') ~> source2\nsource(output(\n\t\tdate_of_gang as date,\n\t\tGang as short,\n\t\tCall_Sign as string,\n\t\tVessel_name as string,\n\t\tImp_Voy as string,\n\t\tExp_Voy as string,\n\t\tQuay_Crane as short,\n\t\tvessel_Ops as string,\n\t\tZeile as short,\n\t\tCategory as string,\n\t\tCategory_description as string,\n\t\tSite as string,\n\t\tID as integer,\n\t\tvon_Call_Sign as string,\n\t\t{von_Brcke} as short,\n\t\tTeam as string,\n\t\tCode as string,\n\t\tStart as string,\n\t\tStop as string,\n\t\tAccounting as string,\n\t\tAktiv_Stunden as double,\n\t\tZeitsteuerung as string,\n\t\tVerz as string,\n\t\tLabour_No as integer,\n\t\tDuration as double,\n\t\tTDR as string,\n\t\tOperation_Report as integer,\n\t\tSystem as string,\n\t\tReise as integer,\n\t\taktiv_von as string,\n\t\taktiv_bis as string,\n\t\tStatus as string,\n\t\tStapler_B as boolean,\n\t\tStd_Stapler_B as boolean,\n\t\t{Letzte_nderung} as string,\n\t\tVA as short,\n\t\tAR as short,\n\t\tCB as boolean,\n\t\tVC as short,\n\t\tZM as boolean,\n\t\tST as boolean,\n\t\tRS as boolean,\n\t\tSpr as short,\n\t\tStd_VA as double,\n\t\tStd_AR as double,\n\t\tStd_CB as double,\n\t\tStd_VC as double,\n\t\tStd_ZM as boolean,\n\t\tStd_RS as boolean,\n\t\tST_Std as boolean,\n\t\tStd_Spr as double,\n\t\tBemerkung as string,\n\t\tBrutto_Zeit as short,\n\t\tNetto_Zeit as boolean,\n\t\tStammcode as string,\n\t\tTerminal as string,\n\t\tDokument_Nr as boolean,\n\t\tnew_category as string,\n\t\tdesription_of_activity as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'silver/delays') ~> source3\nsource1 filter(Event_Type_Id==\"UNIT_DISCH\" || Event_Type_Id == \"UNIT_LOAD\") ~> Filter1\nFilter1, source2 join(source1@Carrier_Visit_Key == source2@Carrier_Visit_Key,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id = source1@Facility_Id,\n\t\tComplex_Id = source1@Complex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key = source1@Carrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA = source1@ATA,\n\t\tATD = source1@ATD,\n\t\tRehandles,\n\t\tYear = source1@Year,\n\t\tMonth = source1@Month,\n\t\tWeek = source1@Week,\n\t\tCarrier_Visit_Id,\n\t\tCarrier_Mode,\n\t\tOperator_Line_Id,\n\t\tOperator_Line_Name,\n\t\tService_Name,\n\t\tVessel_Id,\n\t\tCarrier_Name,\n\t\tVessel_Class,\n\t\tVessel_Classification,\n\t\tVisit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Time_Completed_Date_Time = iif(Event_Type_Id== \"UNIT_LOAD\", iifNull(t_put,t_carry_complete),iifNull(t_fetch,t_discharge))) ~> DerivedColumn1\nDerivedColumn1 derive(Time = toString(Time_Completed_Date_Time,'HH:mm:ss'),\n\t\tDate = toDate(toString(Time_Completed_Date_Time,'yyyy-MM-dd'))) ~> DerivedColumn2\nDerivedColumn6 derive(Shift_Start_Time = iif(Day_Of_Week==1 || Day_Of_Week==7,\r\n    iif(Time>=toString('06:00:00') && Time<toString('12:00:00'),\r\n        toTimestamp(concat(toString(Date),' ','06:00:00')),\r\n        iif(Time>=toString('12:00:00') && Time<toString('18:00:00'),\r\n            toTimestamp(concat(toString(Date),' ','12:00:00')),\r\n            iif(Time>=toString('18:00:00') && Time<toString('24:00:00'),\r\n                toTimestamp(concat(toString(Date),' ','18:00:00')),\r\n                toTimestamp(concat(toString(subDays(Date,1)),' ','24:00:00'))))),\r\n    iif(Time>=toString('06:00:00') && Time<toString('14:00:00'),\r\n        toTimestamp(concat(toString(Date),' ','06:00:00')),\r\n        iif(Time>=toString('14:00:00') && Time<toString('22:00:00'),\r\n            toTimestamp(concat(toString(Date),' ','14:00:00')),\r\n            iif(Time>=toString('22:00:00'),\r\n                toTimestamp(concat(toString(Date),' ','22:00:00')),\r\n\t\t\t\ttoTimestamp(concat(toString(subDays(Date,1)),' ','22:00:00')))))),\n\t\tShift_End_Time = iif(Day_Of_Week==1 || Day_Of_Week==7,\r\n    iif(Time>=toString('06:00:00') && Time<toString('12:00:00'),\r\n        toTimestamp(concat(toString(Date),' ','11:59:59')),\r\n        iif(Time>=toString('12:00:00') && Time<toString('18:00:00'),\r\n            toTimestamp(concat(toString(Date),' ','17:59:59')),\r\n            iif(Time>=toString('18:00:00') && Time<toString('24:00:00'),\r\n                toTimestamp(concat(toString(Date),' ','23:59:59')),\r\n                toTimestamp(concat(toString(Date),' ','05:59:59'))))),\r\n    iif(Time>=toString('06:00:00') && Time<toString('14:00:00'),\r\n        toTimestamp(concat(toString(Date),' ','13:59:59')),\r\n        iif(Time>=toString('14:00:00') && Time<toString('22:00:00'),\r\n            toTimestamp(concat(toString(Date),' ','21:59:59')),\r\n            iif(Time>=toString('22:00:00'),\r\n                toTimestamp(concat(toString(addDays(Date,1)),' ','05:59:59')),\r\n\t\t\t\ttoTimestamp(concat(toString(Date),' ','05:59:59'))))))) ~> DerivedColumn3\nDerivedColumn5 aggregate(groupBy(pow,\n\t\tShift_Start_Time,\n\t\tShift_End_Time,\n\t\tShift_Date,\n\t\tShift),\n\tFirst_Lift = min(Time_Completed_Date_Time),\n\t\tLast_Lift = max(Time_Completed_Date_Time),\n\t\tMove_Count = countDistinct(mve_gkey)) ~> Aggregate1\nFilter4 derive(WorkTime = Last_Lift-First_Lift,\n\t\tYear = iifNull(year(Shift_Date),0),\n\t\tMonth = iifNull(month(Shift_Date),0),\n\t\tWeek = iifNull(weekOfYear(Shift_Date),0),\n\t\tPow_No = toInteger(iif(left(pow,2)=='SK',substring(pow, 3),iif(left(pow,1)=='M',substring(pow, 2),'0')))) ~> DerivedColumn4\nDerivedColumn3 derive(Shift = iif(toString(Shift_Start_Time, 'HH:mm:ss')==toString('06:00:00'),1,\r\niif(toString(Shift_Start_Time, 'HH:mm:ss')==toString('14:00:00')||toString(Shift_Start_Time, 'HH:mm:ss')==toString('12:00:00'),2,\r\niif(toString(Shift_Start_Time, 'HH:mm:ss')==toString('22:00:00')||toString(Shift_Start_Time, 'HH:mm:ss')==toString('18:00:00'),3,4)))) ~> DerivedColumn5\nDerivedColumn2 derive(Day_Of_Week = dayOfWeek(iif(Time<toString('06:00:00'),subDays(Date,1),Date)),\n\t\tShift_Date = iif(Time<toString('06:00:00'),subDays(Date,1),Date)) ~> DerivedColumn6\nsource3 filter(Code=='BKO' || Code=='MTG'|| Code=='OFF'||Code=='AIT'||Code=='BBK'||Code=='LBR'||Code=='AIL' || Code=='COS'|| Code=='DTW'||Code=='INC'||Code=='LCA'||Code=='MTW'\r\n|| Code=='OTL'||Code=='WCC'||Code=='WEA'||Code=='WTG'||Code=='WVL') ~> Filter3\nAggregate1 filter(pow!='') ~> Filter4\nFilter3 derive(Start_datetime = toTimestamp(concat(toString(date_of_gang),' ',Start)),\n\t\tStop_datetime = iif(Stop<Start,toTimestamp(concat(toString(addDays(date_of_gang,1)),' ',Stop)),toTimestamp(concat(toString(date_of_gang),' ',Stop)))) ~> DerivedColumn7\nFilter5, Select2 join(Pow_No == Quay_Crane\n\t&& First_Lift <= Start_datetime\n\t&& Last_Lift >= Stop_datetime,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'right')~> Join2\nDerivedColumn7 derive(Delay = Stop_datetime-Start_datetime) ~> DerivedColumn8\naggregate2 derive(Final_WorkTime = WorkTime-iifNull(Delay,0)) ~> DerivedColumn9\nDerivedColumn8 select(mapColumn(\n\t\tdate_of_gang,\n\t\tVessel_name,\n\t\tQuay_Crane,\n\t\tCode,\n\t\tStart,\n\t\tStop,\n\t\tDuration,\n\t\tdesription_of_activity,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tStart_datetime,\n\t\tStop_datetime,\n\t\tDelay\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDerivedColumn4 filter(Pow_No!=0) ~> Filter5\nJoin2 select(mapColumn(\n\t\tpow,\n\t\tShift_Start_Time,\n\t\tShift_End_Time,\n\t\tShift_Date,\n\t\tShift,\n\t\tFirst_Lift,\n\t\tLast_Lift,\n\t\tMove_Count,\n\t\tWorkTime,\n\t\tYear = DerivedColumn4@Year,\n\t\tMonth = DerivedColumn4@Month,\n\t\tWeek = DerivedColumn4@Week,\n\t\tPow_No,\n\t\tdate_of_gang,\n\t\tVessel_name,\n\t\tQuay_Crane,\n\t\tCode,\n\t\tStart,\n\t\tStop,\n\t\tDuration,\n\t\tdesription_of_activity,\n\t\tStart_datetime,\n\t\tStop_datetime,\n\t\tDelay\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select3\nSelect3 aggregate(groupBy(pow,\n\t\tShift_Start_Time,\n\t\tShift_End_Time,\n\t\tShift_Date,\n\t\tShift,\n\t\tFirst_Lift,\n\t\tLast_Lift,\n\t\tMove_Count,\n\t\tWorkTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tPow_No),\n\tDelay = sum(Delay)) ~> aggregate2\nDerivedColumn9 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'gold/GMPH',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/GMPH_gpa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source3"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter3"
						},
						{
							"name": "Filter4"
						},
						{
							"name": "DerivedColumn7"
						},
						{
							"name": "Join2"
						},
						{
							"name": "DerivedColumn8"
						},
						{
							"name": "DerivedColumn9"
						},
						{
							"name": "Select2"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Select3"
						},
						{
							"name": "aggregate2"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/moves') ~> source1\nsource(output(\n\t\tComplex_Id as string,\n\t\tFacility_Id as string,\n\t\tCarrier_Visit_Id as string,\n\t\tPhase as string,\n\t\tVisit_Nbr as string,\n\t\tCarrier_Mode as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tETA as timestamp,\n\t\tETD as timestamp,\n\t\tOperator_Line_Id as string,\n\t\tOperator_Line_Role as string,\n\t\tOperator_Line_Name as string,\n\t\tTime_First_Availabilty as string,\n\t\tTime_Discharge_Complete as string,\n\t\tService_Id as string,\n\t\tService_Name as string,\n\t\tVessel_Id as string,\n\t\tIB_VYG as string,\n\t\tOB_VYG as string,\n\t\tCarrier_Name as string,\n\t\tVessel_Class as string,\n\t\tPublished_ETA as string,\n\t\tPublished_ETD as string,\n\t\tStart_Work as string,\n\t\tEnd_Work as string,\n\t\tBegin_Receive_Date as string,\n\t\tCargo_Cutoff_Date as string,\n\t\tHazard_Cutoff_Date as string,\n\t\tReefer_Cutoff_Date as string,\n\t\tLabor_On_Board_Date as string,\n\t\tLabor_Off_Board_Date as string,\n\t\tOff_Port_Arrival_Date as string,\n\t\tOff_Port_Departure as string,\n\t\tPilot_On_Board_Date as string,\n\t\tPilot_Off_Board_Date as string,\n\t\tEst_BBK_Discharge as string,\n\t\tEst_BBK_Load as string,\n\t\tEst_Load as string,\n\t\tEst_Discharge as string,\n\t\tEst_Restow as string,\n\t\tEst_Shift as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tVessel_Classification as string,\n\t\tVessel_Class_Length_Overall_cm as integer,\n\t\tVessel_Class_Beam_cm as short,\n\t\tVessel_TEU_Capacity as string,\n\t\tLloyds_Code as string,\n\t\tTimeFirstAvailabilty as timestamp,\n\t\tStartWork as timestamp,\n\t\tTimeDischargeComplete as timestamp,\n\t\tEndWork as timestamp,\n\t\tWeek as integer,\n\t\tYear as integer,\n\t\tMonth as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/vessel_visits') ~> source2\nsource(output(\n\t\tdate_of_gang as date,\n\t\tGang as short,\n\t\tCall_Sign as string,\n\t\tVessel_name as string,\n\t\tImp_Voy as string,\n\t\tExp_Voy as string,\n\t\tQuay_Crane as short,\n\t\tvessel_Ops as string,\n\t\tZeile as short,\n\t\tCategory as string,\n\t\tCategory_description as string,\n\t\tSite as string,\n\t\tID as integer,\n\t\tvon_Call_Sign as string,\n\t\t{von_Brcke} as short,\n\t\tTeam as string,\n\t\tCode as string,\n\t\tStart as string,\n\t\tStop as string,\n\t\tAccounting as string,\n\t\tAktiv_Stunden as double,\n\t\tZeitsteuerung as string,\n\t\tVerz as string,\n\t\tLabour_No as integer,\n\t\tDuration as double,\n\t\tTDR as string,\n\t\tOperation_Report as integer,\n\t\tSystem as string,\n\t\tReise as integer,\n\t\taktiv_von as string,\n\t\taktiv_bis as string,\n\t\tStatus as string,\n\t\tStapler_B as boolean,\n\t\tStd_Stapler_B as boolean,\n\t\t{Letzte_nderung} as string,\n\t\tVA as short,\n\t\tAR as short,\n\t\tCB as boolean,\n\t\tVC as short,\n\t\tZM as boolean,\n\t\tST as boolean,\n\t\tRS as boolean,\n\t\tSpr as short,\n\t\tStd_VA as double,\n\t\tStd_AR as double,\n\t\tStd_CB as double,\n\t\tStd_VC as double,\n\t\tStd_ZM as boolean,\n\t\tStd_RS as boolean,\n\t\tST_Std as boolean,\n\t\tStd_Spr as double,\n\t\tBemerkung as string,\n\t\tBrutto_Zeit as short,\n\t\tNetto_Zeit as boolean,\n\t\tStammcode as string,\n\t\tTerminal as string,\n\t\tDokument_Nr as boolean,\n\t\tnew_category as string,\n\t\tdesription_of_activity as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/delays') ~> source3\nsource1 filter(Event_Type_Id==\"UNIT_DISCH\" || Event_Type_Id == \"UNIT_LOAD\") ~> Filter1\nFilter1, source2 join(source1@Carrier_Visit_Key == source2@Carrier_Visit_Key,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id = source1@Facility_Id,\n\t\tComplex_Id = source1@Complex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key = source1@Carrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA = source1@ATA,\n\t\tATD = source1@ATD,\n\t\tRehandles,\n\t\tYear = source1@Year,\n\t\tMonth = source1@Month,\n\t\tWeek = source1@Week,\n\t\tCarrier_Visit_Id,\n\t\tCarrier_Mode,\n\t\tOperator_Line_Id,\n\t\tOperator_Line_Name,\n\t\tService_Name,\n\t\tVessel_Id,\n\t\tCarrier_Name,\n\t\tVessel_Class,\n\t\tVessel_Classification,\n\t\tVisit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Time_Completed_Date_Time = iif(Event_Type_Id== \"UNIT_LOAD\", iifNull(t_put,t_carry_complete),iifNull(t_fetch,t_discharge))) ~> DerivedColumn1\nDerivedColumn1 derive(Time = toString(Time_Completed_Date_Time,'HH:mm:ss'),\n\t\tDate = toDate(toString(Time_Completed_Date_Time,'yyyy-MM-dd'))) ~> DerivedColumn2\nDerivedColumn6 derive(Shift_Start_Time = iif(Day_Of_Week==1 || Day_Of_Week==7,\r\n    iif(Time>=toString('06:00:00') && Time<toString('12:00:00'),\r\n        toTimestamp(concat(toString(Date),' ','06:00:00')),\r\n        iif(Time>=toString('12:00:00') && Time<toString('18:00:00'),\r\n            toTimestamp(concat(toString(Date),' ','12:00:00')),\r\n            iif(Time>=toString('18:00:00') && Time<toString('24:00:00'),\r\n                toTimestamp(concat(toString(Date),' ','18:00:00')),\r\n                toTimestamp(concat(toString(subDays(Date,1)),' ','24:00:00'))))),\r\n    iif(Time>=toString('06:00:00') && Time<toString('14:00:00'),\r\n        toTimestamp(concat(toString(Date),' ','06:00:00')),\r\n        iif(Time>=toString('14:00:00') && Time<toString('22:00:00'),\r\n            toTimestamp(concat(toString(Date),' ','14:00:00')),\r\n            iif(Time>=toString('22:00:00'),\r\n                toTimestamp(concat(toString(Date),' ','22:00:00')),\r\n\t\t\t\ttoTimestamp(concat(toString(subDays(Date,1)),' ','22:00:00')))))),\n\t\tShift_End_Time = iif(Day_Of_Week==1 || Day_Of_Week==7,\r\n    iif(Time>=toString('06:00:00') && Time<toString('12:00:00'),\r\n        toTimestamp(concat(toString(Date),' ','11:59:59')),\r\n        iif(Time>=toString('12:00:00') && Time<toString('18:00:00'),\r\n            toTimestamp(concat(toString(Date),' ','17:59:59')),\r\n            iif(Time>=toString('18:00:00') && Time<toString('24:00:00'),\r\n                toTimestamp(concat(toString(Date),' ','23:59:59')),\r\n                toTimestamp(concat(toString(Date),' ','05:59:59'))))),\r\n    iif(Time>=toString('06:00:00') && Time<toString('14:00:00'),\r\n        toTimestamp(concat(toString(Date),' ','13:59:59')),\r\n        iif(Time>=toString('14:00:00') && Time<toString('22:00:00'),\r\n            toTimestamp(concat(toString(Date),' ','21:59:59')),\r\n            iif(Time>=toString('22:00:00'),\r\n                toTimestamp(concat(toString(addDays(Date,1)),' ','05:59:59')),\r\n\t\t\t\ttoTimestamp(concat(toString(Date),' ','05:59:59'))))))) ~> DerivedColumn3\nDerivedColumn5 aggregate(groupBy(pow,\n\t\tShift_Start_Time,\n\t\tShift_End_Time,\n\t\tShift_Date,\n\t\tShift),\n\tFirst_Lift = min(Time_Completed_Date_Time),\n\t\tLast_Lift = max(Time_Completed_Date_Time),\n\t\tMove_Count = countDistinct(mve_gkey)) ~> Aggregate1\nFilter4 derive(WorkTime = Last_Lift-First_Lift,\n\t\tYear = iifNull(year(Shift_Date),0),\n\t\tMonth = iifNull(month(Shift_Date),0),\n\t\tWeek = iifNull(weekOfYear(Shift_Date),0),\n\t\tPow_No = toInteger(iif(left(pow,2)=='SK',substring(pow, 3),iif(left(pow,1)=='M',substring(pow, 2),'0')))) ~> DerivedColumn4\nDerivedColumn3 derive(Shift = iif(toString(Shift_Start_Time, 'HH:mm:ss')==toString('06:00:00'),1,\r\niif(toString(Shift_Start_Time, 'HH:mm:ss')==toString('14:00:00')||toString(Shift_Start_Time, 'HH:mm:ss')==toString('12:00:00'),2,\r\niif(toString(Shift_Start_Time, 'HH:mm:ss')==toString('22:00:00')||toString(Shift_Start_Time, 'HH:mm:ss')==toString('18:00:00'),3,4)))) ~> DerivedColumn5\nDerivedColumn2 derive(Day_Of_Week = dayOfWeek(iif(Time<toString('06:00:00'),subDays(Date,1),Date)),\n\t\tShift_Date = iif(Time<toString('06:00:00'),subDays(Date,1),Date)) ~> DerivedColumn6\nsource3 filter(Code=='BKO' || Code=='MTG'|| Code=='OFF'||Code=='AIT'||Code=='BBK'||Code=='LBR'||Code=='AIL' || Code=='COS'|| Code=='DTW'||Code=='INC'||Code=='LCA'||Code=='MTW'\r\n|| Code=='OTL'||Code=='WCC'||Code=='WEA'||Code=='WTG'||Code=='WVL') ~> Filter3\nAggregate1 filter(pow!='') ~> Filter4\nFilter3 derive(Start_datetime = toTimestamp(concat(toString(date_of_gang),' ',Start)),\n\t\tStop_datetime = iif(Stop<Start,toTimestamp(concat(toString(addDays(date_of_gang,1)),' ',Stop)),toTimestamp(concat(toString(date_of_gang),' ',Stop)))) ~> DerivedColumn7\nFilter5, Select2 join(Pow_No == Quay_Crane\n\t&& First_Lift <= Start_datetime\n\t&& Last_Lift >= Stop_datetime,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'right')~> Join2\nDerivedColumn7 derive(Delay = Stop_datetime-Start_datetime) ~> DerivedColumn8\naggregate2 derive(Final_WorkTime = WorkTime-iifNull(Delay,0)) ~> DerivedColumn9\nDerivedColumn8 select(mapColumn(\n\t\tdate_of_gang,\n\t\tVessel_name,\n\t\tQuay_Crane,\n\t\tCode,\n\t\tStart,\n\t\tStop,\n\t\tDuration,\n\t\tdesription_of_activity,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tStart_datetime,\n\t\tStop_datetime,\n\t\tDelay\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDerivedColumn4 filter(Pow_No!=0) ~> Filter5\nJoin2 select(mapColumn(\n\t\tpow,\n\t\tShift_Start_Time,\n\t\tShift_End_Time,\n\t\tShift_Date,\n\t\tShift,\n\t\tFirst_Lift,\n\t\tLast_Lift,\n\t\tMove_Count,\n\t\tWorkTime,\n\t\tYear = DerivedColumn4@Year,\n\t\tMonth = DerivedColumn4@Month,\n\t\tWeek = DerivedColumn4@Week,\n\t\tPow_No,\n\t\tdate_of_gang,\n\t\tVessel_name,\n\t\tQuay_Crane,\n\t\tCode,\n\t\tStart,\n\t\tStop,\n\t\tDuration,\n\t\tdesription_of_activity,\n\t\tStart_datetime,\n\t\tStop_datetime,\n\t\tDelay\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select3\nSelect3 aggregate(groupBy(pow,\n\t\tShift_Start_Time,\n\t\tShift_End_Time,\n\t\tShift_Date,\n\t\tShift,\n\t\tFirst_Lift,\n\t\tLast_Lift,\n\t\tMove_Count,\n\t\tWorkTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tPow_No),\n\tDelay = sum(Delay)) ~> aggregate2\nDerivedColumn9 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'gold/GMPH',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/GMPH_mict')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source3"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter4"
						},
						{
							"name": "Join2"
						},
						{
							"name": "DerivedColumn9"
						},
						{
							"name": "Select2"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Select3"
						},
						{
							"name": "aggregate2"
						},
						{
							"name": "derivedColumn7"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'silver/moves') ~> source1\nsource(output(\n\t\tCarrier_Visit_Key as integer,\n\t\tComplex_Id as string,\n\t\tFacility_Id as string,\n\t\tCarrier_Visit_Id as string,\n\t\tPhase as string,\n\t\tVisit_Nbr as boolean,\n\t\tCarrier_Mode as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tETA as timestamp,\n\t\tETD as timestamp,\n\t\tOperator_Line_Id as string,\n\t\tOperator_Line_Role as string,\n\t\tOperator_Line_Name as string,\n\t\tTime_First_Availabilty as string,\n\t\tTime_Discharge_Complete as string,\n\t\tService_Id as string,\n\t\tService_Name as string,\n\t\tVessel_Id as string,\n\t\tIB_VYG as string,\n\t\tOB_VYG as string,\n\t\tCarrier_Name as string,\n\t\tVessel_Class as string,\n\t\tPublished_ETA as string,\n\t\tPublished_ETD as string,\n\t\tStart_Work as string,\n\t\tEnd_Work as string,\n\t\tBegin_Receive_Date as string,\n\t\tCargo_Cutoff_Date as string,\n\t\tHazard_Cutoff_Date as string,\n\t\tReefer_Cutoff_Date as string,\n\t\tLabor_On_Board_Date as string,\n\t\tLabor_Off_Board_Date as string,\n\t\tOff_Port_Arrival_Date as string,\n\t\tOff_Port_Departure as string,\n\t\tPilot_On_Board_Date as string,\n\t\tPilot_Off_Board_Date as string,\n\t\tEst_BBK_Discharge as string,\n\t\tEst_BBK_Load as string,\n\t\tEst_Load as string,\n\t\tEst_Discharge as string,\n\t\tEst_Restow as string,\n\t\tEst_Shift as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\tVessel_Classification as string,\n\t\tVessel_Class_Length_Overall_cm as string,\n\t\tVessel_Class_Beam_cm as string,\n\t\tVessel_TEU_Capacity as string,\n\t\tLloyds_Code as string,\n\t\tTimeFirstAvailabilty as timestamp,\n\t\tStartWork as timestamp,\n\t\tTimeDischargeComplete as timestamp,\n\t\tEndWork as timestamp,\n\t\tWeek as integer,\n\t\tYear as integer,\n\t\tMonth as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'silver/vesselvisits') ~> source2\nsource(output(\n\t\tCraneDelayGkey as short,\n\t\tFacilityId as string,\n\t\tYard_Id as string,\n\t\tCarrierVisitId as string,\n\t\tCarrierVisitKey as integer,\n\t\tCraneServiceGkey as short,\n\t\tCrane_DelayTypeId as string,\n\t\tDelayCategory as string,\n\t\tDelayDurationSec as integer,\n\t\tDelayStartTime as timestamp,\n\t\tCHEId as short,\n\t\tCHEShortName as string,\n\t\tSrcTable as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'silver/cranedelays') ~> source3\nsource1 filter(Event_Type_Id==\"UNIT_DISCH\" || Event_Type_Id == \"UNIT_LOAD\") ~> Filter1\nFilter1, source2 join(source1@Carrier_Visit_Key == source2@Carrier_Visit_Key,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id = source1@Facility_Id,\n\t\tComplex_Id = source1@Complex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key = source1@Carrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA = source2@ATA,\n\t\tATD = source2@ATD,\n\t\tRehandles,\n\t\tYear = source2@Year,\n\t\tMonth = source2@Month,\n\t\tWeek = source2@Week,\n\t\tCarrier_Visit_Id,\n\t\tCarrier_Mode,\n\t\tOperator_Line_Id,\n\t\tOperator_Line_Name,\n\t\tService_Name,\n\t\tVessel_Id,\n\t\tCarrier_Name,\n\t\tVessel_Class,\n\t\tVessel_Classification,\n\t\tVisit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Time_Completed_Date_Time = iif(Event_Type_Id== \"UNIT_LOAD\", iifNull(t_put,t_carry_complete),iifNull(t_fetch,t_discharge))) ~> DerivedColumn1\nDerivedColumn1 derive(Time = toString(Time_Completed_Date_Time,'HH:mm:ss'),\n\t\tDate = toDate(toString(Time_Completed_Date_Time,'yyyy-MM-dd'))) ~> DerivedColumn2\nDerivedColumn6 derive(Shift_Start_Time = iif(Time>=toString('07:00:00') && Time<toString('19:00:00'),\r\n        toTimestamp(concat(toString(Date),' ','07:00:00')),\r\n\t\tiif(Time>=toString('19:00:00') && Time<=toString('23:59:59'),\r\n            toTimestamp(concat(toString(Date),' ','19:00:00')),\r\n            iif(Time>=toString('00:00:00') && Time<toString('07:00:00'),\r\n\t\t\t\ttoTimestamp(concat(toString(subDays(Date,1)),' ','19:00:00')),\r\n                toTimestamp(concat(toString(Date),' ','19:00:00'))))),\n\t\tShift_End_Time = iif(Time>=toString('07:00:00') && Time<toString('19:00:00'),\r\n        toTimestamp(concat(toString(Date),' ','18:59:00')),\r\n\t\tiif(Time>=toString('19:00:00') && Time<=toString('23:59:59'),\r\n            toTimestamp(concat(toString(addDays(Date,1)),' ','06:59:59')),\r\n            iif(Time>=toString('00:00:00') && Time<toString('07:00:00'),\r\n\t\t\t\ttoTimestamp(concat(toString(Date),' ','19:00:00')),\r\n                toTimestamp(concat(toString(subDays(Date,1)),' ','19:00:00')))))) ~> DerivedColumn3\nDerivedColumn5 aggregate(groupBy(pow,\n\t\tShift_Start_Time,\n\t\tShift_End_Time,\n\t\tShift_Date,\n\t\tShift),\n\tFirst_Lift = min(Time_Completed_Date_Time),\n\t\tLast_Lift = max(Time_Completed_Date_Time),\n\t\tMove_Count = countDistinct(mve_gkey)) ~> Aggregate1\nFilter4 derive(WorkTime = Last_Lift-First_Lift,\n\t\tYear = iifNull(year(Shift_Date),0),\n\t\tMonth = iifNull(month(Shift_Date),0),\n\t\tWeek = iifNull(weekOfYear(Shift_Date),0),\n\t\tPow_No = toInteger(iif(left(pow,2)=='QC',substring(pow, 3),iif(left(pow,1)=='M',substring(pow, 2),'0')))) ~> DerivedColumn4\nDerivedColumn3 derive(Shift = iif(toString(Shift_Start_Time, 'HH:mm:ss')==toString('07:00:00'),\"Day\",\r\niif(toString(Shift_Start_Time, 'HH:mm:ss')==toString('19:00:00'),\"Night\",\"Day\"))) ~> DerivedColumn5\nDerivedColumn2 derive(Day_Of_Week = dayOfWeek(iif(Time<toString('07:00:00'),subDays(Date,1),Date)),\n\t\tShift_Date = iif(Time<toString('07:00:00'),subDays(Date,1),Date)) ~> DerivedColumn6\nAggregate1 filter(pow!='') ~> Filter4\nFilter5, Select2 join(Pow_No == CHEShortNumber\n\t&& First_Lift <= Start_datetime\n\t&& Last_Lift >= Stop_datetime,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'right')~> Join2\naggregate2 derive(Final_WorkTime = WorkTime-iifNull(Delay,0)) ~> DerivedColumn9\nderivedColumn7 select(mapColumn(\n\t\tCraneDelayGkey,\n\t\tFacilityId,\n\t\tYard_Id,\n\t\tCarrierVisitId,\n\t\tCarrierVisitKey,\n\t\tCraneServiceGkey,\n\t\tCrane_DelayTypeId,\n\t\tDelayCategory,\n\t\tDelay = DelayDurationSec,\n\t\tStart_datetime = DelayStartTime,\n\t\tCHEId,\n\t\tCHEShortName,\n\t\tSrcTable,\n\t\tStop_datetime,\n\t\tCHEShortNumber\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDerivedColumn4 filter(Pow_No!=0) ~> Filter5\nJoin2 select(mapColumn(\n\t\tpow,\n\t\tShift_Start_Time,\n\t\tShift_End_Time,\n\t\tShift_Date,\n\t\tShift,\n\t\tFirst_Lift,\n\t\tLast_Lift,\n\t\tMove_Count,\n\t\tWorkTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tPow_No,\n\t\tCraneDelayGkey,\n\t\tFacilityId,\n\t\tYard_Id,\n\t\tCarrierVisitId,\n\t\tCarrierVisitKey,\n\t\tCraneServiceGkey,\n\t\tCrane_DelayTypeId,\n\t\tDelayCategory,\n\t\tDelay,\n\t\tStart_datetime,\n\t\tCHEId,\n\t\tCHEShortName,\n\t\tSrcTable,\n\t\tStop_datetime,\n\t\tCHEShortNumber\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select3\nSelect3 aggregate(groupBy(pow,\n\t\tShift_Start_Time,\n\t\tShift_End_Time,\n\t\tShift_Date,\n\t\tShift,\n\t\tFirst_Lift,\n\t\tLast_Lift,\n\t\tMove_Count,\n\t\tWorkTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tPow_No),\n\tDelay = sum(Delay)) ~> aggregate2\nsource3 derive(Stop_datetime = DelayStartTime + (DelayDurationSec * 1000),\n\t\tCHEShortNumber = toInteger(iif(left(CHEShortName,2)=='QC',substring(CHEShortName, 3),iif(left(CHEShortName,1)=='M',substring(CHEShortName, 2),'0')))) ~> derivedColumn7\nDerivedColumn9 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'gold/GMPH',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/General Housekeeping')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "parameters{\n\tcustomer as string\n}\nsource(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: ($customer),\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 derive(Yard_Move = iif(Event_Type_Id=='UNIT_YARD_MOVE' || Event_Type_Id=='UNIT_PAYLOAD_YARD_MOVE', 1, 0),\n\t\tVessel_Move = iif(Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_PAYLOAD_LOAD', 1, 0),\n\t\tRail_Move = iif(Event_Type_Id=='UNIT_RAMP', 1, 0),\n\t\tDeliver_Move = iif(Event_Type_Id=='UNIT_DELIVER' || Event_Type_Id=='UNIT_PAYLOAD_DELIVER', 1, 0)) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tWeek,\n\t\tYear,\n\t\tMonth\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: '$customer',\n\tfolderPath: 'gold/general_housekeeping',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/General Housekeeping_CTB')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('eurogatectb')\n}\nsource(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 derive(Yard_Move = iif(Event_Type_Id=='UNIT_YARD_MOVE' || Event_Type_Id=='UNIT_PAYLOAD_YARD_MOVE', 1, 0),\n\t\tVessel_Move = iif(Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_PAYLOAD_LOAD', 1, 0),\n\t\tRail_Move = iif(Event_Type_Id=='UNIT_RAMP', 1, 0),\n\t\tDeliver_Move = iif(Event_Type_Id=='UNIT_DELIVER' || Event_Type_Id=='UNIT_PAYLOAD_DELIVER', 1, 0)) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tWeek,\n\t\tYear,\n\t\tMonth\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn1 alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'gold/general_housekeeping',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/General Housekeeping_valencia')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('valencia')\n}\nsource(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: ($customer),\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 derive(Yard_Move = iif(Event_Type_Id=='UNIT_YARD_MOVE' || Event_Type_Id=='UNIT_PAYLOAD_YARD_MOVE', 1, 0),\n\t\tVessel_Move = iif(Event_Type_Id=='UNIT_LOAD' || Event_Type_Id=='UNIT_PAYLOAD_LOAD', 1, 0),\n\t\tRail_Move = iif(Event_Type_Id=='UNIT_RAMP', 1, 0),\n\t\tDeliver_Move = iif(Event_Type_Id=='UNIT_DELIVER' || Event_Type_Id=='UNIT_PAYLOAD_DELIVER', 1, 0)) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tWeek,\n\t\tYear,\n\t\tMonth\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'gold/general_housekeeping',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ITV EcEvents_cmsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "ITV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name = cheName,\n\t\tCHE_ID = cheID,\n\t\tTimeStamp = EcEventTime,\n\t\teventType = type,\n\t\teventSubType = subType,\n\t\teventTypeDescription = typeDescription,\n\t\tunit = unitIdName,\n\t\tpow = powName,\n\t\tpool = poolName,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot = ladenLocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='ITV' && eventTypeDescription=='CMPL') ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tMoveCount = 1,\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(TimeStamp, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))))) ~> DerivedColumn1\nselect filter((eventTypeDescription == 'LGOF' || eventTypeDescription == 'LGON') && cheKind == 'ITV') ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tBlock = left(locSlot,3)) ~> DerivedColumn3\nSort1 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\teventTypeDescription_PREV = lag(eventTypeDescription),\n\t\teventTypeDescription_NXT = lead(eventTypeDescription)) ~> Window1\nWindow1 derive(LGOF = case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(eventTypeDescription=='LGON',TimeStamp),\n\t\tWorkTime = toDouble((case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime))-case(eventTypeDescription=='LGON',TimeStamp))/3600000)) ~> DerivedColumn4\nDerivedColumn3 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nDerivedColumn1, Filter7 join(Aggregate1@CHE_ID == Aggregate3@CHE_ID\n\t&& DerivedColumn1@ShiftStartTime == DerivedColumn3@ShiftStartTime\n\t&& DerivedColumn1@ShiftEndTime == DerivedColumn3@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tecEventGkey = Aggregate1@ecEventGkey,\n\t\tyardGkey = Aggregate1@yardGkey,\n\t\tYardID = Aggregate1@YardID,\n\t\tFcyID = Aggregate1@FcyID,\n\t\tcheKind = Aggregate1@cheKind,\n\t\tCHE_Name = Aggregate1@CHE_Name,\n\t\tCHE_ID = Aggregate1@CHE_ID,\n\t\tTimeStamp = Aggregate1@TimeStamp,\n\t\teventType = Aggregate1@eventType,\n\t\teventSubType = Aggregate1@eventSubType,\n\t\teventTypeDescription = Aggregate1@eventTypeDescription,\n\t\tunit = Aggregate1@unit,\n\t\tpow = Aggregate1@pow,\n\t\tpool = Aggregate1@pool,\n\t\tworkQueue = Aggregate1@workQueue,\n\t\tmoveKind = Aggregate1@moveKind,\n\t\tlocSlot = Aggregate1@locSlot,\n\t\tunladenLocSlot = Aggregate1@unladenLocSlot,\n\t\tladen_LocSlot = Aggregate1@laden_LocSlot,\n\t\tYear = Aggregate1@Year,\n\t\tMonth = Aggregate1@Month,\n\t\tWeek = Aggregate1@Week,\n\t\tDate = DerivedColumn1@Date,\n\t\tTime = DerivedColumn1@Time,\n\t\tShiftStartTime = DerivedColumn1@ShiftStartTime,\n\t\tShiftEndTime = DerivedColumn1@ShiftEndTime,\n\t\tShift = DerivedColumn1@Shift,\n\t\tShiftDate = DerivedColumn1@ShiftDate,\n\t\tMoveCount,\n\t\tBlock = DerivedColumn1@Block,\n\t\tHour,\n\t\tWeekofYear = DerivedColumn1@WeekofYear,\n\t\t{ecEventGkey.1} = Aggregate3@ecEventGkey,\n\t\t{ShiftDate.1} = DerivedColumn3@ShiftDate,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(TimeStamp>=LGON && TimeStamp<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp),\n\t\tLastMove = case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp),\n\t\tIdleTimeFL = case(isNull(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp))==false(),(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp)-LGON)/3600000,isNull(case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))==false(),(LGOF-case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))/3600000),\n\t\tITVIdleTime = iif(CHE_ID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-TimeStamp)<0,0.0,toFloat((TimeStamp_NXT-TimeStamp)/3600000)),0.0),\n\t\tBayChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0),\n\t\tBayChangeCount = iif(isNull(locSlot_NXT)==true(),0,iif(iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0)==1,\r\niif(toInteger(substring(locSlot,4,2))>toInteger(substring(locSlot_NXT,4,2)),iif( \r\ntoInteger(substring(locSlot,4,2))%2==0,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2)))), \r\niif(toInteger(substring(locSlot_NXT,4,2))%2==0,toInteger(substring(locSlot,4,2))-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2)))-(toInteger(substring(locSlot_NXT,4,2)))))\r\n,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,iif(\r\n    toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2)))) \r\n,iif(toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2)))))),0)),\n\t\tBlockChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)!=left(locSlot_NXT,3),1,0),0),0),0),\n\t\tLaneChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,2)!=left(locSlot_NXT,2),1,0),0),0),0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'gold/itv_ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tMoveCount,\n\t\tBlock,\n\t\tHour,\n\t\tWeekofYear,\n\t\t{ecEventGkey.1},\n\t\t{ShiftDate.1},\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime,\n\t\tValid,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\tlocSlot_PREV,\n\t\tlocSlot_NXT,\n\t\tecEventGkey_PREV,\n\t\tecEventGkey_NXT,\n\t\tShiftDate_PREV,\n\t\tShiftDate_NXT,\n\t\tLGON_PREV,\n\t\tLGON_NXT,\n\t\tLGOF_PREV,\n\t\tLGOF_NXT,\n\t\tFirstMove,\n\t\tLastMove,\n\t\tIdleTimeFL,\n\t\tITVIdleTime,\n\t\tBayChangeInstance,\n\t\tBayChangeCount,\n\t\tBlockChangeInstance,\n\t\tLaneChangeInstance\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> ITV\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\tmoveKind as string,\n\t\tlocSlot as string,\n\t\tunladenLocSlot as string,\n\t\tladen_LocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tWeekofYear as integer,\n\t\tDate as date,\n\t\tTime as string,\n\t\tShiftStartTime as timestamp,\n\t\tShiftEndTime as timestamp,\n\t\tShift as integer,\n\t\tShiftDate as date,\n\t\tBlock as string,\n\t\tCHE_ID_PREV as long,\n\t\tCHE_ID_NXT as long,\n\t\tTimeStamp_PREV as timestamp,\n\t\tTimeStamp_NXT as timestamp,\n\t\teventTypeDescription_PREV as string,\n\t\teventTypeDescription_NXT as string,\n\t\tLGOF as timestamp,\n\t\tLGON as timestamp,\n\t\tWorkTime as double\n\t),\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'gold/itv_workhours',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tWeekofYear,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tBlock,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\teventTypeDescription_PREV,\n\t\teventTypeDescription_NXT,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ITV EcEvents_gpa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "ITV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name = cheName,\n\t\tCHE_ID = cheID,\n\t\tTimeStamp = EcEventTime,\n\t\teventType = type,\n\t\teventSubType = subType,\n\t\teventTypeDescription = typeDescription,\n\t\tunit = unitIdName,\n\t\tpow = powName,\n\t\tpool = poolName,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot = ladenLocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='ITV' && eventTypeDescription=='CMPL') ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tMoveCount = 1,\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(TimeStamp, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))))) ~> DerivedColumn1\nselect filter((eventTypeDescription == 'LGOF' || eventTypeDescription == 'LGON') && cheKind == 'ITV') ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tBlock = left(locSlot,3)) ~> DerivedColumn3\nSort1 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\teventTypeDescription_PREV = lag(eventTypeDescription),\n\t\teventTypeDescription_NXT = lead(eventTypeDescription)) ~> Window1\nWindow1 derive(LGOF = case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(eventTypeDescription=='LGON',TimeStamp),\n\t\tWorkTime = toDouble((case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime))-case(eventTypeDescription=='LGON',TimeStamp))/3600000)) ~> DerivedColumn4\nDerivedColumn3 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nDerivedColumn1, Filter7 join(Aggregate1@CHE_ID == Aggregate3@CHE_ID\n\t&& DerivedColumn1@ShiftStartTime == DerivedColumn3@ShiftStartTime\n\t&& DerivedColumn1@ShiftEndTime == DerivedColumn3@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tecEventGkey = Aggregate1@ecEventGkey,\n\t\tyardGkey = Aggregate1@yardGkey,\n\t\tYardID = Aggregate1@YardID,\n\t\tFcyID = Aggregate1@FcyID,\n\t\tcheKind = Aggregate1@cheKind,\n\t\tCHE_Name = Aggregate1@CHE_Name,\n\t\tCHE_ID = Aggregate1@CHE_ID,\n\t\tTimeStamp = Aggregate1@TimeStamp,\n\t\teventType = Aggregate1@eventType,\n\t\teventSubType = Aggregate1@eventSubType,\n\t\teventTypeDescription = Aggregate1@eventTypeDescription,\n\t\tunit = Aggregate1@unit,\n\t\tpow = Aggregate1@pow,\n\t\tpool = Aggregate1@pool,\n\t\tworkQueue = Aggregate1@workQueue,\n\t\tmoveKind = Aggregate1@moveKind,\n\t\tlocSlot = Aggregate1@locSlot,\n\t\tunladenLocSlot = Aggregate1@unladenLocSlot,\n\t\tladen_LocSlot = Aggregate1@laden_LocSlot,\n\t\tYear = Aggregate1@Year,\n\t\tMonth = Aggregate1@Month,\n\t\tWeek = Aggregate1@Week,\n\t\tDate = DerivedColumn1@Date,\n\t\tTime = DerivedColumn1@Time,\n\t\tShiftStartTime = DerivedColumn1@ShiftStartTime,\n\t\tShiftEndTime = DerivedColumn1@ShiftEndTime,\n\t\tShift = DerivedColumn1@Shift,\n\t\tShiftDate = DerivedColumn1@ShiftDate,\n\t\tMoveCount,\n\t\tBlock = DerivedColumn1@Block,\n\t\tHour,\n\t\tWeekofYear = DerivedColumn1@WeekofYear,\n\t\t{ecEventGkey.1} = Aggregate3@ecEventGkey,\n\t\t{ShiftDate.1} = DerivedColumn3@ShiftDate,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(TimeStamp>=LGON && TimeStamp<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp),\n\t\tLastMove = case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp),\n\t\tIdleTimeFL = case(isNull(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp))==false(),(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp)-LGON)/3600000,isNull(case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))==false(),(LGOF-case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))/3600000),\n\t\tITVIdleTime = iif(CHE_ID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-TimeStamp)<0,0.0,toFloat((TimeStamp_NXT-TimeStamp)/3600000)),0.0),\n\t\tBayChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0),\n\t\tBayChangeCount = iif(isNull(locSlot_NXT)==true(),0,iif(iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0)==1,\r\niif(toInteger(substring(locSlot,4,2))>toInteger(substring(locSlot_NXT,4,2)),iif( \r\ntoInteger(substring(locSlot,4,2))%2==0,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2)))), \r\niif(toInteger(substring(locSlot_NXT,4,2))%2==0,toInteger(substring(locSlot,4,2))-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2)))-(toInteger(substring(locSlot_NXT,4,2)))))\r\n,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,iif(\r\n    toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2)))) \r\n,iif(toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2)))))),0)),\n\t\tBlockChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)!=left(locSlot_NXT,3),1,0),0),0),0),\n\t\tLaneChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,2)!=left(locSlot_NXT,2),1,0),0),0),0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'gold/itv_ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tMoveCount,\n\t\tBlock,\n\t\tHour,\n\t\tWeekofYear,\n\t\t{ecEventGkey.1},\n\t\t{ShiftDate.1},\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime,\n\t\tValid,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\tlocSlot_PREV,\n\t\tlocSlot_NXT,\n\t\tecEventGkey_PREV,\n\t\tecEventGkey_NXT,\n\t\tShiftDate_PREV,\n\t\tShiftDate_NXT,\n\t\tLGON_PREV,\n\t\tLGON_NXT,\n\t\tLGOF_PREV,\n\t\tLGOF_NXT,\n\t\tFirstMove,\n\t\tLastMove,\n\t\tIdleTimeFL,\n\t\tITVIdleTime,\n\t\tBayChangeInstance,\n\t\tBayChangeCount,\n\t\tBlockChangeInstance,\n\t\tLaneChangeInstance\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> ITV\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\tmoveKind as string,\n\t\tlocSlot as string,\n\t\tunladenLocSlot as string,\n\t\tladen_LocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tWeekofYear as integer,\n\t\tDate as date,\n\t\tTime as string,\n\t\tShiftStartTime as timestamp,\n\t\tShiftEndTime as timestamp,\n\t\tShift as integer,\n\t\tShiftDate as date,\n\t\tBlock as string,\n\t\tCHE_ID_PREV as long,\n\t\tCHE_ID_NXT as long,\n\t\tTimeStamp_PREV as timestamp,\n\t\tTimeStamp_NXT as timestamp,\n\t\teventTypeDescription_PREV as string,\n\t\teventTypeDescription_NXT as string,\n\t\tLGOF as timestamp,\n\t\tLGON as timestamp,\n\t\tWorkTime as double\n\t),\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'gold/itv_workhours',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tWeekofYear,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tBlock,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\teventTypeDescription_PREV,\n\t\teventTypeDescription_NXT,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ITV EcEvents_haifa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "ITV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'haifa',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name = cheName,\n\t\tCHE_ID = cheID,\n\t\tTimeStamp = EcEventTime,\n\t\teventType = type,\n\t\teventSubType = subType,\n\t\teventTypeDescription = typeDescription,\n\t\tunit = unitIdName,\n\t\tpow = powName,\n\t\tpool = poolName,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot = ladenLocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='ITV' && eventTypeDescription=='CMPL') ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tMoveCount = 1,\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(TimeStamp, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))))) ~> DerivedColumn1\nselect filter((eventTypeDescription == 'LGOF' || eventTypeDescription == 'LGON') && cheKind == 'ITV') ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tBlock = left(locSlot,3)) ~> DerivedColumn3\nSort1 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\teventTypeDescription_PREV = lag(eventTypeDescription),\n\t\teventTypeDescription_NXT = lead(eventTypeDescription)) ~> Window1\nWindow1 derive(LGOF = case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(eventTypeDescription=='LGON',TimeStamp),\n\t\tWorkTime = toDouble((case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime))-case(eventTypeDescription=='LGON',TimeStamp))/3600000)) ~> DerivedColumn4\nDerivedColumn3 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nDerivedColumn1, Filter7 join(Aggregate1@CHE_ID == Aggregate3@CHE_ID\n\t&& DerivedColumn1@ShiftStartTime == DerivedColumn3@ShiftStartTime\n\t&& DerivedColumn1@ShiftEndTime == DerivedColumn3@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tecEventGkey = Aggregate1@ecEventGkey,\n\t\tyardGkey = Aggregate1@yardGkey,\n\t\tYardID = Aggregate1@YardID,\n\t\tFcyID = Aggregate1@FcyID,\n\t\tcheKind = Aggregate1@cheKind,\n\t\tCHE_Name = Aggregate1@CHE_Name,\n\t\tCHE_ID = Aggregate1@CHE_ID,\n\t\tTimeStamp = Aggregate1@TimeStamp,\n\t\teventType = Aggregate1@eventType,\n\t\teventSubType = Aggregate1@eventSubType,\n\t\teventTypeDescription = Aggregate1@eventTypeDescription,\n\t\tunit = Aggregate1@unit,\n\t\tpow = Aggregate1@pow,\n\t\tpool = Aggregate1@pool,\n\t\tworkQueue = Aggregate1@workQueue,\n\t\tmoveKind = Aggregate1@moveKind,\n\t\tlocSlot = Aggregate1@locSlot,\n\t\tunladenLocSlot = Aggregate1@unladenLocSlot,\n\t\tladen_LocSlot = Aggregate1@laden_LocSlot,\n\t\tYear = Aggregate1@Year,\n\t\tMonth = Aggregate1@Month,\n\t\tWeek = Aggregate1@Week,\n\t\tDate = DerivedColumn1@Date,\n\t\tTime = DerivedColumn1@Time,\n\t\tShiftStartTime = DerivedColumn1@ShiftStartTime,\n\t\tShiftEndTime = DerivedColumn1@ShiftEndTime,\n\t\tShift = DerivedColumn1@Shift,\n\t\tShiftDate = DerivedColumn1@ShiftDate,\n\t\tMoveCount,\n\t\tBlock = DerivedColumn1@Block,\n\t\tHour,\n\t\tWeekofYear = DerivedColumn1@WeekofYear,\n\t\t{ecEventGkey.1} = Aggregate3@ecEventGkey,\n\t\t{ShiftDate.1} = DerivedColumn3@ShiftDate,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(TimeStamp>=LGON && TimeStamp<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp),\n\t\tLastMove = case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp),\n\t\tIdleTimeFL = case(isNull(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp))==false(),(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp)-LGON)/3600000,isNull(case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))==false(),(LGOF-case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))/3600000),\n\t\tITVIdleTime = iif(CHE_ID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-TimeStamp)<0,0.0,toFloat((TimeStamp_NXT-TimeStamp)/3600000)),0.0),\n\t\tBayChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0),\n\t\tBayChangeCount = iif(isNull(locSlot_NXT)==true(),0,iif(iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0)==1,\r\niif(toInteger(substring(locSlot,4,2))>toInteger(substring(locSlot_NXT,4,2)),iif( \r\ntoInteger(substring(locSlot,4,2))%2==0,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2)))), \r\niif(toInteger(substring(locSlot_NXT,4,2))%2==0,toInteger(substring(locSlot,4,2))-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2)))-(toInteger(substring(locSlot_NXT,4,2)))))\r\n,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,iif(\r\n    toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2)))) \r\n,iif(toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2)))))),0)),\n\t\tBlockChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)!=left(locSlot_NXT,3),1,0),0),0),0),\n\t\tLaneChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,2)!=left(locSlot_NXT,2),1,0),0),0),0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'haifa',\n\tfolderPath: 'gold/itv_ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tMoveCount,\n\t\tBlock,\n\t\tHour,\n\t\tWeekofYear,\n\t\t{ecEventGkey.1},\n\t\t{ShiftDate.1},\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime,\n\t\tValid,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\tlocSlot_PREV,\n\t\tlocSlot_NXT,\n\t\tecEventGkey_PREV,\n\t\tecEventGkey_NXT,\n\t\tShiftDate_PREV,\n\t\tShiftDate_NXT,\n\t\tLGON_PREV,\n\t\tLGON_NXT,\n\t\tLGOF_PREV,\n\t\tLGOF_NXT,\n\t\tFirstMove,\n\t\tLastMove,\n\t\tIdleTimeFL,\n\t\tITVIdleTime,\n\t\tBayChangeInstance,\n\t\tBayChangeCount,\n\t\tBlockChangeInstance,\n\t\tLaneChangeInstance\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> ITV\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\tmoveKind as string,\n\t\tlocSlot as string,\n\t\tunladenLocSlot as string,\n\t\tladen_LocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tWeekofYear as integer,\n\t\tDate as date,\n\t\tTime as string,\n\t\tShiftStartTime as timestamp,\n\t\tShiftEndTime as timestamp,\n\t\tShift as integer,\n\t\tShiftDate as date,\n\t\tBlock as string,\n\t\tCHE_ID_PREV as long,\n\t\tCHE_ID_NXT as long,\n\t\tTimeStamp_PREV as timestamp,\n\t\tTimeStamp_NXT as timestamp,\n\t\teventTypeDescription_PREV as string,\n\t\teventTypeDescription_NXT as string,\n\t\tLGOF as timestamp,\n\t\tLGON as timestamp,\n\t\tWorkTime as double\n\t),\n\tformat: 'delta',\n\tfileSystem: 'haifa',\n\tfolderPath: 'gold/itv_workhours',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tWeekofYear,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tBlock,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\teventTypeDescription_PREV,\n\t\teventTypeDescription_NXT,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ITV EcEvents_kssp')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "for TT Productivity report",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ITV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'kssp',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name = cheName,\n\t\tCHE_ID = cheID,\n\t\tTimeStamp = EcEventTime,\n\t\teventType = type,\n\t\teventSubType = subType,\n\t\teventTypeDescription = typeDescription,\n\t\tunit = unitIdName,\n\t\tpow = powName,\n\t\tpool = poolName,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot = ladenLocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='ITV' && eventTypeDescription=='CMPL') ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tMoveCount = 1,\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(TimeStamp, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))))) ~> DerivedColumn1\nselect filter((eventTypeDescription == 'LGOF' || eventTypeDescription == 'LGON') && cheKind == 'ITV') ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tBlock = left(locSlot,3)) ~> DerivedColumn3\nSort1 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\teventTypeDescription_PREV = lag(eventTypeDescription),\n\t\teventTypeDescription_NXT = lead(eventTypeDescription)) ~> Window1\nWindow1 derive(LGOF = case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(eventTypeDescription=='LGON',TimeStamp),\n\t\tWorkTime = toDouble((case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime))-case(eventTypeDescription=='LGON',TimeStamp))/3600000)) ~> DerivedColumn4\nDerivedColumn3 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nDerivedColumn1, Filter7 join(Aggregate1@CHE_ID == Aggregate3@CHE_ID\n\t&& DerivedColumn1@ShiftStartTime == DerivedColumn3@ShiftStartTime\n\t&& DerivedColumn1@ShiftEndTime == DerivedColumn3@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tecEventGkey = Aggregate1@ecEventGkey,\n\t\tyardGkey = Aggregate1@yardGkey,\n\t\tYardID = Aggregate1@YardID,\n\t\tFcyID = Aggregate1@FcyID,\n\t\tcheKind = Aggregate1@cheKind,\n\t\tCHE_Name = Aggregate1@CHE_Name,\n\t\tCHE_ID = Aggregate1@CHE_ID,\n\t\tTimeStamp = Aggregate1@TimeStamp,\n\t\teventType = Aggregate1@eventType,\n\t\teventSubType = Aggregate1@eventSubType,\n\t\teventTypeDescription = Aggregate1@eventTypeDescription,\n\t\tunit = Aggregate1@unit,\n\t\tpow = Aggregate1@pow,\n\t\tpool = Aggregate1@pool,\n\t\tworkQueue = Aggregate1@workQueue,\n\t\tmoveKind = Aggregate1@moveKind,\n\t\tlocSlot = Aggregate1@locSlot,\n\t\tunladenLocSlot = Aggregate1@unladenLocSlot,\n\t\tladen_LocSlot = Aggregate1@laden_LocSlot,\n\t\tYear = Aggregate1@Year,\n\t\tMonth = Aggregate1@Month,\n\t\tWeek = Aggregate1@Week,\n\t\tDate = DerivedColumn1@Date,\n\t\tTime = DerivedColumn1@Time,\n\t\tShiftStartTime = DerivedColumn1@ShiftStartTime,\n\t\tShiftEndTime = DerivedColumn1@ShiftEndTime,\n\t\tShift = DerivedColumn1@Shift,\n\t\tShiftDate = DerivedColumn1@ShiftDate,\n\t\tMoveCount,\n\t\tBlock = DerivedColumn1@Block,\n\t\tHour,\n\t\tWeekofYear = DerivedColumn1@WeekofYear,\n\t\t{ecEventGkey.1} = Aggregate3@ecEventGkey,\n\t\t{ShiftDate.1} = DerivedColumn3@ShiftDate,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(TimeStamp>=LGON && TimeStamp<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp),\n\t\tLastMove = case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp),\n\t\tIdleTimeFL = case(isNull(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp))==false(),(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp)-LGON)/3600000,isNull(case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))==false(),(LGOF-case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))/3600000),\n\t\tITVIdleTime = iif(CHE_ID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-TimeStamp)<0,0.0,toFloat((TimeStamp_NXT-TimeStamp)/3600000)),0.0),\n\t\tBayChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0),\n\t\tBayChangeCount = iif(isNull(locSlot_NXT)==true(),0,iif(iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0)==1,\r\niif(toInteger(substring(locSlot,4,2))>toInteger(substring(locSlot_NXT,4,2)),iif( \r\ntoInteger(substring(locSlot,4,2))%2==0,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2)))), \r\niif(toInteger(substring(locSlot_NXT,4,2))%2==0,toInteger(substring(locSlot,4,2))-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2)))-(toInteger(substring(locSlot_NXT,4,2)))))\r\n,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,iif(\r\n    toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2)))) \r\n,iif(toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2)))))),0)),\n\t\tBlockChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)!=left(locSlot_NXT,3),1,0),0),0),0),\n\t\tLaneChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,2)!=left(locSlot_NXT,2),1,0),0),0),0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'kssp',\n\tfolderPath: 'gold/itv_ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tMoveCount,\n\t\tBlock,\n\t\tHour,\n\t\tWeekofYear,\n\t\t{ecEventGkey.1},\n\t\t{ShiftDate.1},\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime,\n\t\tValid,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\tlocSlot_PREV,\n\t\tlocSlot_NXT,\n\t\tecEventGkey_PREV,\n\t\tecEventGkey_NXT,\n\t\tShiftDate_PREV,\n\t\tShiftDate_NXT,\n\t\tLGON_PREV,\n\t\tLGON_NXT,\n\t\tLGOF_PREV,\n\t\tLGOF_NXT,\n\t\tFirstMove,\n\t\tLastMove,\n\t\tIdleTimeFL,\n\t\tITVIdleTime,\n\t\tBayChangeInstance,\n\t\tBayChangeCount,\n\t\tBlockChangeInstance,\n\t\tLaneChangeInstance\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> ITV\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\tmoveKind as string,\n\t\tlocSlot as string,\n\t\tunladenLocSlot as string,\n\t\tladen_LocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tWeekofYear as integer,\n\t\tDate as date,\n\t\tTime as string,\n\t\tShiftStartTime as timestamp,\n\t\tShiftEndTime as timestamp,\n\t\tShift as integer,\n\t\tShiftDate as date,\n\t\tBlock as string,\n\t\tCHE_ID_PREV as long,\n\t\tCHE_ID_NXT as long,\n\t\tTimeStamp_PREV as timestamp,\n\t\tTimeStamp_NXT as timestamp,\n\t\teventTypeDescription_PREV as string,\n\t\teventTypeDescription_NXT as string,\n\t\tLGOF as timestamp,\n\t\tLGON as timestamp,\n\t\tWorkTime as double\n\t),\n\tformat: 'delta',\n\tfileSystem: 'kssp',\n\tfolderPath: 'gold/itv_workhours',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tWeekofYear,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tBlock,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\teventTypeDescription_PREV,\n\t\teventTypeDescription_NXT,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ITV EcEvents_mict')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "ITV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name = cheName,\n\t\tCHE_ID = cheID,\n\t\tTimeStamp = EcEventTime,\n\t\teventType = type,\n\t\teventSubType = subType,\n\t\teventTypeDescription = typeDescription,\n\t\tunit = unitIdName,\n\t\tpow = powName,\n\t\tpool = poolName,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot = ladenLocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='ITV' && eventTypeDescription=='CMPL') ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tMoveCount = 1,\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(TimeStamp, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))))) ~> DerivedColumn1\nselect filter((eventTypeDescription == 'LGOF' || eventTypeDescription == 'LGON') && cheKind == 'ITV') ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tBlock = left(locSlot,3)) ~> DerivedColumn3\nSort1 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\teventTypeDescription_PREV = lag(eventTypeDescription),\n\t\teventTypeDescription_NXT = lead(eventTypeDescription)) ~> Window1\nWindow1 derive(LGOF = case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(eventTypeDescription=='LGON',TimeStamp),\n\t\tWorkTime = toDouble((case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime))-case(eventTypeDescription=='LGON',TimeStamp))/3600000)) ~> DerivedColumn4\nDerivedColumn3 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nDerivedColumn1, Filter7 join(Aggregate1@CHE_ID == Aggregate3@CHE_ID\n\t&& DerivedColumn1@ShiftStartTime == DerivedColumn3@ShiftStartTime\n\t&& DerivedColumn1@ShiftEndTime == DerivedColumn3@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tecEventGkey = Aggregate1@ecEventGkey,\n\t\tyardGkey = Aggregate1@yardGkey,\n\t\tYardID = Aggregate1@YardID,\n\t\tFcyID = Aggregate1@FcyID,\n\t\tcheKind = Aggregate1@cheKind,\n\t\tCHE_Name = Aggregate1@CHE_Name,\n\t\tCHE_ID = Aggregate1@CHE_ID,\n\t\tTimeStamp = Aggregate1@TimeStamp,\n\t\teventType = Aggregate1@eventType,\n\t\teventSubType = Aggregate1@eventSubType,\n\t\teventTypeDescription = Aggregate1@eventTypeDescription,\n\t\tunit = Aggregate1@unit,\n\t\tpow = Aggregate1@pow,\n\t\tpool = Aggregate1@pool,\n\t\tworkQueue = Aggregate1@workQueue,\n\t\tmoveKind = Aggregate1@moveKind,\n\t\tlocSlot = Aggregate1@locSlot,\n\t\tunladenLocSlot = Aggregate1@unladenLocSlot,\n\t\tladen_LocSlot = Aggregate1@laden_LocSlot,\n\t\tYear = Aggregate1@Year,\n\t\tMonth = Aggregate1@Month,\n\t\tWeek = Aggregate1@Week,\n\t\tDate = DerivedColumn1@Date,\n\t\tTime = DerivedColumn1@Time,\n\t\tShiftStartTime = DerivedColumn1@ShiftStartTime,\n\t\tShiftEndTime = DerivedColumn1@ShiftEndTime,\n\t\tShift = DerivedColumn1@Shift,\n\t\tShiftDate = DerivedColumn1@ShiftDate,\n\t\tMoveCount,\n\t\tBlock = DerivedColumn1@Block,\n\t\tHour,\n\t\tWeekofYear = DerivedColumn1@WeekofYear,\n\t\t{ecEventGkey.1} = Aggregate3@ecEventGkey,\n\t\t{ShiftDate.1} = DerivedColumn3@ShiftDate,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(TimeStamp>=LGON && TimeStamp<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp),\n\t\tLastMove = case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp),\n\t\tIdleTimeFL = case(isNull(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp))==false(),(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp)-LGON)/3600000,isNull(case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))==false(),(LGOF-case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))/3600000),\n\t\tITVIdleTime = iif(CHE_ID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-TimeStamp)<0,0.0,toFloat((TimeStamp_NXT-TimeStamp)/3600000)),0.0),\n\t\tBayChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0),\n\t\tBayChangeCount = iif(isNull(locSlot_NXT)==true(),0,iif(iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0)==1,\r\niif(toInteger(substring(locSlot,4,2))>toInteger(substring(locSlot_NXT,4,2)),iif( \r\ntoInteger(substring(locSlot,4,2))%2==0,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2)))), \r\niif(toInteger(substring(locSlot_NXT,4,2))%2==0,toInteger(substring(locSlot,4,2))-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2)))-(toInteger(substring(locSlot_NXT,4,2)))))\r\n,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,iif(\r\n    toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2)))) \r\n,iif(toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2)))))),0)),\n\t\tBlockChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)!=left(locSlot_NXT,3),1,0),0),0),0),\n\t\tLaneChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,2)!=left(locSlot_NXT,2),1,0),0),0),0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'gold/itv_ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tMoveCount,\n\t\tBlock,\n\t\tHour,\n\t\tWeekofYear,\n\t\t{ecEventGkey.1},\n\t\t{ShiftDate.1},\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime,\n\t\tValid,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\tlocSlot_PREV,\n\t\tlocSlot_NXT,\n\t\tecEventGkey_PREV,\n\t\tecEventGkey_NXT,\n\t\tShiftDate_PREV,\n\t\tShiftDate_NXT,\n\t\tLGON_PREV,\n\t\tLGON_NXT,\n\t\tLGOF_PREV,\n\t\tLGOF_NXT,\n\t\tFirstMove,\n\t\tLastMove,\n\t\tIdleTimeFL,\n\t\tITVIdleTime,\n\t\tBayChangeInstance,\n\t\tBayChangeCount,\n\t\tBlockChangeInstance,\n\t\tLaneChangeInstance\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> ITV\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\tmoveKind as string,\n\t\tlocSlot as string,\n\t\tunladenLocSlot as string,\n\t\tladen_LocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tWeekofYear as integer,\n\t\tDate as date,\n\t\tTime as string,\n\t\tShiftStartTime as timestamp,\n\t\tShiftEndTime as timestamp,\n\t\tShift as integer,\n\t\tShiftDate as date,\n\t\tBlock as string,\n\t\tCHE_ID_PREV as long,\n\t\tCHE_ID_NXT as long,\n\t\tTimeStamp_PREV as timestamp,\n\t\tTimeStamp_NXT as timestamp,\n\t\teventTypeDescription_PREV as string,\n\t\teventTypeDescription_NXT as string,\n\t\tLGOF as timestamp,\n\t\tLGON as timestamp,\n\t\tWorkTime as double\n\t),\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'gold/itv_workhours',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tWeekofYear,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tBlock,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\teventTypeDescription_PREV,\n\t\teventTypeDescription_NXT,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ITV EcEvents_mnhpi')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "ITV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name = cheName,\n\t\tCHE_ID = cheID,\n\t\tTimeStamp = EcEventTime,\n\t\teventType = type,\n\t\teventSubType = subType,\n\t\teventTypeDescription = typeDescription,\n\t\tunit = unitIdName,\n\t\tpow = powName,\n\t\tpool = poolName,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot = ladenLocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='ITV' && eventTypeDescription=='CMPL') ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tMoveCount = 1,\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(TimeStamp, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))))) ~> DerivedColumn1\nselect filter((eventTypeDescription == 'LGOF' || eventTypeDescription == 'LGON') && cheKind == 'ITV') ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tBlock = left(locSlot,3)) ~> DerivedColumn3\nSort1 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\teventTypeDescription_PREV = lag(eventTypeDescription),\n\t\teventTypeDescription_NXT = lead(eventTypeDescription)) ~> Window1\nWindow1 derive(LGOF = case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(eventTypeDescription=='LGON',TimeStamp),\n\t\tWorkTime = toDouble((case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime))-case(eventTypeDescription=='LGON',TimeStamp))/3600000)) ~> DerivedColumn4\nDerivedColumn3 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nDerivedColumn1, Filter7 join(Aggregate1@CHE_ID == Aggregate3@CHE_ID\n\t&& DerivedColumn1@ShiftStartTime == DerivedColumn3@ShiftStartTime\n\t&& DerivedColumn1@ShiftEndTime == DerivedColumn3@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tecEventGkey = Aggregate1@ecEventGkey,\n\t\tyardGkey = Aggregate1@yardGkey,\n\t\tYardID = Aggregate1@YardID,\n\t\tFcyID = Aggregate1@FcyID,\n\t\tcheKind = Aggregate1@cheKind,\n\t\tCHE_Name = Aggregate1@CHE_Name,\n\t\tCHE_ID = Aggregate1@CHE_ID,\n\t\tTimeStamp = Aggregate1@TimeStamp,\n\t\teventType = Aggregate1@eventType,\n\t\teventSubType = Aggregate1@eventSubType,\n\t\teventTypeDescription = Aggregate1@eventTypeDescription,\n\t\tunit = Aggregate1@unit,\n\t\tpow = Aggregate1@pow,\n\t\tpool = Aggregate1@pool,\n\t\tworkQueue = Aggregate1@workQueue,\n\t\tmoveKind = Aggregate1@moveKind,\n\t\tlocSlot = Aggregate1@locSlot,\n\t\tunladenLocSlot = Aggregate1@unladenLocSlot,\n\t\tladen_LocSlot = Aggregate1@laden_LocSlot,\n\t\tYear = Aggregate1@Year,\n\t\tMonth = Aggregate1@Month,\n\t\tWeek = Aggregate1@Week,\n\t\tDate = DerivedColumn1@Date,\n\t\tTime = DerivedColumn1@Time,\n\t\tShiftStartTime = DerivedColumn1@ShiftStartTime,\n\t\tShiftEndTime = DerivedColumn1@ShiftEndTime,\n\t\tShift = DerivedColumn1@Shift,\n\t\tShiftDate = DerivedColumn1@ShiftDate,\n\t\tMoveCount,\n\t\tBlock = DerivedColumn1@Block,\n\t\tHour,\n\t\tWeekofYear = DerivedColumn1@WeekofYear,\n\t\t{ecEventGkey.1} = Aggregate3@ecEventGkey,\n\t\t{ShiftDate.1} = DerivedColumn3@ShiftDate,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(TimeStamp>=LGON && TimeStamp<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp),\n\t\tLastMove = case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp),\n\t\tIdleTimeFL = case(isNull(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp))==false(),(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp)-LGON)/3600000,isNull(case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))==false(),(LGOF-case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))/3600000),\n\t\tITVIdleTime = iif(CHE_ID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-TimeStamp)<0,0.0,toFloat((TimeStamp_NXT-TimeStamp)/3600000)),0.0),\n\t\tBayChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0),\n\t\tBayChangeCount = iif(isNull(locSlot_NXT)==true(),0,iif(iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0)==1,\r\niif(toInteger(substring(locSlot,4,2))>toInteger(substring(locSlot_NXT,4,2)),iif( \r\ntoInteger(substring(locSlot,4,2))%2==0,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2)))), \r\niif(toInteger(substring(locSlot_NXT,4,2))%2==0,toInteger(substring(locSlot,4,2))-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2)))-(toInteger(substring(locSlot_NXT,4,2)))))\r\n,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,iif(\r\n    toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2)))) \r\n,iif(toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2)))))),0)),\n\t\tBlockChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)!=left(locSlot_NXT,3),1,0),0),0),0),\n\t\tLaneChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,2)!=left(locSlot_NXT,2),1,0),0),0),0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'gold/itv_ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tMoveCount,\n\t\tBlock,\n\t\tHour,\n\t\tWeekofYear,\n\t\t{ecEventGkey.1},\n\t\t{ShiftDate.1},\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime,\n\t\tValid,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\tlocSlot_PREV,\n\t\tlocSlot_NXT,\n\t\tecEventGkey_PREV,\n\t\tecEventGkey_NXT,\n\t\tShiftDate_PREV,\n\t\tShiftDate_NXT,\n\t\tLGON_PREV,\n\t\tLGON_NXT,\n\t\tLGOF_PREV,\n\t\tLGOF_NXT,\n\t\tFirstMove,\n\t\tLastMove,\n\t\tIdleTimeFL,\n\t\tITVIdleTime,\n\t\tBayChangeInstance,\n\t\tBayChangeCount,\n\t\tBlockChangeInstance,\n\t\tLaneChangeInstance\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> ITV\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\tmoveKind as string,\n\t\tlocSlot as string,\n\t\tunladenLocSlot as string,\n\t\tladen_LocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tWeekofYear as integer,\n\t\tDate as date,\n\t\tTime as string,\n\t\tShiftStartTime as timestamp,\n\t\tShiftEndTime as timestamp,\n\t\tShift as integer,\n\t\tShiftDate as date,\n\t\tBlock as string,\n\t\tCHE_ID_PREV as long,\n\t\tCHE_ID_NXT as long,\n\t\tTimeStamp_PREV as timestamp,\n\t\tTimeStamp_NXT as timestamp,\n\t\teventTypeDescription_PREV as string,\n\t\teventTypeDescription_NXT as string,\n\t\tLGOF as timestamp,\n\t\tLGON as timestamp,\n\t\tWorkTime as double\n\t),\n\tformat: 'delta',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'gold/itv_workhours',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tWeekofYear,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tBlock,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\teventTypeDescription_PREV,\n\t\teventTypeDescription_NXT,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ITV EcEvents_tdt')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "ITV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'tdt',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name = cheName,\n\t\tCHE_ID = cheID,\n\t\tTimeStamp = EcEventTime,\n\t\teventType = type,\n\t\teventSubType = subType,\n\t\teventTypeDescription = typeDescription,\n\t\tunit = unitIdName,\n\t\tpow = powName,\n\t\tpool = poolName,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot = ladenLocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='ITV' && eventTypeDescription=='CMPL') ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tMoveCount = 1,\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(TimeStamp, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))))) ~> DerivedColumn1\nselect filter((eventTypeDescription == 'LGOF' || eventTypeDescription == 'LGON') && cheKind == 'ITV') ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tBlock = left(locSlot,3)) ~> DerivedColumn3\nSort1 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\teventTypeDescription_PREV = lag(eventTypeDescription),\n\t\teventTypeDescription_NXT = lead(eventTypeDescription)) ~> Window1\nWindow1 derive(LGOF = case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(eventTypeDescription=='LGON',TimeStamp),\n\t\tWorkTime = toDouble((case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime))-case(eventTypeDescription=='LGON',TimeStamp))/3600000)) ~> DerivedColumn4\nDerivedColumn3 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nDerivedColumn1, Filter7 join(Aggregate1@CHE_ID == Aggregate3@CHE_ID\n\t&& DerivedColumn1@ShiftStartTime == DerivedColumn3@ShiftStartTime\n\t&& DerivedColumn1@ShiftEndTime == DerivedColumn3@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tecEventGkey = Aggregate1@ecEventGkey,\n\t\tyardGkey = Aggregate1@yardGkey,\n\t\tYardID = Aggregate1@YardID,\n\t\tFcyID = Aggregate1@FcyID,\n\t\tcheKind = Aggregate1@cheKind,\n\t\tCHE_Name = Aggregate1@CHE_Name,\n\t\tCHE_ID = Aggregate1@CHE_ID,\n\t\tTimeStamp = Aggregate1@TimeStamp,\n\t\teventType = Aggregate1@eventType,\n\t\teventSubType = Aggregate1@eventSubType,\n\t\teventTypeDescription = Aggregate1@eventTypeDescription,\n\t\tunit = Aggregate1@unit,\n\t\tpow = Aggregate1@pow,\n\t\tpool = Aggregate1@pool,\n\t\tworkQueue = Aggregate1@workQueue,\n\t\tmoveKind = Aggregate1@moveKind,\n\t\tlocSlot = Aggregate1@locSlot,\n\t\tunladenLocSlot = Aggregate1@unladenLocSlot,\n\t\tladen_LocSlot = Aggregate1@laden_LocSlot,\n\t\tYear = Aggregate1@Year,\n\t\tMonth = Aggregate1@Month,\n\t\tWeek = Aggregate1@Week,\n\t\tDate = DerivedColumn1@Date,\n\t\tTime = DerivedColumn1@Time,\n\t\tShiftStartTime = DerivedColumn1@ShiftStartTime,\n\t\tShiftEndTime = DerivedColumn1@ShiftEndTime,\n\t\tShift = DerivedColumn1@Shift,\n\t\tShiftDate = DerivedColumn1@ShiftDate,\n\t\tMoveCount,\n\t\tBlock = DerivedColumn1@Block,\n\t\tHour,\n\t\tWeekofYear = DerivedColumn1@WeekofYear,\n\t\t{ecEventGkey.1} = Aggregate3@ecEventGkey,\n\t\t{ShiftDate.1} = DerivedColumn3@ShiftDate,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(TimeStamp>=LGON && TimeStamp<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp),\n\t\tLastMove = case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp),\n\t\tIdleTimeFL = case(isNull(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp))==false(),(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp)-LGON)/3600000,isNull(case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))==false(),(LGOF-case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))/3600000),\n\t\tITVIdleTime = iif(CHE_ID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-TimeStamp)<0,0.0,toFloat((TimeStamp_NXT-TimeStamp)/3600000)),0.0),\n\t\tBayChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0),\n\t\tBayChangeCount = iif(isNull(locSlot_NXT)==true(),0,iif(iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0)==1,\r\niif(toInteger(substring(locSlot,4,2))>toInteger(substring(locSlot_NXT,4,2)),iif( \r\ntoInteger(substring(locSlot,4,2))%2==0,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2)))), \r\niif(toInteger(substring(locSlot_NXT,4,2))%2==0,toInteger(substring(locSlot,4,2))-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2)))-(toInteger(substring(locSlot_NXT,4,2)))))\r\n,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,iif(\r\n    toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2)))) \r\n,iif(toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2)))))),0)),\n\t\tBlockChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)!=left(locSlot_NXT,3),1,0),0),0),0),\n\t\tLaneChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,2)!=left(locSlot_NXT,2),1,0),0),0),0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'tdt',\n\tfolderPath: 'gold/itv_ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tMoveCount,\n\t\tBlock,\n\t\tHour,\n\t\tWeekofYear,\n\t\t{ecEventGkey.1},\n\t\t{ShiftDate.1},\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime,\n\t\tValid,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\tlocSlot_PREV,\n\t\tlocSlot_NXT,\n\t\tecEventGkey_PREV,\n\t\tecEventGkey_NXT,\n\t\tShiftDate_PREV,\n\t\tShiftDate_NXT,\n\t\tLGON_PREV,\n\t\tLGON_NXT,\n\t\tLGOF_PREV,\n\t\tLGOF_NXT,\n\t\tFirstMove,\n\t\tLastMove,\n\t\tIdleTimeFL,\n\t\tITVIdleTime,\n\t\tBayChangeInstance,\n\t\tBayChangeCount,\n\t\tBlockChangeInstance,\n\t\tLaneChangeInstance\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> ITV\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\tmoveKind as string,\n\t\tlocSlot as string,\n\t\tunladenLocSlot as string,\n\t\tladen_LocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tWeekofYear as integer,\n\t\tDate as date,\n\t\tTime as string,\n\t\tShiftStartTime as timestamp,\n\t\tShiftEndTime as timestamp,\n\t\tShift as integer,\n\t\tShiftDate as date,\n\t\tBlock as string,\n\t\tCHE_ID_PREV as long,\n\t\tCHE_ID_NXT as long,\n\t\tTimeStamp_PREV as timestamp,\n\t\tTimeStamp_NXT as timestamp,\n\t\teventTypeDescription_PREV as string,\n\t\teventTypeDescription_NXT as string,\n\t\tLGOF as timestamp,\n\t\tLGON as timestamp,\n\t\tWorkTime as double\n\t),\n\tformat: 'delta',\n\tfileSystem: 'tdt',\n\tfolderPath: 'gold/itv_workhours',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tWeekofYear,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tBlock,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\teventTypeDescription_PREV,\n\t\teventTypeDescription_NXT,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ITV EcEvents_transnet_ctct')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "for TT Productivity report",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ITV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'transnet',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name = cheName,\n\t\tCHE_ID = cheID,\n\t\tTimeStamp = EcEventTime,\n\t\teventType = type,\n\t\teventSubType = subType,\n\t\teventTypeDescription = typeDescription,\n\t\tunit = unitIdName,\n\t\tpow = powName,\n\t\tpool = poolName,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot = ladenLocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='ITV' && eventTypeDescription=='CMPL' && FcyID == 'CTCT') ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tMoveCount = 1,\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(TimeStamp, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))))) ~> DerivedColumn1\nselect filter((eventTypeDescription == 'LGOF' || eventTypeDescription == 'LGON') && cheKind == 'ITV'&& FcyID == 'CTCT') ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tBlock = left(locSlot,3)) ~> DerivedColumn3\nSort1 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\teventTypeDescription_PREV = lag(eventTypeDescription),\n\t\teventTypeDescription_NXT = lead(eventTypeDescription)) ~> Window1\nWindow1 derive(LGOF = case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(eventTypeDescription=='LGON',TimeStamp),\n\t\tWorkTime = toDouble((case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime))-case(eventTypeDescription=='LGON',TimeStamp))/3600000)) ~> DerivedColumn4\nDerivedColumn3 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nDerivedColumn1, Filter7 join(Aggregate1@CHE_ID == Aggregate3@CHE_ID\n\t&& DerivedColumn1@ShiftStartTime == DerivedColumn3@ShiftStartTime\n\t&& DerivedColumn1@ShiftEndTime == DerivedColumn3@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tecEventGkey = Aggregate1@ecEventGkey,\n\t\tyardGkey = Aggregate1@yardGkey,\n\t\tYardID = Aggregate1@YardID,\n\t\tFcyID = Aggregate1@FcyID,\n\t\tcheKind = Aggregate1@cheKind,\n\t\tCHE_Name = Aggregate1@CHE_Name,\n\t\tCHE_ID = Aggregate1@CHE_ID,\n\t\tTimeStamp = Aggregate1@TimeStamp,\n\t\teventType = Aggregate1@eventType,\n\t\teventSubType = Aggregate1@eventSubType,\n\t\teventTypeDescription = Aggregate1@eventTypeDescription,\n\t\tunit = Aggregate1@unit,\n\t\tpow = Aggregate1@pow,\n\t\tpool = Aggregate1@pool,\n\t\tworkQueue = Aggregate1@workQueue,\n\t\tmoveKind = Aggregate1@moveKind,\n\t\tlocSlot = Aggregate1@locSlot,\n\t\tunladenLocSlot = Aggregate1@unladenLocSlot,\n\t\tladen_LocSlot = Aggregate1@laden_LocSlot,\n\t\tYear = Aggregate1@Year,\n\t\tMonth = Aggregate1@Month,\n\t\tWeek = Aggregate1@Week,\n\t\tDate = DerivedColumn1@Date,\n\t\tTime = DerivedColumn1@Time,\n\t\tShiftStartTime = DerivedColumn1@ShiftStartTime,\n\t\tShiftEndTime = DerivedColumn1@ShiftEndTime,\n\t\tShift = DerivedColumn1@Shift,\n\t\tShiftDate = DerivedColumn1@ShiftDate,\n\t\tMoveCount,\n\t\tBlock = DerivedColumn1@Block,\n\t\tHour,\n\t\tWeekofYear = DerivedColumn1@WeekofYear,\n\t\t{ecEventGkey.1} = Aggregate3@ecEventGkey,\n\t\t{ShiftDate.1} = DerivedColumn3@ShiftDate,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(TimeStamp>=LGON && TimeStamp<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp),\n\t\tLastMove = case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp),\n\t\tIdleTimeFL = case(isNull(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp))==false(),(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp)-LGON)/3600000,isNull(case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))==false(),(LGOF-case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))/3600000),\n\t\tITVIdleTime = iif(CHE_ID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-TimeStamp)<0,0.0,toFloat((TimeStamp_NXT-TimeStamp)/3600000)),0.0),\n\t\tBayChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0),\n\t\tBayChangeCount = iif(isNull(locSlot_NXT)==true(),0,iif(iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0)==1,\r\niif(toInteger(substring(locSlot,4,2))>toInteger(substring(locSlot_NXT,4,2)),iif( \r\ntoInteger(substring(locSlot,4,2))%2==0,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2)))), \r\niif(toInteger(substring(locSlot_NXT,4,2))%2==0,toInteger(substring(locSlot,4,2))-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2)))-(toInteger(substring(locSlot_NXT,4,2)))))\r\n,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,iif(\r\n    toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2)))) \r\n,iif(toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2)))))),0)),\n\t\tBlockChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)!=left(locSlot_NXT,3),1,0),0),0),0),\n\t\tLaneChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,2)!=left(locSlot_NXT,2),1,0),0),0),0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'transnet',\n\tfolderPath: 'gold/itv_ecevents_ctct',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tMoveCount,\n\t\tBlock,\n\t\tHour,\n\t\tWeekofYear,\n\t\t{ecEventGkey.1},\n\t\t{ShiftDate.1},\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime,\n\t\tValid,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\tlocSlot_PREV,\n\t\tlocSlot_NXT,\n\t\tecEventGkey_PREV,\n\t\tecEventGkey_NXT,\n\t\tShiftDate_PREV,\n\t\tShiftDate_NXT,\n\t\tLGON_PREV,\n\t\tLGON_NXT,\n\t\tLGOF_PREV,\n\t\tLGOF_NXT,\n\t\tFirstMove,\n\t\tLastMove,\n\t\tIdleTimeFL,\n\t\tITVIdleTime,\n\t\tBayChangeInstance,\n\t\tBayChangeCount,\n\t\tBlockChangeInstance,\n\t\tLaneChangeInstance\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> ITV\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\tmoveKind as string,\n\t\tlocSlot as string,\n\t\tunladenLocSlot as string,\n\t\tladen_LocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tWeekofYear as integer,\n\t\tDate as date,\n\t\tTime as string,\n\t\tShiftStartTime as timestamp,\n\t\tShiftEndTime as timestamp,\n\t\tShift as integer,\n\t\tShiftDate as date,\n\t\tBlock as string,\n\t\tCHE_ID_PREV as long,\n\t\tCHE_ID_NXT as long,\n\t\tTimeStamp_PREV as timestamp,\n\t\tTimeStamp_NXT as timestamp,\n\t\teventTypeDescription_PREV as string,\n\t\teventTypeDescription_NXT as string,\n\t\tLGOF as timestamp,\n\t\tLGON as timestamp,\n\t\tWorkTime as double\n\t),\n\tformat: 'delta',\n\tfileSystem: 'transnet',\n\tfolderPath: 'gold/itv_workhours_ctct',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tWeekofYear,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tBlock,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\teventTypeDescription_PREV,\n\t\teventTypeDescription_NXT,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ITV EcEvents_valencia')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "ITV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name = cheName,\n\t\tCHE_ID = cheID,\n\t\tTimeStamp = EcEventTime,\n\t\teventType = type,\n\t\teventSubType = subType,\n\t\teventTypeDescription = typeDescription,\n\t\tunit = unitIdName,\n\t\tpow = powName,\n\t\tpool = poolName,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot = ladenLocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='ITV' && eventTypeDescription=='CMPL') ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tMoveCount = 1,\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(TimeStamp, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))))) ~> DerivedColumn1\nselect filter((eventTypeDescription == 'LGOF' || eventTypeDescription == 'LGON') && cheKind == 'ITV') ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tBlock = left(locSlot,3)) ~> DerivedColumn3\nSort1 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\teventTypeDescription_PREV = lag(eventTypeDescription),\n\t\teventTypeDescription_NXT = lead(eventTypeDescription)) ~> Window1\nWindow1 derive(LGOF = case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(eventTypeDescription=='LGON',TimeStamp),\n\t\tWorkTime = toDouble((case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime))-case(eventTypeDescription=='LGON',TimeStamp))/3600000)) ~> DerivedColumn4\nDerivedColumn3 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nDerivedColumn1, Filter7 join(Aggregate1@CHE_ID == Aggregate3@CHE_ID\n\t&& DerivedColumn1@ShiftStartTime == DerivedColumn3@ShiftStartTime\n\t&& DerivedColumn1@ShiftEndTime == DerivedColumn3@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tecEventGkey = Aggregate1@ecEventGkey,\n\t\tyardGkey = Aggregate1@yardGkey,\n\t\tYardID = Aggregate1@YardID,\n\t\tFcyID = Aggregate1@FcyID,\n\t\tcheKind = Aggregate1@cheKind,\n\t\tCHE_Name = Aggregate1@CHE_Name,\n\t\tCHE_ID = Aggregate1@CHE_ID,\n\t\tTimeStamp = Aggregate1@TimeStamp,\n\t\teventType = Aggregate1@eventType,\n\t\teventSubType = Aggregate1@eventSubType,\n\t\teventTypeDescription = Aggregate1@eventTypeDescription,\n\t\tunit = Aggregate1@unit,\n\t\tpow = Aggregate1@pow,\n\t\tpool = Aggregate1@pool,\n\t\tworkQueue = Aggregate1@workQueue,\n\t\tmoveKind = Aggregate1@moveKind,\n\t\tlocSlot = Aggregate1@locSlot,\n\t\tunladenLocSlot = Aggregate1@unladenLocSlot,\n\t\tladen_LocSlot = Aggregate1@laden_LocSlot,\n\t\tYear = Aggregate1@Year,\n\t\tMonth = Aggregate1@Month,\n\t\tWeek = Aggregate1@Week,\n\t\tDate = DerivedColumn1@Date,\n\t\tTime = DerivedColumn1@Time,\n\t\tShiftStartTime = DerivedColumn1@ShiftStartTime,\n\t\tShiftEndTime = DerivedColumn1@ShiftEndTime,\n\t\tShift = DerivedColumn1@Shift,\n\t\tShiftDate = DerivedColumn1@ShiftDate,\n\t\tMoveCount,\n\t\tBlock = DerivedColumn1@Block,\n\t\tHour,\n\t\tWeekofYear = DerivedColumn1@WeekofYear,\n\t\t{ecEventGkey.1} = Aggregate3@ecEventGkey,\n\t\t{ShiftDate.1} = DerivedColumn3@ShiftDate,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(TimeStamp>=LGON && TimeStamp<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp),\n\t\tLastMove = case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp),\n\t\tIdleTimeFL = case(isNull(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp))==false(),(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp)-LGON)/3600000,isNull(case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))==false(),(LGOF-case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))/3600000),\n\t\tITVIdleTime = iif(CHE_ID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-TimeStamp)<0,0.0,toFloat((TimeStamp_NXT-TimeStamp)/3600000)),0.0),\n\t\tBayChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0),\n\t\tBayChangeCount = iif(isNull(locSlot_NXT)==true(),0,iif(iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0)==1,\r\niif(toInteger(substring(locSlot,4,2))>toInteger(substring(locSlot_NXT,4,2)),iif( \r\ntoInteger(substring(locSlot,4,2))%2==0,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2)))), \r\niif(toInteger(substring(locSlot_NXT,4,2))%2==0,toInteger(substring(locSlot,4,2))-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2)))-(toInteger(substring(locSlot_NXT,4,2)))))\r\n,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,iif(\r\n    toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2)))) \r\n,iif(toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2)))))),0)),\n\t\tBlockChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)!=left(locSlot_NXT,3),1,0),0),0),0),\n\t\tLaneChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,2)!=left(locSlot_NXT,2),1,0),0),0),0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'gold/itv_ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tMoveCount,\n\t\tBlock,\n\t\tHour,\n\t\tWeekofYear,\n\t\t{ecEventGkey.1},\n\t\t{ShiftDate.1},\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime,\n\t\tValid,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\tlocSlot_PREV,\n\t\tlocSlot_NXT,\n\t\tecEventGkey_PREV,\n\t\tecEventGkey_NXT,\n\t\tShiftDate_PREV,\n\t\tShiftDate_NXT,\n\t\tLGON_PREV,\n\t\tLGON_NXT,\n\t\tLGOF_PREV,\n\t\tLGOF_NXT,\n\t\tFirstMove,\n\t\tLastMove,\n\t\tIdleTimeFL,\n\t\tITVIdleTime,\n\t\tBayChangeInstance,\n\t\tBayChangeCount,\n\t\tBlockChangeInstance,\n\t\tLaneChangeInstance\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> ITV\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\tmoveKind as string,\n\t\tlocSlot as string,\n\t\tunladenLocSlot as string,\n\t\tladen_LocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tWeekofYear as integer,\n\t\tDate as date,\n\t\tTime as string,\n\t\tShiftStartTime as timestamp,\n\t\tShiftEndTime as timestamp,\n\t\tShift as integer,\n\t\tShiftDate as date,\n\t\tBlock as string,\n\t\tCHE_ID_PREV as long,\n\t\tCHE_ID_NXT as long,\n\t\tTimeStamp_PREV as timestamp,\n\t\tTimeStamp_NXT as timestamp,\n\t\teventTypeDescription_PREV as string,\n\t\teventTypeDescription_NXT as string,\n\t\tLGOF as timestamp,\n\t\tLGON as timestamp,\n\t\tWorkTime as double\n\t),\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'gold/itv_workhours',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tWeekofYear,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tBlock,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\teventTypeDescription_PREV,\n\t\teventTypeDescription_NXT,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ITV_Violations_TEAGTL')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "navispowerbidata2-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "select1"
						},
						{
							"name": "select2"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "derivedColumn3"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as string,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          operator as string,",
						"          EcEventTime as timestamp,",
						"          cheID as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source(output(",
						"          gkey as short,",
						"          user_id as string,",
						"          name as string,",
						"          yard as string,",
						"          {_c4} as string,",
						"          {_c5} as string,",
						"          {_c6} as string,",
						"          {_c7} as string,",
						"          {_c8} as string,",
						"          {_c9} as string,",
						"          {_c10} as string,",
						"          {_c11} as string,",
						"          {_c12} as string,",
						"          {_c13} as string,",
						"          {_c14} as string,",
						"          {_c15} as string,",
						"          {_c16} as string,",
						"          {_c17} as string,",
						"          {_c18} as string,",
						"          {_c19} as string,",
						"          {_c20} as string,",
						"          {_c21} as string,",
						"          {_c22} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'bronze/xpsecuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> source2",
						"source1 filter(cheKind==\"ITV\" && (eventTypeDescription==\"AYDR\" || eventTypeDescription==\"TYDR\" || eventTypeDescription==\"AYCO\" || eventTypeDescription==\"TYCO\" || eventTypeDescription==\"AVDR\" || eventTypeDescription==\"TVDR\" || eventTypeDescription==\"AVCO\" || eventTypeDescription==\"TVCO\") && (moveKind==\"DSCH\"||moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     startRowOffset: 1L,",
						"     endRowOffset: 1L,",
						"     eventName_nxt = lead(eventName),",
						"          pow_nxt = lead(pow),",
						"          cheID_nxt = lead(cheID),",
						"          EcEventTime_nxt = lead(EcEventTime),",
						"          yardBlock_nxt = lead(yardBlock),",
						"          yardRow_nxt = lead(yardRow)) ~> window1",
						"derivedColumn2 sort(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"select1 alterRow(upsertIf(true())) ~> AlterRow1",
						"join1 select(mapColumn(",
						"          ecEventGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          CHE_Name,",
						"          eventTypeDescription,",
						"          unit,",
						"          pow,",
						"          pool,",
						"          workQueue,",
						"          travelDistance,",
						"          moveKind,",
						"          startDistance,",
						"          locSlot,",
						"          cheID,",
						"          EcEventTime,",
						"          eventName,",
						"          yardBlock,",
						"          yardRow,",
						"          eventName_nxt,",
						"          pow_nxt,",
						"          cheID_nxt,",
						"          EcEventTime_nxt,",
						"          yardBlock_nxt,",
						"          yardRow_nxt,",
						"          operator,",
						"          user_id,",
						"          name,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          violation",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"source2 select(mapColumn(",
						"          user_id,",
						"          name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"select2 aggregate(groupBy(user_id),",
						"     name = last(trim(name))) ~> aggregate1",
						"filter2, derivedColumn3 join(lower(trim(user_id)) == lower(trim(operator)),",
						"     joinType:'right',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"aggregate1 filter(not(isNull(user_id))) ~> filter2",
						"filter1 derive(eventName = iif(in([\"TVCO\", \"AVCO\", \"TYCO\", \"AYCO\"], eventTypeDescription), \"EVENT_1\", iif(in([\"TYDR\", \"AYDR\", \"TVDR\", \"AVDR\"], eventTypeDescription), \"EVENT_2\", \"EVENT_DEFAULT\")),",
						"          yardBlock = left(locSlot , 5),",
						"          yardRow = substring(locSlot , 3, 3)) ~> derivedColumn2",
						"window1 derive(violation = iif(moveKind==\"DSCH\",\r",
						" iif(cheID==cheID_nxt && eventName==\"EVENT_1\" && eventName_nxt==\"EVENT_2\" && pow!=pow_nxt, 1, 0), \r",
						"    iif(moveKind==\"LOAD\", \r",
						"        iif(cheID==cheID_nxt && eventName==\"EVENT_1\" && eventName_nxt==\"EVENT_2\" && (yardBlock!=yardBlock_nxt || yardRow!=yardRow_nxt), 1, 0),0)\r",
						")) ~> derivedColumn3",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'gold/itv_violation',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]",
				"[concat(variables('workspaceId'), '/linkedServices/navispowerbidata2-WorkspaceDefaultStorage')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ITV_Violations_TEAGTL_v1')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "navispowerbidata2-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "select1"
						},
						{
							"name": "select2"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "derivedColumn3"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as string,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          operator as string,",
						"          EcEventTime as timestamp,",
						"          cheID as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source(output(",
						"          gkey as short,",
						"          user_id as string,",
						"          name as string,",
						"          yard as string,",
						"          {_c4} as string,",
						"          {_c5} as string,",
						"          {_c6} as string,",
						"          {_c7} as string,",
						"          {_c8} as string,",
						"          {_c9} as string,",
						"          {_c10} as string,",
						"          {_c11} as string,",
						"          {_c12} as string,",
						"          {_c13} as string,",
						"          {_c14} as string,",
						"          {_c15} as string,",
						"          {_c16} as string,",
						"          {_c17} as string,",
						"          {_c18} as string,",
						"          {_c19} as string,",
						"          {_c20} as string,",
						"          {_c21} as string,",
						"          {_c22} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'bronze/xpsecuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> source2",
						"source1 filter(cheKind==\"ITV\" && (eventTypeDescription==\"AYDR\" || eventTypeDescription==\"TYDR\" || eventTypeDescription==\"AYCO\" || eventTypeDescription==\"TYCO\" || eventTypeDescription==\"AVDR\" || eventTypeDescription==\"TVDR\" || eventTypeDescription==\"AVCO\" || eventTypeDescription==\"TVCO\") && (moveKind==\"DSCH\"||moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     startRowOffset: 1L,",
						"     endRowOffset: 1L,",
						"     eventName_nxt = lead(eventName),",
						"          pow_nxt = lead(pow),",
						"          cheID_nxt = lead(cheID),",
						"          EcEventTime_nxt = lead(EcEventTime),",
						"          yardBlock_nxt = lead(yardBlock),",
						"          yardRow_nxt = lead(yardRow)) ~> window1",
						"derivedColumn2 sort(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"select1 alterRow(upsertIf(true())) ~> AlterRow1",
						"join1 select(mapColumn(",
						"          ecEventGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          CHE_Name,",
						"          eventTypeDescription,",
						"          unit,",
						"          pow,",
						"          pool,",
						"          workQueue,",
						"          travelDistance,",
						"          moveKind,",
						"          startDistance,",
						"          locSlot,",
						"          cheID,",
						"          EcEventTime,",
						"          eventName,",
						"          yardBlock,",
						"          yardRow,",
						"          eventName_nxt,",
						"          pow_nxt,",
						"          cheID_nxt,",
						"          EcEventTime_nxt,",
						"          yardBlock_nxt,",
						"          yardRow_nxt,",
						"          operator,",
						"          user_id,",
						"          name,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          violation",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"source2 select(mapColumn(",
						"          user_id,",
						"          name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"select2 aggregate(groupBy(user_id),",
						"     name = last(trim(name))) ~> aggregate1",
						"filter2, derivedColumn3 join(lower(trim(user_id)) == lower(trim(operator)),",
						"     joinType:'right',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"aggregate1 filter(not(isNull(user_id))) ~> filter2",
						"filter1 derive(eventName = iif(in([\"TVCO\", \"AVCO\", \"TYCO\", \"AYCO\"], eventTypeDescription), \"EVENT_1\", iif(in([\"TYDR\", \"AYDR\", \"TVDR\", \"AVDR\"], eventTypeDescription), \"EVENT_2\", \"EVENT_DEFAULT\")),",
						"          yardBlock = left(locSlot , 5),",
						"          yardRow = substring(locSlot , 3, 3)) ~> derivedColumn2",
						"window1 derive(violation = iif(moveKind==\"DSCH\",\r",
						" iif(cheID==cheID_nxt && eventName==\"EVENT_1\" && eventName_nxt==\"EVENT_2\" && pow!=pow_nxt, 1, 0), \r",
						"    iif(moveKind==\"LOAD\", \r",
						"        iif(cheID==cheID_nxt && eventName==\"EVENT_1\" && eventName_nxt==\"EVENT_2\" && (yardBlock!=yardBlock_nxt || yardRow!=yardRow_nxt), 1, 0),0)\r",
						")) ~> derivedColumn3",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'gold/itv_violation',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]",
				"[concat(variables('workspaceId'), '/linkedServices/navispowerbidata2-WorkspaceDefaultStorage')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Laden_Unladen')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Join1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as integer,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nsource(output(\n\t\tComplex_Id as string,\n\t\tFacility_Id as string,\n\t\tCarrier_Visit_Id as string,\n\t\tPhase as string,\n\t\tVisit_Nbr as string,\n\t\tCarrier_Mode as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tETA as timestamp,\n\t\tETD as timestamp,\n\t\tOperator_Line_Id as string,\n\t\tOperator_Line_Role as string,\n\t\tOperator_Line_Name as string,\n\t\tTime_First_Availabilty as string,\n\t\tTime_Discharge_Complete as string,\n\t\tService_Id as string,\n\t\tService_Name as string,\n\t\tVessel_Id as string,\n\t\tIB_VYG as string,\n\t\tOB_VYG as string,\n\t\tCarrier_Name as string,\n\t\tVessel_Class as string,\n\t\tPublished_ETA as string,\n\t\tPublished_ETD as string,\n\t\tStart_Work as string,\n\t\tEnd_Work as string,\n\t\tBegin_Receive_Date as string,\n\t\tCargo_Cutoff_Date as string,\n\t\tHazard_Cutoff_Date as string,\n\t\tReefer_Cutoff_Date as string,\n\t\tLabor_On_Board_Date as string,\n\t\tLabor_Off_Board_Date as string,\n\t\tOff_Port_Arrival_Date as string,\n\t\tOff_Port_Departure as string,\n\t\tPilot_On_Board_Date as string,\n\t\tPilot_Off_Board_Date as string,\n\t\tEst_BBK_Discharge as string,\n\t\tEst_BBK_Load as string,\n\t\tEst_Load as string,\n\t\tEst_Discharge as string,\n\t\tEst_Restow as string,\n\t\tEst_Shift as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tVessel_Classification as string,\n\t\tVessel_Class_Length_Overall_cm as integer,\n\t\tVessel_Class_Beam_cm as short,\n\t\tVessel_TEU_Capacity as string,\n\t\tLloyds_Code as string,\n\t\tTimeFirstAvailabilty as timestamp,\n\t\tStartWork as timestamp,\n\t\tTimeDischargeComplete as timestamp,\n\t\tEndWork as timestamp,\n\t\tWeek as integer,\n\t\tYear as integer,\n\t\tMonth as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'silver/vesselvisits') ~> source2\nSelect1 filter(equals(Carry_CHE_Kind,'ITV') && (equals(Event_Type_Id,'UNIT_LOAD') || equals(Event_Type_Id, 'UNIT_DISCH'))) ~> Filter1\nJoin1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key = source1@Carrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear = source1@Year,\n\t\tMonth = source1@Month,\n\t\tWeek = source1@Week,\n\t\tmve_gkey,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tUnladen = dist_start,\n\t\tLaden = dist_carry,\n\t\tCarrier_Name,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nFilter1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nsource1, source2 join(source1@Carrier_Visit_Key == source2@Carrier_Visit_Key,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'gold/laden_unladen',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Laden_Unladen_GTI')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as integer,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gti',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nsource(output(\n\t\tComplex_Id as string,\n\t\tFacility_Id as string,\n\t\tCarrier_Visit_Id as string,\n\t\tPhase as string,\n\t\tVisit_Nbr as string,\n\t\tCarrier_Mode as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tETA as timestamp,\n\t\tETD as timestamp,\n\t\tOperator_Line_Id as string,\n\t\tOperator_Line_Role as string,\n\t\tOperator_Line_Name as string,\n\t\tTime_First_Availabilty as string,\n\t\tTime_Discharge_Complete as string,\n\t\tService_Id as string,\n\t\tService_Name as string,\n\t\tVessel_Id as string,\n\t\tIB_VYG as string,\n\t\tOB_VYG as string,\n\t\tCarrier_Name as string,\n\t\tVessel_Class as string,\n\t\tPublished_ETA as string,\n\t\tPublished_ETD as string,\n\t\tStart_Work as string,\n\t\tEnd_Work as string,\n\t\tBegin_Receive_Date as string,\n\t\tCargo_Cutoff_Date as string,\n\t\tHazard_Cutoff_Date as string,\n\t\tReefer_Cutoff_Date as string,\n\t\tLabor_On_Board_Date as string,\n\t\tLabor_Off_Board_Date as string,\n\t\tOff_Port_Arrival_Date as string,\n\t\tOff_Port_Departure as string,\n\t\tPilot_On_Board_Date as string,\n\t\tPilot_Off_Board_Date as string,\n\t\tEst_BBK_Discharge as string,\n\t\tEst_BBK_Load as string,\n\t\tEst_Load as string,\n\t\tEst_Discharge as string,\n\t\tEst_Restow as string,\n\t\tEst_Shift as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tVessel_Classification as string,\n\t\tVessel_Class_Length_Overall_cm as integer,\n\t\tVessel_Class_Beam_cm as short,\n\t\tVessel_TEU_Capacity as string,\n\t\tLloyds_Code as string,\n\t\tTimeFirstAvailabilty as timestamp,\n\t\tStartWork as timestamp,\n\t\tTimeDischargeComplete as timestamp,\n\t\tEndWork as timestamp,\n\t\tWeek as integer,\n\t\tYear as integer,\n\t\tMonth as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gti',\n\tfolderPath: 'silver/vesselvisits') ~> source2\nSelect1 filter(equals(Carry_CHE_Kind,'ITV') && (equals(Event_Type_Id,'UNIT_LOAD') || equals(Event_Type_Id, 'UNIT_DISCH'))) ~> Filter1\nJoin1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key = source1@Carrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear = source1@Year,\n\t\tMonth = source1@Month,\n\t\tWeek = source1@Week,\n\t\tmve_gkey,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tUnladen = dist_start,\n\t\tLaden = dist_carry,\n\t\tCarrier_Name,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\naggregate1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nsource1, source2 join(source1@Carrier_Visit_Key == source2@Carrier_Visit_Key,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nFilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gti',\n\tfolderPath: 'gold/laden_unladen',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Laden_Unladen_SC')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Aggregate1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as integer,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nsource(output(\n\t\tComplex_Id as string,\n\t\tFacility_Id as string,\n\t\tCarrier_Visit_Id as string,\n\t\tPhase as string,\n\t\tVisit_Nbr as string,\n\t\tCarrier_Mode as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tETA as timestamp,\n\t\tETD as timestamp,\n\t\tOperator_Line_Id as string,\n\t\tOperator_Line_Role as string,\n\t\tOperator_Line_Name as string,\n\t\tTime_First_Availabilty as string,\n\t\tTime_Discharge_Complete as string,\n\t\tService_Id as string,\n\t\tService_Name as string,\n\t\tVessel_Id as string,\n\t\tIB_VYG as string,\n\t\tOB_VYG as string,\n\t\tCarrier_Name as string,\n\t\tVessel_Class as string,\n\t\tPublished_ETA as string,\n\t\tPublished_ETD as string,\n\t\tStart_Work as string,\n\t\tEnd_Work as string,\n\t\tBegin_Receive_Date as string,\n\t\tCargo_Cutoff_Date as string,\n\t\tHazard_Cutoff_Date as string,\n\t\tReefer_Cutoff_Date as string,\n\t\tLabor_On_Board_Date as string,\n\t\tLabor_Off_Board_Date as string,\n\t\tOff_Port_Arrival_Date as string,\n\t\tOff_Port_Departure as string,\n\t\tPilot_On_Board_Date as string,\n\t\tPilot_Off_Board_Date as string,\n\t\tEst_BBK_Discharge as string,\n\t\tEst_BBK_Load as string,\n\t\tEst_Load as string,\n\t\tEst_Discharge as string,\n\t\tEst_Restow as string,\n\t\tEst_Shift as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tVessel_Classification as string,\n\t\tVessel_Class_Length_Overall_cm as integer,\n\t\tVessel_Class_Beam_cm as short,\n\t\tVessel_TEU_Capacity as string,\n\t\tLloyds_Code as string,\n\t\tTimeFirstAvailabilty as timestamp,\n\t\tStartWork as timestamp,\n\t\tTimeDischargeComplete as timestamp,\n\t\tEndWork as timestamp,\n\t\tWeek as integer,\n\t\tYear as integer,\n\t\tMonth as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'silver/vessel_visits') ~> source2\nSelect1 filter(equals(Carry_CHE_Kind,'SC') && (equals(Event_Type_Id,'UNIT_LOAD') || equals(Event_Type_Id, 'UNIT_DISCH'))) ~> Filter1\nJoin1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key = source1@Carrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear = source1@Year,\n\t\tMonth = source1@Month,\n\t\tWeek = source1@Week,\n\t\tmve_gkey,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tUnladen = dist_start,\n\t\tLaden = dist_carry,\n\t\tCarrier_Name\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nAggregate1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nsource1, source2 join(source1@Carrier_Visit_Key == source2@Carrier_Visit_Key,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nFilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'gold/laden_unladen',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['mve_gkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Laden_Unladen_aarhus')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as integer,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'apmtaarhus',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nsource(output(\n\t\tComplex_Id as string,\n\t\tFacility_Id as string,\n\t\tCarrier_Visit_Id as string,\n\t\tPhase as string,\n\t\tVisit_Nbr as string,\n\t\tCarrier_Mode as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tETA as timestamp,\n\t\tETD as timestamp,\n\t\tOperator_Line_Id as string,\n\t\tOperator_Line_Role as string,\n\t\tOperator_Line_Name as string,\n\t\tTime_First_Availabilty as string,\n\t\tTime_Discharge_Complete as string,\n\t\tService_Id as string,\n\t\tService_Name as string,\n\t\tVessel_Id as string,\n\t\tIB_VYG as string,\n\t\tOB_VYG as string,\n\t\tCarrier_Name as string,\n\t\tVessel_Class as string,\n\t\tPublished_ETA as string,\n\t\tPublished_ETD as string,\n\t\tStart_Work as string,\n\t\tEnd_Work as string,\n\t\tBegin_Receive_Date as string,\n\t\tCargo_Cutoff_Date as string,\n\t\tHazard_Cutoff_Date as string,\n\t\tReefer_Cutoff_Date as string,\n\t\tLabor_On_Board_Date as string,\n\t\tLabor_Off_Board_Date as string,\n\t\tOff_Port_Arrival_Date as string,\n\t\tOff_Port_Departure as string,\n\t\tPilot_On_Board_Date as string,\n\t\tPilot_Off_Board_Date as string,\n\t\tEst_BBK_Discharge as string,\n\t\tEst_BBK_Load as string,\n\t\tEst_Load as string,\n\t\tEst_Discharge as string,\n\t\tEst_Restow as string,\n\t\tEst_Shift as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tVessel_Classification as string,\n\t\tVessel_Class_Length_Overall_cm as integer,\n\t\tVessel_Class_Beam_cm as short,\n\t\tVessel_TEU_Capacity as string,\n\t\tLloyds_Code as string,\n\t\tTimeFirstAvailabilty as timestamp,\n\t\tStartWork as timestamp,\n\t\tTimeDischargeComplete as timestamp,\n\t\tEndWork as timestamp,\n\t\tWeek as integer,\n\t\tYear as integer,\n\t\tMonth as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'apmtaarhus',\n\tfolderPath: 'silver/vesselvisits') ~> source2\nSelect1 filter(equals(Carry_CHE_Kind,'ITV') && (equals(Event_Type_Id,'UNIT_LOAD') || equals(Event_Type_Id, 'UNIT_DISCH'))) ~> Filter1\nJoin1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key = source1@Carrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear = source1@Year,\n\t\tMonth = source1@Month,\n\t\tWeek = source1@Week,\n\t\tmve_gkey,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tUnladen = dist_start,\n\t\tLaden = dist_carry,\n\t\tCarrier_Name,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\naggregate1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nsource1, source2 join(source1@Carrier_Visit_Key == source2@Carrier_Visit_Key,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nFilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'apmtaarhus',\n\tfolderPath: 'gold/laden_unladen',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Laden_Unladen_fromMoves_gpa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as integer,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nsource(output(\n\t\tComplex_Id as string,\n\t\tFacility_Id as string,\n\t\tCarrier_Visit_Id as string,\n\t\tPhase as string,\n\t\tVisit_Nbr as string,\n\t\tCarrier_Mode as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tETA as timestamp,\n\t\tETD as timestamp,\n\t\tOperator_Line_Id as string,\n\t\tOperator_Line_Role as string,\n\t\tOperator_Line_Name as string,\n\t\tTime_First_Availabilty as string,\n\t\tTime_Discharge_Complete as string,\n\t\tService_Id as string,\n\t\tService_Name as string,\n\t\tVessel_Id as string,\n\t\tIB_VYG as string,\n\t\tOB_VYG as string,\n\t\tCarrier_Name as string,\n\t\tVessel_Class as string,\n\t\tPublished_ETA as string,\n\t\tPublished_ETD as string,\n\t\tStart_Work as string,\n\t\tEnd_Work as string,\n\t\tBegin_Receive_Date as string,\n\t\tCargo_Cutoff_Date as string,\n\t\tHazard_Cutoff_Date as string,\n\t\tReefer_Cutoff_Date as string,\n\t\tLabor_On_Board_Date as string,\n\t\tLabor_Off_Board_Date as string,\n\t\tOff_Port_Arrival_Date as string,\n\t\tOff_Port_Departure as string,\n\t\tPilot_On_Board_Date as string,\n\t\tPilot_Off_Board_Date as string,\n\t\tEst_BBK_Discharge as string,\n\t\tEst_BBK_Load as string,\n\t\tEst_Load as string,\n\t\tEst_Discharge as string,\n\t\tEst_Restow as string,\n\t\tEst_Shift as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tVessel_Classification as string,\n\t\tVessel_Class_Length_Overall_cm as integer,\n\t\tVessel_Class_Beam_cm as short,\n\t\tVessel_TEU_Capacity as string,\n\t\tLloyds_Code as string,\n\t\tTimeFirstAvailabilty as timestamp,\n\t\tStartWork as timestamp,\n\t\tTimeDischargeComplete as timestamp,\n\t\tEndWork as timestamp,\n\t\tWeek as integer,\n\t\tYear as integer,\n\t\tMonth as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/vesselvisits') ~> source2\nSelect1 filter(equals(Carry_CHE_Kind,'ITV') && (equals(Event_Type_Id,'UNIT_LOAD') || equals(Event_Type_Id, 'UNIT_DISCH'))) ~> Filter1\nJoin1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key = source1@Carrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear = source1@Year,\n\t\tMonth = source1@Month,\n\t\tWeek = source1@Week,\n\t\tmve_gkey,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tUnladen = dist_start,\n\t\tLaden = dist_carry,\n\t\tCarrier_Name,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\naggregate1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nsource1, source2 join(source1@Carrier_Visit_Key == source2@Carrier_Visit_Key,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nFilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'gold/laden_unladen',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Laden_Unladen_haifa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as integer,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'haifa',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nsource(output(\n\t\tComplex_Id as string,\n\t\tFacility_Id as string,\n\t\tCarrier_Visit_Id as string,\n\t\tPhase as string,\n\t\tVisit_Nbr as string,\n\t\tCarrier_Mode as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tETA as timestamp,\n\t\tETD as timestamp,\n\t\tOperator_Line_Id as string,\n\t\tOperator_Line_Role as string,\n\t\tOperator_Line_Name as string,\n\t\tTime_First_Availabilty as string,\n\t\tTime_Discharge_Complete as string,\n\t\tService_Id as string,\n\t\tService_Name as string,\n\t\tVessel_Id as string,\n\t\tIB_VYG as string,\n\t\tOB_VYG as string,\n\t\tCarrier_Name as string,\n\t\tVessel_Class as string,\n\t\tPublished_ETA as string,\n\t\tPublished_ETD as string,\n\t\tStart_Work as string,\n\t\tEnd_Work as string,\n\t\tBegin_Receive_Date as string,\n\t\tCargo_Cutoff_Date as string,\n\t\tHazard_Cutoff_Date as string,\n\t\tReefer_Cutoff_Date as string,\n\t\tLabor_On_Board_Date as string,\n\t\tLabor_Off_Board_Date as string,\n\t\tOff_Port_Arrival_Date as string,\n\t\tOff_Port_Departure as string,\n\t\tPilot_On_Board_Date as string,\n\t\tPilot_Off_Board_Date as string,\n\t\tEst_BBK_Discharge as string,\n\t\tEst_BBK_Load as string,\n\t\tEst_Load as string,\n\t\tEst_Discharge as string,\n\t\tEst_Restow as string,\n\t\tEst_Shift as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tVessel_Classification as string,\n\t\tVessel_Class_Length_Overall_cm as integer,\n\t\tVessel_Class_Beam_cm as short,\n\t\tVessel_TEU_Capacity as string,\n\t\tLloyds_Code as string,\n\t\tTimeFirstAvailabilty as timestamp,\n\t\tStartWork as timestamp,\n\t\tTimeDischargeComplete as timestamp,\n\t\tEndWork as timestamp,\n\t\tWeek as integer,\n\t\tYear as integer,\n\t\tMonth as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'haifa',\n\tfolderPath: 'silver/vesselvisits') ~> source2\nSelect1 filter(equals(Carry_CHE_Kind,'ITV') && (equals(Event_Type_Id,'UNIT_LOAD') || equals(Event_Type_Id, 'UNIT_DISCH'))) ~> Filter1\nJoin1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key = source1@Carrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear = source1@Year,\n\t\tMonth = source1@Month,\n\t\tWeek = source1@Week,\n\t\tmve_gkey,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tUnladen = dist_start,\n\t\tLaden = dist_carry,\n\t\tCarrier_Name,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\naggregate1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nsource1, source2 join(source1@Carrier_Visit_Key == source2@Carrier_Visit_Key,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nFilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'haifa',\n\tfolderPath: 'gold/laden_unladen',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Laden_Unladen_kssp')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "carry and start distance respectively on  ITV moves",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as integer,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'kssp',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 filter(equals(Carry_CHE_Kind,'ITV') && (equals(Event_Type_Id,'UNIT_LOAD') || equals(Event_Type_Id, 'UNIT_DISCH'))) ~> Filter1\nsource1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\naggregate1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nFilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'kssp',\n\tfolderPath: 'gold/laden_unladen',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Laden_Unladen_mict')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "carry and start distance respectively on  ITV moves",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as integer,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nsource(output(\n\t\tComplex_Id as string,\n\t\tFacility_Id as string,\n\t\tCarrier_Visit_Id as string,\n\t\tPhase as string,\n\t\tVisit_Nbr as string,\n\t\tCarrier_Mode as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tETA as timestamp,\n\t\tETD as timestamp,\n\t\tOperator_Line_Id as string,\n\t\tOperator_Line_Role as string,\n\t\tOperator_Line_Name as string,\n\t\tTime_First_Availabilty as string,\n\t\tTime_Discharge_Complete as string,\n\t\tService_Id as string,\n\t\tService_Name as string,\n\t\tVessel_Id as string,\n\t\tIB_VYG as string,\n\t\tOB_VYG as string,\n\t\tCarrier_Name as string,\n\t\tVessel_Class as string,\n\t\tPublished_ETA as string,\n\t\tPublished_ETD as string,\n\t\tStart_Work as string,\n\t\tEnd_Work as string,\n\t\tBegin_Receive_Date as string,\n\t\tCargo_Cutoff_Date as string,\n\t\tHazard_Cutoff_Date as string,\n\t\tReefer_Cutoff_Date as string,\n\t\tLabor_On_Board_Date as string,\n\t\tLabor_Off_Board_Date as string,\n\t\tOff_Port_Arrival_Date as string,\n\t\tOff_Port_Departure as string,\n\t\tPilot_On_Board_Date as string,\n\t\tPilot_Off_Board_Date as string,\n\t\tEst_BBK_Discharge as string,\n\t\tEst_BBK_Load as string,\n\t\tEst_Load as string,\n\t\tEst_Discharge as string,\n\t\tEst_Restow as string,\n\t\tEst_Shift as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tVessel_Classification as string,\n\t\tVessel_Class_Length_Overall_cm as integer,\n\t\tVessel_Class_Beam_cm as short,\n\t\tVessel_TEU_Capacity as string,\n\t\tLloyds_Code as string,\n\t\tTimeFirstAvailabilty as timestamp,\n\t\tStartWork as timestamp,\n\t\tTimeDischargeComplete as timestamp,\n\t\tEndWork as timestamp,\n\t\tWeek as integer,\n\t\tYear as integer,\n\t\tMonth as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'silver/vesselvisits') ~> source2\nSelect1 filter(equals(Carry_CHE_Kind,'ITV') && (equals(Event_Type_Id,'UNIT_LOAD') || equals(Event_Type_Id, 'UNIT_DISCH'))) ~> Filter1\nJoin1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key = source1@Carrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear = source1@Year,\n\t\tMonth = source1@Month,\n\t\tWeek = source1@Week,\n\t\tmve_gkey,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tUnladen = dist_start,\n\t\tLaden = dist_carry,\n\t\tCarrier_Name,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\naggregate1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nsource1, source2 join(source1@Carrier_Visit_Key == source2@Carrier_Visit_Key,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nFilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'gold/laden_unladen',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Laden_Unladen_pdports')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as integer,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'pdports',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nsource(output(\n\t\tComplex_Id as string,\n\t\tFacility_Id as string,\n\t\tCarrier_Visit_Id as string,\n\t\tPhase as string,\n\t\tVisit_Nbr as string,\n\t\tCarrier_Mode as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tETA as timestamp,\n\t\tETD as timestamp,\n\t\tOperator_Line_Id as string,\n\t\tOperator_Line_Role as string,\n\t\tOperator_Line_Name as string,\n\t\tTime_First_Availabilty as string,\n\t\tTime_Discharge_Complete as string,\n\t\tService_Id as string,\n\t\tService_Name as string,\n\t\tVessel_Id as string,\n\t\tIB_VYG as string,\n\t\tOB_VYG as string,\n\t\tCarrier_Name as string,\n\t\tVessel_Class as string,\n\t\tPublished_ETA as string,\n\t\tPublished_ETD as string,\n\t\tStart_Work as string,\n\t\tEnd_Work as string,\n\t\tBegin_Receive_Date as string,\n\t\tCargo_Cutoff_Date as string,\n\t\tHazard_Cutoff_Date as string,\n\t\tReefer_Cutoff_Date as string,\n\t\tLabor_On_Board_Date as string,\n\t\tLabor_Off_Board_Date as string,\n\t\tOff_Port_Arrival_Date as string,\n\t\tOff_Port_Departure as string,\n\t\tPilot_On_Board_Date as string,\n\t\tPilot_Off_Board_Date as string,\n\t\tEst_BBK_Discharge as string,\n\t\tEst_BBK_Load as string,\n\t\tEst_Load as string,\n\t\tEst_Discharge as string,\n\t\tEst_Restow as string,\n\t\tEst_Shift as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tVessel_Classification as string,\n\t\tVessel_Class_Length_Overall_cm as integer,\n\t\tVessel_Class_Beam_cm as short,\n\t\tVessel_TEU_Capacity as string,\n\t\tLloyds_Code as string,\n\t\tTimeFirstAvailabilty as timestamp,\n\t\tStartWork as timestamp,\n\t\tTimeDischargeComplete as timestamp,\n\t\tEndWork as timestamp,\n\t\tWeek as integer,\n\t\tYear as integer,\n\t\tMonth as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'pdports',\n\tfolderPath: 'silver/vesselvisits') ~> source2\nSelect1 filter(equals(Carry_CHE_Kind,'ITV') && (equals(Event_Type_Id,'UNIT_LOAD') || equals(Event_Type_Id, 'UNIT_DISCH'))) ~> Filter1\nJoin1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key = source1@Carrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear = source1@Year,\n\t\tMonth = source1@Month,\n\t\tWeek = source1@Week,\n\t\tmve_gkey,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tUnladen = dist_start,\n\t\tLaden = dist_carry,\n\t\tCarrier_Name,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\naggregate1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nsource1, source2 join(source1@Carrier_Visit_Key == source2@Carrier_Visit_Key,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nFilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'pdports',\n\tfolderPath: 'gold/laden_unladen',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Laden_Unladen_tdt')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as integer,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'tdt',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nsource(output(\n\t\tComplex_Id as string,\n\t\tFacility_Id as string,\n\t\tCarrier_Visit_Id as string,\n\t\tPhase as string,\n\t\tVisit_Nbr as string,\n\t\tCarrier_Mode as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tETA as timestamp,\n\t\tETD as timestamp,\n\t\tOperator_Line_Id as string,\n\t\tOperator_Line_Role as string,\n\t\tOperator_Line_Name as string,\n\t\tTime_First_Availabilty as string,\n\t\tTime_Discharge_Complete as string,\n\t\tService_Id as string,\n\t\tService_Name as string,\n\t\tVessel_Id as string,\n\t\tIB_VYG as string,\n\t\tOB_VYG as string,\n\t\tCarrier_Name as string,\n\t\tVessel_Class as string,\n\t\tPublished_ETA as string,\n\t\tPublished_ETD as string,\n\t\tStart_Work as string,\n\t\tEnd_Work as string,\n\t\tBegin_Receive_Date as string,\n\t\tCargo_Cutoff_Date as string,\n\t\tHazard_Cutoff_Date as string,\n\t\tReefer_Cutoff_Date as string,\n\t\tLabor_On_Board_Date as string,\n\t\tLabor_Off_Board_Date as string,\n\t\tOff_Port_Arrival_Date as string,\n\t\tOff_Port_Departure as string,\n\t\tPilot_On_Board_Date as string,\n\t\tPilot_Off_Board_Date as string,\n\t\tEst_BBK_Discharge as string,\n\t\tEst_BBK_Load as string,\n\t\tEst_Load as string,\n\t\tEst_Discharge as string,\n\t\tEst_Restow as string,\n\t\tEst_Shift as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tVessel_Classification as string,\n\t\tVessel_Class_Length_Overall_cm as integer,\n\t\tVessel_Class_Beam_cm as short,\n\t\tVessel_TEU_Capacity as string,\n\t\tLloyds_Code as string,\n\t\tTimeFirstAvailabilty as timestamp,\n\t\tStartWork as timestamp,\n\t\tTimeDischargeComplete as timestamp,\n\t\tEndWork as timestamp,\n\t\tWeek as integer,\n\t\tYear as integer,\n\t\tMonth as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'tdt',\n\tfolderPath: 'silver/vesselvisits') ~> source2\nSelect1 filter(equals(Carry_CHE_Kind,'ITV') && (equals(Event_Type_Id,'UNIT_LOAD') || equals(Event_Type_Id, 'UNIT_DISCH'))) ~> Filter1\nJoin1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key = source1@Carrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear = source1@Year,\n\t\tMonth = source1@Month,\n\t\tWeek = source1@Week,\n\t\tmve_gkey,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tUnladen = dist_start,\n\t\tLaden = dist_carry,\n\t\tCarrier_Name,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\naggregate1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nsource1, source2 join(source1@Carrier_Visit_Key == source2@Carrier_Visit_Key,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nFilter1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'tdt',\n\tfolderPath: 'gold/laden_unladen',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "select2"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as string,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as string,\n\t\tdist_start as string,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as short,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as string,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATD as string,\n\t\tRehandles as string,\n\t\t{_c55} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'arica',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nSelect1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nselect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nCSV select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATD,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'arica',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_CMATK')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as string,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as string,\n\t\tdist_start as string,\n\t\t{Twin Fetch} as string,\n\t\t{Twin Carry} as string,\n\t\t{Twin Put} as string,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as string,\n\t\tufv_gkey as string,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as string,\n\t\tactive_ufv as string,\n\t\t{Requires Power Flag} as string,\n\t\t{OOG Flag} as string,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: true,\n\tmoveFiles: ['bronze/moves/load','bronze/movehistory/load'],\n\tformat: 'delimited',\n\tfileSystem: 'cmatk',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'MM/dd/yyyy HH:mm'),toTimestamp(t_carry_complete,'MM-dd-yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), \r\ntoTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'MM/dd/yyyy HH:mm'),toTimestamp(t_put,'MM-dd-yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'),  toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_fetch,'MM/dd/yyyy HH:mm'),toTimestamp(t_fetch,'MM-dd-yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'),  toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'MM/dd/yyyy HH:mm'),toTimestamp(t_discharge,'MM-dd-yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'),  toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'MM/dd/yyyy HH:mm'),toTimestamp(t_put,'MM-dd-yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'),  toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'MM/dd/yyyy HH:mm'),toTimestamp(t_put,'MM-dd-yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'),  toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'MM/dd/yyyy HH:mm'),toTimestamp(t_put,'MM-dd-yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'),  toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm'),toTimestamp(t_dispatch,'MM-dd-yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'),  toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm'),toTimestamp(t_carry_dispatch,'MM-dd-yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'),  toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm'),toTimestamp(t_carry_fetch_ready,'MM-dd-yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'),  toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm'),toTimestamp(t_carry_put_ready,'MM-dd-yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'),  toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'MM/dd/yyyy HH:mm'),toTimestamp(ATD,'MM-dd-yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'),  toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'MM/dd/yyyy HH:mm'),toTimestamp(ATA,'MM-dd-yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'),  toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATD,\n\t\tRehandles,\n\t\tATA\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'cmatk',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_CTB')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{   } as short,\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as short,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as short,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as short,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as short,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as string,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as string,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as long,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATD as string,\n\t\tRehandles as short\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ';',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nsource(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as boolean,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as short,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delimited',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'bronze/vessel_visits/load',\n\tcolumnDelimiter: ';',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source2\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'dd.MM.yy HH:mm:ss'),toTimestamp(concatWS(' ',substringIndex(t_carry_complete,'.',3),right(t_carry_complete, 2)),'dd-MMM-yy hh.mm.ss a'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(concatWS(' ',substringIndex(t_put,'.',3),right(t_put, 2)),'dd-MMM-yy hh.mm.ss a'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(concatWS(' ',substringIndex(t_fetch,'.',3),right(t_fetch, 2)),'dd-MMM-yy hh.mm.ss a'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(concatWS(' ',substringIndex(t_discharge,'.',3),right(t_discharge, 2)),'dd-MMM-yy hh.mm.ss a'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(concatWS(' ',substringIndex(t_put,'.',3),right(t_put, 2)),'dd-MMM-yy hh.mm.ss a'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(concatWS(' ',substringIndex(t_put,'.',3),right(t_put, 2)),'dd-MMM-yy hh.mm.ss a'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(concatWS(' ',substringIndex(t_put,'.',3),right(t_put, 2)),'dd-MMM-yy hh.mm.ss a'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(concatWS(' ',substringIndex(t_dispatch,'.',3),right(t_dispatch, 2)),'dd-MMM-yy hh.mm.ss a'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(concatWS(' ',substringIndex(t_carry_dispatch,'.',3),right(t_carry_dispatch, 2)),'dd-MMM-yy hh.mm.ss a'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(concatWS(' ',substringIndex(t_carry_fetch_ready,'.',3),right(t_carry_fetch_ready, 2)),'dd-MMM-yy hh.mm.ss a'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(concatWS(' ',substringIndex(t_carry_put_ready,'.',3),right(t_carry_put_ready, 2)),'dd-MMM-yy hh.mm.ss a'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(concatWS(' ',substringIndex(ATD,'.',3),right(ATD, 2)),'dd-MMM-yy hh.mm.ss a'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(concatWS(' ',substringIndex(ATA,'.',3),right(ATA, 2)),'dd-MMM-yy hh.mm.ss a'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss')),\n\t\tmve_gkey = toLong(mve_gkey)) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV, source2 join(CSV@{Carrier Visit Key} == source2@{Carrier Visit Key},\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id} = CSV@{Facility Id},\n\t\t{Complex Id} = CSV@{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key} = CSV@{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATA,\n\t\tATD = CSV@ATD,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_CWIT')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as short,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as short,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as short,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as short,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as boolean,\n\t\tTwin_Carry as boolean,\n\t\tTwin_Put as boolean,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as short,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as boolean,\n\t\tOOG_Flag as boolean,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as short\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'cwit',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(concat(substring(t_carry_complete, 1, 22), ' ', substring(t_carry_complete, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(concat(substring(t_put, 1, 22), ' ', substring(t_put, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(concat(substring(t_fetch, 1, 22), ' ', substring(t_fetch, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(concat(substring(t_discharge, 1, 22), ' ', substring(t_discharge, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(concat(substring(t_put, 1, 22), ' ', substring(t_put, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(concat(substring(t_put, 1, 22), ' ', substring(t_put, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(concat(substring(t_put, 1, 22), ' ', substring(t_put, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(concat(substring(t_dispatch, 1, 22), ' ', substring(t_dispatch, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(concat(substring(t_carry_dispatch, 1, 22), ' ', substring(t_carry_dispatch, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(concat(substring(t_carry_fetch_ready, 1, 22), ' ', substring(t_carry_fetch_ready, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(concat(substring(t_carry_put_ready, 1, 22), ' ', substring(t_carry_put_ready, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(concat(substring(ATD, 1, 22), ' ', substring(ATD, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(concat(substring(ATA, 1, 22), ' ', substring(ATA, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'cwit',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_Ennore')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as string,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as string,\n\t\tdist_start as integer,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as double,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as short\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'ennore',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm'),toTimestamp(t_carry_complete,'dd/MM/yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'dd-MM-yyyy HH:mm'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'dd-MM-yyyy HH:mm'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'dd-MM-yyyy HH:mm'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'dd-MM-yyyy HH:mm'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'dd-MM-yyyy HH:mm'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'dd-MM-yyyy HH:mm'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'dd-MM-yyyy HH:mm'), toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'dd-MM-yyyy HH:mm'), toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATA,\n\t\tATD,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'ennore',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: false,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]",
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_GTI')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('gti')\n}\nsource(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as short,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as short,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as short,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as short,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as short,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\t{Twin Fetch} as string,\n\t\t{Twin Carry} as string,\n\t\t{Twin Put} as string,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as double,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as string,\n\t\t{OOG Flag} as string,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATD as string,\n\t\tRehandles as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'gti',\n\tfolderPath: 'bronze/moves',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nsource(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as boolean,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as short,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delimited',\n\tfileSystem: 'gti',\n\tfolderPath: 'bronze/vessel_visits',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source2\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV, source2 join(CSV@{Carrier Visit Key} == source2@{Carrier Visit Key},\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id} = CSV@{Facility Id},\n\t\t{Complex Id} = CSV@{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key} = CSV@{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATA,\n\t\tATD = CSV@ATD,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gti',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_MCT')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink2"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as short,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as short,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as short,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as short,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as integer,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as short\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'mct',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm')),\n\t\tt_put = coalesce(toTimestamp(t_put,'dd/MM/yyyy HH:mm'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'dd/MM/yyyy HH:mm'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'dd/MM/yyyy HH:mm'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'dd/MM/yyyy HH:mm'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'dd/MM/yyyy HH:mm'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'dd/MM/yyyy HH:mm'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'dd/MM/yyyy HH:mm'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'dd/MM/yyyy HH:mm'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATD,\n\t\tRehandles,\n\t\tATA\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mct',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: false,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink2"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]",
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_Onne')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('gti')\n}\nsource(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as short,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as short,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as short,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as short,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as short,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\t{Twin Fetch} as string,\n\t\t{Twin Carry} as string,\n\t\t{Twin Put} as string,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as double,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as string,\n\t\t{OOG Flag} as string,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATD as string,\n\t\tRehandles as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'onne',\n\tfolderPath: 'bronze/moves',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nsource(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as boolean,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as short,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delimited',\n\tfileSystem: 'onne',\n\tfolderPath: 'bronze/vesselvisits',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source2\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'yyyy-MM-dd HH24:mm:ss.SSS'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV, source2 join(CSV@{Carrier Visit Key} == source2@{Carrier Visit Key},\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id} = CSV@{Facility Id},\n\t\t{Complex Id} = CSV@{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key} = CSV@{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATA,\n\t\tATD = CSV@ATD,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'onne',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_SLPA')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as string,\n\t\tdist_start as string,\n\t\t{Twin Fetch} as string,\n\t\t{Twin Carry} as string,\n\t\t{Twin Put} as string,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as integer,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATD as string,\n\t\tRehandles as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'slpa',\n\tfolderPath: 'bronze/moves',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nsource(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as string,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as string,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delimited',\n\tfileSystem: 'slpa',\n\tfolderPath: 'bronze/vesselvisits',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source2\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV, source2 join(CSV@{Carrier Visit Key} == source2@{Carrier Visit Key},\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id} = CSV@{Facility Id},\n\t\t{Complex Id} = CSV@{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key} = CSV@{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATD = CSV@ATD,\n\t\tRehandles,\n\t\tATA\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'slpa',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_aarhus')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as string,\n\t\tdist_start as string,\n\t\t{Twin Fetch} as string,\n\t\t{Twin Carry} as string,\n\t\t{Twin Put} as string,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as integer,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATD as string,\n\t\tRehandles as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'apmtaarhus',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nsource(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as string,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as string,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delimited',\n\tfileSystem: 'apmtaarhus',\n\tfolderPath: 'bronze/vesselvisits/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source2\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV, source2 join(CSV@{Carrier Visit Key} == source2@{Carrier Visit Key},\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id} = CSV@{Facility Id},\n\t\t{Complex Id} = CSV@{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key} = CSV@{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATD = CSV@ATD,\n\t\tRehandles,\n\t\tATA\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'apmtaarhus',\n\tfolderPath: 'silver/moves',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_aqaba')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as string,\n\t\tdist_start as string,\n\t\t{Twin Fetch} as string,\n\t\t{Twin Carry} as string,\n\t\t{Twin Put} as string,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as integer,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATD as string,\n\t\tRehandles as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'apmtaqaba',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nsource(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as string,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as string,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delimited',\n\tfileSystem: 'apmtaqaba',\n\tfolderPath: 'bronze/vesselvisits/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source2\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV, source2 join(CSV@{Carrier Visit Key} == source2@{Carrier Visit Key},\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id} = CSV@{Facility Id},\n\t\t{Complex Id} = CSV@{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key} = CSV@{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATD = CSV@ATD,\n\t\tRehandles,\n\t\tATA\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'apmtaqaba',\n\tfolderPath: 'silver/moves',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_cgsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as string,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as string,\n\t\tdist_start as string,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as integer,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/movehistory/load'],\n\tformat: 'delimited',\n\tfileSystem: 'cgsa',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATD,\n\t\tRehandles,\n\t\tATA\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'cgsa',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_cmsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "CSV",
							"description": "Import data from linkedService2"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as string,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as string,\n\t\tdist_start as string,\n\t\t{Twin Fetch} as string,\n\t\t{Twin Carry} as string,\n\t\t{Twin Put} as string,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as string,\n\t\tufv_gkey as string,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as string,\n\t\tactive_ufv as string,\n\t\t{Requires Power Flag} as string,\n\t\t{OOG Flag} as string,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nsource(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as string,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Carrier Visit Key} as string,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as string,\n\t\t{Vessel Class Beam cm} as string,\n\t\t{Vessel TEU Capacity} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delimited',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'bronze/vesselvisits/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source2\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'yyyy/MM/dd HH:mm:ss.SSS'), toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce( toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV, source2 join(CSV@{Carrier Visit Key} == source2@{Carrier Visit Key},\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id} = CSV@{Facility Id},\n\t\t{Complex Id} = CSV@{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key} = CSV@{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\tATD = CSV@ATD,\n\t\tATA = source2@ATA,\n\t\t{Service Id}\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_dpw_lg')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as string,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as string,\n\t\tdist_start as string,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as short,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/movehistory/load'],\n\tformat: 'delimited',\n\tfileSystem: 'dpw-lg',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(concat(substring(t_carry_complete, 1, 21), ' ', substring(t_carry_complete, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'MM/dd/yyyy HH:mm'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm')),\n\t\tt_put = coalesce(toTimestamp(concat(substring(t_put, 1, 21), ' ', substring(t_put, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(concat(substring(t_fetch, 1, 21), ' ', substring(t_fetch, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(concat(substring(t_discharge, 1, 21), ' ', substring(t_discharge, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(concat(substring(t_put, 1, 21), ' ', substring(t_put, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(concat(substring(t_put, 1, 21), ' ', substring(t_put, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(concat(substring(t_put, 1, 21), ' ', substring(t_put, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(concat(substring(t_dispatch, 1, 21), ' ', substring(t_dispatch, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(concat(substring(t_carry_dispatch, 1, 21), ' ', substring(t_carry_dispatch, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(concat(substring(t_carry_fetch_ready, 1, 21), ' ', substring(t_carry_fetch_ready, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(concat(substring(t_carry_put_ready, 1, 21), ' ', substring(t_carry_put_ready, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(concat(substring(ATD, 1, 21), ' ', substring(ATD, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(concat(substring(ATA, 1, 21), ' ', substring(ATA, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATA,\n\t\tATD,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'dpw-lg',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_dpw_peru')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as long,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as short,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as short,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as short,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as short,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as long,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as integer,\n\t\tactive_ufv as long,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as boolean\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/movehistory/load'],\n\tformat: 'delimited',\n\tfileSystem: 'dpw-peru',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(concat(substring(t_carry_complete, 1, 21), ' ', substring(t_carry_complete, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(concat(substring(t_put, 1, 21), ' ', substring(t_put, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(concat(substring(t_fetch, 1, 21), ' ', substring(t_fetch, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(concat(substring(t_discharge, 1, 21), ' ', substring(t_discharge, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(concat(substring(t_put, 1, 21), ' ', substring(t_put, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(concat(substring(t_put, 1, 21), ' ', substring(t_put, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(concat(substring(t_put, 1, 21), ' ', substring(t_put, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(concat(substring(t_dispatch, 1, 21), ' ', substring(t_dispatch, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(concat(substring(t_carry_dispatch, 1, 21), ' ', substring(t_carry_dispatch, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(concat(substring(t_carry_fetch_ready, 1, 21), ' ', substring(t_carry_fetch_ready, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(concat(substring(t_carry_put_ready, 1, 21), ' ', substring(t_carry_put_ready, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(concat(substring(ATD, 1, 21), ' ', substring(ATD, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(concat(substring(ATA, 1, 21), ' ', substring(ATA, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATA,\n\t\tATD,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'dpw-peru',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_gpa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "derivedColumn1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as string,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as string,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as string,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as string,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as string,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as string,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as long,\n\t\tdist_start as long,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tRestow_Reason as string,\n\t\tPOW as string,\n\t\tufv_gkey as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'gpa',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(t_put),\n\t\tMonth = month(t_put),\n\t\tWeek = weekOfYear(t_put),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce( toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss')),\n\t\tmve_gkey = toLong(mve_gkey),\n\t\tCarrier_Visit_Key = toLong(Carrier_Visit_Key),\n\t\tRehandles = toLong(Rehandles)) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nderivedColumn1 select(mapColumn(\n\t\teach(match(/* All input columns */true()),\n\t\t\t/* Input name */$$ = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nCSV derive(Carrier_Visit_Key = toLong(Carrier_Visit_Key),\n\t\tmve_gkey = toLong(mve_gkey),\n\t\tRehandles = toLong(Rehandles),\n\t\tt_put = toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),\n\t\tt_fetch = toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss'),\n\t\tufv_gkey = toLong(ufv_gkey)) ~> derivedColumn1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: false,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tRestow_Reason,\n\t\tPOW,\n\t\tufv_gkey,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_gpa_old')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Moves joined to Vessel Visits",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "vesselVisits"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "derivedColumn1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as string,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as string,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as string,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as string,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as string,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as string,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as long,\n\t\tdist_start as long,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tRestow_Reason as string,\n\t\tPOW as string,\n\t\tufv_gkey as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'gpa',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nsource(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/vesselvisits') ~> vesselVisits\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(t_put),\n\t\tMonth = month(t_put),\n\t\tWeek = weekOfYear(t_put),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce( toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss')),\n\t\tmve_gkey = toLong(mve_gkey),\n\t\tCarrier_Visit_Key = toLong(Carrier_Visit_Key),\n\t\tRehandles = toLong(Rehandles)) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nderivedColumn1, vesselVisits join(Carrier_Visit_Key == Carrier_Visit_Key,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'right')~> Join1\nJoin1 select(mapColumn(\n\t\teach(match(/* All input columns */true()),\n\t\t\t/* Input name */$$ = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nCSV derive(Carrier_Visit_Key = toLong(Carrier_Visit_Key),\n\t\tmve_gkey = toLong(mve_gkey),\n\t\tRehandles = toLong(Rehandles),\n\t\tt_put = toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),\n\t\tt_fetch = toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss')) ~> derivedColumn1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: false,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tRestow_Reason,\n\t\tPOW,\n\t\tufv_gkey,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_haifa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as long,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as string,\n\t\tdist_start as string,\n\t\t{Twin Fetch} as string,\n\t\t{Twin Carry} as string,\n\t\t{Twin Put} as string,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as string,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as integer,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATD as string,\n\t\tRehandles as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'haifa',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nsource(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as string,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as long,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as string,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delimited',\n\tfileSystem: 'haifa',\n\tfolderPath: 'bronze/vesselvisits/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source2\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(t_carry_complete,'dd/MM/yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV, source2 join(CSV@{Carrier Visit Key} == source2@{Carrier Visit Key},\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id} = CSV@{Facility Id},\n\t\t{Complex Id} = CSV@{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key} = CSV@{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATD = CSV@ATD,\n\t\tRehandles,\n\t\tATA\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'haifa',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_hazira')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as string,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as short,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as boolean\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: true,\n\tmoveFiles: ['bronze/moves/load','bronze/movehistory/load'],\n\tformat: 'delimited',\n\tfileSystem: 'hazira',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\''],\n\tmode: 'read') ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(concat(substring(t_carry_complete, 1, 21), ' ', substring(t_carry_complete, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm')),\n\t\tt_put = coalesce(toTimestamp(concat(substring(t_put, 1, 21), ' ', substring(t_put, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm')),\n\t\tt_fetch = coalesce(toTimestamp(concat(substring(t_fetch, 1, 21), ' ', substring(t_fetch, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm')),\n\t\tt_discharge = coalesce(toTimestamp(concat(substring(t_discharge, 1, 21), ' ', substring(t_discharge, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(concat(substring(t_put, 1, 21), ' ', substring(t_put, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm'))),\n\t\tMonth = month(coalesce(toTimestamp(concat(substring(t_put, 1, 21), ' ', substring(t_put, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(concat(substring(t_put, 1, 21), ' ', substring(t_put, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm'))),\n\t\tt_dispatch = coalesce(toTimestamp(concat(substring(t_dispatch, 1, 21), ' ', substring(t_dispatch, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(concat(substring(t_carry_dispatch, 1, 21), ' ', substring(t_carry_dispatch, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(concat(substring(t_carry_fetch_ready, 1, 21), ' ', substring(t_carry_fetch_ready, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(concat(substring(t_carry_put_ready, 1, 21), ' ', substring(t_carry_put_ready, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm')),\n\t\tATD = coalesce(toTimestamp(concat(substring(ATD, 1, 21), ' ', substring(ATD, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm')),\n\t\tATA = coalesce(toTimestamp(concat(substring(ATA, 1, 21), ' ', substring(ATA, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATA,\n\t\tATD,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'hazira',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_kattupalli')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as string,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as string,\n\t\tdist_start as integer,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as double,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as short\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'kattupalli',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm'),toTimestamp(t_carry_complete,'dd/MM/yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'dd-MM-yyyy HH:mm'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'dd-MM-yyyy HH:mm'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'dd-MM-yyyy HH:mm'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'dd-MM-yyyy HH:mm'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'dd-MM-yyyy HH:mm'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'dd-MM-yyyy HH:mm'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'dd-MM-yyyy HH:mm'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'dd-MM-yyyy HH:mm'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATA,\n\t\tATD,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'kattupalli',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: false,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]",
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_kssp')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as string,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as short,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as string,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as string,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as boolean,\n\t\tTwin_Carry as boolean,\n\t\tTwin_Put as boolean,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tPOW as string,\n\t\tufv_gkey as integer,\n\t\tRequires_Power_Flag as boolean,\n\t\tOOG_Flag as boolean\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'kssp',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nsource(output(\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as string,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Carrier Visit Key} as integer\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delimited',\n\tfileSystem: 'kssp',\n\tfolderPath: 'bronze/vesselvisits/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source2\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss'),toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss'),toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV, source2 join(Carrier_Visit_Key == {Carrier Visit Key},\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tPOW,\n\t\tufv_gkey,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\t{Facility Id},\n\t\t{Carrier Visit Id},\n\t\tPhase,\n\t\t{Visit Nbr},\n\t\t{Carrier Mode},\n\t\tATA,\n\t\tATD,\n\t\t{Time First Availabilty},\n\t\t{Time Discharge Complete},\n\t\t{Service Id},\n\t\t{Service Name},\n\t\t{Vessel Id},\n\t\t{IB VYG},\n\t\t{OB VYG},\n\t\t{Carrier Name},\n\t\t{Vessel Class},\n\t\t{Published ETA},\n\t\t{Published ETD},\n\t\t{Start Work},\n\t\t{End Work},\n\t\t{Carrier Visit Key}\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'kssp',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tpow = POW,\n\t\tufv_gkey,\n\t\tATA,\n\t\tATD,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_malta')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink2"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as string,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as string,\n\t\tdist_start as string,\n\t\t{Twin Fetch} as string,\n\t\t{Twin Carry} as string,\n\t\t{Twin Put} as string,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as string,\n\t\tufv_gkey as string,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as string,\n\t\tactive_ufv as string,\n\t\t{Requires Power Flag} as string,\n\t\t{OOG Flag} as string,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'malta',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm')),\n\t\tt_put = coalesce(toTimestamp(t_put,'dd/MM/yyyy HH:mm'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'dd/MM/yyyy HH:mm'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'dd/MM/yyyy HH:mm'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'dd/MM/yyyy HH:mm'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'dd/MM/yyyy HH:mm'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'dd/MM/yyyy HH:mm'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'dd/MM/yyyy HH:mm'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'dd/MM/yyyy HH:mm'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATD,\n\t\tRehandles,\n\t\tATA\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'malta',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: false,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink2"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]",
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_mict')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as short,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as short,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as short,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as short,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tPow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as integer,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as short\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: true,\n\tmoveFiles: ['bronze/moves/load','bronze/movehistory/load'],\n\tformat: 'delimited',\n\tfileSystem: 'mict',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow = Pow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATD,\n\t\tRehandles,\n\t\tATA\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_mnhpi')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as short,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as short,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as short,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as short,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as integer,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/movehistory/load'],\n\tformat: 'delimited',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_complete,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss'), toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'dd/MM/yyyy HH:mm'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'dd/MM/yyyy HH:mm'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss'),toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'dd/MM/yyyy HH:mm'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:sS')),\n\t\tATA = coalesce(toTimestamp(ATA,'dd/MM/yyyy HH:mm'))) ~> DataTypeConversion\nCSV select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\teach(match(/* All input columns */true()),\n\t\t\t/* Input name */$$ = $$)\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_mundra_ct02')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as integer,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as short,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as short,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as short,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as double,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as short,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as short\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'mundra-ct02',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm'),toTimestamp(t_carry_complete,'dd/MM/yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'dd-MM-yyyy HH:mm'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'dd-MM-yyyy HH:mm'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'dd-MM-yyyy HH:mm'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'dd-MM-yyyy HH:mm'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'dd-MM-yyyy HH:mm'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'dd-MM-yyyy HH:mm'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'dd-MM-yyyy HH:mm'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'dd-MM-yyyy HH:mm'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATA,\n\t\tATD,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mundra-ct02',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: false,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]",
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_mundra_ct04')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as integer,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as short,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as short,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as short,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as double,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as short,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as short\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'mundra-ct04',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm'),toTimestamp(t_carry_complete,'dd/MM/yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'dd-MM-yyyy HH:mm'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'dd-MM-yyyy HH:mm'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'dd-MM-yyyy HH:mm'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'dd-MM-yyyy HH:mm'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'dd-MM-yyyy HH:mm'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'dd-MM-yyyy HH:mm'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'dd-MM-yyyy HH:mm'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'dd-MM-yyyy HH:mm'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATA,\n\t\tATD,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mundra-ct04',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: false,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]",
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_oldformat_cmsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "2022 files are missing some extracted fields",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "CSV",
							"description": "Import data from linkedService2"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as short,\n\t\tdist_start as string,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as double,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as short\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nsource(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as string,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as string,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delimited',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'bronze/vesselvisits',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source2\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_put,'yyyy/MM/dd HH:mm:ss.SSS'), toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce( toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss')),\n\t\tHazardous_Flag = false()) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV, source2 join(CSV@{Carrier Visit Key} == source2@{Carrier Visit Key},\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id} = CSV@{Facility Id},\n\t\t{Complex Id} = CSV@{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key} = CSV@{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\tATD = CSV@ATD,\n\t\tATA = source2@ATA,\n\t\t{Service Id}\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_pdports')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as string,\n\t\tdist_start as string,\n\t\t{Twin Fetch} as string,\n\t\t{Twin Carry} as string,\n\t\t{Twin Put} as string,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as integer,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATD as string,\n\t\tRehandles as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'pdports',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nsource(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as string,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as string,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delimited',\n\tfileSystem: 'pdports',\n\tfolderPath: 'bronze/vesselvisits/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source2\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV, source2 join(CSV@{Carrier Visit Key} == source2@{Carrier Visit Key},\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id} = CSV@{Facility Id},\n\t\t{Complex Id} = CSV@{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key} = CSV@{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATD = CSV@ATD,\n\t\tRehandles,\n\t\tATA\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'pdports',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_plipdeco')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as string,\n\t\tdist_start as string,\n\t\t{Twin Fetch} as string,\n\t\t{Twin Carry} as string,\n\t\t{Twin Put} as string,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as integer,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATD as string,\n\t\tRehandles as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'plipdeco',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nsource(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as string,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as string,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delimited',\n\tfileSystem: 'plipdeco',\n\tfolderPath: 'bronze/vesselvisits/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source2\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV, source2 join(CSV@{Carrier Visit Key} == source2@{Carrier Visit Key},\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id} = CSV@{Facility Id},\n\t\t{Complex Id} = CSV@{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key} = CSV@{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATD = CSV@ATD,\n\t\tRehandles,\n\t\tATA\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'plipdeco',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_rio')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as integer,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as short,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as short,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as short,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as double,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as short,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as short\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'rio',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATA,\n\t\tATD,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'rio',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: false,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]",
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_salalah')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "derivedColumn1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as short,\n\t\t{Fetch CHE Operator Id} as short,\n\t\t{Put CHE Operator Id} as short,\n\t\t{Fetch CHE Id} as long,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as long,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as long,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as long,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as timestamp 'M/dd/yyyy HH:mm',\n\t\tt_put as timestamp 'M/dd/yyyy HH:mm',\n\t\tt_fetch as timestamp 'M/dd/yyyy HH:mm',\n\t\tt_dispatch as timestamp 'M/dd/yyyy HH:mm',\n\t\tt_discharge as timestamp 'M/dd/yyyy HH:mm',\n\t\tt_carry_dispatch as timestamp 'M/dd/yyyy HH:mm',\n\t\tt_carry_fetch_ready as timestamp 'M/dd/yyyy HH:mm',\n\t\tt_carry_put_ready as timestamp 'M/dd/yyyy HH:mm',\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\t{Twin Fetch} as string,\n\t\t{Twin Carry} as string,\n\t\t{Twin Put} as string,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as integer,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATD as timestamp 'M/dd/yyyy HH:mm',\n\t\tRehandles as short\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'salalah',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nsource(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as boolean,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as short,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delimited',\n\tfileSystem: 'salalah',\n\tfolderPath: 'bronze/vesselvisits/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source2\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV, source2 join(CSV@{Carrier Visit Key} == source2@{Carrier Visit Key},\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id} = CSV@{Facility Id},\n\t\t{Complex Id} = CSV@{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key} = CSV@{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATA,\n\t\tATD = CSV@ATD,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nderivedColumn1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAggregate1 derive(Year = year(t_put),\n\t\tMonth = month(t_put),\n\t\tWeek = weekOfYear(t_put)) ~> derivedColumn1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tcompressionType: 'snappy',\n\tcompressionLevel: 'Optimal',\n\tfileSystem: 'salalah',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_seayard')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as short,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as short,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as short,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as short,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as short,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as string,\n\t\tdist_start as string,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as double,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'seayard',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATA,\n\t\tATD,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'seayard',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: false,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]",
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_sgtd')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as long,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as short,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as short,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as short,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as short,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as long,\n\t\tfm_pos_gkey as long,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as double,\n\t\tactive_ufv as long,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as short\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/movehistory/load'],\n\tformat: 'delimited',\n\tfileSystem: 'sgtd',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(dropRight(t_carry_complete, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(concat(substring(t_carry_complete, 1, 22), ' ', substring(t_carry_complete, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(dropRight(t_put, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(concat(substring(t_put, 1, 22), ' ', substring(t_put, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(dropRight(t_fetch, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(concat(substring(t_fetch, 1, 22), ' ', substring(t_fetch, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(dropRight(t_discharge, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(concat(substring(t_discharge, 1, 22), ' ', substring(t_discharge, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(dropRight(t_put, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(concat(substring(t_put, 1, 22), ' ', substring(t_put, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(dropRight(t_put, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(concat(substring(t_put, 1, 22), ' ', substring(t_put, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(dropRight(t_put, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(concat(substring(t_put, 1, 22), ' ', substring(t_put, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(dropRight(t_dispatch, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(concat(substring(t_dispatch, 1, 22), ' ', substring(t_dispatch, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(dropRight(t_carry_dispatch, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(concat(substring(t_carry_dispatch, 1, 22), ' ', substring(t_carry_dispatch, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(dropRight(t_carry_fetch_ready, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(concat(substring(t_carry_fetch_ready, 1, 22), ' ', substring(t_carry_fetch_ready, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(dropRight(t_carry_put_ready, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(concat(substring(t_carry_put_ready, 1, 22), ' ', substring(t_carry_put_ready, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(dropRight(ATD, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(concat(substring(ATD, 1, 22), ' ', substring(ATD, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(dropRight(ATA, 3) ,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(concat(substring(ATA, 1, 22), ' ', substring(ATA, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATA,\n\t\tATD,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'sgtd',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_socar')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink2"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as string,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as short,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as short\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'socar',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm')),\n\t\tt_put = coalesce(toTimestamp(t_put,'dd/MM/yyyy HH:mm'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'dd/MM/yyyy HH:mm'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'dd/MM/yyyy HH:mm'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'dd/MM/yyyy HH:mm'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'dd/MM/yyyy HH:mm'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'dd/MM/yyyy HH:mm'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'dd/MM/yyyy HH:mm'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'dd/MM/yyyy HH:mm'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATD,\n\t\tRehandles,\n\t\tATA\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'socar',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: false,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink2"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]",
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_tauranga')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as long,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as short,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as short,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as short,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as short,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as long,\n\t\tfm_pos_gkey as long,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as double,\n\t\tactive_ufv as long,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as short\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'tauranga',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(split(t_carry_complete,\".\")[1],'yyyy-MM-dd HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(split(t_fetch,\".\")[1],'yyyy-MM-dd HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(split(t_discharge,\".\")[1],'yyyy-MM-dd HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(split(t_dispatch,\".\")[1],'yyyy-MM-dd HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(split(t_carry_dispatch,\".\")[1],'yyyy-MM-dd HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(split(t_carry_fetch_ready,\".\")[1],'yyyy-MM-dd HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(split(t_carry_put_ready,\".\")[1],'yyyy-MM-dd HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(split(ATD,\".\")[1],'yyyy-MM-dd HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(split(ATA,\".\")[1],'yyyy-MM-dd HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATA,\n\t\tATD,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'tauranga',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]",
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_tauranga_new')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as long,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as short,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as short,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as short,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as short,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as long,\n\t\tfm_pos_gkey as long,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as double,\n\t\tactive_ufv as long,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as short\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'tauranga',\n\tfolderPath: 'bronze/moves/load/',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATA,\n\t\tATD,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'tauranga',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_tdt')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as string,\n\t\tdist_start as string,\n\t\t{Twin Fetch} as string,\n\t\t{Twin Carry} as string,\n\t\t{Twin Put} as string,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as integer,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATD as string,\n\t\tRehandles as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'tdt',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nsource(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as string,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as string,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delimited',\n\tfileSystem: 'tdt',\n\tfolderPath: 'bronze/vesselvisits',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source2\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss')),\n\t\tdist_start = toLong(dist_start),\n\t\tdist_carry = toLong(dist_carry)) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV, source2 join(CSV@{Carrier Visit Key} == source2@{Carrier Visit Key},\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id} = CSV@{Facility Id},\n\t\t{Complex Id} = CSV@{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key} = CSV@{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATD = CSV@ATD,\n\t\tRehandles,\n\t\tATA\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'tdt',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_teagtl')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "filter1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as string,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as short,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as short\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: true,\n\tmoveFiles: ['bronze/moves/load','bronze/movehistory/load'],\n\tformat: 'delimited',\n\tfileSystem: 'teagtl',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\''],\n\tmode: 'read') ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(split(t_carry_complete,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_carry_complete,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tt_put = coalesce(toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tt_fetch = coalesce(toTimestamp(split(t_fetch,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_fetch,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tt_discharge = coalesce(toTimestamp(split(t_discharge,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_discharge,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm'))),\n\t\tMonth = month(coalesce(toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm'))),\n\t\tt_dispatch = coalesce(toTimestamp(split(t_dispatch,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_dispatch,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(split(t_carry_dispatch,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_carry_dispatch,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(split(t_carry_fetch_ready,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_carry_fetch_ready,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(split(t_carry_put_ready,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_carry_put_ready,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tATD = coalesce(toTimestamp(split(ATD,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(ATD,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tATA = coalesce(toTimestamp(split(ATA,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(ATA,\".\")[1],'yyyy-MM-dd HH:mm'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATA,\n\t\tATD,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nfilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion filter(not(isNull(mve_gkey)) && not(isNull(t_put))) ~> filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'teagtl',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: false,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_tp_angamos')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as string,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as string,\n\t\tdist_start as string,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as string,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: true,\n\tmoveFiles: ['bronze/moves/load','bronze/movehistory/load'],\n\tformat: 'delimited',\n\tfileSystem: 'tp-angamos',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ';',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(concat(substring(t_carry_complete, 1, 21), ' ', substring(t_carry_complete, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(concat(substring(t_put, 1, 21), ' ', substring(t_put, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(concat(substring(t_fetch, 1, 21), ' ', substring(t_fetch, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(concat(substring(t_discharge, 1, 21), ' ', substring(t_discharge, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(concat(substring(t_put, 1, 21), ' ', substring(t_put, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(concat(substring(t_put, 1, 21), ' ', substring(t_put, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(concat(substring(t_put, 1, 21), ' ', substring(t_put, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(concat(substring(t_dispatch, 1, 21), ' ', substring(t_dispatch, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(concat(substring(t_carry_dispatch, 1, 21), ' ', substring(t_carry_dispatch, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(concat(substring(t_carry_fetch_ready, 1, 21), ' ', substring(t_carry_fetch_ready, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(concat(substring(t_carry_put_ready, 1, 21), ' ', substring(t_carry_put_ready, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(concat(substring(ATD, 1, 21), ' ', substring(ATD, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(concat(substring(ATA, 1, 21), ' ', substring(ATA, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATA,\n\t\tATD,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'tp-angamos',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_transnet')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "vslvisit"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as string,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as string,\n\t\tdist_start as string,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as string,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\t{Rehandles,} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'transnet',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ';',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nsource(output(\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as boolean,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Carrier Visit Key} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delimited',\n\tfileSystem: 'transnet',\n\tfolderPath: 'bronze/vesselvisits/load',\n\tcolumnDelimiter: ';',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> vslvisit\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_complete,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'), toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss'),toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss'),toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce( toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss'),toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV, vslvisit join(CSV@{Carrier Visit Key} == vslvisit@{Carrier Visit Key},\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id} = CSV@{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key} = CSV@{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATD = CSV@ATD,\n\t\tATA = vslvisit@ATA\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'transnet',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MoveSrc_vizingham')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as string,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as string,\n\t\tdist_start as string,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as integer,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'vizingham',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(concat(substring(t_carry_complete, 1, 22), ' ', substring(t_carry_complete, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(concat(substring(t_put, 1, 22), ' ', substring(t_put, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(concat(substring(t_fetch, 1, 22), ' ', substring(t_fetch, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(concat(substring(t_discharge, 1, 22), ' ', substring(t_discharge, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(concat(substring(t_put, 1, 22), ' ', substring(t_put, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tMonth = month(coalesce(toTimestamp(concat(substring(t_put, 1, 22), ' ', substring(t_put, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(concat(substring(t_put, 1, 22), ' ', substring(t_put, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd.MM.yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(concat(substring(t_dispatch, 1, 22), ' ', substring(t_dispatch, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(concat(substring(t_carry_dispatch, 1, 22), ' ', substring(t_carry_dispatch, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(concat(substring(t_carry_fetch_ready, 1, 22), ' ', substring(t_carry_fetch_ready, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(concat(substring(t_carry_put_ready, 1, 22), ' ', substring(t_carry_put_ready, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(concat(substring(ATD, 1, 22), ' ', substring(ATD, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATA = coalesce(toTimestamp(concat(substring(ATA, 1, 22), ' ', substring(ATA, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATA,\n\t\tATD,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'vizingham',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Moves_CMSA')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "filter1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\t{Twin Fetch} as string,\n\t\t{Twin Carry} as string,\n\t\t{Twin Put} as string,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as short,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as string,\n\t\t{OOG Flag} as string,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as short\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: true,\n\tmoveFiles: ['bronze/moves/load','bronze/movehistory/load'],\n\tformat: 'delimited',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\''],\n\tmode: 'read') ~> CSV\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(split(t_carry_complete,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_carry_complete,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tt_put = coalesce(toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tt_fetch = coalesce(toTimestamp(split(t_fetch,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_fetch,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tt_discharge = coalesce(toTimestamp(split(t_discharge,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_discharge,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tFetch_CHE_Id = toLong(Fetch_CHE_Id),\n\t\tQC_CHE_Id = toLong(QC_CHE_Id),\n\t\tPut_CHE_Id = toLong(Put_CHE_Id),\n\t\tCarry_CHE_Id = toLong(Carry_CHE_Id),\n\t\tYear = year(coalesce(toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm'))),\n\t\tMonth = month(coalesce(toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm'))),\n\t\tt_dispatch = coalesce(toTimestamp(split(t_dispatch,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_dispatch,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(split(t_carry_dispatch,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_carry_dispatch,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(split(t_carry_fetch_ready,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_carry_fetch_ready,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(split(t_carry_put_ready,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_carry_put_ready,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tATD = coalesce(toTimestamp(split(ATD,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(ATD,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tATA = coalesce(toTimestamp(split(ATA,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(ATA,\".\")[1],'yyyy-MM-dd HH:mm'))) ~> DataTypeConversion\nSelect2 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Facility Id},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{From Location},\n\t\t{To Location},\n\t\t{From Position Name},\n\t\t{To Position Name},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Twin Fetch},\n\t\t{Twin Carry},\n\t\t{Twin Put},\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\t{Restow Reason},\n\t\t{Container Line Id},\n\t\t{Container Line Role},\n\t\tpow,\n\t\tmve_gkey,\n\t\tufv_gkey,\n\t\t{Berth Id},\n\t\t{Goods And Ctr Wt Kg},\n\t\tactive_ufv,\n\t\t{Requires Power Flag},\n\t\t{OOG Flag},\n\t\t{Shipper Id},\n\t\t{Consignee Id},\n\t\t{Commodity Id},\n\t\tATA,\n\t\tATD,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nfilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion filter(not(isNull(mve_gkey)) && not(isNull(t_put))) ~> filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tATD as timestamp,\n\t\tATA as timestamp,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'silver/moves',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: false,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tpow,\n\t\tufv_gkey,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tATA,\n\t\tATD,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PTP_EcEvents')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "powerbianalyticsdata-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "powerbianalyticsdata-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as integer,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as short,\n\t\tTimeStamp as string,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as string,\n\t\tmoveKind as string,\n\t\tisTwin as string,\n\t\tstartDistance as string,\n\t\tworkAssignment as string,\n\t\tunitRef as string,\n\t\ttrain_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['PTP/bronze','PTP/bronze/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'ptpbianalyticsdata',\n\tfolderPath: 'PTP/bronze',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nCSV derive(TimeStamp = toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'),\n\t\tecEventGkey = toLong(ecEventGkey),\n\t\tCHE_ID = toLong(CHE_ID),\n\t\tYear = year(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS')),\n\t\tMonth = month(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS')),\n\t\tWeek = weekOfYear(toTimestamp(TimeStamp,'yyyy-MM-dd HH:mm:ss.SSS'))) ~> DataTypeConversion\nDataTypeConversion aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as string,\n\t\tmoveKind as string,\n\t\tisTwin as string,\n\t\tstartDistance as string,\n\t\tworkAssignment as string,\n\t\tunitRef as string,\n\t\ttrain_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'ptpbianalyticsdata',\n\tfolderPath: 'PTP/silver/EcEvents_v2',\n\tmergeSchema: false,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/powerbianalyticsdata-WorkspaceDefaultStorage')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ParquetToDelta')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "powerbianalyticsdata-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "powerbianalyticsdata-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as string,\n\t\tmoveKind as string,\n\t\tisTwin as string,\n\t\tstartDistance as string,\n\t\tworkAssignment as string,\n\t\tunitRef as string,\n\t\ttrain_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinferDriftedColumnTypes: true,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet',\n\tfileSystem: 'ptpbianalyticsdata',\n\tfolderPath: 'RawData/EcEvents/2021/202110',\n\tfileName: 'part-00000-tid-2874371059126942969-3ceea6c0-94b1-488f-82fe-a7a21d733ccb-14-1-c000.snappy.parquet') ~> source1\nsource1 derive(Year = year(TimeStamp),\n\t\tMonth = month(TimeStamp),\n\t\tWeek = weekOfYear(TimeStamp)) ~> DerivedColumn1\nDerivedColumn1 alterRow(updateIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'ptpbianalyticsdata',\n\tfolderPath: 'RawData/EcEvents/Delta',\n\tmergeSchema: false,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: true,\n\tupsertable: false,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/powerbianalyticsdata-WorkspaceDefaultStorage')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/QC_Idle_Time')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "powerbianalyticsdata-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "powerbianalyticsdata-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn2"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'arica',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nsource1 filter(equals(Event_Type_Id,'UNIT_DISCH') || equals(Event_Type_Id,'UNIT_LOAD')) ~> Filter1\nFilter1 derive(Move_Completion_Date_Time = iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),\n\t\tMove_Complete_Date = toDate(toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'yyyy-MM-dd'),'yyyy-MM-dd'),\n\t\tMove_Complete_Time = toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'HH:mm:ss'),\n\t\tVessel_Code = iif(Event_Type_Id=='UNIT_LOAD',left(substring(To_Position_Name,3),instr(substring(To_Position_Name,3), '-')),left(substring(From_Position_Name,3),instr(substring(From_Position_Name,3), '-')))) ~> DerivedColumn1\nDerivedColumn2 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDerivedColumn1 window(asc(pow, true),\n\tasc(Move_Completion_Date_Time, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tMove_Completion_Date_Time_PREV = lag(Move_Completion_Date_Time),\n\t\tPOW_PREV = lag(pow),\n\t\tVessel_PREV = iif(lag(Event_Type_Id)=='UNIT_LOAD',left(substring(lag(To_Position_Name),3),instr(substring(lag(To_Position_Name),3), '-')),left(substring(lag(From_Position_Name),3),instr(substring(lag(From_Position_Name),3), '-')))) ~> Window1\nWindow1 derive(Idle_Time_Min = iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0)),\n\t\tIdle_Time_Range = case(iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>0 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=2,\"0 to 02 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>2 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=5,\"02 to 05 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>5\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=10,\"05 to 10 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>10\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=15,\"10 to 15 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>15\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=20,\"15 to 20 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>20\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=25,\"20 to 25 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>25\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=30,\"25 to 30 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>30\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=60,\"30 to 60 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>60,\"60 & more\")) ~> DerivedColumn2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'arica',\n\tfolderPath: 'gold/qc_idle_time',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/powerbianalyticsdata-WorkspaceDefaultStorage')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/QC_Idle_Time_CTB')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn2"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 filter(equals(Event_Type_Id,'UNIT_DISCH') || equals(Event_Type_Id,'UNIT_LOAD')) ~> Filter1\nFilter1 derive(Move_Completion_Date_Time = iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),\n\t\tMove_Complete_Date = toDate(toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'yyyy-MM-dd'),'yyyy-MM-dd'),\n\t\tMove_Complete_Time = toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'HH:mm:ss'),\n\t\tVessel_Code = iif(Event_Type_Id=='UNIT_LOAD',left(substring(To_Position_Name,3),instr(substring(To_Position_Name,3), '-')),left(substring(From_Position_Name,3),instr(substring(From_Position_Name,3), '-')))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tmve_gkey,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn2 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDerivedColumn1 window(asc(pow, true),\n\tasc(Move_Completion_Date_Time, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tMove_Completion_Date_Time_PREV = lag(Move_Completion_Date_Time),\n\t\tPOW_PREV = lag(pow),\n\t\tVessel_PREV = iif(lag(Event_Type_Id)=='UNIT_LOAD',left(substring(lag(To_Position_Name),3),instr(substring(lag(To_Position_Name),3), '-')),left(substring(lag(From_Position_Name),3),instr(substring(lag(From_Position_Name),3), '-')))) ~> Window1\nWindow1 derive(Idle_Time_Min = iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0)),\n\t\tIdle_Time_Range = case(iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>0 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=2,\"0 to 02 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>2 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=5,\"02 to 05 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>5\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=10,\"05 to 10 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>10\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=15,\"10 to 15 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>15\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=20,\"15 to 20 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>20\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=25,\"20 to 25 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>25\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=30,\"25 to 30 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>30\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=60,\"30 to 60 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>60,\"60 & more\")) ~> DerivedColumn2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'gold/qc_idle_time',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/QC_Idle_Time_GTI')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn2"
						}
					],
					"script": "parameters{\n\tcustomer as string ('gti')\n}\nsource(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gti',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 filter(equals(Event_Type_Id,'UNIT_DISCH') || equals(Event_Type_Id,'UNIT_LOAD')) ~> Filter1\nFilter1 derive(Move_Completion_Date_Time = iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),\n\t\tMove_Complete_Date = toDate(toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'yyyy-MM-dd'),'yyyy-MM-dd'),\n\t\tMove_Complete_Time = toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'HH:mm:ss'),\n\t\tVessel_Code = iif(Event_Type_Id=='UNIT_LOAD',left(substring(To_Position_Name,3),instr(substring(To_Position_Name,3), '-')),left(substring(From_Position_Name,3),instr(substring(From_Position_Name,3), '-')))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tmve_gkey,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn2 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDerivedColumn1 window(asc(pow, true),\n\tasc(Move_Completion_Date_Time, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tMove_Completion_Date_Time_PREV = lag(Move_Completion_Date_Time),\n\t\tPOW_PREV = lag(pow),\n\t\tVessel_PREV = iif(lag(Event_Type_Id)=='UNIT_LOAD',left(substring(lag(To_Position_Name),3),instr(substring(lag(To_Position_Name),3), '-')),left(substring(lag(From_Position_Name),3),instr(substring(lag(From_Position_Name),3), '-')))) ~> Window1\nWindow1 derive(Idle_Time_Min = iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0)),\n\t\tIdle_Time_Range = case(iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>0 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=2,\"Upto 2 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>2 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=5,\"02 to 05 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>5\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=10,\"05 to 10 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>10\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=15,\"10 to 15 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>15\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=20,\"15 to 20 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>20\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=25,\"20 to 25 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>25\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=30,\"25 to 30 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>30\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=1000,\"> 30 min\")) ~> DerivedColumn2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gti',\n\tfolderPath: 'gold/qc_idle_time',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/QC_Idle_Time_Onne')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn2"
						}
					],
					"script": "parameters{\n\tcustomer as string ('gti')\n}\nsource(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'onne',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 filter(equals(Event_Type_Id,'UNIT_DISCH') || equals(Event_Type_Id,'UNIT_LOAD')) ~> Filter1\nFilter1 derive(Move_Completion_Date_Time = iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),\n\t\tMove_Complete_Date = toDate(toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'yyyy-MM-dd'),'yyyy-MM-dd'),\n\t\tMove_Complete_Time = toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'HH:mm:ss'),\n\t\tVessel_Code = iif(Event_Type_Id=='UNIT_LOAD',left(substring(To_Position_Name,3),instr(substring(To_Position_Name,3), '-')),left(substring(From_Position_Name,3),instr(substring(From_Position_Name,3), '-')))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tmve_gkey,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn2 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDerivedColumn1 window(asc(pow, true),\n\tasc(Move_Completion_Date_Time, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tMove_Completion_Date_Time_PREV = lag(Move_Completion_Date_Time),\n\t\tPOW_PREV = lag(pow),\n\t\tVessel_PREV = iif(lag(Event_Type_Id)=='UNIT_LOAD',left(substring(lag(To_Position_Name),3),instr(substring(lag(To_Position_Name),3), '-')),left(substring(lag(From_Position_Name),3),instr(substring(lag(From_Position_Name),3), '-')))) ~> Window1\nWindow1 derive(Idle_Time_Min = iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0)),\n\t\tIdle_Time_Range = case(iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>0 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=2,\"Upto 2 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>2 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=5,\"02 to 05 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>5\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=10,\"05 to 10 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>10\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=15,\"10 to 15 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>15\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=20,\"15 to 20 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>20\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=25,\"20 to 25 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>25\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=30,\"25 to 30 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>30\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=1000,\"> 30 min\")) ~> DerivedColumn2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'onne',\n\tfolderPath: 'gold/qc_idle_time',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/QC_Idle_Time_Valencia')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "filterOutNullMoveCompleteTime"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 filter(equals(Event_Type_Id,'UNIT_DISCH') || equals(Event_Type_Id,'UNIT_LOAD')) ~> Filter1\nFilter1 derive(Move_Completion_Date_Time = iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),\n\t\tMove_Complete_Date = toDate(toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'yyyy-MM-dd'),'yyyy-MM-dd'),\n\t\tMove_Complete_Time = toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'HH:mm:ss'),\n\t\tVessel_Code = iif(Event_Type_Id=='UNIT_LOAD',left(substring(To_Position_Name,3),instr(substring(To_Position_Name,3), '-')),left(substring(From_Position_Name,3),instr(substring(From_Position_Name,3), '-')))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tmve_gkey,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn2 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nfilterOutNullMoveCompleteTime window(asc(pow, true),\n\tasc(Move_Completion_Date_Time, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tMove_Completion_Date_Time_PREV = lag(Move_Completion_Date_Time),\n\t\tPOW_PREV = lag(pow),\n\t\tVessel_PREV = iif(lag(Event_Type_Id)=='UNIT_LOAD',left(substring(lag(To_Position_Name),3),instr(substring(lag(To_Position_Name),3), '-')),left(substring(lag(From_Position_Name),3),instr(substring(lag(From_Position_Name),3), '-')))) ~> Window1\nWindow1 derive(Idle_Time_Min = iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0)),\n\t\tIdle_Time_Range = case(iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>0 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=2,\"0 to 02 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>2 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=5,\"02 to 05 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>5\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=10,\"05 to 10 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>10\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=15,\"10 to 15 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>15\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=20,\"15 to 20 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>20\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=25,\"20 to 25 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>25\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=30,\"25 to 30 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>30\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=60,\"30 to 60 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>60,\"60 & more\")) ~> DerivedColumn2\nDerivedColumn1 filter(length(toString(Move_Complete_Date, 'yyyy-mm-dd') )>1) ~> filterOutNullMoveCompleteTime\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'gold/qc_idle_time',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/QC_Idle_Time_Valencia_testDec6')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "filterOutNullMoveCompleteDate"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 filter(equals(Event_Type_Id,'UNIT_DISCH') || equals(Event_Type_Id,'UNIT_LOAD')) ~> Filter1\nFilter1 derive(Move_Completion_Date_Time = iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),\n\t\tMove_Complete_Date = toDate(toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'yyyy-MM-dd'),'yyyy-MM-dd'),\n\t\tMove_Complete_Time = toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'HH:mm:ss'),\n\t\tVessel_Code = iif(Event_Type_Id=='UNIT_LOAD',left(substring(To_Position_Name,3),instr(substring(To_Position_Name,3), '-')),left(substring(From_Position_Name,3),instr(substring(From_Position_Name,3), '-')))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tmve_gkey,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn2 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nfilterOutNullMoveCompleteDate window(asc(pow, true),\n\tasc(Move_Completion_Date_Time, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tMove_Completion_Date_Time_PREV = lag(Move_Completion_Date_Time),\n\t\tPOW_PREV = lag(pow),\n\t\tVessel_PREV = iif(lag(Event_Type_Id)=='UNIT_LOAD',left(substring(lag(To_Position_Name),3),instr(substring(lag(To_Position_Name),3), '-')),left(substring(lag(From_Position_Name),3),instr(substring(lag(From_Position_Name),3), '-')))) ~> Window1\nWindow1 derive(Idle_Time_Min = iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0)),\n\t\tIdle_Time_Range = case(iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>0 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=2,\"0 to 02 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>2 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=5,\"02 to 05 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>5\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=10,\"05 to 10 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>10\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=15,\"10 to 15 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>15\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=20,\"15 to 20 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>20\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=25,\"20 to 25 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>25\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=30,\"25 to 30 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>30\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=60,\"30 to 60 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>60,\"60 & more\")) ~> DerivedColumn2\nDerivedColumn1 filter(isNull(Move_Complete_Date)==false()) ~> filterOutNullMoveCompleteDate\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'gold/qc_idle_time',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/QC_Idle_Time_aarhus')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn2"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'apmtaarhus',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 filter(equals(Event_Type_Id,'UNIT_DISCH') || equals(Event_Type_Id,'UNIT_LOAD')) ~> Filter1\nFilter1 derive(Move_Completion_Date_Time = iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),\n\t\tMove_Complete_Date = toDate(toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'yyyy-MM-dd'),'yyyy-MM-dd'),\n\t\tMove_Complete_Time = toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'HH:mm:ss'),\n\t\tVessel_Code = iif(Event_Type_Id=='UNIT_LOAD',left(substring(To_Position_Name,3),instr(substring(To_Position_Name,3), '-')),left(substring(From_Position_Name,3),instr(substring(From_Position_Name,3), '-')))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tmve_gkey,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn2 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDerivedColumn1 window(asc(pow, true),\n\tasc(Move_Completion_Date_Time, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tMove_Completion_Date_Time_PREV = lag(Move_Completion_Date_Time),\n\t\tPOW_PREV = lag(pow),\n\t\tVessel_PREV = iif(lag(Event_Type_Id)=='UNIT_LOAD',left(substring(lag(To_Position_Name),3),instr(substring(lag(To_Position_Name),3), '-')),left(substring(lag(From_Position_Name),3),instr(substring(lag(From_Position_Name),3), '-')))) ~> Window1\nWindow1 derive(Idle_Time_Min = iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0)),\n\t\tIdle_Time_Range = case(iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>0 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=2,\"0 to 02 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>2 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=5,\"02 to 05 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>5\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=10,\"05 to 10 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>10\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=15,\"10 to 15 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>15\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=20,\"15 to 20 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>20\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=25,\"20 to 25 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>25\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=30,\"25 to 30 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>30\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=60,\"30 to 60 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>60,\"60 & more\")) ~> DerivedColumn2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'apmtaarhus',\n\tfolderPath: 'gold/qc_idle_time',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/QC_Idle_Time_aqaba')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn2"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'apmtaqaba',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 filter(equals(Event_Type_Id,'UNIT_DISCH') || equals(Event_Type_Id,'UNIT_LOAD')) ~> Filter1\nFilter1 derive(Move_Completion_Date_Time = iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),\n\t\tMove_Complete_Date = toDate(toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'yyyy-MM-dd'),'yyyy-MM-dd'),\n\t\tMove_Complete_Time = toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'HH:mm:ss'),\n\t\tVessel_Code = iif(Event_Type_Id=='UNIT_LOAD',left(substring(To_Position_Name,3),instr(substring(To_Position_Name,3), '-')),left(substring(From_Position_Name,3),instr(substring(From_Position_Name,3), '-')))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tmve_gkey,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn2 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDerivedColumn1 window(asc(pow, true),\n\tasc(Move_Completion_Date_Time, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tMove_Completion_Date_Time_PREV = lag(Move_Completion_Date_Time),\n\t\tPOW_PREV = lag(pow),\n\t\tVessel_PREV = iif(lag(Event_Type_Id)=='UNIT_LOAD',left(substring(lag(To_Position_Name),3),instr(substring(lag(To_Position_Name),3), '-')),left(substring(lag(From_Position_Name),3),instr(substring(lag(From_Position_Name),3), '-')))) ~> Window1\nWindow1 derive(Idle_Time_Min = iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0)),\n\t\tIdle_Time_Range = case(iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>0 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=2,\"0 to 02 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>2 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=5,\"02 to 05 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>5\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=10,\"05 to 10 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>10\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=15,\"10 to 15 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>15\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=20,\"15 to 20 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>20\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=25,\"20 to 25 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>25\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=30,\"25 to 30 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>30\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=60,\"30 to 60 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>60,\"60 & more\")) ~> DerivedColumn2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'apmtaqaba',\n\tfolderPath: 'gold/qc_idle_time',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/QC_Idle_Time_cmsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn2"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 filter(equals(Event_Type_Id,'UNIT_DISCH') || equals(Event_Type_Id,'UNIT_LOAD')) ~> Filter1\nFilter1 derive(Move_Completion_Date_Time = iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),\n\t\tMove_Complete_Date = toDate(toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'yyyy-MM-dd'),'yyyy-MM-dd'),\n\t\tMove_Complete_Time = toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'HH:mm:ss'),\n\t\tVessel_Code = iif(Event_Type_Id=='UNIT_LOAD',left(substring(To_Position_Name,3),instr(substring(To_Position_Name,3), '-')),left(substring(From_Position_Name,3),instr(substring(From_Position_Name,3), '-')))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tmve_gkey,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn2 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDerivedColumn1 window(asc(pow, true),\n\tasc(Move_Completion_Date_Time, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tMove_Completion_Date_Time_PREV = lag(Move_Completion_Date_Time),\n\t\tPOW_PREV = lag(pow),\n\t\tVessel_PREV = iif(lag(Event_Type_Id)=='UNIT_LOAD',left(substring(lag(To_Position_Name),3),instr(substring(lag(To_Position_Name),3), '-')),left(substring(lag(From_Position_Name),3),instr(substring(lag(From_Position_Name),3), '-')))) ~> Window1\nWindow1 derive(Idle_Time_Min = iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0)),\n\t\tIdle_Time_Range = case(iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>0 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=2,\"0 to 02 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>2 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=5,\"02 to 05 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>5\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=10,\"05 to 10 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>10\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=15,\"10 to 15 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>15\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=20,\"15 to 20 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>20\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=25,\"20 to 25 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>25\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=30,\"25 to 30 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>30\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=60,\"30 to 60 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>60,\"60 & more\")) ~> DerivedColumn2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'gold/qc_idle_time',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/QC_Idle_Time_gpa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn2"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as long,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as long,\n\t\tdist_start as long,\n\t\tTwin_Fetch as boolean,\n\t\tTwin_Carry as boolean,\n\t\tTwin_Put as boolean,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tRestow_Reason as string,\n\t\tPOW as string,\n\t\tufv_gkey as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tRequires_Power_Flag as boolean,\n\t\tOOG_Flag as boolean,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as long,\n\t\tComplex_Id as string,\n\t\tCarrier_Visit_Id as string,\n\t\tPhase as string,\n\t\tVisit_Nbr as string,\n\t\tCarrier_Mode as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\tOperator_Line_Id as string,\n\t\tOperator_Line_Role as string,\n\t\tOperator_Line_Name as string,\n\t\tTime_First_Availabilty as string,\n\t\tTime_Discharge_Complete as string,\n\t\tService_Id as string,\n\t\tService_Name as string,\n\t\tVessel_Id as string,\n\t\tIB_VYG as string,\n\t\tOB_VYG as string,\n\t\tCarrier_Name as string,\n\t\tVessel_Class as string,\n\t\tPublished_ETA as string,\n\t\tPublished_ETD as string,\n\t\tStart_Work as string,\n\t\tEnd_Work as string,\n\t\tBegin_Receive_Date as string,\n\t\tCargo_Cutoff_Date as string,\n\t\tHazard_Cutoff_Date as string,\n\t\tReefer_Cutoff_Date as string,\n\t\tLabor_On_Board_Date as string,\n\t\tLabor_Off_Board_Date as string,\n\t\tOff_Port_Arrival_Date as string,\n\t\tOff_Port_Departure as string,\n\t\tPilot_On_Board_Date as string,\n\t\tPilot_Off_Board_Date as string,\n\t\tEst_BBK_Discharge as string,\n\t\tEst_BBK_Load as string,\n\t\tEst_Load as string,\n\t\tEst_Discharge as string,\n\t\tEst_Restow as string,\n\t\tEst_Shift as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\tVessel_Classification as string,\n\t\tVessel_Class_Length_Overall_cm as integer,\n\t\tVessel_Class_Beam_cm as string,\n\t\tVessel_TEU_Capacity as string,\n\t\tLloyds_Code as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 filter(equals(Event_Type_Id,'UNIT_DISCH') || equals(Event_Type_Id,'UNIT_LOAD')) ~> Filter1\nFilter1 derive(Move_Completion_Date_Time = iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),\n\t\tMove_Complete_Date = toDate(toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'yyyy-MM-dd'),'yyyy-MM-dd'),\n\t\tMove_Complete_Time = toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'HH:mm:ss'),\n\t\tVessel_Code = iif(Event_Type_Id=='UNIT_LOAD',left(substring(To_Position_Name,3),instr(substring(To_Position_Name,3), '-')),left(substring(From_Position_Name,3),instr(substring(From_Position_Name,3), '-')))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow = POW,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tmve_gkey,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn2 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDerivedColumn1 window(asc(pow, true),\n\tasc(Move_Completion_Date_Time, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tMove_Completion_Date_Time_PREV = lag(Move_Completion_Date_Time),\n\t\tPOW_PREV = lag(pow),\n\t\tVessel_PREV = iif(lag(Event_Type_Id)=='UNIT_LOAD',left(substring(lag(To_Position_Name),3),instr(substring(lag(To_Position_Name),3), '-')),left(substring(lag(From_Position_Name),3),instr(substring(lag(From_Position_Name),3), '-')))) ~> Window1\nWindow1 derive(Idle_Time_Min = iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0)),\n\t\tIdle_Time_Range = case(iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>0 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=2,\"0 to 02 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>2 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=5,\"02 to 05 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>5\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=10,\"05 to 10 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>10\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=15,\"10 to 15 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>15\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=20,\"15 to 20 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>20\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=25,\"20 to 25 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>25\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=30,\"25 to 30 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>30\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=60,\"30 to 60 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>60,\"60 & more\")) ~> DerivedColumn2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'gold/qc_idle_time',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/QC_Idle_Time_haifa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn2"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'haifa',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 filter(equals(Event_Type_Id,'UNIT_DISCH') || equals(Event_Type_Id,'UNIT_LOAD')) ~> Filter1\nFilter1 derive(Move_Completion_Date_Time = iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),\n\t\tMove_Complete_Date = toDate(toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'yyyy-MM-dd'),'yyyy-MM-dd'),\n\t\tMove_Complete_Time = toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'HH:mm:ss'),\n\t\tVessel_Code = iif(Event_Type_Id=='UNIT_LOAD',left(substring(To_Position_Name,3),instr(substring(To_Position_Name,3), '-')),left(substring(From_Position_Name,3),instr(substring(From_Position_Name,3), '-')))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tmve_gkey,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn2 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDerivedColumn1 window(asc(pow, true),\n\tasc(Move_Completion_Date_Time, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tMove_Completion_Date_Time_PREV = lag(Move_Completion_Date_Time),\n\t\tPOW_PREV = lag(pow),\n\t\tVessel_PREV = iif(lag(Event_Type_Id)=='UNIT_LOAD',left(substring(lag(To_Position_Name),3),instr(substring(lag(To_Position_Name),3), '-')),left(substring(lag(From_Position_Name),3),instr(substring(lag(From_Position_Name),3), '-')))) ~> Window1\nWindow1 derive(Idle_Time_Min = iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0)),\n\t\tIdle_Time_Range = case(iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>0 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=2,\"0 to 02 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>2 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=5,\"02 to 05 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>5\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=10,\"05 to 10 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>10\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=15,\"10 to 15 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>15\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=20,\"15 to 20 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>20\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=25,\"20 to 25 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>25\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=30,\"25 to 30 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>30\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=60,\"30 to 60 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>60,\"60 & more\")) ~> DerivedColumn2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'haifa',\n\tfolderPath: 'gold/qc_idle_time',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/QC_Idle_Time_kssp')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "filterOutNullMoveCompleteTime"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'kssp',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 filter(equals(Event_Type_Id,'UNIT_DISCH') || equals(Event_Type_Id,'UNIT_LOAD')) ~> Filter1\nFilter1 derive(Move_Completion_Date_Time = iif(Event_Type_Id=='UNIT_LOAD', coalesce(t_carry_complete,t_put), coalesce(t_discharge,t_fetch)),\n\t\tMove_Complete_Date = toDate(toString(iif(Event_Type_Id=='UNIT_LOAD', coalesce(t_carry_complete,t_put), coalesce(t_discharge,t_fetch)),'yyyy-MM-dd'),'yyyy-MM-dd'),\n\t\tMove_Complete_Time = toString(iif(Event_Type_Id=='UNIT_LOAD', coalesce(t_carry_complete,t_put), coalesce(t_discharge,t_fetch)),'HH:mm:ss'),\n\t\tVessel_Code = iif(Event_Type_Id=='UNIT_LOAD',left(substring(To_Position_Name,3),instr(substring(To_Position_Name,3), '-')),left(substring(From_Position_Name,3),instr(substring(From_Position_Name,3), '-')))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tmve_gkey,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn2 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nfilterOutNullMoveCompleteTime window(asc(pow, true),\n\tasc(Move_Completion_Date_Time, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tMove_Completion_Date_Time_PREV = lag(Move_Completion_Date_Time),\n\t\tPOW_PREV = lag(pow),\n\t\tVessel_PREV = iif(lag(Event_Type_Id)=='UNIT_LOAD',left(substring(lag(To_Position_Name),3),instr(substring(lag(To_Position_Name),3), '-')),left(substring(lag(From_Position_Name),3),instr(substring(lag(From_Position_Name),3), '-')))) ~> Window1\nWindow1 derive(Idle_Time_Min = iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0)),\n\t\tIdle_Time_Range = case(iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>0 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=2,\"0 to 02 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>2 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=5,\"02 to 05 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>5\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=10,\"05 to 10 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>10\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=15,\"10 to 15 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>15\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=20,\"15 to 20 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>20\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=25,\"20 to 25 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>25\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=30,\"25 to 30 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>30\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=60,\"30 to 60 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>60,\"60 & more\")) ~> DerivedColumn2\nDerivedColumn1 filter(length(toString(Move_Complete_Date, 'yyyy-mm-dd') )>1) ~> filterOutNullMoveCompleteTime\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'kssp',\n\tfolderPath: 'gold/qc_idle_time',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/QC_Idle_Time_malta')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn2"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as string,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as string,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as string,\n\t\tdist_start as string,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as string,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as string,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tATA as timestamp,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'malta',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 filter(equals(Event_Type_Id,'UNIT_DISCH') || equals(Event_Type_Id,'UNIT_LOAD')) ~> Filter1\nFilter1 derive(Move_Completion_Date_Time = iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),\n\t\tMove_Complete_Date = toDate(toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'yyyy-MM-dd'),'yyyy-MM-dd'),\n\t\tMove_Complete_Time = toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'HH:mm:ss'),\n\t\tVessel_Code = iif(Event_Type_Id=='UNIT_LOAD',\r\n    left(substring(To_Position_Name,3),\r\n    instr(substring(To_Position_Name,3), '-') -1),\r\n    left(substring(From_Position_Name,3),\r\n    instr(substring(From_Position_Name,3), '-') -1))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tmve_gkey,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn2 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDerivedColumn1 window(asc(pow, true),\n\tasc(Move_Completion_Date_Time, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tMove_Completion_Date_Time_PREV = lag(Move_Completion_Date_Time),\n\t\tPOW_PREV = lag(pow),\n\t\tVessel_PREV = iif(lag(Event_Type_Id)=='UNIT_LOAD',left(substring(lag(To_Position_Name),3),instr(substring(lag(To_Position_Name),3), '-')),left(substring(lag(From_Position_Name),3),instr(substring(lag(From_Position_Name),3), '-')))) ~> Window1\nWindow1 derive(Idle_Time_Min = iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0)),\n\t\tIdle_Time_Range = case(iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>0 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=2,\"0 to 02 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>2 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=5,\"02 to 05 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>5\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=10,\"05 to 10 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>10\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=15,\"10 to 15 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>15\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=20,\"15 to 20 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>20\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=25,\"20 to 25 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>25\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=30,\"25 to 30 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>30\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=60,\"30 to 60 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>60,\"60 & more\")) ~> DerivedColumn2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'tauranga',\n\tfolderPath: 'gold/qc_idle_time',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/QC_Idle_Time_mict')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn2"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 filter(equals(Event_Type_Id,'UNIT_DISCH') || equals(Event_Type_Id,'UNIT_LOAD')) ~> Filter1\nFilter1 derive(Move_Completion_Date_Time = iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),\n\t\tMove_Complete_Date = toDate(toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'yyyy-MM-dd'),'yyyy-MM-dd'),\n\t\tMove_Complete_Time = toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'HH:mm:ss'),\n\t\tVessel_Code = iif(Event_Type_Id=='UNIT_LOAD',left(substring(To_Position_Name,3),instr(substring(To_Position_Name,3), '-')),left(substring(From_Position_Name,3),instr(substring(From_Position_Name,3), '-')))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tmve_gkey,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn2 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDerivedColumn1 window(asc(pow, true),\n\tasc(Move_Completion_Date_Time, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tMove_Completion_Date_Time_PREV = lag(Move_Completion_Date_Time),\n\t\tPOW_PREV = lag(pow),\n\t\tVessel_PREV = iif(lag(Event_Type_Id)=='UNIT_LOAD',left(substring(lag(To_Position_Name),3),instr(substring(lag(To_Position_Name),3), '-')),left(substring(lag(From_Position_Name),3),instr(substring(lag(From_Position_Name),3), '-')))) ~> Window1\nWindow1 derive(Idle_Time_Min = iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0)),\n\t\tIdle_Time_Range = case(iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>0 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=2,\"0 to 02 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>2 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=5,\"02 to 05 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>5\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=10,\"05 to 10 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>10\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=15,\"10 to 15 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>15\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=20,\"15 to 20 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>20\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=25,\"20 to 25 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>25\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=30,\"25 to 30 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>30\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=60,\"30 to 60 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>60,\"60 & more\")) ~> DerivedColumn2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'gold/qc_idle_time',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/QC_Idle_Time_mnhpi')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn2"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 filter(equals(Event_Type_Id,'UNIT_DISCH') || equals(Event_Type_Id,'UNIT_LOAD')) ~> Filter1\nFilter1 derive(Move_Completion_Date_Time = iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),\n\t\tMove_Complete_Date = toDate(toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'yyyy-MM-dd'),'yyyy-MM-dd'),\n\t\tMove_Complete_Time = toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'HH:mm:ss'),\n\t\tVessel_Code = iif(Event_Type_Id=='UNIT_LOAD',left(substring(To_Position_Name,3),instr(substring(To_Position_Name,3), '-')),left(substring(From_Position_Name,3),instr(substring(From_Position_Name,3), '-')))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tmve_gkey,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn2 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDerivedColumn1 window(asc(pow, true),\n\tasc(Move_Completion_Date_Time, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tMove_Completion_Date_Time_PREV = lag(Move_Completion_Date_Time),\n\t\tPOW_PREV = lag(pow),\n\t\tVessel_PREV = iif(lag(Event_Type_Id)=='UNIT_LOAD',left(substring(lag(To_Position_Name),3),instr(substring(lag(To_Position_Name),3), '-')),left(substring(lag(From_Position_Name),3),instr(substring(lag(From_Position_Name),3), '-')))) ~> Window1\nWindow1 derive(Idle_Time_Min = iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0)),\n\t\tIdle_Time_Range = case(iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>0 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=2,\"0 to 02 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>2 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=5,\"02 to 05 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>5\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=10,\"05 to 10 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>10\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=15,\"10 to 15 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>15\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=20,\"15 to 20 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>20\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=25,\"20 to 25 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>25\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=30,\"25 to 30 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>30\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=60,\"30 to 60 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>60,\"60 & more\")) ~> DerivedColumn2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'gold/qc_idle_time',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/QC_Idle_Time_pdports')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn2"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'pdports',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 filter(equals(Event_Type_Id,'UNIT_DISCH') || equals(Event_Type_Id,'UNIT_LOAD')) ~> Filter1\nFilter1 derive(Move_Completion_Date_Time = iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),\n\t\tMove_Complete_Date = toDate(toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'yyyy-MM-dd'),'yyyy-MM-dd'),\n\t\tMove_Complete_Time = toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'HH:mm:ss'),\n\t\tVessel_Code = iif(Event_Type_Id=='UNIT_LOAD',left(substring(To_Position_Name,3),instr(substring(To_Position_Name,3), '-')),left(substring(From_Position_Name,3),instr(substring(From_Position_Name,3), '-')))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tmve_gkey,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn2 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDerivedColumn1 window(asc(pow, true),\n\tasc(Move_Completion_Date_Time, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tMove_Completion_Date_Time_PREV = lag(Move_Completion_Date_Time),\n\t\tPOW_PREV = lag(pow),\n\t\tVessel_PREV = iif(lag(Event_Type_Id)=='UNIT_LOAD',left(substring(lag(To_Position_Name),3),instr(substring(lag(To_Position_Name),3), '-')),left(substring(lag(From_Position_Name),3),instr(substring(lag(From_Position_Name),3), '-')))) ~> Window1\nWindow1 derive(Idle_Time_Min = iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0)),\n\t\tIdle_Time_Range = case(iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>0 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=2,\"0 to 02 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>2 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=5,\"02 to 05 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>5\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=10,\"05 to 10 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>10\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=15,\"10 to 15 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>15\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=20,\"15 to 20 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>20\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=25,\"20 to 25 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>25\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=30,\"25 to 30 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>30\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=60,\"30 to 60 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>60,\"60 & more\")) ~> DerivedColumn2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'pdports',\n\tfolderPath: 'gold/qc_idle_time',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/QC_Idle_Time_plipdeco')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn2"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'plipdeco',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 filter(equals(Event_Type_Id,'UNIT_DISCH') || equals(Event_Type_Id,'UNIT_LOAD')) ~> Filter1\nFilter1 derive(Move_Completion_Date_Time = iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),\n\t\tMove_Complete_Date = toDate(toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'yyyy-MM-dd'),'yyyy-MM-dd'),\n\t\tMove_Complete_Time = toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'HH:mm:ss'),\n\t\tVessel_Code = iif(Event_Type_Id=='UNIT_LOAD',left(substring(To_Position_Name,3),instr(substring(To_Position_Name,3), '-')),left(substring(From_Position_Name,3),instr(substring(From_Position_Name,3), '-')))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tmve_gkey,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn2 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDerivedColumn1 window(asc(pow, true),\n\tasc(Move_Completion_Date_Time, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tMove_Completion_Date_Time_PREV = lag(Move_Completion_Date_Time),\n\t\tPOW_PREV = lag(pow),\n\t\tVessel_PREV = iif(lag(Event_Type_Id)=='UNIT_LOAD',left(substring(lag(To_Position_Name),3),instr(substring(lag(To_Position_Name),3), '-')),left(substring(lag(From_Position_Name),3),instr(substring(lag(From_Position_Name),3), '-')))) ~> Window1\nWindow1 derive(Idle_Time_Min = iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0)),\n\t\tIdle_Time_Range = case(iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>0 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=2,\"0 to 02 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>2 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=5,\"02 to 05 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>5\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=10,\"05 to 10 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>10\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=15,\"10 to 15 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>15\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=20,\"15 to 20 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>20\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=25,\"20 to 25 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>25\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=30,\"25 to 30 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>30\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=60,\"30 to 60 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>60,\"60 & more\")) ~> DerivedColumn2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'plipdeco',\n\tfolderPath: 'gold/qc_idle_time',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/QC_Idle_Time_salalah')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn2"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'salalah',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 filter(equals(Event_Type_Id,'UNIT_DISCH') || equals(Event_Type_Id,'UNIT_LOAD')) ~> Filter1\nFilter1 derive(Move_Completion_Date_Time = iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),\n\t\tMove_Complete_Date = toDate(toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'yyyy-MM-dd'),'yyyy-MM-dd'),\n\t\tMove_Complete_Time = toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'HH:mm:ss'),\n\t\tVessel_Code = iif(Event_Type_Id=='UNIT_LOAD',left(substring(To_Position_Name,3),instr(substring(To_Position_Name,3), '-')),left(substring(From_Position_Name,3),instr(substring(From_Position_Name,3), '-')))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tmve_gkey,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn2 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDerivedColumn1 window(asc(pow, true),\n\tasc(Move_Completion_Date_Time, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tMove_Completion_Date_Time_PREV = lag(Move_Completion_Date_Time),\n\t\tPOW_PREV = lag(pow),\n\t\tVessel_PREV = iif(lag(Event_Type_Id)=='UNIT_LOAD',left(substring(lag(To_Position_Name),3),instr(substring(lag(To_Position_Name),3), '-')),left(substring(lag(From_Position_Name),3),instr(substring(lag(From_Position_Name),3), '-')))) ~> Window1\nWindow1 derive(Idle_Time_Min = iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0)),\n\t\tIdle_Time_Range = case(iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>0 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=2,\"0 to 02 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>2 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=5,\"02 to 05 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>5\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=10,\"05 to 10 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>10\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=15,\"10 to 15 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>15\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=20,\"15 to 20 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>20\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=25,\"20 to 25 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>25\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=30,\"25 to 30 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>30\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=60,\"30 to 60 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>60,\"60 & more\")) ~> DerivedColumn2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'salalah',\n\tfolderPath: 'gold/qc_idle_time',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/QC_Idle_Time_tauranga')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn2"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'tauranga',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 filter(equals(Event_Type_Id,'UNIT_DISCH') || equals(Event_Type_Id,'UNIT_LOAD')) ~> Filter1\nFilter1 derive(Move_Completion_Date_Time = iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),\n\t\tMove_Complete_Date = toDate(toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'yyyy-MM-dd'),'yyyy-MM-dd'),\n\t\tMove_Complete_Time = toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'HH:mm:ss'),\n\t\tVessel_Code = iif(Event_Type_Id=='UNIT_LOAD',left(substring(To_Position_Name,3),instr(substring(To_Position_Name,3), '-')),left(substring(From_Position_Name,3),instr(substring(From_Position_Name,3), '-')))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tmve_gkey,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn2 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDerivedColumn1 window(asc(pow, true),\n\tasc(Move_Completion_Date_Time, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tMove_Completion_Date_Time_PREV = lag(Move_Completion_Date_Time),\n\t\tPOW_PREV = lag(pow),\n\t\tVessel_PREV = iif(lag(Event_Type_Id)=='UNIT_LOAD',left(substring(lag(To_Position_Name),3),instr(substring(lag(To_Position_Name),3), '-')),left(substring(lag(From_Position_Name),3),instr(substring(lag(From_Position_Name),3), '-')))) ~> Window1\nWindow1 derive(Idle_Time_Min = iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0)),\n\t\tIdle_Time_Range = case(iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>0 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=2,\"0 to 02 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>2 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=5,\"02 to 05 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>5\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=10,\"05 to 10 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>10\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=15,\"10 to 15 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>15\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=20,\"15 to 20 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>20\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=25,\"20 to 25 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>25\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=30,\"25 to 30 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>30\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=60,\"30 to 60 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>60,\"60 & more\")) ~> DerivedColumn2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'tauranga',\n\tfolderPath: 'gold/qc_idle_time',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/QC_Idle_Time_tdt')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn2"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'tdt',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nSelect1 filter(equals(Event_Type_Id,'UNIT_DISCH') || equals(Event_Type_Id,'UNIT_LOAD')) ~> Filter1\nFilter1 derive(Move_Completion_Date_Time = iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),\n\t\tMove_Complete_Date = toDate(toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'yyyy-MM-dd'),'yyyy-MM-dd'),\n\t\tMove_Complete_Time = toString(iif(Event_Type_Id=='UNIT_LOAD', t_carry_complete, t_discharge),'HH:mm:ss'),\n\t\tVessel_Code = iif(Event_Type_Id=='UNIT_LOAD',left(substring(To_Position_Name,3),instr(substring(To_Position_Name,3), '-')),left(substring(From_Position_Name,3),instr(substring(From_Position_Name,3), '-')))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tmve_gkey,\n\t\tUnit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nDerivedColumn2 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDerivedColumn1 window(asc(pow, true),\n\tasc(Move_Completion_Date_Time, true),\n\tstartRowOffset: -1L,\n\tendRowOffset: -1L,\n\tMove_Completion_Date_Time_PREV = lag(Move_Completion_Date_Time),\n\t\tPOW_PREV = lag(pow),\n\t\tVessel_PREV = iif(lag(Event_Type_Id)=='UNIT_LOAD',left(substring(lag(To_Position_Name),3),instr(substring(lag(To_Position_Name),3), '-')),left(substring(lag(From_Position_Name),3),instr(substring(lag(From_Position_Name),3), '-')))) ~> Window1\nWindow1 derive(Idle_Time_Min = iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0)),\n\t\tIdle_Time_Range = case(iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>0 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=2,\"0 to 02 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>2 \r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=5,\"02 to 05 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>5\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=10,\"05 to 10 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>10\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=15,\"10 to 15 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>15\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=20,\"15 to 20 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>20\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=25,\"20 to 25 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>25\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=30,\"25 to 30 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>30\r\n&& iif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))<=60,\"30 to 60 min\",\r\niif(POW_PREV==pow && Vessel_Code==Vessel_PREV,minus(Move_Completion_Date_Time,Move_Completion_Date_Time_PREV)/60000,toLong(0))>60,\"60 & more\")) ~> DerivedColumn2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'tdt',\n\tfolderPath: 'gold/qc_idle_time',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RTG EcEvents')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "powerbianalyticsdata-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "powerbianalyticsdata-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "RTG"
						},
						{
							"linkedService": {
								"referenceName": "powerbianalyticsdata-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						},
						{
							"name": "Filter8"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as string,\n\t\tmoveKind as string,\n\t\tisTwin as string,\n\t\tstartDistance as string,\n\t\tworkAssignment as string,\n\t\tunitRef as string,\n\t\ttrain_ID as string,\n\t\tlocType as string,\n\t\tlocID as string,\n\t\tlocSlot as string,\n\t\topsPosID as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocID as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocID as string,\n\t\tladen_LocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'ptpbianalyticsdata',\n\tfolderPath: 'PTP/silver/EcEvents_v2') ~> source1\nFilter8 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='RTG' && eventTypeDescription=='CMPL' && (CHE_Name!='CFSG1' && CHE_Name!='CFSG2' && CHE_Name!='DPT01' && CHE_Name!='DUMRTG' && CHE_Name!='RAIL01')) ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('07:00:00') && toString(TimeStamp,'HH:mm:ss')< toString('19:00:00'),toTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:00:00')),iif(toString(TimeStamp,'HH:mm:ss') >= toString('19:00:00'),toTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:00:00')),toTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'19:00:00')))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('07:00:00') && toString(TimeStamp,'HH:mm:ss')< toString('19:00:00'),toTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'18:59:59')),iif(toString(TimeStamp,'HH:mm:ss') >= toString('19:00:00'),toTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'06:59:59')),toTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'06:59:59')))),\n\t\tShift = iif(toString(iif(toString(TimeStamp,'HH:mm:ss')>=toString('07:00:00') && toString(TimeStamp,'HH:mm:ss')< toString('19:00:00'),toTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'18:59:59')),iif(toString(TimeStamp,'HH:mm:ss') >= toString('19:00:00'),toTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'06:59:59')),toTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'06:59:59')))),'HH:mm:ss') == toString('07:00:00'),1,2),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('07:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tMoveCount = iif(moveKind=='YARD',iif(left(locSlot,5)==left(laden_LocSlot,5),2,1),1),\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(TimeStamp, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('07:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))))) ~> DerivedColumn1\nselect filter((eventTypeDescription == 'LGOF' || eventTypeDescription == 'LGON') && cheKind == 'RTG' && (CHE_Name != 'CFSG1' && CHE_Name != 'CFSG2' && CHE_Name != 'DPT01' && CHE_Name != 'DUMRTG' && CHE_Name != 'RAIL01')) ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('07:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('07:00:00') && toString(TimeStamp,'HH:mm:ss')< toString('19:00:00'),toTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:00:00')),iif(toString(TimeStamp,'HH:mm:ss') >= toString('19:00:00'),toTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:00:00')),toTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'19:00:00')))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('07:00:00') && toString(TimeStamp,'HH:mm:ss')< toString('19:00:00'),toTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'18:59:59')),iif(toString(TimeStamp,'HH:mm:ss') >= toString('19:00:00'),toTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'06:59:59')),toTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'06:59:59')))),\n\t\tShift = iif(toString(iif(toString(TimeStamp,'HH:mm:ss')>=toString('07:00:00') && toString(TimeStamp,'HH:mm:ss')< toString('19:00:00'),toTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'18:59:59')),iif(toString(TimeStamp,'HH:mm:ss') >= toString('19:00:00'),toTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'06:59:59')),toTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'06:59:59')))),'HH:mm:ss') == toString('07:00:00'),1,2),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('07:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tBlock = left(locSlot,3)) ~> DerivedColumn3\nSort1 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\teventTypeDescription_PREV = lag(eventTypeDescription),\n\t\teventTypeDescription_NXT = lead(eventTypeDescription)) ~> Window1\nWindow1 derive(LGOF = case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(eventTypeDescription=='LGON',TimeStamp),\n\t\tWorkTime = toDouble((case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime))-case(eventTypeDescription=='LGON',TimeStamp))/3600000)) ~> DerivedColumn4\nDerivedColumn3 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nDerivedColumn1, Filter7 join(Aggregate1@CHE_ID == Aggregate3@CHE_ID\n\t&& DerivedColumn1@ShiftStartTime == DerivedColumn3@ShiftStartTime\n\t&& DerivedColumn1@ShiftEndTime == DerivedColumn3@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tecEventGkey = Aggregate1@ecEventGkey,\n\t\tyardGkey = Aggregate1@yardGkey,\n\t\tYardID = Aggregate1@YardID,\n\t\tFcyID = Aggregate1@FcyID,\n\t\tcheKind = Aggregate1@cheKind,\n\t\tCHE_Name = Aggregate1@CHE_Name,\n\t\tCHE_ID = Aggregate1@CHE_ID,\n\t\tTimeStamp = Aggregate1@TimeStamp,\n\t\teventType = Aggregate1@eventType,\n\t\teventSubType = Aggregate1@eventSubType,\n\t\teventTypeDescription = Aggregate1@eventTypeDescription,\n\t\tunit = Aggregate1@unit,\n\t\tpow = Aggregate1@pow,\n\t\tpool = Aggregate1@pool,\n\t\tworkQueue = Aggregate1@workQueue,\n\t\tmoveKind = Aggregate1@moveKind,\n\t\tlocSlot = Aggregate1@locSlot,\n\t\tunladenLocSlot = Aggregate1@unladenLocSlot,\n\t\tladen_LocSlot = Aggregate1@laden_LocSlot,\n\t\tYear = Aggregate1@Year,\n\t\tMonth = Aggregate1@Month,\n\t\tWeek = Aggregate1@Week,\n\t\tDate = DerivedColumn1@Date,\n\t\tTime = DerivedColumn1@Time,\n\t\tShiftStartTime = DerivedColumn1@ShiftStartTime,\n\t\tShiftEndTime = DerivedColumn1@ShiftEndTime,\n\t\tShift = DerivedColumn1@Shift,\n\t\tShiftDate = DerivedColumn1@ShiftDate,\n\t\tMoveCount,\n\t\tBlock = DerivedColumn1@Block,\n\t\tHour,\n\t\tWeekofYear = DerivedColumn1@WeekofYear,\n\t\t{ecEventGkey.1} = Aggregate3@ecEventGkey,\n\t\t{ShiftDate.1} = DerivedColumn3@ShiftDate,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(TimeStamp>=LGON && TimeStamp<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp),\n\t\tLastMove = case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp),\n\t\tIdleTimeFL = case(isNull(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp))==false(),(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp)-LGON)/3600000,isNull(case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))==false(),(LGOF-case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))/3600000),\n\t\tRTGIdleTime = iif(CHE_ID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-TimeStamp)<0,0.0,toFloat((TimeStamp_NXT-TimeStamp)/3600000)),0.0),\n\t\tBayChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0),\n\t\tBayChangeCount = iif(isNull(locSlot_NXT)==true(),0,iif(iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0)==1,\r\niif(toInteger(substring(locSlot,4,2))>toInteger(substring(locSlot_NXT,4,2)),iif( \r\ntoInteger(substring(locSlot,4,2))%2==0,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2)))), \r\niif(toInteger(substring(locSlot_NXT,4,2))%2==0,toInteger(substring(locSlot,4,2))-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2)))-(toInteger(substring(locSlot_NXT,4,2)))))\r\n,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,iif(\r\n    toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2)))) \r\n,iif(toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2)))))),0)),\n\t\tBlockChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)!=left(locSlot_NXT,3),1,0),0),0),0),\n\t\tLaneChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,2)!=left(locSlot_NXT,2),1,0),0),0),0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nsource1 filter(Week==49 || Week==50) ~> Filter8\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'ptpbianalyticsdata',\n\tfolderPath: 'PTP/gold/rtg_ecevents_v2',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tMoveCount,\n\t\tBlock,\n\t\tHour,\n\t\tWeekofYear,\n\t\t{ecEventGkey.1},\n\t\t{ShiftDate.1},\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime,\n\t\tValid,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\tlocSlot_PREV,\n\t\tlocSlot_NXT,\n\t\tecEventGkey_PREV,\n\t\tecEventGkey_NXT,\n\t\tShiftDate_PREV,\n\t\tShiftDate_NXT,\n\t\tLGON_PREV,\n\t\tLGON_NXT,\n\t\tLGOF_PREV,\n\t\tLGOF_NXT,\n\t\tFirstMove,\n\t\tLastMove,\n\t\tIdleTimeFL,\n\t\tRTGIdleTime,\n\t\tBayChangeInstance,\n\t\tBayChangeCount,\n\t\tBlockChangeInstance,\n\t\tLaneChangeInstance\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> RTG\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\tmoveKind as string,\n\t\tlocSlot as string,\n\t\tunladenLocSlot as string,\n\t\tladen_LocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tWeekofYear as integer,\n\t\tDate as date,\n\t\tTime as string,\n\t\tShiftStartTime as timestamp,\n\t\tShiftEndTime as timestamp,\n\t\tShift as integer,\n\t\tShiftDate as date,\n\t\tBlock as string,\n\t\tCHE_ID_PREV as long,\n\t\tCHE_ID_NXT as long,\n\t\tTimeStamp_PREV as timestamp,\n\t\tTimeStamp_NXT as timestamp,\n\t\teventTypeDescription_PREV as string,\n\t\teventTypeDescription_NXT as string,\n\t\tLGOF as timestamp,\n\t\tLGON as timestamp,\n\t\tWorkTime as double\n\t),\n\tformat: 'delta',\n\tfileSystem: 'ptpbianalyticsdata',\n\tfolderPath: 'PTP/gold/rtg_workhours_v2',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tWeekofYear,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tBlock,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\teventTypeDescription_PREV,\n\t\teventTypeDescription_NXT,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/powerbianalyticsdata-WorkspaceDefaultStorage')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RTG EcEvents_aqaba')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "RTG"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'apmtaqaba',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name = cheName,\n\t\tCHE_ID = cheID,\n\t\tTimeStamp = EcEventTime,\n\t\teventType = type,\n\t\teventSubType = subType,\n\t\teventTypeDescription = typeDescription,\n\t\tunit = unitIdName,\n\t\tpow = powName,\n\t\tpool = poolName,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot = ladenLocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='RTG' && eventTypeDescription=='CMPL') ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tMoveCount = iif(moveKind=='YARD',iif(left(locSlot,5)==left(laden_LocSlot,5),2,1),1),\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(TimeStamp, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))))) ~> DerivedColumn1\nselect filter((eventTypeDescription == 'LGOF' || eventTypeDescription == 'LGON') && cheKind == 'RTG') ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tBlock = left(locSlot,3)) ~> DerivedColumn3\nSort1 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\teventTypeDescription_PREV = lag(eventTypeDescription),\n\t\teventTypeDescription_NXT = lead(eventTypeDescription)) ~> Window1\nWindow1 derive(LGOF = case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(eventTypeDescription=='LGON',TimeStamp),\n\t\tWorkTime = toDouble((case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime))-case(eventTypeDescription=='LGON',TimeStamp))/3600000)) ~> DerivedColumn4\nDerivedColumn3 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nDerivedColumn1, Filter7 join(Aggregate1@CHE_ID == Aggregate3@CHE_ID\n\t&& DerivedColumn1@ShiftStartTime == DerivedColumn3@ShiftStartTime\n\t&& DerivedColumn1@ShiftEndTime == DerivedColumn3@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tecEventGkey = Aggregate1@ecEventGkey,\n\t\tyardGkey = Aggregate1@yardGkey,\n\t\tYardID = Aggregate1@YardID,\n\t\tFcyID = Aggregate1@FcyID,\n\t\tcheKind = Aggregate1@cheKind,\n\t\tCHE_Name = Aggregate1@CHE_Name,\n\t\tCHE_ID = Aggregate1@CHE_ID,\n\t\tTimeStamp = Aggregate1@TimeStamp,\n\t\teventType = Aggregate1@eventType,\n\t\teventSubType = Aggregate1@eventSubType,\n\t\teventTypeDescription = Aggregate1@eventTypeDescription,\n\t\tunit = Aggregate1@unit,\n\t\tpow = Aggregate1@pow,\n\t\tpool = Aggregate1@pool,\n\t\tworkQueue = Aggregate1@workQueue,\n\t\tmoveKind = Aggregate1@moveKind,\n\t\tlocSlot = Aggregate1@locSlot,\n\t\tunladenLocSlot = Aggregate1@unladenLocSlot,\n\t\tladen_LocSlot = Aggregate1@laden_LocSlot,\n\t\tYear = Aggregate1@Year,\n\t\tMonth = Aggregate1@Month,\n\t\tWeek = Aggregate1@Week,\n\t\tDate = DerivedColumn1@Date,\n\t\tTime = DerivedColumn1@Time,\n\t\tShiftStartTime = DerivedColumn1@ShiftStartTime,\n\t\tShiftEndTime = DerivedColumn1@ShiftEndTime,\n\t\tShift = DerivedColumn1@Shift,\n\t\tShiftDate = DerivedColumn1@ShiftDate,\n\t\tMoveCount,\n\t\tBlock = DerivedColumn1@Block,\n\t\tHour,\n\t\tWeekofYear = DerivedColumn1@WeekofYear,\n\t\t{ecEventGkey.1} = Aggregate3@ecEventGkey,\n\t\t{ShiftDate.1} = DerivedColumn3@ShiftDate,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(TimeStamp>=LGON && TimeStamp<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp),\n\t\tLastMove = case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp),\n\t\tIdleTimeFL = case(isNull(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp))==false(),(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp)-LGON)/3600000,isNull(case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))==false(),(LGOF-case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))/3600000),\n\t\tRTGIdleTime = iif(CHE_ID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-TimeStamp)<0,0.0,toFloat((TimeStamp_NXT-TimeStamp)/3600000)),0.0),\n\t\tBayChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0),\n\t\tBayChangeCount = iif(isNull(locSlot_NXT)==true(),0,iif(iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0)==1,\r\niif(toInteger(substring(locSlot,4,2))>toInteger(substring(locSlot_NXT,4,2)),iif( \r\ntoInteger(substring(locSlot,4,2))%2==0,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2)))), \r\niif(toInteger(substring(locSlot_NXT,4,2))%2==0,toInteger(substring(locSlot,4,2))-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2)))-(toInteger(substring(locSlot_NXT,4,2)))))\r\n,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,iif(\r\n    toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2)))) \r\n,iif(toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2)))))),0)),\n\t\tBlockChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)!=left(locSlot_NXT,3),1,0),0),0),0),\n\t\tLaneChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,2)!=left(locSlot_NXT,2),1,0),0),0),0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'apmtaqaba',\n\tfolderPath: 'gold/rtg_ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tMoveCount,\n\t\tBlock,\n\t\tHour,\n\t\tWeekofYear,\n\t\t{ecEventGkey.1},\n\t\t{ShiftDate.1},\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime,\n\t\tValid,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\tlocSlot_PREV,\n\t\tlocSlot_NXT,\n\t\tecEventGkey_PREV,\n\t\tecEventGkey_NXT,\n\t\tShiftDate_PREV,\n\t\tShiftDate_NXT,\n\t\tLGON_PREV,\n\t\tLGON_NXT,\n\t\tLGOF_PREV,\n\t\tLGOF_NXT,\n\t\tFirstMove,\n\t\tLastMove,\n\t\tIdleTimeFL,\n\t\tRTGIdleTime,\n\t\tBayChangeInstance,\n\t\tBayChangeCount,\n\t\tBlockChangeInstance,\n\t\tLaneChangeInstance\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> RTG\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\tmoveKind as string,\n\t\tlocSlot as string,\n\t\tunladenLocSlot as string,\n\t\tladen_LocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tWeekofYear as integer,\n\t\tDate as date,\n\t\tTime as string,\n\t\tShiftStartTime as timestamp,\n\t\tShiftEndTime as timestamp,\n\t\tShift as integer,\n\t\tShiftDate as date,\n\t\tBlock as string,\n\t\tCHE_ID_PREV as long,\n\t\tCHE_ID_NXT as long,\n\t\tTimeStamp_PREV as timestamp,\n\t\tTimeStamp_NXT as timestamp,\n\t\teventTypeDescription_PREV as string,\n\t\teventTypeDescription_NXT as string,\n\t\tLGOF as timestamp,\n\t\tLGON as timestamp,\n\t\tWorkTime as double\n\t),\n\tformat: 'delta',\n\tfileSystem: 'apmtaqaba',\n\tfolderPath: 'gold/rtg_workhours',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tWeekofYear,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tBlock,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\teventTypeDescription_PREV,\n\t\teventTypeDescription_NXT,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RTG EcEvents_cmsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "RTG"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name = cheName,\n\t\tCHE_ID = cheID,\n\t\tTimeStamp = EcEventTime,\n\t\teventType = type,\n\t\teventSubType = subType,\n\t\teventTypeDescription = typeDescription,\n\t\tunit = unitIdName,\n\t\tpow = powName,\n\t\tpool = poolName,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot = ladenLocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='RTG' && eventTypeDescription=='CMPL') ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tMoveCount = iif(moveKind=='YARD',iif(left(locSlot,5)==left(laden_LocSlot,5),2,1),1),\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(TimeStamp, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))))) ~> DerivedColumn1\nselect filter((eventTypeDescription == 'LGOF' || eventTypeDescription == 'LGON') && cheKind == 'RTG') ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tBlock = left(locSlot,3)) ~> DerivedColumn3\nSort1 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\teventTypeDescription_PREV = lag(eventTypeDescription),\n\t\teventTypeDescription_NXT = lead(eventTypeDescription)) ~> Window1\nWindow1 derive(LGOF = case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(eventTypeDescription=='LGON',TimeStamp),\n\t\tWorkTime = toDouble((case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime))-case(eventTypeDescription=='LGON',TimeStamp))/3600000)) ~> DerivedColumn4\nDerivedColumn3 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nDerivedColumn1, Filter7 join(Aggregate1@CHE_ID == Aggregate3@CHE_ID\n\t&& DerivedColumn1@ShiftStartTime == DerivedColumn3@ShiftStartTime\n\t&& DerivedColumn1@ShiftEndTime == DerivedColumn3@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tecEventGkey = Aggregate1@ecEventGkey,\n\t\tyardGkey = Aggregate1@yardGkey,\n\t\tYardID = Aggregate1@YardID,\n\t\tFcyID = Aggregate1@FcyID,\n\t\tcheKind = Aggregate1@cheKind,\n\t\tCHE_Name = Aggregate1@CHE_Name,\n\t\tCHE_ID = Aggregate1@CHE_ID,\n\t\tTimeStamp = Aggregate1@TimeStamp,\n\t\teventType = Aggregate1@eventType,\n\t\teventSubType = Aggregate1@eventSubType,\n\t\teventTypeDescription = Aggregate1@eventTypeDescription,\n\t\tunit = Aggregate1@unit,\n\t\tpow = Aggregate1@pow,\n\t\tpool = Aggregate1@pool,\n\t\tworkQueue = Aggregate1@workQueue,\n\t\tmoveKind = Aggregate1@moveKind,\n\t\tlocSlot = Aggregate1@locSlot,\n\t\tunladenLocSlot = Aggregate1@unladenLocSlot,\n\t\tladen_LocSlot = Aggregate1@laden_LocSlot,\n\t\tYear = Aggregate1@Year,\n\t\tMonth = Aggregate1@Month,\n\t\tWeek = Aggregate1@Week,\n\t\tDate = DerivedColumn1@Date,\n\t\tTime = DerivedColumn1@Time,\n\t\tShiftStartTime = DerivedColumn1@ShiftStartTime,\n\t\tShiftEndTime = DerivedColumn1@ShiftEndTime,\n\t\tShift = DerivedColumn1@Shift,\n\t\tShiftDate = DerivedColumn1@ShiftDate,\n\t\tMoveCount,\n\t\tBlock = DerivedColumn1@Block,\n\t\tHour,\n\t\tWeekofYear = DerivedColumn1@WeekofYear,\n\t\t{ecEventGkey.1} = Aggregate3@ecEventGkey,\n\t\t{ShiftDate.1} = DerivedColumn3@ShiftDate,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(TimeStamp>=LGON && TimeStamp<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp),\n\t\tLastMove = case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp),\n\t\tIdleTimeFL = case(isNull(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp))==false(),(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp)-LGON)/3600000,isNull(case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))==false(),(LGOF-case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))/3600000),\n\t\tRTGIdleTime = iif(CHE_ID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-TimeStamp)<0,0.0,toFloat((TimeStamp_NXT-TimeStamp)/3600000)),0.0),\n\t\tBayChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0),\n\t\tBayChangeCount = iif(isNull(locSlot_NXT)==true(),0,iif(iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0)==1,\r\niif(toInteger(substring(locSlot,4,2))>toInteger(substring(locSlot_NXT,4,2)),iif( \r\ntoInteger(substring(locSlot,4,2))%2==0,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2)))), \r\niif(toInteger(substring(locSlot_NXT,4,2))%2==0,toInteger(substring(locSlot,4,2))-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2)))-(toInteger(substring(locSlot_NXT,4,2)))))\r\n,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,iif(\r\n    toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2)))) \r\n,iif(toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2)))))),0)),\n\t\tBlockChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)!=left(locSlot_NXT,3),1,0),0),0),0),\n\t\tLaneChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,2)!=left(locSlot_NXT,2),1,0),0),0),0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'gold/rtg_ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tMoveCount,\n\t\tBlock,\n\t\tHour,\n\t\tWeekofYear,\n\t\t{ecEventGkey.1},\n\t\t{ShiftDate.1},\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime,\n\t\tValid,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\tlocSlot_PREV,\n\t\tlocSlot_NXT,\n\t\tecEventGkey_PREV,\n\t\tecEventGkey_NXT,\n\t\tShiftDate_PREV,\n\t\tShiftDate_NXT,\n\t\tLGON_PREV,\n\t\tLGON_NXT,\n\t\tLGOF_PREV,\n\t\tLGOF_NXT,\n\t\tFirstMove,\n\t\tLastMove,\n\t\tIdleTimeFL,\n\t\tRTGIdleTime,\n\t\tBayChangeInstance,\n\t\tBayChangeCount,\n\t\tBlockChangeInstance,\n\t\tLaneChangeInstance\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> RTG\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\tmoveKind as string,\n\t\tlocSlot as string,\n\t\tunladenLocSlot as string,\n\t\tladen_LocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tWeekofYear as integer,\n\t\tDate as date,\n\t\tTime as string,\n\t\tShiftStartTime as timestamp,\n\t\tShiftEndTime as timestamp,\n\t\tShift as integer,\n\t\tShiftDate as date,\n\t\tBlock as string,\n\t\tCHE_ID_PREV as long,\n\t\tCHE_ID_NXT as long,\n\t\tTimeStamp_PREV as timestamp,\n\t\tTimeStamp_NXT as timestamp,\n\t\teventTypeDescription_PREV as string,\n\t\teventTypeDescription_NXT as string,\n\t\tLGOF as timestamp,\n\t\tLGON as timestamp,\n\t\tWorkTime as double\n\t),\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'gold/rtg_workhours',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tWeekofYear,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tBlock,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\teventTypeDescription_PREV,\n\t\teventTypeDescription_NXT,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RTG EcEvents_gpa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "RTG"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name = cheName,\n\t\tCHE_ID = cheID,\n\t\tTimeStamp = EcEventTime,\n\t\teventType = type,\n\t\teventSubType = subType,\n\t\teventTypeDescription = typeDescription,\n\t\tunit = unitIdName,\n\t\tpow = powName,\n\t\tpool = poolName,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot = ladenLocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='RTG' && eventTypeDescription=='CMPL') ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tMoveCount = iif(moveKind=='YARD',iif(left(locSlot,5)==left(laden_LocSlot,5),2,1),1),\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(TimeStamp, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))))) ~> DerivedColumn1\nselect filter((eventTypeDescription == 'LGOF' || eventTypeDescription == 'LGON') && cheKind == 'RTG') ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tBlock = left(locSlot,3)) ~> DerivedColumn3\nSort1 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\teventTypeDescription_PREV = lag(eventTypeDescription),\n\t\teventTypeDescription_NXT = lead(eventTypeDescription)) ~> Window1\nWindow1 derive(LGOF = case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(eventTypeDescription=='LGON',TimeStamp),\n\t\tWorkTime = toDouble((case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime))-case(eventTypeDescription=='LGON',TimeStamp))/3600000)) ~> DerivedColumn4\nDerivedColumn3 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nDerivedColumn1, Filter7 join(Aggregate1@CHE_ID == Aggregate3@CHE_ID\n\t&& DerivedColumn1@ShiftStartTime == DerivedColumn3@ShiftStartTime\n\t&& DerivedColumn1@ShiftEndTime == DerivedColumn3@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tecEventGkey = Aggregate1@ecEventGkey,\n\t\tyardGkey = Aggregate1@yardGkey,\n\t\tYardID = Aggregate1@YardID,\n\t\tFcyID = Aggregate1@FcyID,\n\t\tcheKind = Aggregate1@cheKind,\n\t\tCHE_Name = Aggregate1@CHE_Name,\n\t\tCHE_ID = Aggregate1@CHE_ID,\n\t\tTimeStamp = Aggregate1@TimeStamp,\n\t\teventType = Aggregate1@eventType,\n\t\teventSubType = Aggregate1@eventSubType,\n\t\teventTypeDescription = Aggregate1@eventTypeDescription,\n\t\tunit = Aggregate1@unit,\n\t\tpow = Aggregate1@pow,\n\t\tpool = Aggregate1@pool,\n\t\tworkQueue = Aggregate1@workQueue,\n\t\tmoveKind = Aggregate1@moveKind,\n\t\tlocSlot = Aggregate1@locSlot,\n\t\tunladenLocSlot = Aggregate1@unladenLocSlot,\n\t\tladen_LocSlot = Aggregate1@laden_LocSlot,\n\t\tYear = Aggregate1@Year,\n\t\tMonth = Aggregate1@Month,\n\t\tWeek = Aggregate1@Week,\n\t\tDate = DerivedColumn1@Date,\n\t\tTime = DerivedColumn1@Time,\n\t\tShiftStartTime = DerivedColumn1@ShiftStartTime,\n\t\tShiftEndTime = DerivedColumn1@ShiftEndTime,\n\t\tShift = DerivedColumn1@Shift,\n\t\tShiftDate = DerivedColumn1@ShiftDate,\n\t\tMoveCount,\n\t\tBlock = DerivedColumn1@Block,\n\t\tHour,\n\t\tWeekofYear = DerivedColumn1@WeekofYear,\n\t\t{ecEventGkey.1} = Aggregate3@ecEventGkey,\n\t\t{ShiftDate.1} = DerivedColumn3@ShiftDate,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(TimeStamp>=LGON && TimeStamp<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp),\n\t\tLastMove = case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp),\n\t\tIdleTimeFL = case(isNull(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp))==false(),(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp)-LGON)/3600000,isNull(case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))==false(),(LGOF-case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))/3600000),\n\t\tRTGIdleTime = iif(CHE_ID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-TimeStamp)<0,0.0,toFloat((TimeStamp_NXT-TimeStamp)/3600000)),0.0),\n\t\tBayChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0),\n\t\tBayChangeCount = iif(isNull(locSlot_NXT)==true(),0,iif(iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0)==1,\r\niif(toInteger(substring(locSlot,4,2))>toInteger(substring(locSlot_NXT,4,2)),iif( \r\ntoInteger(substring(locSlot,4,2))%2==0,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2)))), \r\niif(toInteger(substring(locSlot_NXT,4,2))%2==0,toInteger(substring(locSlot,4,2))-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2)))-(toInteger(substring(locSlot_NXT,4,2)))))\r\n,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,iif(\r\n    toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2)))) \r\n,iif(toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2)))))),0)),\n\t\tBlockChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)!=left(locSlot_NXT,3),1,0),0),0),0),\n\t\tLaneChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,2)!=left(locSlot_NXT,2),1,0),0),0),0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'gold/rtg_ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tMoveCount,\n\t\tBlock,\n\t\tHour,\n\t\tWeekofYear,\n\t\t{ecEventGkey.1},\n\t\t{ShiftDate.1},\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime,\n\t\tValid,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\tlocSlot_PREV,\n\t\tlocSlot_NXT,\n\t\tecEventGkey_PREV,\n\t\tecEventGkey_NXT,\n\t\tShiftDate_PREV,\n\t\tShiftDate_NXT,\n\t\tLGON_PREV,\n\t\tLGON_NXT,\n\t\tLGOF_PREV,\n\t\tLGOF_NXT,\n\t\tFirstMove,\n\t\tLastMove,\n\t\tIdleTimeFL,\n\t\tRTGIdleTime,\n\t\tBayChangeInstance,\n\t\tBayChangeCount,\n\t\tBlockChangeInstance,\n\t\tLaneChangeInstance\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> RTG\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\tmoveKind as string,\n\t\tlocSlot as string,\n\t\tunladenLocSlot as string,\n\t\tladen_LocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tWeekofYear as integer,\n\t\tDate as date,\n\t\tTime as string,\n\t\tShiftStartTime as timestamp,\n\t\tShiftEndTime as timestamp,\n\t\tShift as integer,\n\t\tShiftDate as date,\n\t\tBlock as string,\n\t\tCHE_ID_PREV as long,\n\t\tCHE_ID_NXT as long,\n\t\tTimeStamp_PREV as timestamp,\n\t\tTimeStamp_NXT as timestamp,\n\t\teventTypeDescription_PREV as string,\n\t\teventTypeDescription_NXT as string,\n\t\tLGOF as timestamp,\n\t\tLGON as timestamp,\n\t\tWorkTime as double\n\t),\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'gold/rtg_workhours',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tWeekofYear,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tBlock,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\teventTypeDescription_PREV,\n\t\teventTypeDescription_NXT,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RTG EcEvents_mict')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "RTG"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "Workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn35"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn9"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						},
						{
							"name": "derivedColumn11"
						},
						{
							"name": "derivedColumn2"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name = cheName,\n\t\tCHE_ID = cheID,\n\t\tTimeStamp = EcEventTime,\n\t\teventType = type,\n\t\teventSubType = subType,\n\t\teventTypeDescription = typeDescription,\n\t\tunit = unitIdName,\n\t\tpow = powName,\n\t\tpool = poolName,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot = ladenLocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='RTG' && (eventTypeDescription=='CMPL' || eventTypeDescription=='ATRH')) ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('07:00:00') && toString(TimeStamp,'HH:mm:ss')<toString('19:00:00'),\r\n        toTimestamp(concat(toString(TimeStamp,'yyyy-MM-dd'),' ','07:00:00')),\r\n\t\tiif(toString(TimeStamp,'HH:mm:ss')>=toString('19:00:00') && toString(TimeStamp,'HH:mm:ss')<=toString('23:59:59'),\r\n            toTimestamp(concat(toString(TimeStamp,'yyyy-MM-dd'),' ','19:00:00')),\r\n            iif(toString(TimeStamp,'HH:mm:ss')>=toString('00:00:00') && toString(TimeStamp,'HH:mm:ss')<toString('07:00:00'),\r\n\t\t\t\ttoTimestamp(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' ','19:00:00')),\r\n                toTimestamp(concat(toString(TimeStamp,'yyyy-MM-dd'),' ','19:00:00'))))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('07:00:00') && toString(TimeStamp,'HH:mm:ss')<toString('19:00:00'),\r\n        toTimestamp(concat(toString(TimeStamp,'yyyy-MM-dd'),' ','18:59:00')),\r\n\t\tiif(toString(TimeStamp,'HH:mm:ss')>=toString('19:00:00') && toString(TimeStamp,'HH:mm:ss')<=toString('23:59:59'),\r\n            toTimestamp(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' ','06:59:59')),\r\n            iif(toString(TimeStamp,'HH:mm:ss')>=toString('00:00:00') && toString(TimeStamp,'HH:mm:ss')<toString('07:00:00'),\r\n\t\t\t\ttoTimestamp(concat(toString(TimeStamp,'yyyy-MM-dd'),' ','19:00:00')),\r\n                toTimestamp(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' ','19:00:00'))))),\n\t\tMoveCount = iif(moveKind=='YARD',iif(left(locSlot,5)==left(laden_LocSlot,5),2,1),1),\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(TimeStamp, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))))) ~> DerivedColumn35\nselect filter((eventTypeDescription == 'LGOF' || eventTypeDescription == 'LGON') && cheKind == 'RTG') ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('07:00:00') && toString(TimeStamp,'HH:mm:ss')<toString('19:00:00'),\r\n        toTimestamp(concat(toString(TimeStamp,'yyyy-MM-dd'),' ','07:00:00')),\r\n\t\tiif(toString(TimeStamp,'HH:mm:ss')>=toString('19:00:00') && toString(TimeStamp,'HH:mm:ss')<=toString('23:59:59'),\r\n            toTimestamp(concat(toString(TimeStamp,'yyyy-MM-dd'),' ','19:00:00')),\r\n            iif(toString(TimeStamp,'HH:mm:ss')>=toString('00:00:00') && toString(TimeStamp,'HH:mm:ss')<toString('07:00:00'),\r\n\t\t\t\ttoTimestamp(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' ','19:00:00')),\r\n                toTimestamp(concat(toString(TimeStamp,'yyyy-MM-dd'),' ','19:00:00'))))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('07:00:00') && toString(TimeStamp,'HH:mm:ss')<toString('19:00:00'),\r\n        toTimestamp(concat(toString(TimeStamp,'yyyy-MM-dd'),' ','18:59:00')),\r\n\t\tiif(toString(TimeStamp,'HH:mm:ss')>=toString('19:00:00') && toString(TimeStamp,'HH:mm:ss')<=toString('23:59:59'),\r\n            toTimestamp(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' ','06:59:59')),\r\n            iif(toString(TimeStamp,'HH:mm:ss')>=toString('00:00:00') && toString(TimeStamp,'HH:mm:ss')<toString('07:00:00'),\r\n\t\t\t\ttoTimestamp(concat(toString(TimeStamp,'yyyy-MM-dd'),' ','19:00:00')),\r\n                toTimestamp(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' ','19:00:00'))))),\n\t\tBlock = left(locSlot,3)) ~> DerivedColumn9\nSort1 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\teventTypeDescription_PREV = lag(eventTypeDescription),\n\t\teventTypeDescription_NXT = lead(eventTypeDescription)) ~> Window1\nWindow1 derive(LGOF = case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(eventTypeDescription=='LGON',TimeStamp),\n\t\tWorkTime = toDouble((case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime))-case(eventTypeDescription=='LGON',TimeStamp))/3600000)) ~> DerivedColumn4\nderivedColumn11 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nderivedColumn2, Filter7 join(Aggregate1@CHE_ID == Aggregate3@CHE_ID\n\t&& DerivedColumn35@ShiftStartTime == DerivedColumn35@ShiftStartTime\n\t&& DerivedColumn35@ShiftEndTime == DerivedColumn35@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'right')~> Join1\nJoin1 select(mapColumn(\n\t\teach(match(/* All input columns */true()),\n\t\t\t/* Input name */$$ = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(TimeStamp>=LGON && TimeStamp<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp),\n\t\tLastMove = case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp),\n\t\tIdleTimeFL = case(isNull(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp))==false(),(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp)-LGON)/3600000,isNull(case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))==false(),(LGOF-case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))/3600000),\n\t\tRTGIdleTime = iif(CHE_ID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-TimeStamp)<0,0.0,toFloat((TimeStamp_NXT-TimeStamp)/3600000)),0.0),\n\t\tBayChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0),\n\t\tBayChangeCount = iif(isNull(locSlot_NXT)==true(),0,iif(iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0)==1,\r\niif(toInteger(substring(locSlot,4,2))>toInteger(substring(locSlot_NXT,4,2)),iif( \r\ntoInteger(substring(locSlot,4,2))%2==0,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2)))), \r\niif(toInteger(substring(locSlot_NXT,4,2))%2==0,toInteger(substring(locSlot,4,2))-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2)))-(toInteger(substring(locSlot_NXT,4,2)))))\r\n,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,iif(\r\n    toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2)))) \r\n,iif(toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2)))))),0)),\n\t\tBlockChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)!=left(locSlot_NXT,3),1,0),0),0),0),\n\t\tLaneChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,2)!=left(locSlot_NXT,2),1,0),0),0),0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nDerivedColumn9 derive(Shift = iif(toString(ShiftStartTime, 'HH:mm:ss')==toString('07:00:00'),\"Day\",iif(toString(ShiftStartTime, 'HH:mm:ss')==toString('19:00:00'),\"Night\",\"Day\")),\n\t\tShiftDate = iif(Time<toString('07:00:00'),subDays(Date,1),Date)) ~> derivedColumn11\nDerivedColumn35 derive(Shift = iif(toString(ShiftStartTime, 'HH:mm:ss')==toString('07:00:00'),\"Day\",iif(toString(ShiftStartTime, 'HH:mm:ss')==toString('19:00:00'),\"Night\",\"Day\")),\n\t\tShiftDate = iif(Time<toString('07:00:00'),subDays(Date,1),Date)) ~> derivedColumn2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'gold/rtg_ecevent',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\teach(match(/* All input columns */true()),\n\t\t\t/* Input name */$$ = $$)\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> RTG\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'gold/rtg_workhours',\n\tmergeSchema: false,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> Workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]",
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RTG EcEvents_mict_new')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "RTG"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "Workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn35"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn9"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						},
						{
							"name": "derivedColumn11"
						},
						{
							"name": "derivedColumn2"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name = cheName,\n\t\tCHE_ID = cheID,\n\t\tTimeStamp = EcEventTime,\n\t\teventType = type,\n\t\teventSubType = subType,\n\t\teventTypeDescription = typeDescription,\n\t\tunit = unitIdName,\n\t\tpow = powName,\n\t\tpool = poolName,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot = ladenLocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='RTG' && (eventTypeDescription=='CMPL' || eventTypeDescription=='ATRH')) ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('07:00:00') && toString(TimeStamp,'HH:mm:ss')<toString('19:00:00'),\r\n        toTimestamp(concat(toString(TimeStamp,'yyyy-MM-dd'),' ','07:00:00')),\r\n\t\tiif(toString(TimeStamp,'HH:mm:ss')>=toString('19:00:00') && toString(TimeStamp,'HH:mm:ss')<=toString('23:59:59'),\r\n            toTimestamp(concat(toString(TimeStamp,'yyyy-MM-dd'),' ','19:00:00')),\r\n            iif(toString(TimeStamp,'HH:mm:ss')>=toString('00:00:00') && toString(TimeStamp,'HH:mm:ss')<toString('07:00:00'),\r\n\t\t\t\ttoTimestamp(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' ','19:00:00')),\r\n                toTimestamp(concat(toString(TimeStamp,'yyyy-MM-dd'),' ','19:00:00'))))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('07:00:00') && toString(TimeStamp,'HH:mm:ss')<toString('19:00:00'),\r\n        toTimestamp(concat(toString(TimeStamp,'yyyy-MM-dd'),' ','18:59:00')),\r\n\t\tiif(toString(TimeStamp,'HH:mm:ss')>=toString('19:00:00') && toString(TimeStamp,'HH:mm:ss')<=toString('23:59:59'),\r\n            toTimestamp(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' ','06:59:59')),\r\n            iif(toString(TimeStamp,'HH:mm:ss')>=toString('00:00:00') && toString(TimeStamp,'HH:mm:ss')<toString('07:00:00'),\r\n\t\t\t\ttoTimestamp(concat(toString(TimeStamp,'yyyy-MM-dd'),' ','19:00:00')),\r\n                toTimestamp(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' ','19:00:00'))))),\n\t\tMoveCount = iif(moveKind=='YARD',iif(left(locSlot,5)==left(laden_LocSlot,5),2,1),1),\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(TimeStamp, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))))) ~> DerivedColumn35\nselect filter((eventTypeDescription == 'LGOF' || eventTypeDescription == 'LGON') && cheKind == 'RTG') ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('07:00:00') && toString(TimeStamp,'HH:mm:ss')<toString('19:00:00'),\r\n        toTimestamp(concat(toString(TimeStamp,'yyyy-MM-dd'),' ','07:00:00')),\r\n\t\tiif(toString(TimeStamp,'HH:mm:ss')>=toString('19:00:00') && toString(TimeStamp,'HH:mm:ss')<=toString('23:59:59'),\r\n            toTimestamp(concat(toString(TimeStamp,'yyyy-MM-dd'),' ','19:00:00')),\r\n            iif(toString(TimeStamp,'HH:mm:ss')>=toString('00:00:00') && toString(TimeStamp,'HH:mm:ss')<toString('07:00:00'),\r\n\t\t\t\ttoTimestamp(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' ','19:00:00')),\r\n                toTimestamp(concat(toString(TimeStamp,'yyyy-MM-dd'),' ','19:00:00'))))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('07:00:00') && toString(TimeStamp,'HH:mm:ss')<toString('19:00:00'),\r\n        toTimestamp(concat(toString(TimeStamp,'yyyy-MM-dd'),' ','18:59:00')),\r\n\t\tiif(toString(TimeStamp,'HH:mm:ss')>=toString('19:00:00') && toString(TimeStamp,'HH:mm:ss')<=toString('23:59:59'),\r\n            toTimestamp(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' ','06:59:59')),\r\n            iif(toString(TimeStamp,'HH:mm:ss')>=toString('00:00:00') && toString(TimeStamp,'HH:mm:ss')<toString('07:00:00'),\r\n\t\t\t\ttoTimestamp(concat(toString(TimeStamp,'yyyy-MM-dd'),' ','19:00:00')),\r\n                toTimestamp(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' ','19:00:00'))))),\n\t\tBlock = left(locSlot,3)) ~> DerivedColumn9\nSort1 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\teventTypeDescription_PREV = lag(eventTypeDescription),\n\t\teventTypeDescription_NXT = lead(eventTypeDescription)) ~> Window1\nWindow1 derive(LGOF = case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(eventTypeDescription=='LGON',TimeStamp),\n\t\tWorkTime = toDouble((case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime))-case(eventTypeDescription=='LGON',TimeStamp))/3600000)) ~> DerivedColumn4\nderivedColumn11 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nderivedColumn2, Filter7 join(Aggregate1@CHE_ID == Aggregate3@CHE_ID\n\t&& DerivedColumn35@ShiftStartTime == DerivedColumn35@ShiftStartTime\n\t&& DerivedColumn35@ShiftEndTime == DerivedColumn35@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'right')~> Join1\nJoin1 select(mapColumn(\n\t\teach(match(/* All input columns */true()),\n\t\t\t/* Input name */$$ = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(TimeStamp>=LGON && TimeStamp<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp),\n\t\tLastMove = case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp),\n\t\tIdleTimeFL = case(isNull(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp))==false(),(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp)-LGON)/3600000,isNull(case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))==false(),(LGOF-case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))/3600000),\n\t\tRTGIdleTime = iif(CHE_ID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-TimeStamp)<0,0.0,toFloat((TimeStamp_NXT-TimeStamp)/3600000)),0.0),\n\t\tBayChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0),\n\t\tBayChangeCount = iif(isNull(locSlot_NXT)==true(),0,iif(iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0)==1,\r\niif(toInteger(substring(locSlot,4,2))>toInteger(substring(locSlot_NXT,4,2)),iif( \r\ntoInteger(substring(locSlot,4,2))%2==0,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2)))), \r\niif(toInteger(substring(locSlot_NXT,4,2))%2==0,toInteger(substring(locSlot,4,2))-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2)))-(toInteger(substring(locSlot_NXT,4,2)))))\r\n,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,iif(\r\n    toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2)))) \r\n,iif(toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2)))))),0)),\n\t\tBlockChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)!=left(locSlot_NXT,3),1,0),0),0),0),\n\t\tLaneChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,2)!=left(locSlot_NXT,2),1,0),0),0),0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nDerivedColumn9 derive(Shift = iif(toString(ShiftStartTime, 'HH:mm:ss')==toString('07:00:00'),\"Day\",iif(toString(ShiftStartTime, 'HH:mm:ss')==toString('19:00:00'),\"Night\",\"Day\")),\n\t\tShiftDate = iif(Time<toString('07:00:00'),subDays(Date,1),Date)) ~> derivedColumn11\nDerivedColumn35 derive(Shift = iif(toString(ShiftStartTime, 'HH:mm:ss')==toString('07:00:00'),\"Day\",iif(toString(ShiftStartTime, 'HH:mm:ss')==toString('19:00:00'),\"Night\",\"Day\")),\n\t\tShiftDate = iif(Time<toString('07:00:00'),subDays(Date,1),Date)) ~> derivedColumn2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'gold/rtg_ecevent',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\teach(match(/* All input columns */true()),\n\t\t\t/* Input name */$$ = $$)\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> RTG\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'gold/rtg_workhours',\n\tmergeSchema: false,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> Workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]",
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RTG EcEvents_mnhpi')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "RTG"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name = cheName,\n\t\tCHE_ID = cheID,\n\t\tTimeStamp = EcEventTime,\n\t\teventType = type,\n\t\teventSubType = subType,\n\t\teventTypeDescription = typeDescription,\n\t\tunit = unitIdName,\n\t\tpow = powName,\n\t\tpool = poolName,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot = ladenLocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='RTG' && eventTypeDescription=='CMPL') ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tMoveCount = iif(moveKind=='YARD',iif(left(locSlot,5)==left(laden_LocSlot,5),2,1),1),\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(TimeStamp, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))))) ~> DerivedColumn1\nselect filter((eventTypeDescription == 'LGOF' || eventTypeDescription == 'LGON') && cheKind == 'RTG') ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tBlock = left(locSlot,3)) ~> DerivedColumn3\nSort1 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\teventTypeDescription_PREV = lag(eventTypeDescription),\n\t\teventTypeDescription_NXT = lead(eventTypeDescription)) ~> Window1\nWindow1 derive(LGOF = case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(eventTypeDescription=='LGON',TimeStamp),\n\t\tWorkTime = toDouble((case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime))-case(eventTypeDescription=='LGON',TimeStamp))/3600000)) ~> DerivedColumn4\nDerivedColumn3 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nDerivedColumn1, Filter7 join(Aggregate1@CHE_ID == Aggregate3@CHE_ID\n\t&& DerivedColumn1@ShiftStartTime == DerivedColumn3@ShiftStartTime\n\t&& DerivedColumn1@ShiftEndTime == DerivedColumn3@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tecEventGkey = Aggregate1@ecEventGkey,\n\t\tyardGkey = Aggregate1@yardGkey,\n\t\tYardID = Aggregate1@YardID,\n\t\tFcyID = Aggregate1@FcyID,\n\t\tcheKind = Aggregate1@cheKind,\n\t\tCHE_Name = Aggregate1@CHE_Name,\n\t\tCHE_ID = Aggregate1@CHE_ID,\n\t\tTimeStamp = Aggregate1@TimeStamp,\n\t\teventType = Aggregate1@eventType,\n\t\teventSubType = Aggregate1@eventSubType,\n\t\teventTypeDescription = Aggregate1@eventTypeDescription,\n\t\tunit = Aggregate1@unit,\n\t\tpow = Aggregate1@pow,\n\t\tpool = Aggregate1@pool,\n\t\tworkQueue = Aggregate1@workQueue,\n\t\tmoveKind = Aggregate1@moveKind,\n\t\tlocSlot = Aggregate1@locSlot,\n\t\tunladenLocSlot = Aggregate1@unladenLocSlot,\n\t\tladen_LocSlot = Aggregate1@laden_LocSlot,\n\t\tYear = Aggregate1@Year,\n\t\tMonth = Aggregate1@Month,\n\t\tWeek = Aggregate1@Week,\n\t\tDate = DerivedColumn1@Date,\n\t\tTime = DerivedColumn1@Time,\n\t\tShiftStartTime = DerivedColumn1@ShiftStartTime,\n\t\tShiftEndTime = DerivedColumn1@ShiftEndTime,\n\t\tShift = DerivedColumn1@Shift,\n\t\tShiftDate = DerivedColumn1@ShiftDate,\n\t\tMoveCount,\n\t\tBlock = DerivedColumn1@Block,\n\t\tHour,\n\t\tWeekofYear = DerivedColumn1@WeekofYear,\n\t\t{ecEventGkey.1} = Aggregate3@ecEventGkey,\n\t\t{ShiftDate.1} = DerivedColumn3@ShiftDate,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(TimeStamp>=LGON && TimeStamp<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp),\n\t\tLastMove = case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp),\n\t\tIdleTimeFL = case(isNull(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp))==false(),(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp)-LGON)/3600000,isNull(case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))==false(),(LGOF-case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))/3600000),\n\t\tRTGIdleTime = iif(CHE_ID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-TimeStamp)<0,0.0,toFloat((TimeStamp_NXT-TimeStamp)/3600000)),0.0),\n\t\tBayChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0),\n\t\tBayChangeCount = iif(isNull(locSlot_NXT)==true(),0,iif(iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0)==1,\r\niif(toInteger(substring(locSlot,4,2))>toInteger(substring(locSlot_NXT,4,2)),iif( \r\ntoInteger(substring(locSlot,4,2))%2==0,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2)))), \r\niif(toInteger(substring(locSlot_NXT,4,2))%2==0,toInteger(substring(locSlot,4,2))-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2)))-(toInteger(substring(locSlot_NXT,4,2)))))\r\n,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,iif(\r\n    toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2)))) \r\n,iif(toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2)))))),0)),\n\t\tBlockChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)!=left(locSlot_NXT,3),1,0),0),0),0),\n\t\tLaneChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,2)!=left(locSlot_NXT,2),1,0),0),0),0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'gold/rtg_ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tMoveCount,\n\t\tBlock,\n\t\tHour,\n\t\tWeekofYear,\n\t\t{ecEventGkey.1},\n\t\t{ShiftDate.1},\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime,\n\t\tValid,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\tlocSlot_PREV,\n\t\tlocSlot_NXT,\n\t\tecEventGkey_PREV,\n\t\tecEventGkey_NXT,\n\t\tShiftDate_PREV,\n\t\tShiftDate_NXT,\n\t\tLGON_PREV,\n\t\tLGON_NXT,\n\t\tLGOF_PREV,\n\t\tLGOF_NXT,\n\t\tFirstMove,\n\t\tLastMove,\n\t\tIdleTimeFL,\n\t\tRTGIdleTime,\n\t\tBayChangeInstance,\n\t\tBayChangeCount,\n\t\tBlockChangeInstance,\n\t\tLaneChangeInstance\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> RTG\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\tmoveKind as string,\n\t\tlocSlot as string,\n\t\tunladenLocSlot as string,\n\t\tladen_LocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tWeekofYear as integer,\n\t\tDate as date,\n\t\tTime as string,\n\t\tShiftStartTime as timestamp,\n\t\tShiftEndTime as timestamp,\n\t\tShift as integer,\n\t\tShiftDate as date,\n\t\tBlock as string,\n\t\tCHE_ID_PREV as long,\n\t\tCHE_ID_NXT as long,\n\t\tTimeStamp_PREV as timestamp,\n\t\tTimeStamp_NXT as timestamp,\n\t\teventTypeDescription_PREV as string,\n\t\teventTypeDescription_NXT as string,\n\t\tLGOF as timestamp,\n\t\tLGON as timestamp,\n\t\tWorkTime as double\n\t),\n\tformat: 'delta',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'gold/rtg_workhours',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tWeekofYear,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tBlock,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\teventTypeDescription_PREV,\n\t\teventTypeDescription_NXT,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RTG EcEvents_pdports')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "RTG"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'pdports',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name = cheName,\n\t\tCHE_ID = cheID,\n\t\tTimeStamp = EcEventTime,\n\t\teventType = type,\n\t\teventSubType = subType,\n\t\teventTypeDescription = typeDescription,\n\t\tunit = unitIdName,\n\t\tpow = powName,\n\t\tpool = poolName,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot = ladenLocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='RTG' && eventTypeDescription=='CMPL') ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tMoveCount = iif(moveKind=='YARD',iif(left(locSlot,5)==left(laden_LocSlot,5),2,1),1),\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(TimeStamp, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))))) ~> DerivedColumn1\nselect filter((eventTypeDescription == 'LGOF' || eventTypeDescription == 'LGON') && cheKind == 'RTG') ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tBlock = left(locSlot,3)) ~> DerivedColumn3\nSort1 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\teventTypeDescription_PREV = lag(eventTypeDescription),\n\t\teventTypeDescription_NXT = lead(eventTypeDescription)) ~> Window1\nWindow1 derive(LGOF = case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(eventTypeDescription=='LGON',TimeStamp),\n\t\tWorkTime = toDouble((case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime))-case(eventTypeDescription=='LGON',TimeStamp))/3600000)) ~> DerivedColumn4\nDerivedColumn3 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nDerivedColumn1, Filter7 join(Aggregate1@CHE_ID == Aggregate3@CHE_ID\n\t&& DerivedColumn1@ShiftStartTime == DerivedColumn3@ShiftStartTime\n\t&& DerivedColumn1@ShiftEndTime == DerivedColumn3@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tecEventGkey = Aggregate1@ecEventGkey,\n\t\tyardGkey = Aggregate1@yardGkey,\n\t\tYardID = Aggregate1@YardID,\n\t\tFcyID = Aggregate1@FcyID,\n\t\tcheKind = Aggregate1@cheKind,\n\t\tCHE_Name = Aggregate1@CHE_Name,\n\t\tCHE_ID = Aggregate1@CHE_ID,\n\t\tTimeStamp = Aggregate1@TimeStamp,\n\t\teventType = Aggregate1@eventType,\n\t\teventSubType = Aggregate1@eventSubType,\n\t\teventTypeDescription = Aggregate1@eventTypeDescription,\n\t\tunit = Aggregate1@unit,\n\t\tpow = Aggregate1@pow,\n\t\tpool = Aggregate1@pool,\n\t\tworkQueue = Aggregate1@workQueue,\n\t\tmoveKind = Aggregate1@moveKind,\n\t\tlocSlot = Aggregate1@locSlot,\n\t\tunladenLocSlot = Aggregate1@unladenLocSlot,\n\t\tladen_LocSlot = Aggregate1@laden_LocSlot,\n\t\tYear = Aggregate1@Year,\n\t\tMonth = Aggregate1@Month,\n\t\tWeek = Aggregate1@Week,\n\t\tDate = DerivedColumn1@Date,\n\t\tTime = DerivedColumn1@Time,\n\t\tShiftStartTime = DerivedColumn1@ShiftStartTime,\n\t\tShiftEndTime = DerivedColumn1@ShiftEndTime,\n\t\tShift = DerivedColumn1@Shift,\n\t\tShiftDate = DerivedColumn1@ShiftDate,\n\t\tMoveCount,\n\t\tBlock = DerivedColumn1@Block,\n\t\tHour,\n\t\tWeekofYear = DerivedColumn1@WeekofYear,\n\t\t{ecEventGkey.1} = Aggregate3@ecEventGkey,\n\t\t{ShiftDate.1} = DerivedColumn3@ShiftDate,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(TimeStamp>=LGON && TimeStamp<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp),\n\t\tLastMove = case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp),\n\t\tIdleTimeFL = case(isNull(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp))==false(),(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp)-LGON)/3600000,isNull(case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))==false(),(LGOF-case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))/3600000),\n\t\tRTGIdleTime = iif(CHE_ID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-TimeStamp)<0,0.0,toFloat((TimeStamp_NXT-TimeStamp)/3600000)),0.0),\n\t\tBayChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0),\n\t\tBayChangeCount = iif(isNull(locSlot_NXT)==true(),0,iif(iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0)==1,\r\niif(toInteger(substring(locSlot,4,2))>toInteger(substring(locSlot_NXT,4,2)),iif( \r\ntoInteger(substring(locSlot,4,2))%2==0,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2)))), \r\niif(toInteger(substring(locSlot_NXT,4,2))%2==0,toInteger(substring(locSlot,4,2))-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2)))-(toInteger(substring(locSlot_NXT,4,2)))))\r\n,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,iif(\r\n    toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2)))) \r\n,iif(toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2)))))),0)),\n\t\tBlockChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)!=left(locSlot_NXT,3),1,0),0),0),0),\n\t\tLaneChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,2)!=left(locSlot_NXT,2),1,0),0),0),0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'pdports',\n\tfolderPath: 'gold/rtg_ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tMoveCount,\n\t\tBlock,\n\t\tHour,\n\t\tWeekofYear,\n\t\t{ecEventGkey.1},\n\t\t{ShiftDate.1},\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime,\n\t\tValid,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\tlocSlot_PREV,\n\t\tlocSlot_NXT,\n\t\tecEventGkey_PREV,\n\t\tecEventGkey_NXT,\n\t\tShiftDate_PREV,\n\t\tShiftDate_NXT,\n\t\tLGON_PREV,\n\t\tLGON_NXT,\n\t\tLGOF_PREV,\n\t\tLGOF_NXT,\n\t\tFirstMove,\n\t\tLastMove,\n\t\tIdleTimeFL,\n\t\tRTGIdleTime,\n\t\tBayChangeInstance,\n\t\tBayChangeCount,\n\t\tBlockChangeInstance,\n\t\tLaneChangeInstance\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> RTG\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\tmoveKind as string,\n\t\tlocSlot as string,\n\t\tunladenLocSlot as string,\n\t\tladen_LocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tWeekofYear as integer,\n\t\tDate as date,\n\t\tTime as string,\n\t\tShiftStartTime as timestamp,\n\t\tShiftEndTime as timestamp,\n\t\tShift as integer,\n\t\tShiftDate as date,\n\t\tBlock as string,\n\t\tCHE_ID_PREV as long,\n\t\tCHE_ID_NXT as long,\n\t\tTimeStamp_PREV as timestamp,\n\t\tTimeStamp_NXT as timestamp,\n\t\teventTypeDescription_PREV as string,\n\t\teventTypeDescription_NXT as string,\n\t\tLGOF as timestamp,\n\t\tLGON as timestamp,\n\t\tWorkTime as double\n\t),\n\tformat: 'delta',\n\tfileSystem: 'pdports',\n\tfolderPath: 'gold/rtg_workhours',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tWeekofYear,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tBlock,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\teventTypeDescription_PREV,\n\t\teventTypeDescription_NXT,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RTG EcEvents_plipdeco')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "RTG"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'plipdeco',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name = cheName,\n\t\tCHE_ID = cheID,\n\t\tTimeStamp = EcEventTime,\n\t\teventType = type,\n\t\teventSubType = subType,\n\t\teventTypeDescription = typeDescription,\n\t\tunit = unitIdName,\n\t\tpow = powName,\n\t\tpool = poolName,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot = ladenLocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='RTG' && eventTypeDescription=='CMPL') ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tMoveCount = iif(moveKind=='YARD',iif(left(locSlot,5)==left(laden_LocSlot,5),2,1),1),\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(TimeStamp, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))))) ~> DerivedColumn1\nselect filter((eventTypeDescription == 'LGOF' || eventTypeDescription == 'LGON') && cheKind == 'RTG') ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tBlock = left(locSlot,3)) ~> DerivedColumn3\nSort1 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\teventTypeDescription_PREV = lag(eventTypeDescription),\n\t\teventTypeDescription_NXT = lead(eventTypeDescription)) ~> Window1\nWindow1 derive(LGOF = case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(eventTypeDescription=='LGON',TimeStamp),\n\t\tWorkTime = toDouble((case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime))-case(eventTypeDescription=='LGON',TimeStamp))/3600000)) ~> DerivedColumn4\nDerivedColumn3 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nDerivedColumn1, Filter7 join(Aggregate1@CHE_ID == Aggregate3@CHE_ID\n\t&& DerivedColumn1@ShiftStartTime == DerivedColumn3@ShiftStartTime\n\t&& DerivedColumn1@ShiftEndTime == DerivedColumn3@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tecEventGkey = Aggregate1@ecEventGkey,\n\t\tyardGkey = Aggregate1@yardGkey,\n\t\tYardID = Aggregate1@YardID,\n\t\tFcyID = Aggregate1@FcyID,\n\t\tcheKind = Aggregate1@cheKind,\n\t\tCHE_Name = Aggregate1@CHE_Name,\n\t\tCHE_ID = Aggregate1@CHE_ID,\n\t\tTimeStamp = Aggregate1@TimeStamp,\n\t\teventType = Aggregate1@eventType,\n\t\teventSubType = Aggregate1@eventSubType,\n\t\teventTypeDescription = Aggregate1@eventTypeDescription,\n\t\tunit = Aggregate1@unit,\n\t\tpow = Aggregate1@pow,\n\t\tpool = Aggregate1@pool,\n\t\tworkQueue = Aggregate1@workQueue,\n\t\tmoveKind = Aggregate1@moveKind,\n\t\tlocSlot = Aggregate1@locSlot,\n\t\tunladenLocSlot = Aggregate1@unladenLocSlot,\n\t\tladen_LocSlot = Aggregate1@laden_LocSlot,\n\t\tYear = Aggregate1@Year,\n\t\tMonth = Aggregate1@Month,\n\t\tWeek = Aggregate1@Week,\n\t\tDate = DerivedColumn1@Date,\n\t\tTime = DerivedColumn1@Time,\n\t\tShiftStartTime = DerivedColumn1@ShiftStartTime,\n\t\tShiftEndTime = DerivedColumn1@ShiftEndTime,\n\t\tShift = DerivedColumn1@Shift,\n\t\tShiftDate = DerivedColumn1@ShiftDate,\n\t\tMoveCount,\n\t\tBlock = DerivedColumn1@Block,\n\t\tHour,\n\t\tWeekofYear = DerivedColumn1@WeekofYear,\n\t\t{ecEventGkey.1} = Aggregate3@ecEventGkey,\n\t\t{ShiftDate.1} = DerivedColumn3@ShiftDate,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(TimeStamp>=LGON && TimeStamp<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp),\n\t\tLastMove = case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp),\n\t\tIdleTimeFL = case(isNull(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp))==false(),(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp)-LGON)/3600000,isNull(case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))==false(),(LGOF-case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))/3600000),\n\t\tRTGIdleTime = iif(CHE_ID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-TimeStamp)<0,0.0,toFloat((TimeStamp_NXT-TimeStamp)/3600000)),0.0),\n\t\tBayChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0),\n\t\tBayChangeCount = iif(isNull(locSlot_NXT)==true(),0,iif(iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0)==1,\r\niif(toInteger(substring(locSlot,4,2))>toInteger(substring(locSlot_NXT,4,2)),iif( \r\ntoInteger(substring(locSlot,4,2))%2==0,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2)))), \r\niif(toInteger(substring(locSlot_NXT,4,2))%2==0,toInteger(substring(locSlot,4,2))-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2)))-(toInteger(substring(locSlot_NXT,4,2)))))\r\n,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,iif(\r\n    toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2)))) \r\n,iif(toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2)))))),0)),\n\t\tBlockChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)!=left(locSlot_NXT,3),1,0),0),0),0),\n\t\tLaneChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,2)!=left(locSlot_NXT,2),1,0),0),0),0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'plipdeco',\n\tfolderPath: 'gold/rtg_ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tMoveCount,\n\t\tBlock,\n\t\tHour,\n\t\tWeekofYear,\n\t\t{ecEventGkey.1},\n\t\t{ShiftDate.1},\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime,\n\t\tValid,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\tlocSlot_PREV,\n\t\tlocSlot_NXT,\n\t\tecEventGkey_PREV,\n\t\tecEventGkey_NXT,\n\t\tShiftDate_PREV,\n\t\tShiftDate_NXT,\n\t\tLGON_PREV,\n\t\tLGON_NXT,\n\t\tLGOF_PREV,\n\t\tLGOF_NXT,\n\t\tFirstMove,\n\t\tLastMove,\n\t\tIdleTimeFL,\n\t\tRTGIdleTime,\n\t\tBayChangeInstance,\n\t\tBayChangeCount,\n\t\tBlockChangeInstance,\n\t\tLaneChangeInstance\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> RTG\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\tmoveKind as string,\n\t\tlocSlot as string,\n\t\tunladenLocSlot as string,\n\t\tladen_LocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tWeekofYear as integer,\n\t\tDate as date,\n\t\tTime as string,\n\t\tShiftStartTime as timestamp,\n\t\tShiftEndTime as timestamp,\n\t\tShift as integer,\n\t\tShiftDate as date,\n\t\tBlock as string,\n\t\tCHE_ID_PREV as long,\n\t\tCHE_ID_NXT as long,\n\t\tTimeStamp_PREV as timestamp,\n\t\tTimeStamp_NXT as timestamp,\n\t\teventTypeDescription_PREV as string,\n\t\teventTypeDescription_NXT as string,\n\t\tLGOF as timestamp,\n\t\tLGON as timestamp,\n\t\tWorkTime as double\n\t),\n\tformat: 'delta',\n\tfileSystem: 'plipdeco',\n\tfolderPath: 'gold/rtg_workhours',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tWeekofYear,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tBlock,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\teventTypeDescription_PREV,\n\t\teventTypeDescription_NXT,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RTG EcEvents_salalah')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "RTG"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'salalah',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name = cheName,\n\t\tCHE_ID = cheID,\n\t\tTimeStamp = EcEventTime,\n\t\teventType = type,\n\t\teventSubType = subType,\n\t\teventTypeDescription = typeDescription,\n\t\tunit = unitIdName,\n\t\tpow = powName,\n\t\tpool = poolName,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot = ladenLocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='RTG' && eventTypeDescription=='CMPL') ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tMoveCount = iif(moveKind=='YARD',iif(left(locSlot,5)==left(laden_LocSlot,5),2,1),1),\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(TimeStamp, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))))) ~> DerivedColumn1\nselect filter((eventTypeDescription == 'LGOF' || eventTypeDescription == 'LGON') && cheKind == 'RTG') ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tBlock = left(locSlot,3)) ~> DerivedColumn3\nSort1 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\teventTypeDescription_PREV = lag(eventTypeDescription),\n\t\teventTypeDescription_NXT = lead(eventTypeDescription)) ~> Window1\nWindow1 derive(LGOF = case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(eventTypeDescription=='LGON',TimeStamp),\n\t\tWorkTime = toDouble((case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime))-case(eventTypeDescription=='LGON',TimeStamp))/3600000)) ~> DerivedColumn4\nDerivedColumn3 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nDerivedColumn1, Filter7 join(Aggregate1@CHE_ID == Aggregate3@CHE_ID\n\t&& DerivedColumn1@ShiftStartTime == DerivedColumn3@ShiftStartTime\n\t&& DerivedColumn1@ShiftEndTime == DerivedColumn3@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tecEventGkey = Aggregate1@ecEventGkey,\n\t\tyardGkey = Aggregate1@yardGkey,\n\t\tYardID = Aggregate1@YardID,\n\t\tFcyID = Aggregate1@FcyID,\n\t\tcheKind = Aggregate1@cheKind,\n\t\tCHE_Name = Aggregate1@CHE_Name,\n\t\tCHE_ID = Aggregate1@CHE_ID,\n\t\tTimeStamp = Aggregate1@TimeStamp,\n\t\teventType = Aggregate1@eventType,\n\t\teventSubType = Aggregate1@eventSubType,\n\t\teventTypeDescription = Aggregate1@eventTypeDescription,\n\t\tunit = Aggregate1@unit,\n\t\tpow = Aggregate1@pow,\n\t\tpool = Aggregate1@pool,\n\t\tworkQueue = Aggregate1@workQueue,\n\t\tmoveKind = Aggregate1@moveKind,\n\t\tlocSlot = Aggregate1@locSlot,\n\t\tunladenLocSlot = Aggregate1@unladenLocSlot,\n\t\tladen_LocSlot = Aggregate1@laden_LocSlot,\n\t\tYear = Aggregate1@Year,\n\t\tMonth = Aggregate1@Month,\n\t\tWeek = Aggregate1@Week,\n\t\tDate = DerivedColumn1@Date,\n\t\tTime = DerivedColumn1@Time,\n\t\tShiftStartTime = DerivedColumn1@ShiftStartTime,\n\t\tShiftEndTime = DerivedColumn1@ShiftEndTime,\n\t\tShift = DerivedColumn1@Shift,\n\t\tShiftDate = DerivedColumn1@ShiftDate,\n\t\tMoveCount,\n\t\tBlock = DerivedColumn1@Block,\n\t\tHour,\n\t\tWeekofYear = DerivedColumn1@WeekofYear,\n\t\t{ecEventGkey.1} = Aggregate3@ecEventGkey,\n\t\t{ShiftDate.1} = DerivedColumn3@ShiftDate,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(TimeStamp>=LGON && TimeStamp<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp),\n\t\tLastMove = case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp),\n\t\tIdleTimeFL = case(isNull(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp))==false(),(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp)-LGON)/3600000,isNull(case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))==false(),(LGOF-case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))/3600000),\n\t\tRTGIdleTime = iif(CHE_ID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-TimeStamp)<0,0.0,toFloat((TimeStamp_NXT-TimeStamp)/3600000)),0.0),\n\t\tBayChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0),\n\t\tBayChangeCount = iif(isNull(locSlot_NXT)==true(),0,iif(iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0)==1,\r\niif(toInteger(substring(locSlot,4,2))>toInteger(substring(locSlot_NXT,4,2)),iif( \r\ntoInteger(substring(locSlot,4,2))%2==0,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2)))), \r\niif(toInteger(substring(locSlot_NXT,4,2))%2==0,toInteger(substring(locSlot,4,2))-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2)))-(toInteger(substring(locSlot_NXT,4,2)))))\r\n,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,iif(\r\n    toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2)))) \r\n,iif(toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2)))))),0)),\n\t\tBlockChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)!=left(locSlot_NXT,3),1,0),0),0),0),\n\t\tLaneChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,2)!=left(locSlot_NXT,2),1,0),0),0),0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'salalah',\n\tfolderPath: 'gold/rtg_ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tMoveCount,\n\t\tBlock,\n\t\tHour,\n\t\tWeekofYear,\n\t\t{ecEventGkey.1},\n\t\t{ShiftDate.1},\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime,\n\t\tValid,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\tlocSlot_PREV,\n\t\tlocSlot_NXT,\n\t\tecEventGkey_PREV,\n\t\tecEventGkey_NXT,\n\t\tShiftDate_PREV,\n\t\tShiftDate_NXT,\n\t\tLGON_PREV,\n\t\tLGON_NXT,\n\t\tLGOF_PREV,\n\t\tLGOF_NXT,\n\t\tFirstMove,\n\t\tLastMove,\n\t\tIdleTimeFL,\n\t\tRTGIdleTime,\n\t\tBayChangeInstance,\n\t\tBayChangeCount,\n\t\tBlockChangeInstance,\n\t\tLaneChangeInstance\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> RTG\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\tmoveKind as string,\n\t\tlocSlot as string,\n\t\tunladenLocSlot as string,\n\t\tladen_LocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tWeekofYear as integer,\n\t\tDate as date,\n\t\tTime as string,\n\t\tShiftStartTime as timestamp,\n\t\tShiftEndTime as timestamp,\n\t\tShift as integer,\n\t\tShiftDate as date,\n\t\tBlock as string,\n\t\tCHE_ID_PREV as long,\n\t\tCHE_ID_NXT as long,\n\t\tTimeStamp_PREV as timestamp,\n\t\tTimeStamp_NXT as timestamp,\n\t\teventTypeDescription_PREV as string,\n\t\teventTypeDescription_NXT as string,\n\t\tLGOF as timestamp,\n\t\tLGON as timestamp,\n\t\tWorkTime as double\n\t),\n\tformat: 'delta',\n\tfileSystem: 'salalah',\n\tfolderPath: 'gold/rtg_workhours',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tWeekofYear,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tBlock,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\teventTypeDescription_PREV,\n\t\teventTypeDescription_NXT,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RTG EcEvents_valencia')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "RTG"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name = cheName,\n\t\tCHE_ID = cheID,\n\t\tTimeStamp = EcEventTime,\n\t\teventType = type,\n\t\teventSubType = subType,\n\t\teventTypeDescription = typeDescription,\n\t\tunit = unitIdName,\n\t\tpow = powName,\n\t\tpool = poolName,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot = ladenLocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='RTG' && eventTypeDescription=='CMPL') ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tMoveCount = iif(moveKind=='YARD',iif(left(locSlot,5)==left(laden_LocSlot,5),2,1),1),\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(TimeStamp, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))))) ~> DerivedColumn1\nselect filter((eventTypeDescription == 'LGOF' || eventTypeDescription == 'LGON') && cheKind == 'RTG') ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tBlock = left(locSlot,3)) ~> DerivedColumn3\nSort1 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\teventTypeDescription_PREV = lag(eventTypeDescription),\n\t\teventTypeDescription_NXT = lead(eventTypeDescription)) ~> Window1\nWindow1 derive(LGOF = case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(eventTypeDescription=='LGON',TimeStamp),\n\t\tWorkTime = toDouble((case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime))-case(eventTypeDescription=='LGON',TimeStamp))/3600000)) ~> DerivedColumn4\nDerivedColumn3 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nDerivedColumn1, Filter7 join(Aggregate1@CHE_ID == Aggregate3@CHE_ID\n\t&& DerivedColumn1@ShiftStartTime == DerivedColumn3@ShiftStartTime\n\t&& DerivedColumn1@ShiftEndTime == DerivedColumn3@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tecEventGkey = Aggregate1@ecEventGkey,\n\t\tyardGkey = Aggregate1@yardGkey,\n\t\tYardID = Aggregate1@YardID,\n\t\tFcyID = Aggregate1@FcyID,\n\t\tcheKind = Aggregate1@cheKind,\n\t\tCHE_Name = Aggregate1@CHE_Name,\n\t\tCHE_ID = Aggregate1@CHE_ID,\n\t\tTimeStamp = Aggregate1@TimeStamp,\n\t\teventType = Aggregate1@eventType,\n\t\teventSubType = Aggregate1@eventSubType,\n\t\teventTypeDescription = Aggregate1@eventTypeDescription,\n\t\tunit = Aggregate1@unit,\n\t\tpow = Aggregate1@pow,\n\t\tpool = Aggregate1@pool,\n\t\tworkQueue = Aggregate1@workQueue,\n\t\tmoveKind = Aggregate1@moveKind,\n\t\tlocSlot = Aggregate1@locSlot,\n\t\tunladenLocSlot = Aggregate1@unladenLocSlot,\n\t\tladen_LocSlot = Aggregate1@laden_LocSlot,\n\t\tYear = Aggregate1@Year,\n\t\tMonth = Aggregate1@Month,\n\t\tWeek = Aggregate1@Week,\n\t\tDate = DerivedColumn1@Date,\n\t\tTime = DerivedColumn1@Time,\n\t\tShiftStartTime = DerivedColumn1@ShiftStartTime,\n\t\tShiftEndTime = DerivedColumn1@ShiftEndTime,\n\t\tShift = DerivedColumn1@Shift,\n\t\tShiftDate = DerivedColumn1@ShiftDate,\n\t\tMoveCount,\n\t\tBlock = DerivedColumn1@Block,\n\t\tHour,\n\t\tWeekofYear = DerivedColumn1@WeekofYear,\n\t\t{ecEventGkey.1} = Aggregate3@ecEventGkey,\n\t\t{ShiftDate.1} = DerivedColumn3@ShiftDate,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(TimeStamp>=LGON && TimeStamp<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp),\n\t\tLastMove = case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp),\n\t\tIdleTimeFL = case(isNull(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp))==false(),(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp)-LGON)/3600000,isNull(case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))==false(),(LGOF-case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))/3600000),\n\t\tRTGIdleTime = iif(CHE_ID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-TimeStamp)<0,0.0,toFloat((TimeStamp_NXT-TimeStamp)/3600000)),0.0),\n\t\tBayChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0),\n\t\tBayChangeCount = iif(isNull(locSlot_NXT)==true(),0,iif(iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0)==1,\r\niif(toInteger(substring(locSlot,4,2))>toInteger(substring(locSlot_NXT,4,2)),iif( \r\ntoInteger(substring(locSlot,4,2))%2==0,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2)))), \r\niif(toInteger(substring(locSlot_NXT,4,2))%2==0,toInteger(substring(locSlot,4,2))-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2)))-(toInteger(substring(locSlot_NXT,4,2)))))\r\n,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,iif(\r\n    toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2)))) \r\n,iif(toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2)))))),0)),\n\t\tBlockChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)!=left(locSlot_NXT,3),1,0),0),0),0),\n\t\tLaneChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,2)!=left(locSlot_NXT,2),1,0),0),0),0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'gold/rtg_ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tMoveCount,\n\t\tBlock,\n\t\tHour,\n\t\tWeekofYear,\n\t\t{ecEventGkey.1},\n\t\t{ShiftDate.1},\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime,\n\t\tValid,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\tlocSlot_PREV,\n\t\tlocSlot_NXT,\n\t\tecEventGkey_PREV,\n\t\tecEventGkey_NXT,\n\t\tShiftDate_PREV,\n\t\tShiftDate_NXT,\n\t\tLGON_PREV,\n\t\tLGON_NXT,\n\t\tLGOF_PREV,\n\t\tLGOF_NXT,\n\t\tFirstMove,\n\t\tLastMove,\n\t\tIdleTimeFL,\n\t\tRTGIdleTime,\n\t\tBayChangeInstance,\n\t\tBayChangeCount,\n\t\tBlockChangeInstance,\n\t\tLaneChangeInstance\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> RTG\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\tmoveKind as string,\n\t\tlocSlot as string,\n\t\tunladenLocSlot as string,\n\t\tladen_LocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tWeekofYear as integer,\n\t\tDate as date,\n\t\tTime as string,\n\t\tShiftStartTime as timestamp,\n\t\tShiftEndTime as timestamp,\n\t\tShift as integer,\n\t\tShiftDate as date,\n\t\tBlock as string,\n\t\tCHE_ID_PREV as long,\n\t\tCHE_ID_NXT as long,\n\t\tTimeStamp_PREV as timestamp,\n\t\tTimeStamp_NXT as timestamp,\n\t\teventTypeDescription_PREV as string,\n\t\teventTypeDescription_NXT as string,\n\t\tLGOF as timestamp,\n\t\tLGON as timestamp,\n\t\tWorkTime as double\n\t),\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'gold/rtg_workhours',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tWeekofYear,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tBlock,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\teventTypeDescription_PREV,\n\t\teventTypeDescription_NXT,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RTG moves_mict')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "RTG"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name = cheName,\n\t\tCHE_ID = cheID,\n\t\tTimeStamp = EcEventTime,\n\t\teventType = type,\n\t\teventSubType = subType,\n\t\teventTypeDescription = typeDescription,\n\t\tunit = unitIdName,\n\t\tpow = powName,\n\t\tpool = poolName,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot = ladenLocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='RTG' && eventTypeDescription=='CMPL') ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tMoveCount = iif(moveKind=='YARD',iif(left(locSlot,5)==left(laden_LocSlot,5),2,1),1),\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(TimeStamp, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))))) ~> DerivedColumn1\nselect filter((eventTypeDescription == 'LGOF' || eventTypeDescription == 'LGON') && cheKind == 'RTG') ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tBlock = left(locSlot,3)) ~> DerivedColumn3\nSort1 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\teventTypeDescription_PREV = lag(eventTypeDescription),\n\t\teventTypeDescription_NXT = lead(eventTypeDescription)) ~> Window1\nWindow1 derive(LGOF = case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(eventTypeDescription=='LGON',TimeStamp),\n\t\tWorkTime = toDouble((case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime))-case(eventTypeDescription=='LGON',TimeStamp))/3600000)) ~> DerivedColumn4\nDerivedColumn3 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nDerivedColumn1, Filter7 join(Aggregate1@CHE_ID == Aggregate3@CHE_ID\n\t&& DerivedColumn1@ShiftStartTime == DerivedColumn3@ShiftStartTime\n\t&& DerivedColumn1@ShiftEndTime == DerivedColumn3@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tecEventGkey = Aggregate1@ecEventGkey,\n\t\tyardGkey = Aggregate1@yardGkey,\n\t\tYardID = Aggregate1@YardID,\n\t\tFcyID = Aggregate1@FcyID,\n\t\tcheKind = Aggregate1@cheKind,\n\t\tCHE_Name = Aggregate1@CHE_Name,\n\t\tCHE_ID = Aggregate1@CHE_ID,\n\t\tTimeStamp = Aggregate1@TimeStamp,\n\t\teventType = Aggregate1@eventType,\n\t\teventSubType = Aggregate1@eventSubType,\n\t\teventTypeDescription = Aggregate1@eventTypeDescription,\n\t\tunit = Aggregate1@unit,\n\t\tpow = Aggregate1@pow,\n\t\tpool = Aggregate1@pool,\n\t\tworkQueue = Aggregate1@workQueue,\n\t\tmoveKind = Aggregate1@moveKind,\n\t\tlocSlot = Aggregate1@locSlot,\n\t\tunladenLocSlot = Aggregate1@unladenLocSlot,\n\t\tladen_LocSlot = Aggregate1@laden_LocSlot,\n\t\tYear = Aggregate1@Year,\n\t\tMonth = Aggregate1@Month,\n\t\tWeek = Aggregate1@Week,\n\t\tDate = DerivedColumn1@Date,\n\t\tTime = DerivedColumn1@Time,\n\t\tShiftStartTime = DerivedColumn1@ShiftStartTime,\n\t\tShiftEndTime = DerivedColumn1@ShiftEndTime,\n\t\tShift = DerivedColumn1@Shift,\n\t\tShiftDate = DerivedColumn1@ShiftDate,\n\t\tMoveCount,\n\t\tBlock = DerivedColumn1@Block,\n\t\tHour,\n\t\tWeekofYear = DerivedColumn1@WeekofYear,\n\t\t{ecEventGkey.1} = Aggregate3@ecEventGkey,\n\t\t{ShiftDate.1} = DerivedColumn3@ShiftDate,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(TimeStamp>=LGON && TimeStamp<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp),\n\t\tLastMove = case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp),\n\t\tIdleTimeFL = case(isNull(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp))==false(),(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp)-LGON)/3600000,isNull(case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))==false(),(LGOF-case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))/3600000),\n\t\tRTGIdleTime = iif(CHE_ID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-TimeStamp)<0,0.0,toFloat((TimeStamp_NXT-TimeStamp)/3600000)),0.0),\n\t\tBayChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0),\n\t\tBayChangeCount = iif(isNull(locSlot_NXT)==true(),0,iif(iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0)==1,\r\niif(toInteger(substring(locSlot,4,2))>toInteger(substring(locSlot_NXT,4,2)),iif( \r\ntoInteger(substring(locSlot,4,2))%2==0,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2)))), \r\niif(toInteger(substring(locSlot_NXT,4,2))%2==0,toInteger(substring(locSlot,4,2))-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2)))-(toInteger(substring(locSlot_NXT,4,2)))))\r\n,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,iif(\r\n    toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2)))) \r\n,iif(toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2)))))),0)),\n\t\tBlockChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)!=left(locSlot_NXT,3),1,0),0),0),0),\n\t\tLaneChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,2)!=left(locSlot_NXT,2),1,0),0),0),0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'gold/rtg_ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tMoveCount,\n\t\tBlock,\n\t\tHour,\n\t\tWeekofYear,\n\t\t{ecEventGkey.1},\n\t\t{ShiftDate.1},\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime,\n\t\tValid,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\tlocSlot_PREV,\n\t\tlocSlot_NXT,\n\t\tecEventGkey_PREV,\n\t\tecEventGkey_NXT,\n\t\tShiftDate_PREV,\n\t\tShiftDate_NXT,\n\t\tLGON_PREV,\n\t\tLGON_NXT,\n\t\tLGOF_PREV,\n\t\tLGOF_NXT,\n\t\tFirstMove,\n\t\tLastMove,\n\t\tIdleTimeFL,\n\t\tRTGIdleTime,\n\t\tBayChangeInstance,\n\t\tBayChangeCount,\n\t\tBlockChangeInstance,\n\t\tLaneChangeInstance\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> RTG\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\tmoveKind as string,\n\t\tlocSlot as string,\n\t\tunladenLocSlot as string,\n\t\tladen_LocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tWeekofYear as integer,\n\t\tDate as date,\n\t\tTime as string,\n\t\tShiftStartTime as timestamp,\n\t\tShiftEndTime as timestamp,\n\t\tShift as integer,\n\t\tShiftDate as date,\n\t\tBlock as string,\n\t\tCHE_ID_PREV as long,\n\t\tCHE_ID_NXT as long,\n\t\tTimeStamp_PREV as timestamp,\n\t\tTimeStamp_NXT as timestamp,\n\t\teventTypeDescription_PREV as string,\n\t\teventTypeDescription_NXT as string,\n\t\tLGOF as timestamp,\n\t\tLGON as timestamp,\n\t\tWorkTime as double\n\t),\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'gold/rtg_workhours',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tWeekofYear,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tBlock,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\teventTypeDescription_PREV,\n\t\teventTypeDescription_NXT,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RTG_violations_CMSA')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "DeckingHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "XpsEcUser"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "violation"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "decking"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "move"
						}
					],
					"transformations": [
						{
							"name": "select1"
						},
						{
							"name": "select2"
						},
						{
							"name": "join1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter3"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join2"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "select4"
						},
						{
							"name": "join6"
						},
						{
							"name": "select5"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "AlterRow2"
						},
						{
							"name": "alterRow3"
						},
						{
							"name": "select6"
						},
						{
							"name": "filter5"
						},
						{
							"name": "derivedColumn6"
						},
						{
							"name": "select8"
						},
						{
							"name": "filter6"
						},
						{
							"name": "aggregate4"
						},
						{
							"name": "filter7"
						},
						{
							"name": "derivedColumn7"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as integer,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as short,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as integer,",
						"          dist_start as short,",
						"          Twin_Fetch as string,",
						"          Twin_Carry as string,",
						"          Twin_Put as string,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as string,",
						"          OOG_Flag as string,",
						"          ATD as timestamp,",
						"          ATA as timestamp,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/movehistory/load','bronze/moves/archive'],",
						"     format: 'delta',",
						"     fileSystem: 'cmsa',",
						"     folderPath: 'silver/moves') ~> MoveHistory",
						"source(output(",
						"          gkey as integer,",
						"          uyv_gkey as integer,",
						"          unit_id as string,",
						"          time_stamp as timestamp,",
						"          decking_type as string,",
						"          node_id as string,",
						"          yard as boolean,",
						"          from_pos_loctype as string,",
						"          from_pos_locid as string,",
						"          from_pos_loc_gkey as integer,",
						"          from_pos_slot as string,",
						"          from_pos_name as string,",
						"          from_pos_bin as string,",
						"          from_pos_tier as short,",
						"          to_pos_loctype as string,",
						"          to_pos_locid as string,",
						"          to_pos_loc_gkey as boolean,",
						"          to_pos_slot as string,",
						"          to_pos_name as string,",
						"          to_pos_bin as string,",
						"          to_pos_tier as boolean,",
						"          total_score as short,",
						"          execution_time as short,",
						"          details as string,",
						"          phase as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/deckinghistory/load','bronze/deckinghistory/archive'],",
						"     format: 'delta',",
						"     fileSystem: 'cmsa',",
						"     folderPath: 'silver/deckings') ~> DeckingHistory",
						"source(output(",
						"          gkey as short,",
						"          user_id as string,",
						"          name as string,",
						"          yard as string,",
						"          {_c4} as string,",
						"          {_c5} as string,",
						"          {_c6} as string,",
						"          {_c7} as string,",
						"          {_c8} as string,",
						"          {_c9} as string,",
						"          {_c10} as string,",
						"          {_c11} as string,",
						"          {_c12} as string,",
						"          {_c13} as string,",
						"          {_c14} as string,",
						"          {_c15} as string,",
						"          {_c16} as string,",
						"          {_c17} as string,",
						"          {_c18} as string,",
						"          {_c19} as string,",
						"          {_c20} as string,",
						"          {_c21} as string,",
						"          {_c22} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'cmsa',",
						"     folderPath: 'bronze/xpsecuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> XpsEcUser",
						"filter6 select(mapColumn(",
						"          mve_gkey,",
						"          Unit_Nbr,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Location,",
						"          To_Position_Name,",
						"          Put_CHE_Operator_Id,",
						"          Put_CHE_Id,",
						"          Freight_Kind_Id,",
						"          Category_Id,",
						"          ufv_gkey,",
						"          t_put,",
						"          Year,",
						"          Month,",
						"          Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"DeckingHistory select(mapColumn(",
						"          gkey,",
						"          unit_id,",
						"          time_stamp,",
						"          decking_Type = decking_type,",
						"          to_pos_name,",
						"          Year,",
						"          Month,",
						"          Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"derivedColumn7, filter5 join(Unit_Nbr == unit_id,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 filter(From_Location != 'YARD' && Unit_Nbr != '' && not(isNull(Unit_Nbr)) && !startsWith(split(To_Position_Name, \"-\")[3], 'CR') && t_put > addDays(time_stamp, -15)) ~> filter2",
						"filter2 derive(MH_t_put_4 = add(t_put , -4*60*60*1000),",
						"          DH_timestamp_within_4 = iif((time_stamp >= add(t_put , -4*60*60*1000)) && (time_stamp <= t_put), 1, 0),",
						"          MH_To_Position_Name_Short = split(To_Position_Name, \"-\")[3],",
						"          MH_To_Position_Name_Short_5 = iif(length(split(To_Position_Name, \"-\")[3]) == 8, substring(split(To_Position_Name, \"-\")[3], 0, 7), split(To_Position_Name, \"-\")[3]),",
						"          DH_To_Position_Name_Short = split(to_pos_name, \"-\")[3],",
						"          DH_To_Position_Name_Short_5 = iif(length(split(to_pos_name, \"-\")[3]) == 8, substring(split(to_pos_name, \"-\")[3], 0, 7), split(to_pos_name, \"-\")[3])) ~> derivedColumn3",
						"derivedColumn3 filter(DH_timestamp_within_4 == 1 && DH_To_Position_Name_Short != \"FLD\" && not(like(DH_To_Position_Name_Short, \"Fail%\"))) ~> filter3",
						"filter3 aggregate(groupBy(Unit_Nbr,",
						"          Move_Kind,",
						"          Category_Id,",
						"          MH_To_Position_Name_Short,",
						"          t_put,",
						"          Put_CHE_Operator_Id,",
						"          mve_gkey,",
						"          Put_CHE_Id,",
						"          Freight_Kind_Id),",
						"     MaxDHTime = max(time_stamp)) ~> aggregate1",
						"filter3, aggregate1 join(select1@Unit_Nbr == aggregate1@Unit_Nbr",
						"     && select1@Move_Kind == aggregate1@Move_Kind",
						"     && select1@Category_Id == aggregate1@Category_Id",
						"     && derivedColumn3@MH_To_Position_Name_Short == aggregate1@MH_To_Position_Name_Short",
						"     && select1@t_put == aggregate1@t_put",
						"     && select1@Put_CHE_Operator_Id == aggregate1@Put_CHE_Operator_Id",
						"     && select1@mve_gkey == aggregate1@mve_gkey",
						"     && select1@Put_CHE_Id == aggregate1@Put_CHE_Id",
						"     && select1@Freight_Kind_Id == aggregate1@Freight_Kind_Id",
						"     && time_stamp == MaxDHTime,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join2",
						"join2 derive({Location Match or Not} = iif(substring(MH_To_Position_Name_Short_5, 1, 6) == substring(DH_To_Position_Name_Short_5, 1, 6), 'Position Followed', 'Position Not Followed'),",
						"          {T Put Time} = MaxDHTime,",
						"          {T Put Hour} = hour(MaxDHTime),",
						"          {T Put Minute} = minute(MaxDHTime),",
						"          {T Put Second} = second(MaxDHTime),",
						"          Shift_Date = toDate(select1@t_put)) ~> derivedColumn4",
						"derivedColumn6 select(mapColumn(",
						"          {D H Decking Type} = decking_Type,",
						"          {MH ToPosName Short 5Char} = MH_To_Position_Name_Short_5,",
						"          {DH ToPosName Short 5Char} = DH_To_Position_Name_Short_5,",
						"          {MH Unit Nbr} = select1@Unit_Nbr,",
						"          {MH Move Kind} = select1@Move_Kind,",
						"          {Category Id} = select1@Category_Id,",
						"          {MH T_Put DateTime} = select1@t_put,",
						"          {MH Put CHE Operator Id} = select1@Put_CHE_Operator_Id,",
						"          mve_gkey = select1@mve_gkey,",
						"          {MH Put CHE Id} = select1@Put_CHE_Id,",
						"          {Freight Kind Id} = select1@Freight_Kind_Id,",
						"          MaxDHTime,",
						"          {Location Match or Not},",
						"          operator_name = name,",
						"          Block_To_Block_Violation,",
						"          Same_Block_Violation,",
						"          Stack_Violation,",
						"          Date = Shift_Date,",
						"          Year_Month,",
						"          Year_Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select4",
						"derivedColumn4, XpsEcUser join(lower(select1@Put_CHE_Operator_Id) == lower(user_id),",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join6",
						"select4 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select5",
						"select5 alterRow(upsertIf(true())) ~> alterRow1",
						"select6 alterRow(upsertIf(true())) ~> AlterRow2",
						"select1 alterRow(upsertIf(true())) ~> alterRow3",
						"filter5 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select6",
						"select2 filter(not(isNull(gkey)) && (decking_Type == 'Bump Intruder' || decking_Type == 'Vessel Discharge' || decking_Type == 'Vessel Discharge - Twin' || decking_Type == 'XD Drop if Floating Refine' || decking_Type == 'XD Refine Request' || decking_Type == 'XD Rehandle Request')) ~> filter5",
						"join6 derive(Block_To_Block_Violation = iif(substring(MH_To_Position_Name_Short_5, 1, 3) != substring(DH_To_Position_Name_Short_5, 1, 3), true(), false()),",
						"          Same_Block_Violation = iif( (substring(MH_To_Position_Name_Short_5, 1, 3) == substring(DH_To_Position_Name_Short_5, 1, 3)) && (substring(MH_To_Position_Name_Short_5, 5, 2) == substring(DH_To_Position_Name_Short_5, 5, 2)), false(), true()),",
						"          Stack_Violation = iif(substring(MH_To_Position_Name_Short_5, 1, 6) != substring(DH_To_Position_Name_Short_5, 1, 6), true(), false())) ~> derivedColumn6",
						"XpsEcUser select(mapColumn(",
						"          gkey,",
						"          user_id,",
						"          name,",
						"          yard",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select8",
						"MoveHistory filter(Put_CHE_Kind == \"RTG\" && not(isNull(mve_gkey))) ~> filter6",
						"select8 aggregate(groupBy(user_id),",
						"     each(match(name!='user_id'), $$ = last($$))) ~> aggregate4",
						"aggregate4 filter(not(isNull(user_id))) ~> filter7",
						"select1 derive(Year_Month = (Year*100) + Month,",
						"          Year_Week = (Year*100) + Week) ~> derivedColumn7",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmsa',",
						"     folderPath: 'gold/rtg_violation',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> violation",
						"AlterRow2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmsa',",
						"     folderPath: 'gold/decking',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> decking",
						"alterRow3 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmsa',",
						"     folderPath: 'gold/move',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> move"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]",
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RTG_violations_teagtl')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "DeckingHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "XpsEcUser"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "violation"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "decking"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "move"
						}
					],
					"transformations": [
						{
							"name": "select1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "join1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter3"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join2"
						},
						{
							"name": "select3"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "select4"
						},
						{
							"name": "join6"
						},
						{
							"name": "select5"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "AlterRow2"
						},
						{
							"name": "alterRow3"
						},
						{
							"name": "select6"
						},
						{
							"name": "select7"
						},
						{
							"name": "aggregate2"
						},
						{
							"name": "filter4"
						},
						{
							"name": "aggregate3"
						},
						{
							"name": "filter5"
						},
						{
							"name": "derivedColumn6"
						},
						{
							"name": "select8"
						},
						{
							"name": "filter6"
						},
						{
							"name": "aggregate4"
						},
						{
							"name": "filter7"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Unit Nbr} as string,",
						"          {Facility Id} as string,",
						"          {Complex Id} as string,",
						"          {Yard Id} as string,",
						"          {Carrier Visit Key} as long,",
						"          {Event Type Id} as string,",
						"          {Move Kind} as string,",
						"          {From Location} as string,",
						"          {To Location} as string,",
						"          {From Position Name} as string,",
						"          {To Position Name} as string,",
						"          {Carry CHE Operator Id} as string,",
						"          {Fetch CHE Operator Id} as string,",
						"          {Put CHE Operator Id} as string,",
						"          {Fetch CHE Id} as short,",
						"          {Fetch CHE Kind} as string,",
						"          {Carry CHE Id} as short,",
						"          {Carry CHE Kind} as string,",
						"          {Put CHE Id} as short,",
						"          {Put CHE Kind} as string,",
						"          {QC CHE Id} as short,",
						"          {QC CHE Kind} as string,",
						"          t_carry_complete as string,",
						"          t_put as string,",
						"          t_fetch as string,",
						"          t_dispatch as string,",
						"          t_discharge as string,",
						"          t_carry_dispatch as string,",
						"          t_carry_fetch_ready as string,",
						"          t_carry_put_ready as string,",
						"          dist_carry as short,",
						"          dist_start as short,",
						"          {Twin Fetch} as boolean,",
						"          {Twin Carry} as boolean,",
						"          {Twin Put} as boolean,",
						"          {Category Id} as string,",
						"          {Freight Kind Id} as string,",
						"          to_pos_gkey as string,",
						"          fm_pos_gkey as long,",
						"          {Restow Reason} as string,",
						"          {Container Line Id} as string,",
						"          {Container Line Role} as string,",
						"          pow as string,",
						"          mve_gkey as long,",
						"          ufv_gkey as long,",
						"          {Berth Id} as string,",
						"          {Goods And Ctr Wt Kg} as integer,",
						"          active_ufv as long,",
						"          {Requires Power Flag} as boolean,",
						"          {OOG Flag} as boolean,",
						"          {Shipper Id} as string,",
						"          {Consignee Id} as string,",
						"          {Commodity Id} as string,",
						"          ATA as string,",
						"          ATD as string,",
						"          Rehandles as boolean",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/movehistory/load','bronze/moves/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'bronze/movehistory/load/',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> MoveHistory",
						"source(output(",
						"          gkey as integer,",
						"          uyv_gkey as integer,",
						"          unit_id as string,",
						"          time_stamp as string,",
						"          decking_type as string,",
						"          node_id as string,",
						"          yard as boolean,",
						"          from_pos_loctype as string,",
						"          from_pos_locid as string,",
						"          from_pos_loc_gkey as integer,",
						"          from_pos_slot as string,",
						"          from_pos_name as string,",
						"          from_pos_bin as string,",
						"          from_pos_tier as short,",
						"          to_pos_loctype as string,",
						"          to_pos_locid as string,",
						"          to_pos_loc_gkey as boolean,",
						"          to_pos_slot as string,",
						"          to_pos_name as string,",
						"          to_pos_bin as string,",
						"          to_pos_tier as boolean,",
						"          total_score as short,",
						"          execution_time as short,",
						"          details as string,",
						"          phase as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/deckinghistory/load','bronze/deckinghistory/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'bronze/deckinghistory/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> DeckingHistory",
						"source(output(",
						"          gkey as short,",
						"          user_id as string,",
						"          name as string,",
						"          yard as string,",
						"          {_c4} as string,",
						"          {_c5} as string,",
						"          {_c6} as string,",
						"          {_c7} as string,",
						"          {_c8} as string,",
						"          {_c9} as string,",
						"          {_c10} as string,",
						"          {_c11} as string,",
						"          {_c12} as string,",
						"          {_c13} as string,",
						"          {_c14} as string,",
						"          {_c15} as string,",
						"          {_c16} as string,",
						"          {_c17} as string,",
						"          {_c18} as string,",
						"          {_c19} as string,",
						"          {_c20} as string,",
						"          {_c21} as string,",
						"          {_c22} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'bronze/xpsecuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> XpsEcUser",
						"filter6 select(mapColumn(",
						"          mve_gkey,",
						"          {Unit Nbr},",
						"          {Event Type Id},",
						"          {Move Kind},",
						"          {From Location},",
						"          {To Position Name},",
						"          {Put CHE Operator Id},",
						"          {Put CHE Id},",
						"          {MH T_Put DateTime} = t_put,",
						"          {Freight Kind Id},",
						"          {Category Id},",
						"          ufv_gkey",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"aggregate3 derive(Year_Month = (year(:mh_time)*100) + month(:mh_time),",
						"          Year_Week = year(:mh_time)*100 + weekOfYear(:mh_time),",
						"          {MH T_Put DateTime} = :mh_time,",
						"          mh_time := coalesce(toTimestamp(split({MH T_Put DateTime},\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split({MH T_Put DateTime},\".\")[1],'yyyy-MM-dd HH:mm'))) ~> derivedColumn1",
						"DeckingHistory select(mapColumn(",
						"          gkey,",
						"          unit_id,",
						"          {DH TimeStamp} = time_stamp,",
						"          Decking_Type = decking_type,",
						"          to_pos_name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"aggregate2 filter(Decking_Type == 'Bump Intruder' || Decking_Type == 'Vessel Discharge' || Decking_Type == 'Vessel Discharge - Twin' || Decking_Type == 'XD Drop if Floating Refine' || Decking_Type == 'XD Refine Request' || Decking_Type == 'XD Rehandle Request') ~> filter1",
						"filter1 derive(Year_Month = (year(:dh_time)*100) + month(:dh_time),",
						"          Year_Week = (year(:dh_time)*100) + weekOfYear(:dh_time),",
						"          {DH TimeStamp} = coalesce(toTimestamp(split({DH TimeStamp},\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split({DH TimeStamp},\".\")[1],'yyyy-MM-dd HH:mm')),",
						"          dh_time := coalesce(toTimestamp(split({DH TimeStamp},\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split({DH TimeStamp},\".\")[1],'yyyy-MM-dd HH:mm'))) ~> derivedColumn2",
						"derivedColumn1, derivedColumn2 join({Unit Nbr} == unit_id,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 filter({From Location} != 'YARD' && unit_id != '' && not(isNull(unit_id)) && !startsWith(split({To Position Name}, \"-\")[3], 'CR') && {MH T_Put DateTime} > addDays({DH TimeStamp}, -15)) ~> filter2",
						"filter2 derive({MH TPut Less 4 hours} = add({MH T_Put DateTime} , -4*60*60*1000),",
						"          {DH TimeStamp Within 4 Hours} = iif(({DH TimeStamp} >= add({MH T_Put DateTime} , -4*60*60*1000)) && ({DH TimeStamp} <= {MH T_Put DateTime}), 1, 0),",
						"          {MH ToPosName Short} = split({To Position Name}, \"-\")[3],",
						"          {MH ToPosName Short 5Char} = iif(length(split({To Position Name}, \"-\")[3]) == 8, substring(split({To Position Name}, \"-\")[3], 0, 7), split({To Position Name}, \"-\")[3]),",
						"          {DH ToPosName Shorrt} = split(to_pos_name, \"-\")[3],",
						"          {DH ToPosName Short 5Char} = iif(length(split(to_pos_name, \"-\")[3]) == 8, substring(split(to_pos_name, \"-\")[3], 0, 7), split(to_pos_name, \"-\")[3])) ~> derivedColumn3",
						"derivedColumn3 filter({DH TimeStamp Within 4 Hours} == 1 && {DH ToPosName Short 5Char} != \"FLD\" && not(like({DH ToPosName Short 5Char}, \"Fail%\"))) ~> filter3",
						"filter3 aggregate(groupBy({Unit Nbr},",
						"          {Move Kind},",
						"          {Category Id},",
						"          {MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime},",
						"          {Put CHE Operator Id},",
						"          mve_gkey,",
						"          {Put CHE Id},",
						"          {Freight Kind Id}),",
						"     MaxDHTime = max({DH TimeStamp})) ~> aggregate1",
						"filter3, aggregate1 join(aggregate3@{Unit Nbr} == aggregate1@{Unit Nbr}",
						"     && aggregate3@{Move Kind} == aggregate1@{Move Kind}",
						"     && aggregate3@{Category Id} == aggregate1@{Category Id}",
						"     && derivedColumn3@{MH ToPosName Short 5Char} == aggregate1@{MH ToPosName Short 5Char}",
						"     && derivedColumn1@{MH T_Put DateTime} == aggregate1@{MH T_Put DateTime}",
						"     && aggregate3@{Put CHE Operator Id} == aggregate1@{Put CHE Operator Id}",
						"     && aggregate3@mve_gkey == aggregate1@mve_gkey",
						"     && aggregate3@{Put CHE Id} == aggregate1@{Put CHE Id}",
						"     && aggregate3@{Freight Kind Id} == aggregate1@{Freight Kind Id}",
						"     && {DH TimeStamp} == MaxDHTime,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join2",
						"join2 select(mapColumn(",
						"          {MH Event Type Id} = {Event Type Id},",
						"          {From Location},",
						"          {MH To Position Name} = {To Position Name},",
						"          ufv_gkey,",
						"          gkey,",
						"          unit_id,",
						"          {D H TimeStamp} = {DH TimeStamp},",
						"          {D H Decking Type} = Decking_Type,",
						"          {D H To Pos Name} = to_pos_name,",
						"          Year_Month = derivedColumn2@Year_Month,",
						"          Year_Week = derivedColumn2@Year_Week,",
						"          {MH TPut Less 4 hours},",
						"          {DH TimeStamp Within 4 Hours},",
						"          {MH ToPosName Short},",
						"          {MH ToPosName Short 5Char} = derivedColumn3@{MH ToPosName Short 5Char},",
						"          {DH ToPosName Shorrt},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr} = aggregate1@{Unit Nbr},",
						"          {MH Move Kind} = aggregate1@{Move Kind},",
						"          {Category Id} = aggregate1@{Category Id},",
						"          {MH ToPosName Short 5Char} = aggregate1@{MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime} = aggregate1@{MH T_Put DateTime},",
						"          {MH Put CHE Operator Id} = aggregate1@{Put CHE Operator Id},",
						"          mve_gkey = aggregate1@mve_gkey,",
						"          {MH Put CHE Id} = aggregate1@{Put CHE Id},",
						"          {Freight Kind Id} = aggregate1@{Freight Kind Id},",
						"          MaxDHTime",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select3",
						"select3 derive({Location Match or Not} = iif(substring({MH ToPosName Short 5Char}, 1, 6) == substring({DH ToPosName Short 5Char}, 1, 6), 'Position Followed', 'Position Not Followed'),",
						"          Shift_Date = toDate({MH T_Put DateTime}),",
						"          {T Put Time} = MaxDHTime,",
						"          {T Put Hour} = hour(MaxDHTime),",
						"          {T Put Minute} = minute(MaxDHTime),",
						"          {T Put Second} = second(MaxDHTime)) ~> derivedColumn4",
						"derivedColumn6 select(mapColumn(",
						"          {D H Decking Type},",
						"          {MH ToPosName Short 5Char},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr},",
						"          {MH Move Kind},",
						"          {Category Id},",
						"          {MH T_Put DateTime},",
						"          {MH Put CHE Operator Id},",
						"          mve_gkey,",
						"          {MH Put CHE Id},",
						"          {Freight Kind Id},",
						"          MaxDHTime,",
						"          {Location Match or Not},",
						"          operator_name = name,",
						"          Block_To_Block_Violation,",
						"          Same_Block_Violation,",
						"          Stack_Violation,",
						"          Date = Shift_Date,",
						"          Year_Month,",
						"          Year_Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select4",
						"derivedColumn4, XpsEcUser join(lower({MH Put CHE Operator Id}) == lower(user_id),",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join6",
						"select4 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select5",
						"select5 alterRow(upsertIf(true())) ~> alterRow1",
						"select6 alterRow(upsertIf(true())) ~> AlterRow2",
						"select7 alterRow(upsertIf(true())) ~> alterRow3",
						"derivedColumn2 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select6",
						"derivedColumn1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select7",
						"filter5 aggregate(groupBy(gkey),",
						"     each(match(name!='gkey'), $$ = first($$))) ~> aggregate2",
						"select1 filter(not(isNull(mve_gkey))) ~> filter4",
						"filter4 aggregate(groupBy(mve_gkey),",
						"     each(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate3",
						"select2 filter(not(isNull(gkey))) ~> filter5",
						"join6 derive(Block_To_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 3) != substring({DH ToPosName Short 5Char}, 1, 3), true(), false()),",
						"          Same_Block_Violation = iif( (substring({MH ToPosName Short 5Char}, 1, 3) == substring({DH ToPosName Short 5Char}, 1, 3)) && (substring({MH ToPosName Short 5Char}, 5, 2) == substring({DH ToPosName Short 5Char}, 5, 2)), false(), true()),",
						"          Stack_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 6) != substring({DH ToPosName Short 5Char}, 1, 6), true(), false())) ~> derivedColumn6",
						"XpsEcUser select(mapColumn(",
						"          gkey,",
						"          user_id,",
						"          name,",
						"          yard",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select8",
						"MoveHistory filter({Put CHE Kind} == \"RTG\") ~> filter6",
						"select8 aggregate(groupBy(user_id),",
						"     each(match(name!='user_id'), $$ = last($$))) ~> aggregate4",
						"aggregate4 filter(not(isNull(user_id))) ~> filter7",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'gold/rtg_violation',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> violation",
						"AlterRow2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'gold/decking',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> decking",
						"alterRow3 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'gold/move',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> move"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter2"
						},
						{
							"name": "Filter3"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Filter4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('valencia')\n}\nsource(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as long,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: ($customer),\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nsource1 filter(Move_Kind!=\"DSCH\" && Event_Type_Id==\"UNIT_LOAD\") ~> Filter1\nFilter1 derive(Tier = iif(length(From_Position_Name)==15 || length(From_Position_Name)==15, right(From_Position_Name, 1),''),\n\t\tSlot = iif(length(From_Position_Name)==15 || length(From_Position_Name)==15, dropRight(From_Position_Name, 1),'')) ~> DerivedColumn1\nDerivedColumn1 filter(Tier!='') ~> Filter2\nsource1 filter(Move_Kind!='DSCH' && Event_Type_Id=='UNIT_YARD_SHIFT') ~> Filter3\nFilter3 derive(Tier = iif(length(From_Position_Name)==15 || length(From_Position_Name)==15, right(From_Position_Name, 1),''),\n\t\tSlot = iif(length(From_Position_Name)==15 || length(From_Position_Name)==15, dropRight(From_Position_Name, 1),'')) ~> DerivedColumn2\nDerivedColumn2 filter(Tier!='') ~> Filter4\nFilter4 sort(asc(t_put, true)) ~> Sort1\nSort1 select(mapColumn(\n\t\tSlot\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(Slot),\n\teach(match(name!='Slot'), $$ = first($$))) ~> Aggregate1\nFilter2, Aggregate1 join(DerivedColumn1@Slot == Aggregate1@Slot,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 sort(asc(t_put, true)) ~> Sort2\nSort2 alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'gold/rehandle',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_CMATK')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "filter1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: true,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delta',\n\tfileSystem: 'cmatk',\n\tfolderPath: 'silver/moves',\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> MoveHistory\nSelect1 derive(Date = t_put,\n\t\tYear_Week = (Year * 100) + Week) ~> DataTypeConversion\nMoveHistory select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nfilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion filter(!isNull(mve_gkey) && !isNull(t_put) && !isNull({Unit_Nbr})) ~> filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'cmatk',\n\tfolderPath: 'gold/rehandle',\n\tmergeSchema: false,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tpow,\n\t\tactive_ufv,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tYear_Week\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_Unproductive_moves_cmsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Find unproductive moves for RECV and RDSC Full Export, IMPRT, TRSHP ctrs that are loaded on a vessel",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "IBandOBAndUnproductiveMoves"
						},
						{
							"name": "IBFull"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "window1"
						},
						{
							"name": "select2"
						},
						{
							"name": "derivedColumn1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('cmsa')\n}\nsource(output(\n\t\tmve_gkey as long,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as long,\n\t\tdist_start as long,\n\t\tTwin_Fetch as boolean,\n\t\tTwin_Carry as boolean,\n\t\tTwin_Put as boolean,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tRestow_Reason as string,\n\t\tPOW as string,\n\t\tufv_gkey as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tRequires_Power_Flag as boolean,\n\t\tOOG_Flag as boolean,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as long,\n\t\tComplex_Id as string,\n\t\tCarrier_Visit_Id as string,\n\t\tPhase as string,\n\t\tVisit_Nbr as string,\n\t\tCarrier_Mode as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\tOperator_Line_Id as string,\n\t\tOperator_Line_Role as string,\n\t\tOperator_Line_Name as string,\n\t\tTime_First_Availabilty as string,\n\t\tTime_Discharge_Complete as string,\n\t\tService_Id as string,\n\t\tService_Name as string,\n\t\tVessel_Id as string,\n\t\tIB_VYG as string,\n\t\tOB_VYG as string,\n\t\tCarrier_Name as string,\n\t\tVessel_Class as string,\n\t\tPublished_ETA as string,\n\t\tPublished_ETD as string,\n\t\tStart_Work as string,\n\t\tEnd_Work as string,\n\t\tBegin_Receive_Date as string,\n\t\tCargo_Cutoff_Date as string,\n\t\tHazard_Cutoff_Date as string,\n\t\tReefer_Cutoff_Date as string,\n\t\tLabor_On_Board_Date as string,\n\t\tLabor_Off_Board_Date as string,\n\t\tOff_Port_Arrival_Date as string,\n\t\tOff_Port_Departure as string,\n\t\tPilot_On_Board_Date as string,\n\t\tPilot_Off_Board_Date as string,\n\t\tEst_BBK_Discharge as string,\n\t\tEst_BBK_Load as string,\n\t\tEst_Load as string,\n\t\tEst_Discharge as string,\n\t\tEst_Restow as string,\n\t\tEst_Shift as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\tVessel_Classification as string,\n\t\tVessel_Class_Length_Overall_cm as integer,\n\t\tVessel_Class_Beam_cm as string,\n\t\tVessel_TEU_Capacity as string,\n\t\tLloyds_Code as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nsource1 filter((Freight_Kind_Id=='FCL' && ( Move_Kind=='LOAD'||Move_Kind=='RECV' ||Move_Kind=='RDSC' || Move_Kind=='YARD' || Move_Kind=='SHFT'|| Move_Kind=='DSCH') && (Category_Id=='EXPRT'||Category_Id=='TRSHP' ||Category_Id=='IMPRT') )) ~> IBandOBAndUnproductiveMoves\nsource1 filter((Freight_Kind_Id=='FCL'  &&  (Move_Kind=='RECV' || Move_Kind=='RDSC'|| Move_Kind=='DSCH') && (Category_Id=='EXPRT'||Category_Id=='TRSHP' ||Category_Id=='IMPRT') )) ~> IBFull\nIBFull derive(Max_T_Put = addDays(t_put,14),\n\t\tufv_gkey = toLong(ufv_gkey)) ~> DerivedColumn2\nDerivedColumn2 select(mapColumn(\n\t\tIB_mve_gkey = mve_gkey,\n\t\tIB_Unit_Nbr = Unit_Nbr,\n\t\tIB_Facility_Id = Facility_Id,\n\t\tIB_Move_Kind = Move_Kind,\n\t\tIB_t_put = t_put,\n\t\tIB_Category_Id = Category_Id,\n\t\tIB_ufv_gkey = ufv_gkey,\n\t\tIB_Requires_Power_Flag = Requires_Power_Flag,\n\t\tIB_OOG_Flag = OOG_Flag,\n\t\tIB_Year = Year,\n\t\tIB_Month = Month,\n\t\tIB_Week = Week,\n\t\tIB_Max_T_Put = Max_T_Put\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nselect2, Select1 join(ufv_gkey == IB_ufv_gkey,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'right')~> Join1\nwindow1 alterRow(insertIf(true())) ~> AlterRow1\nJoin1 window(over(IB_ufv_gkey),\n\tasc(IB_t_put, true),\n\tasc(t_put, true),\n\tasc(mve_gkey, true),\n\tRNumber = rowNumber(),\n\t\tMovesPerUnitFcyVisit = count(mve_gkey)) ~> window1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tMove_Kind,\n\t\tTo_Position_Name,\n\t\tt_put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tufv_gkey,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tFrom_Position_Name\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select2\nIBandOBAndUnproductiveMoves derive(ufv_gkey = toLong(ufv_gkey)) ~> derivedColumn1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'gold/rehandle_uprod_moves',\n\ttruncate: true,\n\tmergeSchema: false,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tMove_Kind,\n\t\tTo_Position_Name,\n\t\tt_put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tufv_gkey,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tFrom_Position_Name,\n\t\tIB_mve_gkey,\n\t\tIB_Unit_Nbr,\n\t\tIB_Facility_Id,\n\t\tIB_Move_Kind,\n\t\tIB_t_put,\n\t\tIB_Category_Id,\n\t\tIB_ufv_gkey,\n\t\tIB_Requires_Power_Flag,\n\t\tIB_OOG_Flag,\n\t\tIB_Year,\n\t\tIB_Month,\n\t\tIB_Week,\n\t\tIB_Max_T_Put,\n\t\tRNumber,\n\t\tMovesPerUnitFcyVisit\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_cgsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "filter1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: true,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delta',\n\tfileSystem: 'cgsa',\n\tfolderPath: 'silver/moves',\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> MoveHistory\nSelect1 derive(Date = t_put,\n\t\tYear_Week = (Year * 100) + Week) ~> DataTypeConversion\nMoveHistory select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nfilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion filter(!isNull(mve_gkey) && !isNull(t_put) && !isNull({Unit_Nbr})) ~> filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'cgsa',\n\tfolderPath: 'gold/rehandle',\n\tmergeSchema: false,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tpow,\n\t\tactive_ufv,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tYear_Week\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_cmsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter2"
						},
						{
							"name": "Filter3"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Filter4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('cmsa')\n}\nsource(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as long,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nsource1 filter(Move_Kind!=\"DSCH\" && Event_Type_Id==\"UNIT_LOAD\") ~> Filter1\nFilter1 derive(Tier = iif(length(From_Position_Name)==13 || length(From_Position_Name)==13, right(From_Position_Name, 1),''),\n\t\tSlot = iif(length(From_Position_Name)==13 || length(From_Position_Name)==13, dropRight(From_Position_Name, 1),'')) ~> DerivedColumn1\nDerivedColumn1 filter(Tier!='') ~> Filter2\nsource1 filter(Move_Kind!='DSCH' && Event_Type_Id=='UNIT_YARD_SHIFT') ~> Filter3\nFilter3 derive(Tier = iif(length(From_Position_Name)==13 || length(From_Position_Name)==13, right(From_Position_Name, 1),''),\n\t\tSlot = iif(length(From_Position_Name)==13 || length(From_Position_Name)==13, dropRight(From_Position_Name, 1),'')) ~> DerivedColumn2\nDerivedColumn2 filter(Tier!='') ~> Filter4\nFilter4 sort(asc(t_put, true)) ~> Sort1\nSort1 select(mapColumn(\n\t\tSlot\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(Slot),\n\teach(match(name!='Slot'), $$ = first($$))) ~> Aggregate1\nFilter2, Aggregate1 join(DerivedColumn1@Slot == Aggregate1@Slot,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 sort(asc(t_put, true)) ~> Sort2\nSort2 alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'gold/rehandle',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_export_gpa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Find unproductive moves for RECV and RDSC Full Export ctrs in GCT facility",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "IBAndUnproductiveMoves"
						},
						{
							"name": "IBExprtFull"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "window1"
						},
						{
							"name": "select2"
						},
						{
							"name": "derivedColumn1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('gpa')\n}\nsource(output(\n\t\tmve_gkey as long,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as long,\n\t\tdist_start as long,\n\t\tTwin_Fetch as boolean,\n\t\tTwin_Carry as boolean,\n\t\tTwin_Put as boolean,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tRestow_Reason as string,\n\t\tPOW as string,\n\t\tufv_gkey as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tRequires_Power_Flag as boolean,\n\t\tOOG_Flag as boolean,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as long,\n\t\tComplex_Id as string,\n\t\tCarrier_Visit_Id as string,\n\t\tPhase as string,\n\t\tVisit_Nbr as string,\n\t\tCarrier_Mode as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\tOperator_Line_Id as string,\n\t\tOperator_Line_Role as string,\n\t\tOperator_Line_Name as string,\n\t\tTime_First_Availabilty as string,\n\t\tTime_Discharge_Complete as string,\n\t\tService_Id as string,\n\t\tService_Name as string,\n\t\tVessel_Id as string,\n\t\tIB_VYG as string,\n\t\tOB_VYG as string,\n\t\tCarrier_Name as string,\n\t\tVessel_Class as string,\n\t\tPublished_ETA as string,\n\t\tPublished_ETD as string,\n\t\tStart_Work as string,\n\t\tEnd_Work as string,\n\t\tBegin_Receive_Date as string,\n\t\tCargo_Cutoff_Date as string,\n\t\tHazard_Cutoff_Date as string,\n\t\tReefer_Cutoff_Date as string,\n\t\tLabor_On_Board_Date as string,\n\t\tLabor_Off_Board_Date as string,\n\t\tOff_Port_Arrival_Date as string,\n\t\tOff_Port_Departure as string,\n\t\tPilot_On_Board_Date as string,\n\t\tPilot_Off_Board_Date as string,\n\t\tEst_BBK_Discharge as string,\n\t\tEst_BBK_Load as string,\n\t\tEst_Load as string,\n\t\tEst_Discharge as string,\n\t\tEst_Restow as string,\n\t\tEst_Shift as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\tVessel_Classification as string,\n\t\tVessel_Class_Length_Overall_cm as integer,\n\t\tVessel_Class_Beam_cm as string,\n\t\tVessel_TEU_Capacity as string,\n\t\tLloyds_Code as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nsource1 filter((Category_Id=='EXPRT' && Freight_Kind_Id=='FCL' && Facility_Id=='GCT' && ( Move_Kind=='LOAD'||Move_Kind=='RECV' ||Move_Kind=='RDSC' || (( Move_Kind=='YARD' || Move_Kind=='SHFT') && To_Position_Name!='Y-GCT-???') ))) ~> IBAndUnproductiveMoves\nsource1 filter((Category_Id=='EXPRT' && Freight_Kind_Id=='FCL' && Facility_Id=='GCT' &&  (Move_Kind=='RECV' || Move_Kind=='RDSC') )) ~> IBExprtFull\nIBExprtFull derive(Max_T_Put = addDays(t_put,14),\n\t\tufv_gkey = toLong(ufv_gkey)) ~> DerivedColumn2\nDerivedColumn2 select(mapColumn(\n\t\tIB_mve_gkey = mve_gkey,\n\t\tIB_Unit_Nbr = Unit_Nbr,\n\t\tIB_Facility_Id = Facility_Id,\n\t\tIB_Move_Kind = Move_Kind,\n\t\tIB_t_put = t_put,\n\t\tIB_Category_Id = Category_Id,\n\t\tIB_ufv_gkey = ufv_gkey,\n\t\tIB_Requires_Power_Flag = Requires_Power_Flag,\n\t\tIB_OOG_Flag = OOG_Flag,\n\t\tIB_Year = Year,\n\t\tIB_Month = Month,\n\t\tIB_Week = Week,\n\t\tIB_Max_T_Put = Max_T_Put\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nselect2, Select1 join(ufv_gkey == IB_ufv_gkey\n\t&& Facility_Id == IB_Facility_Id,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'right')~> Join1\nwindow1 alterRow(insertIf(true())) ~> AlterRow1\nJoin1 window(over(IB_ufv_gkey),\n\tasc(IB_t_put, true),\n\tasc(t_put, true),\n\tasc(mve_gkey, true),\n\tRNumber = rowNumber(),\n\t\tMovesPerUnitFcyVisit = count(mve_gkey)) ~> window1\nderivedColumn1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tMove_Kind,\n\t\tTo_Position_Name,\n\t\tt_put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tufv_gkey,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tFrom_Position_Name\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select2\nIBAndUnproductiveMoves derive(ufv_gkey = toLong(ufv_gkey)) ~> derivedColumn1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'gold/rehandle_export',\n\ttruncate: true,\n\tmergeSchema: false,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tMove_Kind,\n\t\tTo_Position_Name,\n\t\tt_put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tufv_gkey,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tFrom_Position_Name,\n\t\tIB_mve_gkey,\n\t\tIB_Unit_Nbr,\n\t\tIB_Facility_Id,\n\t\tIB_Move_Kind,\n\t\tIB_t_put,\n\t\tIB_Category_Id,\n\t\tIB_ufv_gkey,\n\t\tIB_Requires_Power_Flag,\n\t\tIB_OOG_Flag,\n\t\tIB_Year,\n\t\tIB_Month,\n\t\tIB_Week,\n\t\tIB_Max_T_Put,\n\t\tRNumber,\n\t\tMovesPerUnitFcyVisit\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_export_tdt')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Grouping by UFV; no filter for export; it is  misnamed !",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Sort2"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "window1"
						},
						{
							"name": "select2"
						}
					],
					"script": "parameters{\n\tcustomer as string ('tdt')\n}\nsource(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as long,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'tdt',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nselect2 sort(asc(ufv_gkey, true),\n\tasc(t_put, true)) ~> Sort2\nwindow1 alterRow(upsertIf(true())) ~> AlterRow1\nSort2 window(over(ufv_gkey,\n\t\tFacility_Id),\n\tasc(t_put, true),\n\tasc(mve_gkey, true),\n\tRNumber = rowNumber(),\n\t\tMovesPerFcyVisit = count(mve_gkey),\n\t\tRehandlePerFcyVisit = countAll(Move_Kind==\"SHFT\" || Move_Kind==\"YARD\")) ~> window1\nsource1 select(mapColumn(\n\t\tmve_gkey,\n\t\tCategory_Id,\n\t\tUnit_Nbr,\n\t\tMove_Kind,\n\t\tt_put,\n\t\tRequires_Power_Flag,\n\t\tFacility_Id,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tufv_gkey\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'tdt',\n\tfolderPath: 'gold/rehandle_export',\n\ttruncate: true,\n\tmergeSchema: false,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['mve_gkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tufv_gkey,\n\t\tmve_gkey,\n\t\tCategory_Id,\n\t\tUnit_Nbr,\n\t\tMove_Kind,\n\t\tt_put,\n\t\tRequires_Power_Flag,\n\t\tFacility_Id,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tRNumber,\n\t\tMovesPerFcyVisit,\n\t\tRehandlePerFcyVisit\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_gpa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "GetLoads"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter2"
						},
						{
							"name": "GetSHFTs"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Filter4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('gpa')\n}\nsource(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as long,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nsource1 filter(Move_Kind!=\"DSCH\" && Event_Type_Id==\"UNIT_LOAD\") ~> GetLoads\nGetLoads derive(Tier = iif(length(From_Position_Name)==17 || length(From_Position_Name)==15, right(From_Position_Name, 1),''),\n\t\tSlot = iif(length(From_Position_Name)==17 || length(From_Position_Name)==15, dropRight(From_Position_Name, 1),'')) ~> DerivedColumn1\nDerivedColumn1 filter(Tier!='') ~> Filter2\nsource1 filter(Move_Kind!='DSCH' && Event_Type_Id=='UNIT_YARD_SHIFT') ~> GetSHFTs\nGetSHFTs derive(Tier = iif(length(From_Position_Name)==17 || length(From_Position_Name)==15, right(From_Position_Name, 1),''),\n\t\tSlot = iif(length(From_Position_Name)==17 || length(From_Position_Name)==15, dropRight(From_Position_Name, 1),'')) ~> DerivedColumn2\nDerivedColumn2 filter(Tier!='') ~> Filter4\nFilter4 sort(asc(t_put, true)) ~> Sort1\nSort1 select(mapColumn(\n\t\tSlot\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(Slot),\n\teach(match(name!='Slot'), $$ = first($$))) ~> Aggregate1\nFilter2, Aggregate1 join(DerivedColumn1@Slot == Aggregate1@Slot,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 sort(asc(t_put, true)) ~> Sort2\nSort2 alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'gold/rehandle',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tTier,\n\t\tSlot = DerivedColumn1@Slot\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_kssp')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter2"
						},
						{
							"name": "Filter3"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Filter4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('cmsa')\n}\nsource(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as long,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'kssp',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nsource1 filter(Move_Kind!=\"DSCH\" && Event_Type_Id==\"UNIT_LOAD\") ~> Filter1\nFilter1 derive(Tier = iif(length(From_Position_Name)==15 || length(From_Position_Name)==15, right(From_Position_Name, 1),''),\n\t\tSlot = iif(length(From_Position_Name)==15 || length(From_Position_Name)==15, dropRight(From_Position_Name, 1),'')) ~> DerivedColumn1\nDerivedColumn1 filter(Tier!='') ~> Filter2\nsource1 filter(Move_Kind!='DSCH' && Event_Type_Id=='UNIT_YARD_SHIFT') ~> Filter3\nFilter3 derive(Tier = iif(length(From_Position_Name)==15 || length(From_Position_Name)==15, right(From_Position_Name, 1),''),\n\t\tSlot = iif(length(From_Position_Name)==15 || length(From_Position_Name)==15, dropRight(From_Position_Name, 1),'')) ~> DerivedColumn2\nDerivedColumn2 filter(Tier!='') ~> Filter4\nFilter4 sort(asc(t_put, true)) ~> Sort1\nSort1 select(mapColumn(\n\t\tSlot\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(Slot),\n\teach(match(name!='Slot'), $$ = first($$))) ~> Aggregate1\nFilter2, Aggregate1 join(DerivedColumn1@Slot == Aggregate1@Slot,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 sort(asc(t_put, true)) ~> Sort2\nSort2 alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'kssp',\n\tfolderPath: 'gold/rehandle',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_mict')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Find Shift Moves within Stack for a LOAD ctr",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "GetLoadMoves"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter2"
						},
						{
							"name": "GetShiftMoves"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Filter4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('mict')\n}\nsource(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as long,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nsource1 filter(Move_Kind!=\"DSCH\" && Event_Type_Id==\"UNIT_LOAD\") ~> GetLoadMoves\nGetLoadMoves derive(Tier = iif(length(From_Position_Name)==15 || length(From_Position_Name)==15, right(From_Position_Name, 1),''),\n\t\tSlot = iif(length(From_Position_Name)==15 || length(From_Position_Name)==15, dropRight(From_Position_Name, 1),'')) ~> DerivedColumn1\nDerivedColumn1 filter(Tier!='') ~> Filter2\nsource1 filter(Move_Kind!='DSCH' && Event_Type_Id=='UNIT_YARD_SHIFT') ~> GetShiftMoves\nGetShiftMoves derive(Tier = iif(length(From_Position_Name)==15 || length(From_Position_Name)==15, right(From_Position_Name, 1),''),\n\t\tSlot = iif(length(From_Position_Name)==15 || length(From_Position_Name)==15, dropRight(From_Position_Name, 1),'')) ~> DerivedColumn2\nDerivedColumn2 filter(Tier!='') ~> Filter4\nFilter4 sort(asc(t_put, true)) ~> Sort1\nSort1 select(mapColumn(\n\t\tSlot\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(Slot),\n\teach(match(name!='Slot'), $$ = first($$))) ~> Aggregate1\nFilter2, Aggregate1 join(DerivedColumn1@Slot == Aggregate1@Slot,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 sort(asc(t_put, true)) ~> Sort2\nSort2 alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'gold/rehandle',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_mnhpi')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Find Shift Moves within Stack for a LOAD ctr",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "GetLoadMoves"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter2"
						},
						{
							"name": "GetShiftMoves"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Filter4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('mnhpi')\n}\nsource(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as long,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nsource1 filter(Move_Kind!=\"DSCH\" && Event_Type_Id==\"UNIT_LOAD\") ~> GetLoadMoves\nGetLoadMoves derive(Tier = iif(length(From_Position_Name)==14 || length(From_Position_Name)==14, right(From_Position_Name, 1),''),\n\t\tSlot = iif(length(From_Position_Name)==14 || length(From_Position_Name)==14, dropRight(From_Position_Name, 1),'')) ~> DerivedColumn1\nDerivedColumn1 filter(Tier!='') ~> Filter2\nsource1 filter(Move_Kind!='DSCH' && Event_Type_Id=='UNIT_YARD_SHIFT') ~> GetShiftMoves\nGetShiftMoves derive(Tier = iif(length(From_Position_Name)==14 || length(From_Position_Name)==14, right(From_Position_Name, 1),''),\n\t\tSlot = iif(length(From_Position_Name)==14 || length(From_Position_Name)==14, dropRight(From_Position_Name, 1),'')) ~> DerivedColumn2\nDerivedColumn2 filter(Tier!='') ~> Filter4\nFilter4 sort(asc(t_put, true)) ~> Sort1\nSort1 select(mapColumn(\n\t\tSlot\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(Slot),\n\teach(match(name!='Slot'), $$ = first($$))) ~> Aggregate1\nFilter2, Aggregate1 join(DerivedColumn1@Slot == Aggregate1@Slot,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 sort(asc(t_put, true)) ~> Sort2\nSort2 alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'gold/rehandle',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_new_agct')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "filter1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as string,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as integer,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as short\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: true,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'agct',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ';',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> MoveHistory\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_put,'dd MM yy HH:mm')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_fetch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_fetch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_fetch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_fetch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_fetch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yy HH:mm:ss'),toTimestamp(t_discharge,'dd.MM.yy HH:mm:ss'),toTimestamp(t_discharge,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_discharge,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_discharge,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_discharge,'dd-MM-yyyy HH:mm:ss')),\n\t\tYear = year(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_put,'dd MM yy HH:mm'))),\n\t\tMonth = month(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_put,'dd MM yy HH:mm'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_put,'dd MM yy HH:mm'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_dispatch,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_dispatch,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_dispatch,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_fetch_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_fetch_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_fetch_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd.MM.yy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_carry_put_ready,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_carry_put_ready,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_carry_put_ready,'dd-MM-yyyy HH:mm:ss')),\n\t\tDate = toDate(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_put,'dd MM yy HH:mm'))),\n\t\tYear_Week = (year(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_put,'dd MM yy HH:mm'))) * 100) + weekOfYear(coalesce(toTimestamp(t_put,'MM/dd/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yy HH:mm:ss'),toTimestamp(t_put,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(t_put,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(t_put,'dd/MM/yyyy HH:mm:ss'),toTimestamp(t_put,'dd-MM-yyyy HH:mm:ss'),toTimestamp(t_put,'dd MM yy HH:mm')))) ~> DataTypeConversion\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nMoveHistory select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tpow,\n\t\tmve_gkey,\n\t\tactive_ufv,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect2 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion filter(!isNull(mve_gkey) && !isNull(t_put) && !isNull({Unit Nbr})) ~> filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'agct',\n\tfolderPath: 'gold/rehandle',\n\tmergeSchema: false,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tpow,\n\t\tactive_ufv,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tYear_Week\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]",
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_new_cmsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "filter1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as string,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as string,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as string,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as string,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as string,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as double,\n\t\tactive_ufv as integer,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as short\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: true,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'bronze/movehistory/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> MoveHistory\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(split(t_carry_complete,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_carry_complete,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tt_put = coalesce(toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tt_fetch = coalesce(toTimestamp(split(t_fetch,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_fetch,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tt_discharge = coalesce(toTimestamp(split(t_discharge,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_discharge,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tYear = year(coalesce(toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm'))),\n\t\tMonth = month(coalesce(toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm'))),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm'))),\n\t\tt_dispatch = coalesce(toTimestamp(split(t_dispatch,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_dispatch,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(split(t_carry_dispatch,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_carry_dispatch,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(split(t_carry_fetch_ready,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_carry_fetch_ready,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(split(t_carry_put_ready,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_carry_put_ready,\".\")[1],'yyyy-MM-dd HH:mm')),\n\t\tDate = toDate(coalesce(toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm'))),\n\t\tYear_Week = (year(coalesce(toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm'))) * 100) + weekOfYear(coalesce(toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm:ss'),toTimestamp(split(t_put,\".\")[1],'yyyy-MM-dd HH:mm')))) ~> DataTypeConversion\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nMoveHistory select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tpow,\n\t\tmve_gkey,\n\t\tactive_ufv,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect2 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion filter(!isNull(mve_gkey) && !isNull(t_put) && !isNull({Unit Nbr})) ~> filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as string,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as string,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as string,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as string,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as string,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tpow as string,\n\t\tactive_ufv as integer,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tDate as date,\n\t\tYear_Week as integer\n\t),\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'gold/rehandle',\n\tmergeSchema: false,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tpow,\n\t\tactive_ufv,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tYear_Week\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]",
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_new_mict')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "filter1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: true,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'silver/moves',\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> MoveHistory\nSelect1 derive(Date = t_put,\n\t\tYear_Week = (Year * 100) + Week) ~> DataTypeConversion\nMoveHistory select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nfilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion filter(!isNull(mve_gkey) && !isNull(t_put) && !isNull({Unit_Nbr})) ~> filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'gold/rehandle',\n\tmergeSchema: false,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tpow,\n\t\tactive_ufv,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tYear_Week\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_new_mnhpi')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "filter1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: true,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delta',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'silver/moves',\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> MoveHistory\nMoveHistory derive(Year_Week = (Year * 100) + Week,\n\t\tDate = toDate(t_put)) ~> DataTypeConversion\nfilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion filter(!isNull(mve_gkey) && !isNull(t_put) && !isNull(Unit_Nbr)) ~> filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'gold/rehandle',\n\tmergeSchema: false,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tt_put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tDate,\n\t\tYear_Week,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]",
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_plipdeco')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter2"
						},
						{
							"name": "Filter3"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Filter4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('cmsa')\n}\nsource(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as long,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'plipdeco',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nsource1 filter(Move_Kind!=\"DSCH\" && Event_Type_Id==\"UNIT_LOAD\") ~> Filter1\nFilter1 derive(Tier = iif(length(From_Position_Name)==15 || length(From_Position_Name)==15, right(From_Position_Name, 1),''),\n\t\tSlot = iif(length(From_Position_Name)==15 || length(From_Position_Name)==15, dropRight(From_Position_Name, 1),'')) ~> DerivedColumn1\nDerivedColumn1 filter(Tier!='') ~> Filter2\nsource1 filter(Move_Kind!='DSCH' && Event_Type_Id=='UNIT_YARD_SHIFT') ~> Filter3\nFilter3 derive(Tier = iif(length(From_Position_Name)==15 || length(From_Position_Name)==15, right(From_Position_Name, 1),''),\n\t\tSlot = iif(length(From_Position_Name)==15 || length(From_Position_Name)==15, dropRight(From_Position_Name, 1),'')) ~> DerivedColumn2\nDerivedColumn2 filter(Tier!='') ~> Filter4\nFilter4 sort(asc(t_put, true)) ~> Sort1\nSort1 select(mapColumn(\n\t\tSlot\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(Slot),\n\teach(match(name!='Slot'), $$ = first($$))) ~> Aggregate1\nFilter2, Aggregate1 join(DerivedColumn1@Slot == Aggregate1@Slot,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 sort(asc(t_put, true)) ~> Sort2\nSort2 alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'plipdeco',\n\tfolderPath: 'gold/rehandle',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_rdsc_export_gpa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Find unproductive moves for RDSC Full Export ctrs in GCT facility",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "IBAndUnproductiveMoves"
						},
						{
							"name": "IBExprtFull"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Select1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "window1"
						},
						{
							"name": "select2"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "select3"
						},
						{
							"name": "filter1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('gpa')\n}\nsource(output(\n\t\tmve_gkey as long,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as long,\n\t\tdist_start as long,\n\t\tTwin_Fetch as boolean,\n\t\tTwin_Carry as boolean,\n\t\tTwin_Put as boolean,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tRestow_Reason as string,\n\t\tPOW as string,\n\t\tufv_gkey as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tRequires_Power_Flag as boolean,\n\t\tOOG_Flag as boolean,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as long,\n\t\tComplex_Id as string,\n\t\tCarrier_Visit_Id as string,\n\t\tPhase as string,\n\t\tVisit_Nbr as string,\n\t\tCarrier_Mode as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\tOperator_Line_Id as string,\n\t\tOperator_Line_Role as string,\n\t\tOperator_Line_Name as string,\n\t\tTime_First_Availabilty as string,\n\t\tTime_Discharge_Complete as string,\n\t\tService_Id as string,\n\t\tService_Name as string,\n\t\tVessel_Id as string,\n\t\tIB_VYG as string,\n\t\tOB_VYG as string,\n\t\tCarrier_Name as string,\n\t\tVessel_Class as string,\n\t\tPublished_ETA as string,\n\t\tPublished_ETD as string,\n\t\tStart_Work as string,\n\t\tEnd_Work as string,\n\t\tBegin_Receive_Date as string,\n\t\tCargo_Cutoff_Date as string,\n\t\tHazard_Cutoff_Date as string,\n\t\tReefer_Cutoff_Date as string,\n\t\tLabor_On_Board_Date as string,\n\t\tLabor_Off_Board_Date as string,\n\t\tOff_Port_Arrival_Date as string,\n\t\tOff_Port_Departure as string,\n\t\tPilot_On_Board_Date as string,\n\t\tPilot_Off_Board_Date as string,\n\t\tEst_BBK_Discharge as string,\n\t\tEst_BBK_Load as string,\n\t\tEst_Load as string,\n\t\tEst_Discharge as string,\n\t\tEst_Restow as string,\n\t\tEst_Shift as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\tVessel_Classification as string,\n\t\tVessel_Class_Length_Overall_cm as integer,\n\t\tVessel_Class_Beam_cm as string,\n\t\tVessel_TEU_Capacity as string,\n\t\tLloyds_Code as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nderivedColumn3 filter((FromEB_WB==0 && ( Move_Kind=='LOAD'||Move_Kind=='RDSC' || ( (Move_Kind=='YARD' || Move_Kind=='SHFT') && To_Position_Name!='Y-GCT-???') ) )) ~> IBAndUnproductiveMoves\nsource1 filter((Category_Id=='EXPRT' && Freight_Kind_Id=='FCL'  && Facility_Id=='GCT' && Move_Kind=='RDSC'  )) ~> IBExprtFull\nIBExprtFull derive(Max_T_Put = addDays(t_put,14),\n\t\tufv_gkey = toLong(ufv_gkey)) ~> DerivedColumn2\nDerivedColumn2 select(mapColumn(\n\t\tIB_mve_gkey = mve_gkey,\n\t\tIB_t_put = t_put,\n\t\tIB_ufv_gkey = ufv_gkey,\n\t\tIB_Max_T_Put = Max_T_Put,\n\t\tIB_Unit_Nbr = Unit_Nbr,\n\t\tIB_Facility_Id = Facility_Id,\n\t\tIB_Move_Kind = Move_Kind,\n\t\tIB_Requires_Power_Flag = Requires_Power_Flag\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nselect2, Select1 join(ufv_gkey == IB_ufv_gkey,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'right')~> Join1\nJoin1 sort(asc(IB_ufv_gkey, true),\n\tasc(IB_t_put, true),\n\tasc(t_put, true),\n\tasc(mve_gkey, true)) ~> Sort2\nwindow1 alterRow(insertIf(true())) ~> AlterRow1\nSort2 window(over(IB_ufv_gkey),\n\tasc(t_put, true),\n\tasc(mve_gkey, true),\n\tRNumber = rowNumber(),\n\t\tMovesPerUnitFcyVisit = count(mve_gkey)) ~> window1\nIBAndUnproductiveMoves select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tMove_Kind,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tt_put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tufv_gkey,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tFromEB_WB\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select2\nfilter1 derive(ufv_gkey = toLong(ufv_gkey),\n\t\tFromEB_WB = iif( ( (Move_Kind=='YARD'|| Move_Kind=='SHFT') && like(From_Position_Name,'Y-GCT-EB%')), 1, iif( ( (Move_Kind=='YARD'|| Move_Kind=='SHFT') && like(From_Position_Name,'Y-GCT-WB%')), 1, 0) )) ~> derivedColumn3\nsource1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tt_put,\n\t\tt_fetch,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tufv_gkey,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select3\nselect3 filter((Category_Id=='EXPRT' && Freight_Kind_Id=='FCL' && Facility_Id=='GCT')) ~> filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'gold/rehandle_rdsc_export',\n\ttruncate: true,\n\tmergeSchema: false,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['mve_gkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tMove_Kind,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tt_put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tufv_gkey,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tFromEB_WB,\n\t\tIB_mve_gkey,\n\t\tIB_t_put,\n\t\tIB_ufv_gkey,\n\t\tIB_Max_T_Put,\n\t\tIB_Unit_Nbr,\n\t\tIB_Facility_Id,\n\t\tIB_Move_Kind,\n\t\tIB_Requires_Power_Flag,\n\t\tRNumber,\n\t\tMovesPerUnitFcyVisit\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_seayard')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "filter1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as short,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as string,\n\t\tdist_start as string,\n\t\tTwin_Fetch as boolean,\n\t\tTwin_Carry as boolean,\n\t\tTwin_Put as boolean,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as boolean,\n\t\tOOG_Flag as boolean,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: true,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delta',\n\tfileSystem: 'seayard',\n\tfolderPath: 'silver/moves',\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> MoveHistory\nSelect1 derive(Date = t_put,\n\t\tYear_Week = (Year * 100) + Week) ~> DataTypeConversion\nMoveHistory select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA,\n\t\tATD,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nfilter1 alterRow(upsertIf(true())) ~> AlterRow1\nDataTypeConversion filter(!isNull(mve_gkey) && !isNull(t_put) && !isNull({Unit_Nbr})) ~> filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'seayard',\n\tfolderPath: 'gold/rehandle',\n\tmergeSchema: false,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tpow,\n\t\tactive_ufv,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tYear_Week\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_sgtd')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "filter1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: true,\n\tinferDriftedColumnTypes: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delta',\n\tfileSystem: 'sgtd',\n\tfolderPath: 'silver/moves',\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> MoveHistory\nAggregate1 derive(Date = t_put,\n\t\tYear_Week = (Year* 100) + Week) ~> DataTypeConversion\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nMoveHistory select(mapColumn(\n\t\t{Unit Nbr} = Unit_Nbr,\n\t\t{Event Type Id} = Event_Type_Id,\n\t\t{Move Kind} = Move_Kind,\n\t\tt_put,\n\t\t{Category Id} = Category_Id,\n\t\t{Freight Kind Id} = Freight_Kind_Id,\n\t\tmve_gkey,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect2 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion filter(!isNull(mve_gkey) && !isNull(t_put) && !isNull({Unit Nbr})) ~> filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'sgtd',\n\tfolderPath: 'gold/rehandle',\n\tmergeSchema: false,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tt_put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tDate,\n\t\tYear_Week,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]",
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_tauranga')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DataTypeConversion"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "filter1"
						}
					],
					"script": "source(output(\n\t\t{Unit Nbr} as string,\n\t\t{Facility Id} as string,\n\t\t{Complex Id} as string,\n\t\t{Yard Id} as string,\n\t\t{Carrier Visit Key} as long,\n\t\t{Event Type Id} as string,\n\t\t{Move Kind} as string,\n\t\t{From Location} as string,\n\t\t{To Location} as string,\n\t\t{From Position Name} as string,\n\t\t{To Position Name} as string,\n\t\t{Carry CHE Operator Id} as string,\n\t\t{Fetch CHE Operator Id} as string,\n\t\t{Put CHE Operator Id} as string,\n\t\t{Fetch CHE Id} as short,\n\t\t{Fetch CHE Kind} as string,\n\t\t{Carry CHE Id} as short,\n\t\t{Carry CHE Kind} as string,\n\t\t{Put CHE Id} as short,\n\t\t{Put CHE Kind} as string,\n\t\t{QC CHE Id} as short,\n\t\t{QC CHE Kind} as string,\n\t\tt_carry_complete as string,\n\t\tt_put as string,\n\t\tt_fetch as string,\n\t\tt_dispatch as string,\n\t\tt_discharge as string,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\t{Twin Fetch} as boolean,\n\t\t{Twin Carry} as boolean,\n\t\t{Twin Put} as boolean,\n\t\t{Category Id} as string,\n\t\t{Freight Kind Id} as string,\n\t\tto_pos_gkey as long,\n\t\tfm_pos_gkey as long,\n\t\t{Restow Reason} as string,\n\t\t{Container Line Id} as string,\n\t\t{Container Line Role} as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\t{Berth Id} as string,\n\t\t{Goods And Ctr Wt Kg} as double,\n\t\tactive_ufv as long,\n\t\t{Requires Power Flag} as boolean,\n\t\t{OOG Flag} as boolean,\n\t\t{Shipper Id} as string,\n\t\t{Consignee Id} as string,\n\t\t{Commodity Id} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tRehandles as short\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: true,\n\tmoveFiles: ['bronze/moves/load','bronze/moves/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'tauranga',\n\tfolderPath: 'bronze/moves/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> MoveHistory\nAggregate1 derive(t_carry_complete = coalesce(toTimestamp(t_carry_complete,'dd/MM/yy HH:mm:ss')),\n\t\tt_put = coalesce(toTimestamp(t_put,'dd/MM/yy HH:mm:ss')),\n\t\tt_fetch = coalesce(toTimestamp(t_fetch,'dd/MM/yy HH:mm:ss')),\n\t\tt_discharge = coalesce(toTimestamp(t_discharge,'dd/MM/yy HH:mm:ss')),\n\t\tYear = year(coalesce(toTimestamp(t_put,'dd/MM/yy HH:mm:ss'))),\n\t\tMonth = month(toTimestamp(t_put,'dd/MM/yy HH:mm:ss')),\n\t\tWeek = weekOfYear(coalesce(toTimestamp(t_put,'dd/MM/yy HH:mm:ss'))),\n\t\tt_dispatch = coalesce(toTimestamp(t_dispatch,'dd/MM/yy HH:mm:ss')),\n\t\tt_carry_dispatch = coalesce(toTimestamp(t_carry_dispatch,'dd/MM/yy HH:mm:ss')),\n\t\tt_carry_fetch_ready = coalesce(toTimestamp(t_carry_fetch_ready,'dd/MM/yy HH:mm:ss')),\n\t\tt_carry_put_ready = coalesce(toTimestamp(t_carry_put_ready,'dd/MM/yy HH:mm:ss')),\n\t\tDate = coalesce(toTimestamp(t_put,'dd/MM/yy HH:mm:ss')),\n\t\tYear_Week = (year(coalesce(toTimestamp(t_put,'dd/MM/yy HH:mm:ss'))) * 100) + weekOfYear(coalesce(toTimestamp(t_put,'dd/MM/yy HH:mm:ss')))) ~> DataTypeConversion\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nMoveHistory select(mapColumn(\n\t\t{Unit Nbr},\n\t\t{Complex Id},\n\t\t{Yard Id},\n\t\t{Carrier Visit Key},\n\t\t{Event Type Id},\n\t\t{Move Kind},\n\t\t{Carry CHE Operator Id},\n\t\t{Fetch CHE Operator Id},\n\t\t{Put CHE Operator Id},\n\t\t{Fetch CHE Id},\n\t\t{Fetch CHE Kind},\n\t\t{Carry CHE Id},\n\t\t{Carry CHE Kind},\n\t\t{Put CHE Id},\n\t\t{Put CHE Kind},\n\t\t{QC CHE Id},\n\t\t{QC CHE Kind},\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\t{Category Id},\n\t\t{Freight Kind Id},\n\t\tpow,\n\t\tmve_gkey,\n\t\tactive_ufv,\n\t\tRehandles\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect2 alterRow(upsertIf(true())) ~> AlterRow1\nfilter1 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDataTypeConversion filter(!isNull(mve_gkey) && !isNull(t_put) && !isNull({Unit Nbr})) ~> filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'tauranga',\n\tfolderPath: 'gold/rehandle',\n\tmergeSchema: false,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tpow,\n\t\tactive_ufv,\n\t\tRehandles,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tYear_Week\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]",
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_ufv_tdt')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Grouping by UFV;  exclude YARD Moves;",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Sort2"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "window1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('tdt')\n}\nsource(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as long,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'tdt',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nfilter1 sort(asc(ufv_gkey, true),\n\tasc(t_put, true)) ~> Sort2\nwindow1 alterRow(upsertIf(true())) ~> AlterRow1\nSort2 window(over(ufv_gkey,\n\t\tFacility_Id),\n\tasc(t_put, true),\n\tasc(mve_gkey, true),\n\tRNumber = rowNumber(),\n\t\tMovesPerFcyVisit = count(mve_gkey)) ~> window1\nsource1 select(mapColumn(\n\t\tmve_gkey,\n\t\tCategory_Id,\n\t\tUnit_Nbr,\n\t\tMove_Kind,\n\t\tt_put,\n\t\tRequires_Power_Flag,\n\t\tFacility_Id,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tufv_gkey,\n\t\tEvent_Type_Id\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select2\nselect2 filter(Event_Type_Id!='UNIT_YARD_MOVE') ~> filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'tdt',\n\tfolderPath: 'gold/rehandle_ufv',\n\ttruncate: true,\n\tmergeSchema: false,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['mve_gkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tCategory_Id,\n\t\tUnit_Nbr,\n\t\tMove_Kind,\n\t\tt_put,\n\t\tRequires_Power_Flag,\n\t\tFacility_Id,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tufv_gkey,\n\t\tEvent_Type_Id,\n\t\tRNumber,\n\t\tMovesPerFcyVisit\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_within_Vessel')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source3"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "lookup1"
						},
						{
							"name": "select1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select2"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as integer,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as short,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as integer,",
						"          dist_start as short,",
						"          Twin_Fetch as string,",
						"          Twin_Carry as string,",
						"          Twin_Put as string,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as string,",
						"          OOG_Flag as string,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'valencia',",
						"     folderPath: 'silver/moves') ~> source1",
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as string,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as string,",
						"          startDistance as short,",
						"          workAssignmentId as double,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'valencia',",
						"     folderPath: 'silver/ecevents') ~> source2",
						"source(output(",
						"          Carrier_Visit_Key as integer,",
						"          Complex_Id as string,",
						"          Facility_Id as string,",
						"          Carrier_Visit_Id as string,",
						"          Phase as string,",
						"          Visit_Nbr as string,",
						"          Carrier_Mode as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          ETA as timestamp,",
						"          ETD as timestamp,",
						"          Operator_Line_Id as string,",
						"          Operator_Line_Role as string,",
						"          Operator_Line_Name as string,",
						"          Time_First_Availabilty as string,",
						"          Time_Discharge_Complete as string,",
						"          Service_Id as string,",
						"          Service_Name as string,",
						"          Vessel_Id as string,",
						"          IB_VYG as string,",
						"          OB_VYG as string,",
						"          Carrier_Name as string,",
						"          Vessel_Class as string,",
						"          Published_ETA as string,",
						"          Published_ETD as string,",
						"          Start_Work as string,",
						"          End_Work as string,",
						"          Begin_Receive_Date as string,",
						"          Cargo_Cutoff_Date as string,",
						"          Hazard_Cutoff_Date as string,",
						"          Reefer_Cutoff_Date as string,",
						"          Labor_On_Board_Date as string,",
						"          Labor_Off_Board_Date as string,",
						"          Off_Port_Arrival_Date as string,",
						"          Off_Port_Departure as string,",
						"          Pilot_On_Board_Date as string,",
						"          Pilot_Off_Board_Date as string,",
						"          Est_BBK_Discharge as string,",
						"          Est_BBK_Load as string,",
						"          Est_Load as string,",
						"          Est_Discharge as string,",
						"          Est_Restow as string,",
						"          Est_Shift as string,",
						"          vvFlexString01 as string,",
						"          vvFlexString02 as string,",
						"          vvFlexString03 as string,",
						"          vvFlexString04 as string,",
						"          vvFlexString05 as string,",
						"          vvFlexString06 as string,",
						"          vvFlexString07 as string,",
						"          vvFlexString08 as string,",
						"          vvFlexDate01 as string,",
						"          vvFlexDate02 as string,",
						"          vvFlexDate03 as string,",
						"          vvFlexDate04 as string,",
						"          vvFlexDate05 as string,",
						"          vvFlexDate06 as string,",
						"          vvFlexDate07 as string,",
						"          vvFlexDate08 as string,",
						"          Vessel_Classification as string,",
						"          Vessel_Class_Length_Overall_cm as integer,",
						"          Vessel_Class_Beam_cm as short,",
						"          Vessel_TEU_Capacity as string,",
						"          Lloyds_Code as string,",
						"          TimeFirstAvailabilty as timestamp,",
						"          StartWork as timestamp,",
						"          TimeDischargeComplete as timestamp,",
						"          EndWork as timestamp,",
						"          Week as integer,",
						"          Year as integer,",
						"          Month as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'valencia',",
						"     folderPath: 'silver/vesselvisits') ~> source3",
						"source2 filter(typeDescription=='MNRH' && (powName!='GATE'&&powName!='RAIL'&&powName!='RAIL 2'&&powName!='REHANDLES'&&powName!='UNASSIGNED'&&powName!='VGM'&&powName!='YARD')) ~> filter1",
						"filter1 derive(Vessel_Id = split(workQueue,'-')[1]) ~> derivedColumn1",
						"source1 filter(Event_Type_Id=='UNIT_LOAD'||Event_Type_Id=='UNIT_PAYLOAD_LOAD') ~> filter2",
						"filter2, source3 lookup(source1@Carrier_Visit_Key == source3@Carrier_Visit_Key,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> lookup1",
						"lookup1 select(mapColumn(",
						"          mve_gkey,",
						"          Unit_Nbr,",
						"          Facility_Id = source1@Facility_Id,",
						"          Complex_Id = source1@Complex_Id,",
						"          Yard_Id,",
						"          Carrier_Visit_Key = source1@Carrier_Visit_Key,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Location,",
						"          To_Location,",
						"          From_Position_Name,",
						"          To_Position_Name,",
						"          Carry_CHE_Operator_Id,",
						"          Fetch_CHE_Operator_Id,",
						"          Put_CHE_Operator_Id,",
						"          Fetch_CHE_Id,",
						"          Fetch_CHE_Kind,",
						"          Carry_CHE_Id,",
						"          Carry_CHE_Kind,",
						"          Put_CHE_Id,",
						"          Put_CHE_Kind,",
						"          QC_CHE_Id,",
						"          QC_CHE_Kind,",
						"          t_carry_complete,",
						"          t_put,",
						"          t_fetch,",
						"          t_dispatch,",
						"          t_discharge,",
						"          t_carry_dispatch,",
						"          t_carry_fetch_ready,",
						"          t_carry_put_ready,",
						"          dist_carry,",
						"          dist_start,",
						"          Twin_Fetch,",
						"          Twin_Carry,",
						"          Twin_Put,",
						"          Category_Id,",
						"          Freight_Kind_Id,",
						"          to_pos_gkey,",
						"          fm_pos_gkey,",
						"          Restow_Reason,",
						"          Container_Line_Id,",
						"          Container_Line_Role,",
						"          pow,",
						"          ufv_gkey,",
						"          Berth_Id,",
						"          Goods_And_Ctr_Wt_Kg,",
						"          active_ufv,",
						"          Requires_Power_Flag,",
						"          OOG_Flag,",
						"          Shipper_Id,",
						"          Consignee_Id,",
						"          Commodity_Id,",
						"          ATA = source1@ATA,",
						"          ATD = source1@ATD,",
						"          Rehandles,",
						"          Year = source1@Year,",
						"          Month = source1@Month,",
						"          Week = source1@Week,",
						"          Vessel_Id",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"derivedColumn1, select1 join(unitIdName == Unit_Nbr",
						"     && derivedColumn1@Vessel_Id == select1@Vessel_Id",
						"     && EcEventTime >= ATA",
						"     && EcEventTime <= ATD,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'left')~> join1",
						"join1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          cheName,",
						"          cheID,",
						"          EcEventTime,",
						"          type,",
						"          subType,",
						"          typeDescription,",
						"          fromCheIdName,",
						"          ToCheIdName,",
						"          unitIdName,",
						"          powName,",
						"          poolName,",
						"          workQueue,",
						"          travelDistance,",
						"          moveKind,",
						"          isTwinMove,",
						"          startDistance,",
						"          workAssignmentId,",
						"          unitReference,",
						"          tranId,",
						"          locType,",
						"          locId,",
						"          locSlot,",
						"          opsPosId,",
						"          unladenLoctype,",
						"          unladenLocid,",
						"          unladenLocSlot,",
						"          ladenLoctype,",
						"          ladenLocid,",
						"          ladenLocSlot,",
						"          lastEstMoveTime,",
						"          Year = source2@Year,",
						"          Month = source2@Month,",
						"          Week = source2@Week,",
						"          Vessel_Id = derivedColumn1@Vessel_Id",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"aggregate1 alterRow(upsertIf(true())) ~> AlterRow1",
						"select2 aggregate(groupBy(ecEventGkey),",
						"     each(match(name!='ecEventGkey'), $$ = first($$))) ~> aggregate1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'valencia',",
						"     folderPath: 'gold/rehandle_vessel',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_within_Vessel_aarhus')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source3"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "lookup1"
						},
						{
							"name": "select1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select2"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as integer,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as short,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as integer,",
						"          dist_start as short,",
						"          Twin_Fetch as string,",
						"          Twin_Carry as string,",
						"          Twin_Put as string,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as string,",
						"          OOG_Flag as string,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'apmtaarhus',",
						"     folderPath: 'silver/moves') ~> source1",
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as string,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as string,",
						"          startDistance as short,",
						"          workAssignmentId as double,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'apmtaarhus',",
						"     folderPath: 'silver/ecevents') ~> source2",
						"source(output(",
						"          Carrier_Visit_Key as integer,",
						"          Complex_Id as string,",
						"          Facility_Id as string,",
						"          Carrier_Visit_Id as string,",
						"          Phase as string,",
						"          Visit_Nbr as string,",
						"          Carrier_Mode as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          ETA as timestamp,",
						"          ETD as timestamp,",
						"          Operator_Line_Id as string,",
						"          Operator_Line_Role as string,",
						"          Operator_Line_Name as string,",
						"          Time_First_Availabilty as string,",
						"          Time_Discharge_Complete as string,",
						"          Service_Id as string,",
						"          Service_Name as string,",
						"          Vessel_Id as string,",
						"          IB_VYG as string,",
						"          OB_VYG as string,",
						"          Carrier_Name as string,",
						"          Vessel_Class as string,",
						"          Published_ETA as string,",
						"          Published_ETD as string,",
						"          Start_Work as string,",
						"          End_Work as string,",
						"          Begin_Receive_Date as string,",
						"          Cargo_Cutoff_Date as string,",
						"          Hazard_Cutoff_Date as string,",
						"          Reefer_Cutoff_Date as string,",
						"          Labor_On_Board_Date as string,",
						"          Labor_Off_Board_Date as string,",
						"          Off_Port_Arrival_Date as string,",
						"          Off_Port_Departure as string,",
						"          Pilot_On_Board_Date as string,",
						"          Pilot_Off_Board_Date as string,",
						"          Est_BBK_Discharge as string,",
						"          Est_BBK_Load as string,",
						"          Est_Load as string,",
						"          Est_Discharge as string,",
						"          Est_Restow as string,",
						"          Est_Shift as string,",
						"          vvFlexString01 as string,",
						"          vvFlexString02 as string,",
						"          vvFlexString03 as string,",
						"          vvFlexString04 as string,",
						"          vvFlexString05 as string,",
						"          vvFlexString06 as string,",
						"          vvFlexString07 as string,",
						"          vvFlexString08 as string,",
						"          vvFlexDate01 as string,",
						"          vvFlexDate02 as string,",
						"          vvFlexDate03 as string,",
						"          vvFlexDate04 as string,",
						"          vvFlexDate05 as string,",
						"          vvFlexDate06 as string,",
						"          vvFlexDate07 as string,",
						"          vvFlexDate08 as string,",
						"          Vessel_Classification as string,",
						"          Vessel_Class_Length_Overall_cm as integer,",
						"          Vessel_Class_Beam_cm as short,",
						"          Vessel_TEU_Capacity as string,",
						"          Lloyds_Code as string,",
						"          TimeFirstAvailabilty as timestamp,",
						"          StartWork as timestamp,",
						"          TimeDischargeComplete as timestamp,",
						"          EndWork as timestamp,",
						"          Week as integer,",
						"          Year as integer,",
						"          Month as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'apmtaarhus',",
						"     folderPath: 'silver/vesselvisits') ~> source3",
						"source2 filter(typeDescription=='MNRH' && (powName!='GATE'&&powName!='RAIL'&&powName!='RAIL 2'&&powName!='REHANDLES'&&powName!='UNASSIGNED'&&powName!='VGM'&&powName!='YARD')) ~> filter1",
						"filter1 derive(Vessel_Id = split(workQueue,'-')[1]) ~> derivedColumn1",
						"source1 filter(Event_Type_Id=='UNIT_LOAD'||Event_Type_Id=='UNIT_PAYLOAD_LOAD') ~> filter2",
						"filter2, source3 lookup(source1@Carrier_Visit_Key == source3@Carrier_Visit_Key,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> lookup1",
						"lookup1 select(mapColumn(",
						"          mve_gkey,",
						"          Unit_Nbr,",
						"          Facility_Id = source1@Facility_Id,",
						"          Complex_Id = source1@Complex_Id,",
						"          Yard_Id,",
						"          Carrier_Visit_Key = source1@Carrier_Visit_Key,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Location,",
						"          To_Location,",
						"          From_Position_Name,",
						"          To_Position_Name,",
						"          Carry_CHE_Operator_Id,",
						"          Fetch_CHE_Operator_Id,",
						"          Put_CHE_Operator_Id,",
						"          Fetch_CHE_Id,",
						"          Fetch_CHE_Kind,",
						"          Carry_CHE_Id,",
						"          Carry_CHE_Kind,",
						"          Put_CHE_Id,",
						"          Put_CHE_Kind,",
						"          QC_CHE_Id,",
						"          QC_CHE_Kind,",
						"          t_carry_complete,",
						"          t_put,",
						"          t_fetch,",
						"          t_dispatch,",
						"          t_discharge,",
						"          t_carry_dispatch,",
						"          t_carry_fetch_ready,",
						"          t_carry_put_ready,",
						"          dist_carry,",
						"          dist_start,",
						"          Twin_Fetch,",
						"          Twin_Carry,",
						"          Twin_Put,",
						"          Category_Id,",
						"          Freight_Kind_Id,",
						"          to_pos_gkey,",
						"          fm_pos_gkey,",
						"          Restow_Reason,",
						"          Container_Line_Id,",
						"          Container_Line_Role,",
						"          pow,",
						"          ufv_gkey,",
						"          Berth_Id,",
						"          Goods_And_Ctr_Wt_Kg,",
						"          active_ufv,",
						"          Requires_Power_Flag,",
						"          OOG_Flag,",
						"          Shipper_Id,",
						"          Consignee_Id,",
						"          Commodity_Id,",
						"          ATA = source1@ATA,",
						"          ATD = source1@ATD,",
						"          Rehandles,",
						"          Year = source1@Year,",
						"          Month = source1@Month,",
						"          Week = source1@Week,",
						"          Vessel_Id",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"derivedColumn1, select1 join(unitIdName == Unit_Nbr",
						"     && derivedColumn1@Vessel_Id == select1@Vessel_Id",
						"     && EcEventTime >= ATA",
						"     && EcEventTime <= ATD,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'left')~> join1",
						"join1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          cheName,",
						"          cheID,",
						"          EcEventTime,",
						"          type,",
						"          subType,",
						"          typeDescription,",
						"          fromCheIdName,",
						"          ToCheIdName,",
						"          unitIdName,",
						"          powName,",
						"          poolName,",
						"          workQueue,",
						"          travelDistance,",
						"          moveKind,",
						"          isTwinMove,",
						"          startDistance,",
						"          workAssignmentId,",
						"          unitReference,",
						"          tranId,",
						"          locType,",
						"          locId,",
						"          locSlot,",
						"          opsPosId,",
						"          unladenLoctype,",
						"          unladenLocid,",
						"          unladenLocSlot,",
						"          ladenLoctype,",
						"          ladenLocid,",
						"          ladenLocSlot,",
						"          lastEstMoveTime,",
						"          Year = source2@Year,",
						"          Month = source2@Month,",
						"          Week = source2@Week,",
						"          Vessel_Id = derivedColumn1@Vessel_Id",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"aggregate1 alterRow(upsertIf(true())) ~> AlterRow1",
						"select2 aggregate(groupBy(ecEventGkey),",
						"     each(match(name!='ecEventGkey'), $$ = first($$))) ~> aggregate1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'apmtaarhus',",
						"     folderPath: 'gold/rehandle_vessel',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_within_Vessel_aqaba')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source3"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "lookup1"
						},
						{
							"name": "select1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select2"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as integer,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as short,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as integer,",
						"          dist_start as short,",
						"          Twin_Fetch as string,",
						"          Twin_Carry as string,",
						"          Twin_Put as string,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as string,",
						"          OOG_Flag as string,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'apmtaqaba',",
						"     folderPath: 'silver/moves') ~> source1",
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as string,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as string,",
						"          startDistance as short,",
						"          workAssignmentId as double,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'apmtaqaba',",
						"     folderPath: 'silver/ecevents') ~> source2",
						"source(output(",
						"          Carrier_Visit_Key as integer,",
						"          Complex_Id as string,",
						"          Facility_Id as string,",
						"          Carrier_Visit_Id as string,",
						"          Phase as string,",
						"          Visit_Nbr as string,",
						"          Carrier_Mode as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          ETA as timestamp,",
						"          ETD as timestamp,",
						"          Operator_Line_Id as string,",
						"          Operator_Line_Role as string,",
						"          Operator_Line_Name as string,",
						"          Time_First_Availabilty as string,",
						"          Time_Discharge_Complete as string,",
						"          Service_Id as string,",
						"          Service_Name as string,",
						"          Vessel_Id as string,",
						"          IB_VYG as string,",
						"          OB_VYG as string,",
						"          Carrier_Name as string,",
						"          Vessel_Class as string,",
						"          Published_ETA as string,",
						"          Published_ETD as string,",
						"          Start_Work as string,",
						"          End_Work as string,",
						"          Begin_Receive_Date as string,",
						"          Cargo_Cutoff_Date as string,",
						"          Hazard_Cutoff_Date as string,",
						"          Reefer_Cutoff_Date as string,",
						"          Labor_On_Board_Date as string,",
						"          Labor_Off_Board_Date as string,",
						"          Off_Port_Arrival_Date as string,",
						"          Off_Port_Departure as string,",
						"          Pilot_On_Board_Date as string,",
						"          Pilot_Off_Board_Date as string,",
						"          Est_BBK_Discharge as string,",
						"          Est_BBK_Load as string,",
						"          Est_Load as string,",
						"          Est_Discharge as string,",
						"          Est_Restow as string,",
						"          Est_Shift as string,",
						"          vvFlexString01 as string,",
						"          vvFlexString02 as string,",
						"          vvFlexString03 as string,",
						"          vvFlexString04 as string,",
						"          vvFlexString05 as string,",
						"          vvFlexString06 as string,",
						"          vvFlexString07 as string,",
						"          vvFlexString08 as string,",
						"          vvFlexDate01 as string,",
						"          vvFlexDate02 as string,",
						"          vvFlexDate03 as string,",
						"          vvFlexDate04 as string,",
						"          vvFlexDate05 as string,",
						"          vvFlexDate06 as string,",
						"          vvFlexDate07 as string,",
						"          vvFlexDate08 as string,",
						"          Vessel_Classification as string,",
						"          Vessel_Class_Length_Overall_cm as integer,",
						"          Vessel_Class_Beam_cm as short,",
						"          Vessel_TEU_Capacity as string,",
						"          Lloyds_Code as string,",
						"          TimeFirstAvailabilty as timestamp,",
						"          StartWork as timestamp,",
						"          TimeDischargeComplete as timestamp,",
						"          EndWork as timestamp,",
						"          Week as integer,",
						"          Year as integer,",
						"          Month as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'apmtaqaba',",
						"     folderPath: 'silver/vesselvisits') ~> source3",
						"source2 filter(typeDescription=='MNRH' && (powName!='GATE'&&powName!='RAIL'&&powName!='RAIL 2'&&powName!='REHANDLES'&&powName!='UNASSIGNED'&&powName!='VGM'&&powName!='YARD')) ~> filter1",
						"filter1 derive(Vessel_Id = split(workQueue,'-')[1]) ~> derivedColumn1",
						"source1 filter(Event_Type_Id=='UNIT_LOAD'||Event_Type_Id=='UNIT_PAYLOAD_LOAD') ~> filter2",
						"filter2, source3 lookup(source1@Carrier_Visit_Key == source3@Carrier_Visit_Key,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> lookup1",
						"lookup1 select(mapColumn(",
						"          mve_gkey,",
						"          Unit_Nbr,",
						"          Facility_Id = source1@Facility_Id,",
						"          Complex_Id = source1@Complex_Id,",
						"          Yard_Id,",
						"          Carrier_Visit_Key = source1@Carrier_Visit_Key,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Location,",
						"          To_Location,",
						"          From_Position_Name,",
						"          To_Position_Name,",
						"          Carry_CHE_Operator_Id,",
						"          Fetch_CHE_Operator_Id,",
						"          Put_CHE_Operator_Id,",
						"          Fetch_CHE_Id,",
						"          Fetch_CHE_Kind,",
						"          Carry_CHE_Id,",
						"          Carry_CHE_Kind,",
						"          Put_CHE_Id,",
						"          Put_CHE_Kind,",
						"          QC_CHE_Id,",
						"          QC_CHE_Kind,",
						"          t_carry_complete,",
						"          t_put,",
						"          t_fetch,",
						"          t_dispatch,",
						"          t_discharge,",
						"          t_carry_dispatch,",
						"          t_carry_fetch_ready,",
						"          t_carry_put_ready,",
						"          dist_carry,",
						"          dist_start,",
						"          Twin_Fetch,",
						"          Twin_Carry,",
						"          Twin_Put,",
						"          Category_Id,",
						"          Freight_Kind_Id,",
						"          to_pos_gkey,",
						"          fm_pos_gkey,",
						"          Restow_Reason,",
						"          Container_Line_Id,",
						"          Container_Line_Role,",
						"          pow,",
						"          ufv_gkey,",
						"          Berth_Id,",
						"          Goods_And_Ctr_Wt_Kg,",
						"          active_ufv,",
						"          Requires_Power_Flag,",
						"          OOG_Flag,",
						"          Shipper_Id,",
						"          Consignee_Id,",
						"          Commodity_Id,",
						"          ATA = source1@ATA,",
						"          ATD = source1@ATD,",
						"          Rehandles,",
						"          Year = source1@Year,",
						"          Month = source1@Month,",
						"          Week = source1@Week,",
						"          Vessel_Id",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"derivedColumn1, select1 join(unitIdName == Unit_Nbr",
						"     && derivedColumn1@Vessel_Id == select1@Vessel_Id",
						"     && EcEventTime >= ATA",
						"     && EcEventTime <= ATD,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'left')~> join1",
						"join1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          cheName,",
						"          cheID,",
						"          EcEventTime,",
						"          type,",
						"          subType,",
						"          typeDescription,",
						"          fromCheIdName,",
						"          ToCheIdName,",
						"          unitIdName,",
						"          powName,",
						"          poolName,",
						"          workQueue,",
						"          travelDistance,",
						"          moveKind,",
						"          isTwinMove,",
						"          startDistance,",
						"          workAssignmentId,",
						"          unitReference,",
						"          tranId,",
						"          locType,",
						"          locId,",
						"          locSlot,",
						"          opsPosId,",
						"          unladenLoctype,",
						"          unladenLocid,",
						"          unladenLocSlot,",
						"          ladenLoctype,",
						"          ladenLocid,",
						"          ladenLocSlot,",
						"          lastEstMoveTime,",
						"          Year = source2@Year,",
						"          Month = source2@Month,",
						"          Week = source2@Week,",
						"          Vessel_Id = derivedColumn1@Vessel_Id",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"aggregate1 alterRow(upsertIf(true())) ~> AlterRow1",
						"select2 aggregate(groupBy(ecEventGkey),",
						"     each(match(name!='ecEventGkey'), $$ = first($$))) ~> aggregate1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'apmtaqaba',",
						"     folderPath: 'gold/rehandle_vessel',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_within_Vessel_cmsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source3"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "lookup1"
						},
						{
							"name": "select1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select2"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as integer,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as short,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as integer,",
						"          dist_start as short,",
						"          Twin_Fetch as string,",
						"          Twin_Carry as string,",
						"          Twin_Put as string,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as string,",
						"          OOG_Flag as string,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmsa',",
						"     folderPath: 'silver/moves') ~> source1",
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as string,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as string,",
						"          startDistance as short,",
						"          workAssignmentId as double,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmsa',",
						"     folderPath: 'silver/ecevents') ~> source2",
						"source(output(",
						"          Carrier_Visit_Key as integer,",
						"          Complex_Id as string,",
						"          Facility_Id as string,",
						"          Carrier_Visit_Id as string,",
						"          Phase as string,",
						"          Visit_Nbr as string,",
						"          Carrier_Mode as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          ETA as timestamp,",
						"          ETD as timestamp,",
						"          Operator_Line_Id as string,",
						"          Operator_Line_Role as string,",
						"          Operator_Line_Name as string,",
						"          Time_First_Availabilty as string,",
						"          Time_Discharge_Complete as string,",
						"          Service_Id as string,",
						"          Service_Name as string,",
						"          Vessel_Id as string,",
						"          IB_VYG as string,",
						"          OB_VYG as string,",
						"          Carrier_Name as string,",
						"          Vessel_Class as string,",
						"          Published_ETA as string,",
						"          Published_ETD as string,",
						"          Start_Work as string,",
						"          End_Work as string,",
						"          Begin_Receive_Date as string,",
						"          Cargo_Cutoff_Date as string,",
						"          Hazard_Cutoff_Date as string,",
						"          Reefer_Cutoff_Date as string,",
						"          Labor_On_Board_Date as string,",
						"          Labor_Off_Board_Date as string,",
						"          Off_Port_Arrival_Date as string,",
						"          Off_Port_Departure as string,",
						"          Pilot_On_Board_Date as string,",
						"          Pilot_Off_Board_Date as string,",
						"          Est_BBK_Discharge as string,",
						"          Est_BBK_Load as string,",
						"          Est_Load as string,",
						"          Est_Discharge as string,",
						"          Est_Restow as string,",
						"          Est_Shift as string,",
						"          vvFlexString01 as string,",
						"          vvFlexString02 as string,",
						"          vvFlexString03 as string,",
						"          vvFlexString04 as string,",
						"          vvFlexString05 as string,",
						"          vvFlexString06 as string,",
						"          vvFlexString07 as string,",
						"          vvFlexString08 as string,",
						"          vvFlexDate01 as string,",
						"          vvFlexDate02 as string,",
						"          vvFlexDate03 as string,",
						"          vvFlexDate04 as string,",
						"          vvFlexDate05 as string,",
						"          vvFlexDate06 as string,",
						"          vvFlexDate07 as string,",
						"          vvFlexDate08 as string,",
						"          Vessel_Classification as string,",
						"          Vessel_Class_Length_Overall_cm as integer,",
						"          Vessel_Class_Beam_cm as short,",
						"          Vessel_TEU_Capacity as string,",
						"          Lloyds_Code as string,",
						"          TimeFirstAvailabilty as timestamp,",
						"          StartWork as timestamp,",
						"          TimeDischargeComplete as timestamp,",
						"          EndWork as timestamp,",
						"          Week as integer,",
						"          Year as integer,",
						"          Month as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmsa',",
						"     folderPath: 'silver/vesselvisits') ~> source3",
						"source2 filter(typeDescription=='MNRH' && (powName!='GATE'&&powName!='RAIL'&&powName!='RAIL 2'&&powName!='REHANDLES'&&powName!='UNASSIGNED'&&powName!='VGM'&&powName!='YARD')) ~> filter1",
						"filter1 derive(Vessel_Id = split(workQueue,'-')[1]) ~> derivedColumn1",
						"source1 filter(Event_Type_Id=='UNIT_LOAD'||Event_Type_Id=='UNIT_PAYLOAD_LOAD') ~> filter2",
						"filter2, source3 lookup(source1@Carrier_Visit_Key == source3@Carrier_Visit_Key,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> lookup1",
						"lookup1 select(mapColumn(",
						"          mve_gkey,",
						"          Unit_Nbr,",
						"          Facility_Id = source1@Facility_Id,",
						"          Complex_Id = source1@Complex_Id,",
						"          Yard_Id,",
						"          Carrier_Visit_Key = source1@Carrier_Visit_Key,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Location,",
						"          To_Location,",
						"          From_Position_Name,",
						"          To_Position_Name,",
						"          Carry_CHE_Operator_Id,",
						"          Fetch_CHE_Operator_Id,",
						"          Put_CHE_Operator_Id,",
						"          Fetch_CHE_Id,",
						"          Fetch_CHE_Kind,",
						"          Carry_CHE_Id,",
						"          Carry_CHE_Kind,",
						"          Put_CHE_Id,",
						"          Put_CHE_Kind,",
						"          QC_CHE_Id,",
						"          QC_CHE_Kind,",
						"          t_carry_complete,",
						"          t_put,",
						"          t_fetch,",
						"          t_dispatch,",
						"          t_discharge,",
						"          t_carry_dispatch,",
						"          t_carry_fetch_ready,",
						"          t_carry_put_ready,",
						"          dist_carry,",
						"          dist_start,",
						"          Twin_Fetch,",
						"          Twin_Carry,",
						"          Twin_Put,",
						"          Category_Id,",
						"          Freight_Kind_Id,",
						"          to_pos_gkey,",
						"          fm_pos_gkey,",
						"          Restow_Reason,",
						"          Container_Line_Id,",
						"          Container_Line_Role,",
						"          pow,",
						"          ufv_gkey,",
						"          Berth_Id,",
						"          Goods_And_Ctr_Wt_Kg,",
						"          active_ufv,",
						"          Requires_Power_Flag,",
						"          OOG_Flag,",
						"          Shipper_Id,",
						"          Consignee_Id,",
						"          Commodity_Id,",
						"          ATA = source1@ATA,",
						"          ATD = source1@ATD,",
						"          Rehandles,",
						"          Year = source1@Year,",
						"          Month = source1@Month,",
						"          Week = source1@Week,",
						"          Vessel_Id",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"derivedColumn1, select1 join(unitIdName == Unit_Nbr",
						"     && derivedColumn1@Vessel_Id == select1@Vessel_Id",
						"     && EcEventTime >= ATA",
						"     && EcEventTime <= ATD,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'left')~> join1",
						"join1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          cheName,",
						"          cheID,",
						"          EcEventTime,",
						"          type,",
						"          subType,",
						"          typeDescription,",
						"          fromCheIdName,",
						"          ToCheIdName,",
						"          unitIdName,",
						"          powName,",
						"          poolName,",
						"          workQueue,",
						"          travelDistance,",
						"          moveKind,",
						"          isTwinMove,",
						"          startDistance,",
						"          workAssignmentId,",
						"          unitReference,",
						"          tranId,",
						"          locType,",
						"          locId,",
						"          locSlot,",
						"          opsPosId,",
						"          unladenLoctype,",
						"          unladenLocid,",
						"          unladenLocSlot,",
						"          ladenLoctype,",
						"          ladenLocid,",
						"          ladenLocSlot,",
						"          lastEstMoveTime,",
						"          Year = source2@Year,",
						"          Month = source2@Month,",
						"          Week = source2@Week,",
						"          Vessel_Id = derivedColumn1@Vessel_Id",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"aggregate1 alterRow(upsertIf(true())) ~> AlterRow1",
						"select2 aggregate(groupBy(ecEventGkey),",
						"     each(match(name!='ecEventGkey'), $$ = first($$))) ~> aggregate1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmsa',",
						"     folderPath: 'gold/rehandle_vessel',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_within_Vessel_mict')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source3"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "lookup1"
						},
						{
							"name": "select1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select2"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as integer,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as short,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as integer,",
						"          dist_start as short,",
						"          Twin_Fetch as string,",
						"          Twin_Carry as string,",
						"          Twin_Put as string,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as string,",
						"          OOG_Flag as string,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'mict',",
						"     folderPath: 'silver/moves') ~> source1",
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as string,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as string,",
						"          startDistance as short,",
						"          workAssignmentId as double,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'mict',",
						"     folderPath: 'silver/ecevents') ~> source2",
						"source(output(",
						"          Carrier_Visit_Key as integer,",
						"          Complex_Id as string,",
						"          Facility_Id as string,",
						"          Carrier_Visit_Id as string,",
						"          Phase as string,",
						"          Visit_Nbr as string,",
						"          Carrier_Mode as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          ETA as timestamp,",
						"          ETD as timestamp,",
						"          Operator_Line_Id as string,",
						"          Operator_Line_Role as string,",
						"          Operator_Line_Name as string,",
						"          Time_First_Availabilty as string,",
						"          Time_Discharge_Complete as string,",
						"          Service_Id as string,",
						"          Service_Name as string,",
						"          Vessel_Id as string,",
						"          IB_VYG as string,",
						"          OB_VYG as string,",
						"          Carrier_Name as string,",
						"          Vessel_Class as string,",
						"          Published_ETA as string,",
						"          Published_ETD as string,",
						"          Start_Work as string,",
						"          End_Work as string,",
						"          Begin_Receive_Date as string,",
						"          Cargo_Cutoff_Date as string,",
						"          Hazard_Cutoff_Date as string,",
						"          Reefer_Cutoff_Date as string,",
						"          Labor_On_Board_Date as string,",
						"          Labor_Off_Board_Date as string,",
						"          Off_Port_Arrival_Date as string,",
						"          Off_Port_Departure as string,",
						"          Pilot_On_Board_Date as string,",
						"          Pilot_Off_Board_Date as string,",
						"          Est_BBK_Discharge as string,",
						"          Est_BBK_Load as string,",
						"          Est_Load as string,",
						"          Est_Discharge as string,",
						"          Est_Restow as string,",
						"          Est_Shift as string,",
						"          vvFlexString01 as string,",
						"          vvFlexString02 as string,",
						"          vvFlexString03 as string,",
						"          vvFlexString04 as string,",
						"          vvFlexString05 as string,",
						"          vvFlexString06 as string,",
						"          vvFlexString07 as string,",
						"          vvFlexString08 as string,",
						"          vvFlexDate01 as string,",
						"          vvFlexDate02 as string,",
						"          vvFlexDate03 as string,",
						"          vvFlexDate04 as string,",
						"          vvFlexDate05 as string,",
						"          vvFlexDate06 as string,",
						"          vvFlexDate07 as string,",
						"          vvFlexDate08 as string,",
						"          Vessel_Classification as string,",
						"          Vessel_Class_Length_Overall_cm as integer,",
						"          Vessel_Class_Beam_cm as short,",
						"          Vessel_TEU_Capacity as string,",
						"          Lloyds_Code as string,",
						"          TimeFirstAvailabilty as timestamp,",
						"          StartWork as timestamp,",
						"          TimeDischargeComplete as timestamp,",
						"          EndWork as timestamp,",
						"          Week as integer,",
						"          Year as integer,",
						"          Month as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'mict',",
						"     folderPath: 'silver/vesselvisits') ~> source3",
						"source2 filter(typeDescription=='MNRH' && (powName!='GATE'&&powName!='RAIL'&&powName!='RAIL 2'&&powName!='REHANDLES'&&powName!='UNASSIGNED'&&powName!='VGM'&&powName!='YARD')) ~> filter1",
						"filter1 derive(Vessel_Id = split(workQueue,'-')[1]) ~> derivedColumn1",
						"source1 filter(Event_Type_Id=='UNIT_LOAD'||Event_Type_Id=='UNIT_PAYLOAD_LOAD') ~> filter2",
						"filter2, source3 lookup(source1@Carrier_Visit_Key == source3@Carrier_Visit_Key,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> lookup1",
						"lookup1 select(mapColumn(",
						"          mve_gkey,",
						"          Unit_Nbr,",
						"          Facility_Id = source1@Facility_Id,",
						"          Complex_Id = source1@Complex_Id,",
						"          Yard_Id,",
						"          Carrier_Visit_Key = source1@Carrier_Visit_Key,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Location,",
						"          To_Location,",
						"          From_Position_Name,",
						"          To_Position_Name,",
						"          Carry_CHE_Operator_Id,",
						"          Fetch_CHE_Operator_Id,",
						"          Put_CHE_Operator_Id,",
						"          Fetch_CHE_Id,",
						"          Fetch_CHE_Kind,",
						"          Carry_CHE_Id,",
						"          Carry_CHE_Kind,",
						"          Put_CHE_Id,",
						"          Put_CHE_Kind,",
						"          QC_CHE_Id,",
						"          QC_CHE_Kind,",
						"          t_carry_complete,",
						"          t_put,",
						"          t_fetch,",
						"          t_dispatch,",
						"          t_discharge,",
						"          t_carry_dispatch,",
						"          t_carry_fetch_ready,",
						"          t_carry_put_ready,",
						"          dist_carry,",
						"          dist_start,",
						"          Twin_Fetch,",
						"          Twin_Carry,",
						"          Twin_Put,",
						"          Category_Id,",
						"          Freight_Kind_Id,",
						"          to_pos_gkey,",
						"          fm_pos_gkey,",
						"          Restow_Reason,",
						"          Container_Line_Id,",
						"          Container_Line_Role,",
						"          pow,",
						"          ufv_gkey,",
						"          Berth_Id,",
						"          Goods_And_Ctr_Wt_Kg,",
						"          active_ufv,",
						"          Requires_Power_Flag,",
						"          OOG_Flag,",
						"          Shipper_Id,",
						"          Consignee_Id,",
						"          Commodity_Id,",
						"          ATA = source1@ATA,",
						"          ATD = source1@ATD,",
						"          Rehandles,",
						"          Year = source1@Year,",
						"          Month = source1@Month,",
						"          Week = source1@Week,",
						"          Vessel_Id",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"derivedColumn1, select1 join(unitIdName == Unit_Nbr",
						"     && derivedColumn1@Vessel_Id == select1@Vessel_Id",
						"     && EcEventTime >= ATA",
						"     && EcEventTime <= ATD,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'left')~> join1",
						"join1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          cheName,",
						"          cheID,",
						"          EcEventTime,",
						"          type,",
						"          subType,",
						"          typeDescription,",
						"          fromCheIdName,",
						"          ToCheIdName,",
						"          unitIdName,",
						"          powName,",
						"          poolName,",
						"          workQueue,",
						"          travelDistance,",
						"          moveKind,",
						"          isTwinMove,",
						"          startDistance,",
						"          workAssignmentId,",
						"          unitReference,",
						"          tranId,",
						"          locType,",
						"          locId,",
						"          locSlot,",
						"          opsPosId,",
						"          unladenLoctype,",
						"          unladenLocid,",
						"          unladenLocSlot,",
						"          ladenLoctype,",
						"          ladenLocid,",
						"          ladenLocSlot,",
						"          lastEstMoveTime,",
						"          Year = source2@Year,",
						"          Month = source2@Month,",
						"          Week = source2@Week,",
						"          Vessel_Id = derivedColumn1@Vessel_Id",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"aggregate1 alterRow(upsertIf(true())) ~> AlterRow1",
						"select2 aggregate(groupBy(ecEventGkey),",
						"     each(match(name!='ecEventGkey'), $$ = first($$))) ~> aggregate1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mict',",
						"     folderPath: 'gold/rehandle_vessel',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_within_Vessel_mnhpi')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source3"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "lookup1"
						},
						{
							"name": "select1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select2"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as integer,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as short,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as integer,",
						"          dist_start as short,",
						"          Twin_Fetch as string,",
						"          Twin_Carry as string,",
						"          Twin_Put as string,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as string,",
						"          OOG_Flag as string,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'silver/moves') ~> source1",
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as string,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as string,",
						"          startDistance as short,",
						"          workAssignmentId as double,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'silver/ecevents') ~> source2",
						"source(output(",
						"          Carrier_Visit_Key as integer,",
						"          Complex_Id as string,",
						"          Facility_Id as string,",
						"          Carrier_Visit_Id as string,",
						"          Phase as string,",
						"          Visit_Nbr as string,",
						"          Carrier_Mode as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          ETA as timestamp,",
						"          ETD as timestamp,",
						"          Operator_Line_Id as string,",
						"          Operator_Line_Role as string,",
						"          Operator_Line_Name as string,",
						"          Time_First_Availabilty as string,",
						"          Time_Discharge_Complete as string,",
						"          Service_Id as string,",
						"          Service_Name as string,",
						"          Vessel_Id as string,",
						"          IB_VYG as string,",
						"          OB_VYG as string,",
						"          Carrier_Name as string,",
						"          Vessel_Class as string,",
						"          Published_ETA as string,",
						"          Published_ETD as string,",
						"          Start_Work as string,",
						"          End_Work as string,",
						"          Begin_Receive_Date as string,",
						"          Cargo_Cutoff_Date as string,",
						"          Hazard_Cutoff_Date as string,",
						"          Reefer_Cutoff_Date as string,",
						"          Labor_On_Board_Date as string,",
						"          Labor_Off_Board_Date as string,",
						"          Off_Port_Arrival_Date as string,",
						"          Off_Port_Departure as string,",
						"          Pilot_On_Board_Date as string,",
						"          Pilot_Off_Board_Date as string,",
						"          Est_BBK_Discharge as string,",
						"          Est_BBK_Load as string,",
						"          Est_Load as string,",
						"          Est_Discharge as string,",
						"          Est_Restow as string,",
						"          Est_Shift as string,",
						"          vvFlexString01 as string,",
						"          vvFlexString02 as string,",
						"          vvFlexString03 as string,",
						"          vvFlexString04 as string,",
						"          vvFlexString05 as string,",
						"          vvFlexString06 as string,",
						"          vvFlexString07 as string,",
						"          vvFlexString08 as string,",
						"          vvFlexDate01 as string,",
						"          vvFlexDate02 as string,",
						"          vvFlexDate03 as string,",
						"          vvFlexDate04 as string,",
						"          vvFlexDate05 as string,",
						"          vvFlexDate06 as string,",
						"          vvFlexDate07 as string,",
						"          vvFlexDate08 as string,",
						"          Vessel_Classification as string,",
						"          Vessel_Class_Length_Overall_cm as integer,",
						"          Vessel_Class_Beam_cm as short,",
						"          Vessel_TEU_Capacity as string,",
						"          Lloyds_Code as string,",
						"          TimeFirstAvailabilty as timestamp,",
						"          StartWork as timestamp,",
						"          TimeDischargeComplete as timestamp,",
						"          EndWork as timestamp,",
						"          Week as integer,",
						"          Year as integer,",
						"          Month as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'silver/vesselvisits') ~> source3",
						"source2 filter(typeDescription=='MNRH' && (powName!='GATE'&&powName!='RAIL'&&powName!='RAIL 2'&&powName!='REHANDLES'&&powName!='UNASSIGNED'&&powName!='VGM'&&powName!='YARD')) ~> filter1",
						"filter1 derive(Vessel_Id = split(workQueue,'-')[1]) ~> derivedColumn1",
						"source1 filter(Event_Type_Id=='UNIT_LOAD'||Event_Type_Id=='UNIT_PAYLOAD_LOAD') ~> filter2",
						"filter2, source3 lookup(source1@Carrier_Visit_Key == source3@Carrier_Visit_Key,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> lookup1",
						"lookup1 select(mapColumn(",
						"          mve_gkey,",
						"          Unit_Nbr,",
						"          Facility_Id = source1@Facility_Id,",
						"          Complex_Id = source1@Complex_Id,",
						"          Yard_Id,",
						"          Carrier_Visit_Key = source1@Carrier_Visit_Key,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Location,",
						"          To_Location,",
						"          From_Position_Name,",
						"          To_Position_Name,",
						"          Carry_CHE_Operator_Id,",
						"          Fetch_CHE_Operator_Id,",
						"          Put_CHE_Operator_Id,",
						"          Fetch_CHE_Id,",
						"          Fetch_CHE_Kind,",
						"          Carry_CHE_Id,",
						"          Carry_CHE_Kind,",
						"          Put_CHE_Id,",
						"          Put_CHE_Kind,",
						"          QC_CHE_Id,",
						"          QC_CHE_Kind,",
						"          t_carry_complete,",
						"          t_put,",
						"          t_fetch,",
						"          t_dispatch,",
						"          t_discharge,",
						"          t_carry_dispatch,",
						"          t_carry_fetch_ready,",
						"          t_carry_put_ready,",
						"          dist_carry,",
						"          dist_start,",
						"          Twin_Fetch,",
						"          Twin_Carry,",
						"          Twin_Put,",
						"          Category_Id,",
						"          Freight_Kind_Id,",
						"          to_pos_gkey,",
						"          fm_pos_gkey,",
						"          Restow_Reason,",
						"          Container_Line_Id,",
						"          Container_Line_Role,",
						"          pow,",
						"          ufv_gkey,",
						"          Berth_Id,",
						"          Goods_And_Ctr_Wt_Kg,",
						"          active_ufv,",
						"          Requires_Power_Flag,",
						"          OOG_Flag,",
						"          Shipper_Id,",
						"          Consignee_Id,",
						"          Commodity_Id,",
						"          ATA = source1@ATA,",
						"          ATD = source1@ATD,",
						"          Rehandles,",
						"          Year = source1@Year,",
						"          Month = source1@Month,",
						"          Week = source1@Week,",
						"          Vessel_Id",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"derivedColumn1, select1 join(unitIdName == Unit_Nbr",
						"     && derivedColumn1@Vessel_Id == select1@Vessel_Id",
						"     && EcEventTime >= ATA",
						"     && EcEventTime <= ATD,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'left')~> join1",
						"join1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          cheName,",
						"          cheID,",
						"          EcEventTime,",
						"          type,",
						"          subType,",
						"          typeDescription,",
						"          fromCheIdName,",
						"          ToCheIdName,",
						"          unitIdName,",
						"          powName,",
						"          poolName,",
						"          workQueue,",
						"          travelDistance,",
						"          moveKind,",
						"          isTwinMove,",
						"          startDistance,",
						"          workAssignmentId,",
						"          unitReference,",
						"          tranId,",
						"          locType,",
						"          locId,",
						"          locSlot,",
						"          opsPosId,",
						"          unladenLoctype,",
						"          unladenLocid,",
						"          unladenLocSlot,",
						"          ladenLoctype,",
						"          ladenLocid,",
						"          ladenLocSlot,",
						"          lastEstMoveTime,",
						"          Year = source2@Year,",
						"          Month = source2@Month,",
						"          Week = source2@Week,",
						"          Vessel_Id = derivedColumn1@Vessel_Id",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"aggregate1 alterRow(upsertIf(true())) ~> AlterRow1",
						"select2 aggregate(groupBy(ecEventGkey),",
						"     each(match(name!='ecEventGkey'), $$ = first($$))) ~> aggregate1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'gold/rehandle_vessel',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_within_Vessel_plipdeco')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source3"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "lookup1"
						},
						{
							"name": "select1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select2"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as integer,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as short,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as integer,",
						"          dist_start as short,",
						"          Twin_Fetch as string,",
						"          Twin_Carry as string,",
						"          Twin_Put as string,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as string,",
						"          OOG_Flag as string,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'plipdeco',",
						"     folderPath: 'silver/moves') ~> source1",
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as string,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as string,",
						"          startDistance as short,",
						"          workAssignmentId as double,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'plipdeco',",
						"     folderPath: 'silver/ecevents') ~> source2",
						"source(output(",
						"          Carrier_Visit_Key as integer,",
						"          Complex_Id as string,",
						"          Facility_Id as string,",
						"          Carrier_Visit_Id as string,",
						"          Phase as string,",
						"          Visit_Nbr as string,",
						"          Carrier_Mode as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          ETA as timestamp,",
						"          ETD as timestamp,",
						"          Operator_Line_Id as string,",
						"          Operator_Line_Role as string,",
						"          Operator_Line_Name as string,",
						"          Time_First_Availabilty as string,",
						"          Time_Discharge_Complete as string,",
						"          Service_Id as string,",
						"          Service_Name as string,",
						"          Vessel_Id as string,",
						"          IB_VYG as string,",
						"          OB_VYG as string,",
						"          Carrier_Name as string,",
						"          Vessel_Class as string,",
						"          Published_ETA as string,",
						"          Published_ETD as string,",
						"          Start_Work as string,",
						"          End_Work as string,",
						"          Begin_Receive_Date as string,",
						"          Cargo_Cutoff_Date as string,",
						"          Hazard_Cutoff_Date as string,",
						"          Reefer_Cutoff_Date as string,",
						"          Labor_On_Board_Date as string,",
						"          Labor_Off_Board_Date as string,",
						"          Off_Port_Arrival_Date as string,",
						"          Off_Port_Departure as string,",
						"          Pilot_On_Board_Date as string,",
						"          Pilot_Off_Board_Date as string,",
						"          Est_BBK_Discharge as string,",
						"          Est_BBK_Load as string,",
						"          Est_Load as string,",
						"          Est_Discharge as string,",
						"          Est_Restow as string,",
						"          Est_Shift as string,",
						"          vvFlexString01 as string,",
						"          vvFlexString02 as string,",
						"          vvFlexString03 as string,",
						"          vvFlexString04 as string,",
						"          vvFlexString05 as string,",
						"          vvFlexString06 as string,",
						"          vvFlexString07 as string,",
						"          vvFlexString08 as string,",
						"          vvFlexDate01 as string,",
						"          vvFlexDate02 as string,",
						"          vvFlexDate03 as string,",
						"          vvFlexDate04 as string,",
						"          vvFlexDate05 as string,",
						"          vvFlexDate06 as string,",
						"          vvFlexDate07 as string,",
						"          vvFlexDate08 as string,",
						"          Vessel_Classification as string,",
						"          Vessel_Class_Length_Overall_cm as integer,",
						"          Vessel_Class_Beam_cm as short,",
						"          Vessel_TEU_Capacity as string,",
						"          Lloyds_Code as string,",
						"          TimeFirstAvailabilty as timestamp,",
						"          StartWork as timestamp,",
						"          TimeDischargeComplete as timestamp,",
						"          EndWork as timestamp,",
						"          Week as integer,",
						"          Year as integer,",
						"          Month as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'plipdeco',",
						"     folderPath: 'silver/vesselvisits') ~> source3",
						"source2 filter(typeDescription=='MNRH' && (powName!='GATE'&&powName!='RAIL'&&powName!='RAIL 2'&&powName!='REHANDLES'&&powName!='UNASSIGNED'&&powName!='VGM'&&powName!='YARD')) ~> filter1",
						"filter1 derive(Vessel_Id = split(workQueue,'-')[1]) ~> derivedColumn1",
						"source1 filter(Event_Type_Id=='UNIT_LOAD'||Event_Type_Id=='UNIT_PAYLOAD_LOAD') ~> filter2",
						"filter2, source3 lookup(source1@Carrier_Visit_Key == source3@Carrier_Visit_Key,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> lookup1",
						"lookup1 select(mapColumn(",
						"          mve_gkey,",
						"          Unit_Nbr,",
						"          Facility_Id = source1@Facility_Id,",
						"          Complex_Id = source1@Complex_Id,",
						"          Yard_Id,",
						"          Carrier_Visit_Key = source1@Carrier_Visit_Key,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Location,",
						"          To_Location,",
						"          From_Position_Name,",
						"          To_Position_Name,",
						"          Carry_CHE_Operator_Id,",
						"          Fetch_CHE_Operator_Id,",
						"          Put_CHE_Operator_Id,",
						"          Fetch_CHE_Id,",
						"          Fetch_CHE_Kind,",
						"          Carry_CHE_Id,",
						"          Carry_CHE_Kind,",
						"          Put_CHE_Id,",
						"          Put_CHE_Kind,",
						"          QC_CHE_Id,",
						"          QC_CHE_Kind,",
						"          t_carry_complete,",
						"          t_put,",
						"          t_fetch,",
						"          t_dispatch,",
						"          t_discharge,",
						"          t_carry_dispatch,",
						"          t_carry_fetch_ready,",
						"          t_carry_put_ready,",
						"          dist_carry,",
						"          dist_start,",
						"          Twin_Fetch,",
						"          Twin_Carry,",
						"          Twin_Put,",
						"          Category_Id,",
						"          Freight_Kind_Id,",
						"          to_pos_gkey,",
						"          fm_pos_gkey,",
						"          Restow_Reason,",
						"          Container_Line_Id,",
						"          Container_Line_Role,",
						"          pow,",
						"          ufv_gkey,",
						"          Berth_Id,",
						"          Goods_And_Ctr_Wt_Kg,",
						"          active_ufv,",
						"          Requires_Power_Flag,",
						"          OOG_Flag,",
						"          Shipper_Id,",
						"          Consignee_Id,",
						"          Commodity_Id,",
						"          ATA = source1@ATA,",
						"          ATD = source1@ATD,",
						"          Rehandles,",
						"          Year = source1@Year,",
						"          Month = source1@Month,",
						"          Week = source1@Week,",
						"          Vessel_Id",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"derivedColumn1, select1 join(unitIdName == Unit_Nbr",
						"     && derivedColumn1@Vessel_Id == select1@Vessel_Id",
						"     && EcEventTime >= ATA",
						"     && EcEventTime <= ATD,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'left')~> join1",
						"join1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          cheName,",
						"          cheID,",
						"          EcEventTime,",
						"          type,",
						"          subType,",
						"          typeDescription,",
						"          fromCheIdName,",
						"          ToCheIdName,",
						"          unitIdName,",
						"          powName,",
						"          poolName,",
						"          workQueue,",
						"          travelDistance,",
						"          moveKind,",
						"          isTwinMove,",
						"          startDistance,",
						"          workAssignmentId,",
						"          unitReference,",
						"          tranId,",
						"          locType,",
						"          locId,",
						"          locSlot,",
						"          opsPosId,",
						"          unladenLoctype,",
						"          unladenLocid,",
						"          unladenLocSlot,",
						"          ladenLoctype,",
						"          ladenLocid,",
						"          ladenLocSlot,",
						"          lastEstMoveTime,",
						"          Year = source2@Year,",
						"          Month = source2@Month,",
						"          Week = source2@Week,",
						"          Vessel_Id = derivedColumn1@Vessel_Id",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"aggregate1 alterRow(upsertIf(true())) ~> AlterRow1",
						"select2 aggregate(groupBy(ecEventGkey),",
						"     each(match(name!='ecEventGkey'), $$ = first($$))) ~> aggregate1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'plipdeco',",
						"     folderPath: 'gold/rehandle_vessel',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_within_Vessel_valencia')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source3"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "lookup1"
						},
						{
							"name": "select1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select2"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as integer,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as short,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as integer,",
						"          dist_start as short,",
						"          Twin_Fetch as string,",
						"          Twin_Carry as string,",
						"          Twin_Put as string,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as string,",
						"          OOG_Flag as string,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'valencia',",
						"     folderPath: 'silver/moves') ~> source1",
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as string,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as string,",
						"          startDistance as short,",
						"          workAssignmentId as double,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'valencia',",
						"     folderPath: 'silver/ecevents') ~> source2",
						"source(output(",
						"          Carrier_Visit_Key as integer,",
						"          Complex_Id as string,",
						"          Facility_Id as string,",
						"          Carrier_Visit_Id as string,",
						"          Phase as string,",
						"          Visit_Nbr as string,",
						"          Carrier_Mode as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          ETA as timestamp,",
						"          ETD as timestamp,",
						"          Operator_Line_Id as string,",
						"          Operator_Line_Role as string,",
						"          Operator_Line_Name as string,",
						"          Time_First_Availabilty as string,",
						"          Time_Discharge_Complete as string,",
						"          Service_Id as string,",
						"          Service_Name as string,",
						"          Vessel_Id as string,",
						"          IB_VYG as string,",
						"          OB_VYG as string,",
						"          Carrier_Name as string,",
						"          Vessel_Class as string,",
						"          Published_ETA as string,",
						"          Published_ETD as string,",
						"          Start_Work as string,",
						"          End_Work as string,",
						"          Begin_Receive_Date as string,",
						"          Cargo_Cutoff_Date as string,",
						"          Hazard_Cutoff_Date as string,",
						"          Reefer_Cutoff_Date as string,",
						"          Labor_On_Board_Date as string,",
						"          Labor_Off_Board_Date as string,",
						"          Off_Port_Arrival_Date as string,",
						"          Off_Port_Departure as string,",
						"          Pilot_On_Board_Date as string,",
						"          Pilot_Off_Board_Date as string,",
						"          Est_BBK_Discharge as string,",
						"          Est_BBK_Load as string,",
						"          Est_Load as string,",
						"          Est_Discharge as string,",
						"          Est_Restow as string,",
						"          Est_Shift as string,",
						"          vvFlexString01 as string,",
						"          vvFlexString02 as string,",
						"          vvFlexString03 as string,",
						"          vvFlexString04 as string,",
						"          vvFlexString05 as string,",
						"          vvFlexString06 as string,",
						"          vvFlexString07 as string,",
						"          vvFlexString08 as string,",
						"          vvFlexDate01 as string,",
						"          vvFlexDate02 as string,",
						"          vvFlexDate03 as string,",
						"          vvFlexDate04 as string,",
						"          vvFlexDate05 as string,",
						"          vvFlexDate06 as string,",
						"          vvFlexDate07 as string,",
						"          vvFlexDate08 as string,",
						"          Vessel_Classification as string,",
						"          Vessel_Class_Length_Overall_cm as integer,",
						"          Vessel_Class_Beam_cm as short,",
						"          Vessel_TEU_Capacity as string,",
						"          Lloyds_Code as string,",
						"          TimeFirstAvailabilty as timestamp,",
						"          StartWork as timestamp,",
						"          TimeDischargeComplete as timestamp,",
						"          EndWork as timestamp,",
						"          Week as integer,",
						"          Year as integer,",
						"          Month as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'valencia',",
						"     folderPath: 'silver/vesselvisits') ~> source3",
						"source2 filter(typeDescription=='MNRH' && (powName!='GATE'&&powName!='RAIL'&&powName!='RAIL 2'&&powName!='REHANDLES'&&powName!='UNASSIGNED'&&powName!='VGM'&&powName!='YARD')) ~> filter1",
						"filter1 derive(Vessel_Id = split(workQueue,'-')[1]) ~> derivedColumn1",
						"source1 filter(Event_Type_Id=='UNIT_LOAD'||Event_Type_Id=='UNIT_PAYLOAD_LOAD') ~> filter2",
						"filter2, source3 lookup(source1@Carrier_Visit_Key == source3@Carrier_Visit_Key,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> lookup1",
						"lookup1 select(mapColumn(",
						"          mve_gkey,",
						"          Unit_Nbr,",
						"          Facility_Id = source1@Facility_Id,",
						"          Complex_Id = source1@Complex_Id,",
						"          Yard_Id,",
						"          Carrier_Visit_Key = source1@Carrier_Visit_Key,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Location,",
						"          To_Location,",
						"          From_Position_Name,",
						"          To_Position_Name,",
						"          Carry_CHE_Operator_Id,",
						"          Fetch_CHE_Operator_Id,",
						"          Put_CHE_Operator_Id,",
						"          Fetch_CHE_Id,",
						"          Fetch_CHE_Kind,",
						"          Carry_CHE_Id,",
						"          Carry_CHE_Kind,",
						"          Put_CHE_Id,",
						"          Put_CHE_Kind,",
						"          QC_CHE_Id,",
						"          QC_CHE_Kind,",
						"          t_carry_complete,",
						"          t_put,",
						"          t_fetch,",
						"          t_dispatch,",
						"          t_discharge,",
						"          t_carry_dispatch,",
						"          t_carry_fetch_ready,",
						"          t_carry_put_ready,",
						"          dist_carry,",
						"          dist_start,",
						"          Twin_Fetch,",
						"          Twin_Carry,",
						"          Twin_Put,",
						"          Category_Id,",
						"          Freight_Kind_Id,",
						"          to_pos_gkey,",
						"          fm_pos_gkey,",
						"          Restow_Reason,",
						"          Container_Line_Id,",
						"          Container_Line_Role,",
						"          pow,",
						"          ufv_gkey,",
						"          Berth_Id,",
						"          Goods_And_Ctr_Wt_Kg,",
						"          active_ufv,",
						"          Requires_Power_Flag,",
						"          OOG_Flag,",
						"          Shipper_Id,",
						"          Consignee_Id,",
						"          Commodity_Id,",
						"          ATA = source1@ATA,",
						"          ATD = source1@ATD,",
						"          Rehandles,",
						"          Year = source1@Year,",
						"          Month = source1@Month,",
						"          Week = source1@Week,",
						"          Vessel_Id",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"derivedColumn1, select1 join(unitIdName == Unit_Nbr",
						"     && derivedColumn1@Vessel_Id == select1@Vessel_Id",
						"     && EcEventTime >= ATA",
						"     && EcEventTime <= ATD,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'left')~> join1",
						"join1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          cheName,",
						"          cheID,",
						"          EcEventTime,",
						"          type,",
						"          subType,",
						"          typeDescription,",
						"          fromCheIdName,",
						"          ToCheIdName,",
						"          unitIdName,",
						"          powName,",
						"          poolName,",
						"          workQueue,",
						"          travelDistance,",
						"          moveKind,",
						"          isTwinMove,",
						"          startDistance,",
						"          workAssignmentId,",
						"          unitReference,",
						"          tranId,",
						"          locType,",
						"          locId,",
						"          locSlot,",
						"          opsPosId,",
						"          unladenLoctype,",
						"          unladenLocid,",
						"          unladenLocSlot,",
						"          ladenLoctype,",
						"          ladenLocid,",
						"          ladenLocSlot,",
						"          lastEstMoveTime,",
						"          Year = source2@Year,",
						"          Month = source2@Month,",
						"          Week = source2@Week,",
						"          Vessel_Id = derivedColumn1@Vessel_Id",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"aggregate1 alterRow(upsertIf(true())) ~> AlterRow1",
						"select2 aggregate(groupBy(ecEventGkey),",
						"     each(match(name!='ecEventGkey'), $$ = first($$))) ~> aggregate1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'valencia',",
						"     folderPath: 'gold/rehandle_vessel',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_within_stack_export_cmsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Find unproductive moves within same block, bay for RECV,RDSC Full Export, TRSHP ctrs ",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Sort2"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "window1"
						},
						{
							"name": "select2"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filterRECVRDSC"
						}
					],
					"script": "parameters{\n\tcustomer as string ('cmsa')\n}\nsource(output(\n\t\tmve_gkey as long,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tt_put as timestamp,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tufv_gkey as long,\n\t\tRequires_Power_Flag as boolean,\n\t\tOOG_Flag as boolean,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tFromEB_WB as integer,\n\t\tIB_mve_gkey as long,\n\t\tIB_t_put as timestamp,\n\t\tIB_ufv_gkey as long,\n\t\tIB_Max_T_Put as timestamp,\n\t\tIB_Unit_Nbr as string,\n\t\tIB_Facility_Id as string,\n\t\tIB_Move_Kind as string,\n\t\tIB_Requires_Power_Flag as boolean,\n\t\tRNumber as integer,\n\t\tMovesPerUnitFcyVisit as long\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'gold/rehandle_uprod_moves',\n\tmode: 'read') ~> source1\nselect2 sort(asc(ufv_gkey, true),\n\tasc(t_put, true),\n\tasc(mve_gkey, true)) ~> Sort2\nwindow1 alterRow(insertIf(true())) ~> AlterRow1\nSort2 window(over(IB_ufv_gkey),\n\tasc(t_put, true),\n\tasc(mve_gkey, true),\n\tRNumber = rowNumber(),\n\t\tMovesPerUnitFcyVisit = count(mve_gkey)) ~> window1\nderivedColumn3 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tMove_Kind,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tt_put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tufv_gkey,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tFromEB_WB,\n\t\tIB_mve_gkey,\n\t\tIB_t_put,\n\t\tIB_ufv_gkey,\n\t\tIB_Max_T_Put,\n\t\tIB_Unit_Nbr,\n\t\tIB_Facility_Id,\n\t\tIB_Move_Kind,\n\t\tIB_Requires_Power_Flag,\n\t\tStack_Move\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select2\nfilterRECVRDSC derive(Stack_Move = iif(((Move_Kind=='SHFT'||Move_Kind=='YARD')&&(left(From_Position_Name,14)==left(To_Position_Name,14))),1,0)) ~> derivedColumn3\nsource1 filter((IB_Move_Kind=='RECV' || IB_Move_Kind=='RDSC')) ~> filterRECVRDSC\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'gold/rehandle_export_within_stack',\n\ttruncate: true,\n\tmergeSchema: false,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['mve_gkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tMove_Kind,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tt_put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tufv_gkey,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tFromEB_WB,\n\t\tIB_mve_gkey,\n\t\tIB_t_put,\n\t\tIB_ufv_gkey,\n\t\tIB_Max_T_Put,\n\t\tIB_Unit_Nbr,\n\t\tIB_Facility_Id,\n\t\tIB_Move_Kind,\n\t\tIB_Requires_Power_Flag,\n\t\tStack_Move,\n\t\tRNumber,\n\t\tMovesPerUnitFcyVisit\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_within_stack_rdsc_export_gpa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Find unproductive moves within same block, bay for RDSC Full Export ctrs in GCT facility",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Sort2"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "window1"
						},
						{
							"name": "select2"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('gpa')\n}\nsource(output(\n\t\tmve_gkey as long,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tt_put as timestamp,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tufv_gkey as long,\n\t\tRequires_Power_Flag as boolean,\n\t\tOOG_Flag as boolean,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tFromEB_WB as integer,\n\t\tIB_mve_gkey as long,\n\t\tIB_t_put as timestamp,\n\t\tIB_ufv_gkey as long,\n\t\tIB_Max_T_Put as timestamp,\n\t\tIB_Unit_Nbr as string,\n\t\tIB_Facility_Id as string,\n\t\tIB_Move_Kind as string,\n\t\tIB_Requires_Power_Flag as boolean,\n\t\tRNumber as integer,\n\t\tMovesPerUnitFcyVisit as long\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'gold/rehandle_rdsc_export',\n\tmode: 'read') ~> source1\nfilter1 sort(asc(ufv_gkey, true),\n\tasc(t_put, true),\n\tasc(mve_gkey, true)) ~> Sort2\nwindow1 alterRow(insertIf(true())) ~> AlterRow1\nSort2 window(over(IB_ufv_gkey),\n\tasc(t_put, true),\n\tasc(mve_gkey, true),\n\tRNumber = rowNumber(),\n\t\tMovesPerUnitFcyVisit = count(mve_gkey)) ~> window1\nderivedColumn3 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tMove_Kind,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tt_put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tufv_gkey,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tFromEB_WB,\n\t\tIB_mve_gkey,\n\t\tIB_t_put,\n\t\tIB_ufv_gkey,\n\t\tIB_Max_T_Put,\n\t\tIB_Unit_Nbr,\n\t\tIB_Facility_Id,\n\t\tIB_Move_Kind,\n\t\tIB_Requires_Power_Flag,\n\t\tIncomplete_To_Position,\n\t\tIncomplete_From_Position,\n\t\tStack_Move\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select2\nsource1 derive(Incomplete_To_Position = iif(((Move_Kind=='SHFT'||Move_Kind=='YARD')&&length(To_Position_Name)<13),1,0),\n\t\tIncomplete_From_Position = iif(((Move_Kind=='SHFT'||Move_Kind=='YARD')&& length(From_Position_Name)<13),1,0),\n\t\tStack_Move = iif(((Move_Kind=='SHFT'||Move_Kind=='YARD')&&(left(From_Position_Name,14)==left(To_Position_Name,14))),1,0)) ~> derivedColumn3\nselect2 filter(Incomplete_To_Position==0) ~> filter1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'gold/rehandle_rdsc_export_within_stack',\n\ttruncate: true,\n\tmergeSchema: false,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['mve_gkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tMove_Kind,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tt_put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tufv_gkey,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tFromEB_WB,\n\t\tIB_mve_gkey,\n\t\tIB_t_put,\n\t\tIB_ufv_gkey,\n\t\tIB_Max_T_Put,\n\t\tIB_Unit_Nbr,\n\t\tIB_Facility_Id,\n\t\tIB_Move_Kind,\n\t\tIB_Requires_Power_Flag,\n\t\tIncomplete_To_Position,\n\t\tIncomplete_From_Position,\n\t\tStack_Move,\n\t\tRNumber,\n\t\tMovesPerUnitFcyVisit\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Rehandle_within_stack_recv_export_gpa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Find unproductive moves within same block, bay for RECV Full Export ctrs in GCT facility",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Sort2"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "window1"
						},
						{
							"name": "select2"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter1"
						},
						{
							"name": "filterRECV"
						}
					],
					"script": "parameters{\n\tcustomer as string ('gpa')\n}\nsource(output(\n\t\tmve_gkey as long,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tt_put as timestamp,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tufv_gkey as long,\n\t\tRequires_Power_Flag as boolean,\n\t\tOOG_Flag as boolean,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tFromEB_WB as integer,\n\t\tIB_mve_gkey as long,\n\t\tIB_t_put as timestamp,\n\t\tIB_ufv_gkey as long,\n\t\tIB_Max_T_Put as timestamp,\n\t\tIB_Unit_Nbr as string,\n\t\tIB_Facility_Id as string,\n\t\tIB_Move_Kind as string,\n\t\tIB_Requires_Power_Flag as boolean,\n\t\tRNumber as integer,\n\t\tMovesPerUnitFcyVisit as long\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'gold/rehandle_export',\n\tmode: 'read') ~> source1\nfilter1 sort(asc(ufv_gkey, true),\n\tasc(t_put, true),\n\tasc(mve_gkey, true)) ~> Sort2\nwindow1 alterRow(insertIf(true())) ~> AlterRow1\nSort2 window(over(IB_ufv_gkey),\n\tasc(t_put, true),\n\tasc(mve_gkey, true),\n\tRNumber = rowNumber(),\n\t\tMovesPerUnitFcyVisit = count(mve_gkey)) ~> window1\nderivedColumn3 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tMove_Kind,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tt_put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tufv_gkey,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tFromEB_WB,\n\t\tIB_mve_gkey,\n\t\tIB_t_put,\n\t\tIB_ufv_gkey,\n\t\tIB_Max_T_Put,\n\t\tIB_Unit_Nbr,\n\t\tIB_Facility_Id,\n\t\tIB_Move_Kind,\n\t\tIB_Requires_Power_Flag,\n\t\tIncomplete_To_Position,\n\t\tIncomplete_From_Position,\n\t\tStack_Move\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select2\nfilterRECV derive(Incomplete_To_Position = iif(((Move_Kind=='SHFT'||Move_Kind=='YARD')&&length(To_Position_Name)<13),1,0),\n\t\tIncomplete_From_Position = iif(((Move_Kind=='SHFT'||Move_Kind=='YARD')&& length(From_Position_Name)<13),1,0),\n\t\tStack_Move = iif(((Move_Kind=='SHFT'||Move_Kind=='YARD')&&(left(From_Position_Name,14)==left(To_Position_Name,14))),1,0)) ~> derivedColumn3\nselect2 filter(Incomplete_To_Position==0) ~> filter1\nsource1 filter(IB_Move_Kind=='RECV') ~> filterRECV\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'gold/rehandle_recv_export_within_stack',\n\ttruncate: true,\n\tmergeSchema: false,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['mve_gkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tMove_Kind,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tt_put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tufv_gkey,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tFromEB_WB,\n\t\tIB_mve_gkey,\n\t\tIB_t_put,\n\t\tIB_ufv_gkey,\n\t\tIB_Max_T_Put,\n\t\tIB_Unit_Nbr,\n\t\tIB_Facility_Id,\n\t\tIB_Move_Kind,\n\t\tIB_Requires_Power_Flag,\n\t\tIncomplete_To_Position,\n\t\tIncomplete_From_Position,\n\t\tStack_Move,\n\t\tRNumber,\n\t\tMovesPerUnitFcyVisit\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RemoveDuplicates')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "powerbianalyticsdata-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "Delta"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "powerbianalyticsdata-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Aggregate1"
						}
					],
					"script": "source(output(\n\t\tUnitNbr as string,\n\t\tFacilityId as string,\n\t\tComplexId as string,\n\t\tYardId as string,\n\t\tCarrierVisitKey as string,\n\t\tEventTypeId as string,\n\t\tMoveKind as string,\n\t\tFromLocation as string,\n\t\tToLocation as string,\n\t\tFromPositionName as string,\n\t\tToPositionName as string,\n\t\tCarryCHEOperatorId as string,\n\t\tFetchCHEOperatorId as string,\n\t\tPutCHEOperatorId as string,\n\t\tFetchCHEId as long,\n\t\tFetchCHEKind as string,\n\t\tCarryCHEId as long,\n\t\tCarryCHEKind as string,\n\t\tPutCHEId as long,\n\t\tPutCHEKind as string,\n\t\tQCCHEId as long,\n\t\tQCCHEKind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as string,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as string,\n\t\tt_carry_fetch_ready as string,\n\t\tt_carry_put_ready as string,\n\t\tdist_carry as string,\n\t\tdist_start as string,\n\t\tTwinFetch as string,\n\t\tTwinCarry as string,\n\t\tTwinPut as string,\n\t\tCategoryId as string,\n\t\tFreightKindId as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestowReason as string,\n\t\tContainerLineId as string,\n\t\tContainerLineRole as string,\n\t\tpow as string,\n\t\tmve_gkey as integer,\n\t\tufv_gkey as integer,\n\t\tBerthId as string,\n\t\tGoodsAndCtrWtKg as string,\n\t\tactive_ufv as integer,\n\t\tRequiresPowerFlag as string,\n\t\tOOGFlag as string,\n\t\tShipperId as string,\n\t\tConsigneeId as string,\n\t\tCommodityId as string,\n\t\tATD as string,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'silver/moves') ~> Delta\nDelta aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 sink(allowSchemaDrift: true,\n\tvalidateSchema: true,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'silver/moves',\n\toverwrite: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/powerbianalyticsdata-WorkspaceDefaultStorage')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SC EcEvents_tauranga')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "ITV"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as long,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as boolean,\n\t\tToCheIdName as boolean,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as long,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'tauranga',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name = cheName,\n\t\tCHE_ID = cheID,\n\t\tTimeStamp = EcEventTime,\n\t\teventType = type,\n\t\teventSubType = subType,\n\t\teventTypeDescription = typeDescription,\n\t\tunit = unitIdName,\n\t\tpow = powName,\n\t\tpool = poolName,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot = ladenLocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='FLT' && eventTypeDescription=='CMPL') ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tMoveCount = 1,\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(TimeStamp, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))))) ~> DerivedColumn1\nselect filter((eventTypeDescription == 'LGOF' || eventTypeDescription == 'LGON') && cheKind == 'FLT') ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tBlock = left(locSlot,3)) ~> DerivedColumn3\nSort1 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\teventTypeDescription_PREV = lag(eventTypeDescription),\n\t\teventTypeDescription_NXT = lead(eventTypeDescription)) ~> Window1\nWindow1 derive(LGOF = case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(eventTypeDescription=='LGON',TimeStamp),\n\t\tWorkTime = toDouble((case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime))-case(eventTypeDescription=='LGON',TimeStamp))/3600000)) ~> DerivedColumn4\nDerivedColumn3 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nDerivedColumn1, Filter7 join(Aggregate1@CHE_ID == Aggregate3@CHE_ID\n\t&& DerivedColumn1@ShiftStartTime == DerivedColumn3@ShiftStartTime\n\t&& DerivedColumn1@ShiftEndTime == DerivedColumn3@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tecEventGkey = Aggregate1@ecEventGkey,\n\t\tyardGkey = Aggregate1@yardGkey,\n\t\tYardID = Aggregate1@YardID,\n\t\tFcyID = Aggregate1@FcyID,\n\t\tcheKind = Aggregate1@cheKind,\n\t\tCHE_Name = Aggregate1@CHE_Name,\n\t\tCHE_ID = Aggregate1@CHE_ID,\n\t\tTimeStamp = Aggregate1@TimeStamp,\n\t\teventType = Aggregate1@eventType,\n\t\teventSubType = Aggregate1@eventSubType,\n\t\teventTypeDescription = Aggregate1@eventTypeDescription,\n\t\tunit = Aggregate1@unit,\n\t\tpow = Aggregate1@pow,\n\t\tpool = Aggregate1@pool,\n\t\tworkQueue = Aggregate1@workQueue,\n\t\tmoveKind = Aggregate1@moveKind,\n\t\tlocSlot = Aggregate1@locSlot,\n\t\tunladenLocSlot = Aggregate1@unladenLocSlot,\n\t\tladen_LocSlot = Aggregate1@laden_LocSlot,\n\t\tYear = Aggregate1@Year,\n\t\tMonth = Aggregate1@Month,\n\t\tWeek = Aggregate1@Week,\n\t\tDate = DerivedColumn1@Date,\n\t\tTime = DerivedColumn1@Time,\n\t\tShiftStartTime = DerivedColumn1@ShiftStartTime,\n\t\tShiftEndTime = DerivedColumn1@ShiftEndTime,\n\t\tShift = DerivedColumn1@Shift,\n\t\tShiftDate = DerivedColumn1@ShiftDate,\n\t\tMoveCount,\n\t\tBlock = DerivedColumn1@Block,\n\t\tHour,\n\t\tWeekofYear = DerivedColumn1@WeekofYear,\n\t\t{ecEventGkey.1} = Aggregate3@ecEventGkey,\n\t\t{ShiftDate.1} = DerivedColumn3@ShiftDate,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(TimeStamp>=LGON && TimeStamp<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp),\n\t\tLastMove = case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp),\n\t\tIdleTimeFL = case(isNull(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp))==false(),(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp)-LGON)/3600000,isNull(case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))==false(),(LGOF-case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))/3600000),\n\t\tITVIdleTime = iif(CHE_ID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-TimeStamp)<0,0.0,toFloat((TimeStamp_NXT-TimeStamp)/3600000)),0.0),\n\t\tBayChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0),\n\t\tBayChangeCount = iif(isNull(locSlot_NXT)==true(),0,iif(iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0)==1,\r\niif(toInteger(substring(locSlot,4,2))>toInteger(substring(locSlot_NXT,4,2)),iif( \r\ntoInteger(substring(locSlot,4,2))%2==0,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2)))), \r\niif(toInteger(substring(locSlot_NXT,4,2))%2==0,toInteger(substring(locSlot,4,2))-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2)))-(toInteger(substring(locSlot_NXT,4,2)))))\r\n,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,iif(\r\n    toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2)))) \r\n,iif(toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2)))))),0)),\n\t\tBlockChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)!=left(locSlot_NXT,3),1,0),0),0),0),\n\t\tLaneChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,2)!=left(locSlot_NXT,2),1,0),0),0),0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'haifa',\n\tfolderPath: 'gold/itv_ecevents',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tMoveCount,\n\t\tBlock,\n\t\tHour,\n\t\tWeekofYear,\n\t\t{ecEventGkey.1},\n\t\t{ShiftDate.1},\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime,\n\t\tValid,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\tlocSlot_PREV,\n\t\tlocSlot_NXT,\n\t\tecEventGkey_PREV,\n\t\tecEventGkey_NXT,\n\t\tShiftDate_PREV,\n\t\tShiftDate_NXT,\n\t\tLGON_PREV,\n\t\tLGON_NXT,\n\t\tLGOF_PREV,\n\t\tLGOF_NXT,\n\t\tFirstMove,\n\t\tLastMove,\n\t\tIdleTimeFL,\n\t\tITVIdleTime,\n\t\tBayChangeInstance,\n\t\tBayChangeCount,\n\t\tBlockChangeInstance,\n\t\tLaneChangeInstance\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> ITV\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\tmoveKind as string,\n\t\tlocSlot as string,\n\t\tunladenLocSlot as string,\n\t\tladen_LocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tWeekofYear as integer,\n\t\tDate as date,\n\t\tTime as string,\n\t\tShiftStartTime as timestamp,\n\t\tShiftEndTime as timestamp,\n\t\tShift as integer,\n\t\tShiftDate as date,\n\t\tBlock as string,\n\t\tCHE_ID_PREV as long,\n\t\tCHE_ID_NXT as long,\n\t\tTimeStamp_PREV as timestamp,\n\t\tTimeStamp_NXT as timestamp,\n\t\teventTypeDescription_PREV as string,\n\t\teventTypeDescription_NXT as string,\n\t\tLGOF as timestamp,\n\t\tLGON as timestamp,\n\t\tWorkTime as double\n\t),\n\tformat: 'delta',\n\tfileSystem: 'haifa',\n\tfolderPath: 'gold/itv_workhours',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tWeekofYear,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tBlock,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\teventTypeDescription_PREV,\n\t\teventTypeDescription_NXT,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SC EcEvents_transnet_dct')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "for TT Productivity report",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "SC"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as string,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'transnet',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name = cheName,\n\t\tCHE_ID = cheID,\n\t\tTimeStamp = EcEventTime,\n\t\teventType = type,\n\t\teventSubType = subType,\n\t\teventTypeDescription = typeDescription,\n\t\tunit = unitIdName,\n\t\tpow = powName,\n\t\tpool = poolName,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot = ladenLocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='SC' && eventTypeDescription=='CMPL' && FcyID == 'DCT') ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tMoveCount = 1,\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(TimeStamp, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))))) ~> DerivedColumn1\nselect filter((eventTypeDescription == 'LGOF' || eventTypeDescription == 'LGON') && cheKind == 'SC'&& FcyID == 'DCT') ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(TimeStamp,'yyyy-MM-dd')),\n\t\tTime = toString(TimeStamp,'HH:mm:ss'),\n\t\tShiftStartTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'02:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'08:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'14:00:00')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'20:00:00')),\r\ntoTimestamp(concat(concat(toString(subDays(TimeStamp,1),'yyyy-MM-dd'),' '),'20:00:00'))\r\n)\r\n))),\n\t\tShiftEndTime = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'07:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'13:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'19:59:59')),\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('20:00:00'),\r\ntoTimestamp(concat(concat(toString(addDays(TimeStamp,1),'yyyy-MM-dd'),' '),'01:59:59')),\r\ntoTimestamp(concat(concat(toString(TimeStamp,'yyyy-MM-dd'),' '),'01:59:59'))\r\n)\r\n))),\n\t\tShift = iif(toString(TimeStamp,'HH:mm:ss')>=toString('02:00:00') \r\n&& toString(TimeStamp,'HH:mm:ss')< toString('08:00:00'),\r\n1,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('08:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('14:00:00'),\r\n2,\r\niif(toString(TimeStamp,'HH:mm:ss') >= toString('14:00:00')\r\n&& toString(TimeStamp,'HH:mm:ss')< toString('20:00:00'),\r\n3,\r\n4\r\n))),\n\t\tShiftDate = iif(toString(TimeStamp,'HH:mm:ss')<toString('02:00:00'),toDate(toString(subDays(TimeStamp,1),'yyyy-MM-dd')),toDate(toString(TimeStamp,'yyyy-MM-dd'))),\n\t\tBlock = left(locSlot,3)) ~> DerivedColumn3\nSort1 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\teventTypeDescription_PREV = lag(eventTypeDescription),\n\t\teventTypeDescription_NXT = lead(eventTypeDescription)) ~> Window1\nWindow1 derive(LGOF = case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(eventTypeDescription=='LGON',TimeStamp),\n\t\tWorkTime = toDouble((case(CHE_ID==CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV),case(eventTypeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(CHE_ID!=CHE_ID_NXT && (CHE_ID==CHE_ID_PREV || CHE_ID!=CHE_ID_PREV)),case(eventTypeDescription=='LGON', ShiftEndTime))-case(eventTypeDescription=='LGON',TimeStamp))/3600000)) ~> DerivedColumn4\nDerivedColumn3 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(CHE_ID, true),\n\tasc(TimeStamp, true),\n\tCHE_ID_PREV = lag(CHE_ID),\n\t\tCHE_ID_NXT = lead(CHE_ID),\n\t\tTimeStamp_PREV = lag(TimeStamp),\n\t\tTimeStamp_NXT = lead(TimeStamp),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nDerivedColumn1, Filter7 join(Aggregate1@CHE_ID == Aggregate3@CHE_ID\n\t&& DerivedColumn1@ShiftStartTime == DerivedColumn3@ShiftStartTime\n\t&& DerivedColumn1@ShiftEndTime == DerivedColumn3@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tecEventGkey = Aggregate1@ecEventGkey,\n\t\tyardGkey = Aggregate1@yardGkey,\n\t\tYardID = Aggregate1@YardID,\n\t\tFcyID = Aggregate1@FcyID,\n\t\tcheKind = Aggregate1@cheKind,\n\t\tCHE_Name = Aggregate1@CHE_Name,\n\t\tCHE_ID = Aggregate1@CHE_ID,\n\t\tTimeStamp = Aggregate1@TimeStamp,\n\t\teventType = Aggregate1@eventType,\n\t\teventSubType = Aggregate1@eventSubType,\n\t\teventTypeDescription = Aggregate1@eventTypeDescription,\n\t\tunit = Aggregate1@unit,\n\t\tpow = Aggregate1@pow,\n\t\tpool = Aggregate1@pool,\n\t\tworkQueue = Aggregate1@workQueue,\n\t\tmoveKind = Aggregate1@moveKind,\n\t\tlocSlot = Aggregate1@locSlot,\n\t\tunladenLocSlot = Aggregate1@unladenLocSlot,\n\t\tladen_LocSlot = Aggregate1@laden_LocSlot,\n\t\tYear = Aggregate1@Year,\n\t\tMonth = Aggregate1@Month,\n\t\tWeek = Aggregate1@Week,\n\t\tDate = DerivedColumn1@Date,\n\t\tTime = DerivedColumn1@Time,\n\t\tShiftStartTime = DerivedColumn1@ShiftStartTime,\n\t\tShiftEndTime = DerivedColumn1@ShiftEndTime,\n\t\tShift = DerivedColumn1@Shift,\n\t\tShiftDate = DerivedColumn1@ShiftDate,\n\t\tMoveCount,\n\t\tBlock = DerivedColumn1@Block,\n\t\tHour,\n\t\tWeekofYear = DerivedColumn1@WeekofYear,\n\t\t{ecEventGkey.1} = Aggregate3@ecEventGkey,\n\t\t{ShiftDate.1} = DerivedColumn3@ShiftDate,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(TimeStamp>=LGON && TimeStamp<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp),\n\t\tLastMove = case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp),\n\t\tIdleTimeFL = case(isNull(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp))==false(),(case(CHE_ID!=CHE_ID_PREV,TimeStamp,LGON!=LGON_PREV,TimeStamp)-LGON)/3600000,isNull(case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))==false(),(LGOF-case(CHE_ID!=CHE_ID_NXT,TimeStamp,LGOF!=LGOF_NXT,TimeStamp))/3600000),\n\t\tITVIdleTime = iif(CHE_ID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-TimeStamp)<0,0.0,toFloat((TimeStamp_NXT-TimeStamp)/3600000)),0.0),\n\t\tBayChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0),\n\t\tBayChangeCount = iif(isNull(locSlot_NXT)==true(),0,iif(iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)==left(locSlot_NXT,3),iif(left(locSlot,5)!=left(locSlot_NXT,5),1,0),0),0),0),0)==1,\r\niif(toInteger(substring(locSlot,4,2))>toInteger(substring(locSlot_NXT,4,2)),iif( \r\ntoInteger(substring(locSlot,4,2))%2==0,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2))-1)-(toInteger(substring(locSlot_NXT,4,2)))), \r\niif(toInteger(substring(locSlot_NXT,4,2))%2==0,toInteger(substring(locSlot,4,2))-(toInteger(substring(locSlot_NXT,4,2))+1),\r\n(toInteger(substring(locSlot,4,2)))-(toInteger(substring(locSlot_NXT,4,2)))))\r\n,iif(toInteger(substring(locSlot_NXT,4,2))%2==0,iif(\r\n    toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2))-1)-(toInteger(substring(locSlot,4,2)))) \r\n,iif(toInteger(substring(locSlot,4,2))%2==0,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2))+1) \r\n,(toInteger(substring(locSlot_NXT,4,2)))-(toInteger(substring(locSlot,4,2)))))),0)),\n\t\tBlockChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,3)!=left(locSlot_NXT,3),1,0),0),0),0),\n\t\tLaneChangeInstance = iif(CHE_ID==CHE_ID_NXT,iif(ecEventGkey!=ecEventGkey_NXT,iif(ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif(left(locSlot,2)!=left(locSlot_NXT,2),1,0),0),0),0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'transnet',\n\tfolderPath: 'gold/sc_ecevents_dct',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tMoveCount,\n\t\tBlock,\n\t\tHour,\n\t\tWeekofYear,\n\t\t{ecEventGkey.1},\n\t\t{ShiftDate.1},\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime,\n\t\tValid,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\tlocSlot_PREV,\n\t\tlocSlot_NXT,\n\t\tecEventGkey_PREV,\n\t\tecEventGkey_NXT,\n\t\tShiftDate_PREV,\n\t\tShiftDate_NXT,\n\t\tLGON_PREV,\n\t\tLGON_NXT,\n\t\tLGOF_PREV,\n\t\tLGOF_NXT,\n\t\tFirstMove,\n\t\tLastMove,\n\t\tIdleTimeFL,\n\t\tITVIdleTime,\n\t\tBayChangeInstance,\n\t\tBayChangeCount,\n\t\tBlockChangeInstance,\n\t\tLaneChangeInstance\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> SC\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\tmoveKind as string,\n\t\tlocSlot as string,\n\t\tunladenLocSlot as string,\n\t\tladen_LocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tWeekofYear as integer,\n\t\tDate as date,\n\t\tTime as string,\n\t\tShiftStartTime as timestamp,\n\t\tShiftEndTime as timestamp,\n\t\tShift as integer,\n\t\tShiftDate as date,\n\t\tBlock as string,\n\t\tCHE_ID_PREV as long,\n\t\tCHE_ID_NXT as long,\n\t\tTimeStamp_PREV as timestamp,\n\t\tTimeStamp_NXT as timestamp,\n\t\teventTypeDescription_PREV as string,\n\t\teventTypeDescription_NXT as string,\n\t\tLGOF as timestamp,\n\t\tLGON as timestamp,\n\t\tWorkTime as double\n\t),\n\tformat: 'delta',\n\tfileSystem: 'transnet',\n\tfolderPath: 'gold/sc_workhours_dct',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tCHE_Name,\n\t\tCHE_ID,\n\t\tTimeStamp,\n\t\teventType,\n\t\teventSubType,\n\t\teventTypeDescription,\n\t\tunit,\n\t\tpow,\n\t\tpool,\n\t\tworkQueue,\n\t\tmoveKind,\n\t\tlocSlot,\n\t\tunladenLocSlot,\n\t\tladen_LocSlot,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tWeekofYear,\n\t\tDate,\n\t\tTime,\n\t\tShiftStartTime,\n\t\tShiftEndTime,\n\t\tShift,\n\t\tShiftDate,\n\t\tBlock,\n\t\tCHE_ID_PREV,\n\t\tCHE_ID_NXT,\n\t\tTimeStamp_PREV,\n\t\tTimeStamp_NXT,\n\t\teventTypeDescription_PREV,\n\t\teventTypeDescription_NXT,\n\t\tLGOF,\n\t\tLGON,\n\t\tWorkTime\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SC_GMPH')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "powerbianalyticsdata-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "powerbianalyticsdata-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "RTG",
							"rejectedDataLinkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							}
						},
						{
							"linkedService": {
								"referenceName": "powerbianalyticsdata-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "workhours"
						}
					],
					"transformations": [
						{
							"name": "select"
						},
						{
							"name": "Filter1"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Aggregate3"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Window1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "Sort1"
						},
						{
							"name": "Sort2"
						},
						{
							"name": "Window2"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "Filter6"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter7"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "AlterRow2"
						},
						{
							"name": "derivedColumn10"
						},
						{
							"name": "derivedColumn11"
						},
						{
							"name": "derivedColumn12"
						},
						{
							"name": "derivedColumn13"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as short,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as boolean,\n\t\tToCheIdName as boolean,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as boolean,\n\t\tstartDistance as short,\n\t\tworkAssignmentId as double,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tlastEstMoveTime as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 select(mapColumn(\n\t\tecEventGkey,\n\t\tyardGkey,\n\t\tYardID,\n\t\tFcyID,\n\t\tcheKind,\n\t\tcheName,\n\t\tcheID,\n\t\tEcEventTime,\n\t\ttype,\n\t\tsubType,\n\t\ttypeDescription,\n\t\tfromCheIdName,\n\t\tToCheIdName,\n\t\tunitIdName,\n\t\tpowName,\n\t\tpoolName,\n\t\tworkQueue,\n\t\ttravelDistance,\n\t\tmoveKind,\n\t\tisTwinMove,\n\t\tstartDistance,\n\t\tworkAssignmentId,\n\t\tunitReference,\n\t\ttranId,\n\t\tlocType,\n\t\tlocId,\n\t\tlocSlot,\n\t\topsPosId,\n\t\tunladenLoctype,\n\t\tunladenLocid,\n\t\tunladenLocSlot,\n\t\tladenLoctype,\n\t\tladenLocid,\n\t\tladenLocSlot,\n\t\tlastEstMoveTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select\nselect filter(cheKind=='SC' && typeDescription=='CMPL') ~> Filter1\nFilter1 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate1\nAggregate1 derive(Date = toDate(toString(EcEventTime,'yyyy-MM-dd')),\n\t\tTime = toString(EcEventTime,'HH:mm:ss'),\n\t\tShiftDate = iif(toString(EcEventTime,'HH:mm:ss')<toString('06:00:00'),toDate(toString(subDays(EcEventTime,1),'yyyy-MM-dd')),toDate(toString(EcEventTime,'yyyy-MM-dd'))),\n\t\tMoveCount = iif(moveKind=='YARD',iif(left(locSlot,5)==left(ladenLocSlot,5),2,1),1),\n\t\tBlock = left(locSlot,3),\n\t\tHour = toString(EcEventTime, 'HH'),\n\t\tWeekofYear = weekOfYear(iif(toString(EcEventTime,'HH:mm:ss')<toString('06:00:00'),toDate(toString(subDays(EcEventTime,1),'yyyy-MM-dd')),toDate(toString(EcEventTime,'yyyy-MM-dd')))),\n\t\tDay_Of_Week = dayOfWeek(iif(toString(EcEventTime,'HH:mm:ss')<toString('06:00:00'),subDays(toDate(toString(EcEventTime,'yyyy-MM-dd')),1),toDate(toString(EcEventTime,'yyyy-MM-dd'))))) ~> DerivedColumn1\nselect filter((typeDescription == 'LGOF' || typeDescription == 'LGON') && cheKind == 'SC') ~> Filter5\nFilter5 aggregate(groupBy(ecEventGkey),\n\teach(match(name!='ecEventGkey'), $$ = first($$))) ~> Aggregate3\nAggregate3 derive(WeekofYear = weekOfYear(iif(toString(EcEventTime,'HH:mm:ss')<toString('06:00:00'),toDate(toString(subDays(EcEventTime,1),'yyyy-MM-dd')),toDate(toString(EcEventTime,'yyyy-MM-dd')))),\n\t\tDate = toDate(toString(EcEventTime,'yyyy-MM-dd')),\n\t\tTime = toString(EcEventTime,'HH:mm:ss'),\n\t\tShiftDate = iif(toString(EcEventTime,'HH:mm:ss')<toString('06:00:00'),toDate(toString(subDays(EcEventTime,1),'yyyy-MM-dd')),toDate(toString(EcEventTime,'yyyy-MM-dd'))),\n\t\tBlock = left(locSlot,3),\n\t\tDay_Of_Week = dayOfWeek(iif(toString(EcEventTime,'HH:mm:ss')<toString('06:00:00'),subDays(toDate(toString(EcEventTime,'yyyy-MM-dd')),1),toDate(toString(EcEventTime,'yyyy-MM-dd'))))) ~> DerivedColumn3\nSort1 window(asc(yardGkey, true),\n\tasc(cheID, true),\n\tasc(EcEventTime, true),\n\tCHE_ID_PREV = lag(cheID),\n\t\tCHE_ID_NXT = lead(cheID),\n\t\tTimeStamp_PREV = lag(EcEventTime),\n\t\tTimeStamp_NXT = lead(EcEventTime),\n\t\teventTypeDescription_PREV = lag(typeDescription),\n\t\teventTypeDescription_NXT = lead(typeDescription)) ~> Window1\nWindow1 derive(LGOF = case(cheID==CHE_ID_NXT && (cheID==CHE_ID_PREV || cheID!=CHE_ID_PREV),case(typeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(cheID!=CHE_ID_NXT && (cheID==CHE_ID_PREV || cheID!=CHE_ID_PREV)),case(typeDescription=='LGON', ShiftEndTime)),\n\t\tLGON = case(typeDescription=='LGON',EcEventTime),\n\t\tWorkTime = toDouble((case(cheID==CHE_ID_NXT && (cheID==CHE_ID_PREV || cheID!=CHE_ID_PREV),case(typeDescription=='LGON',case(eventTypeDescription_NXT=='LGOF',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT),eventTypeDescription_NXT=='LGON',iif(TimeStamp_NXT>ShiftEndTime,ShiftEndTime,TimeStamp_NXT-seconds(1)))),(cheID!=CHE_ID_NXT && (cheID==CHE_ID_PREV || cheID!=CHE_ID_PREV)),case(typeDescription=='LGON', ShiftEndTime))-case(typeDescription=='LGON',EcEventTime))/3600000)) ~> DerivedColumn4\nderivedColumn11 sort(asc(yardGkey, true),\n\tasc(cheID, true),\n\tasc(EcEventTime, true)) ~> Sort1\nFilter6 sort(asc(yardGkey, true),\n\tasc(cheID, true),\n\tasc(EcEventTime, true)) ~> Sort2\nSort2 window(asc(yardGkey, true),\n\tasc(cheID, true),\n\tasc(EcEventTime, true),\n\tCHE_ID_PREV = lag(cheID),\n\t\tCHE_ID_NXT = lead(cheID),\n\t\tTimeStamp_PREV = lag(EcEventTime),\n\t\tTimeStamp_NXT = lead(EcEventTime),\n\t\tlocSlot_PREV = lag(locSlot),\n\t\tlocSlot_NXT = lead(locSlot),\n\t\tecEventGkey_PREV = lag(ecEventGkey),\n\t\tecEventGkey_NXT = lead(ecEventGkey),\n\t\tShiftDate_PREV = lag(ShiftDate),\n\t\tShiftDate_NXT = lead(ShiftDate),\n\t\tLGON_PREV = lag(LGON),\n\t\tLGON_NXT = lead(LGON),\n\t\tLGOF_PREV = lag(LGOF),\n\t\tLGOF_NXT = lead(LGOF)) ~> Window2\nderivedColumn13, Filter7 join(Aggregate1@cheID == Aggregate3@cheID\n\t&& derivedColumn12@ShiftStartTime == derivedColumn10@ShiftStartTime\n\t&& derivedColumn12@ShiftEndTime == derivedColumn10@ShiftEndTime,\n\tjoinType:'inner',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\teach(match(/* All input columns */true()),\n\t\t\t/* Input name */$$ = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Valid = iif(EcEventTime>=LGON && EcEventTime<=LGOF,1,0)) ~> DerivedColumn5\nDerivedColumn5 filter(Valid==1) ~> Filter6\nWindow2 derive(FirstMove = case(cheID!=CHE_ID_PREV,EcEventTime,LGON!=LGON_PREV,EcEventTime),\n\t\tLastMove = case(cheID!=CHE_ID_NXT,EcEventTime,LGOF!=LGOF_NXT,EcEventTime),\n\t\tIdleTimeFL = case(isNull(case(cheID!=CHE_ID_PREV,EcEventTime,LGON!=LGON_PREV,EcEventTime))==false(),(case(cheID!=CHE_ID_PREV,EcEventTime,LGON!=LGON_PREV,EcEventTime)-LGON)/3600000,isNull(case(cheID!=CHE_ID_NXT,Time,LGOF!=LGOF_NXT,Time))==false(),(LGOF- case(cheID!=CHE_ID_NXT,EcEventTime,LGOF!=LGOF_NXT,EcEventTime))/3600000),\n\t\tRTGIdleTime = iif(cheID==CHE_ID_NXT && ecEventGkey!=ecEventGkey_NXT && ShiftDate==ShiftDate_NXT && LGON==LGON_NXT && LGOF==LGOF_NXT,iif((TimeStamp_NXT-EcEventTime)<0,0.0,toFloat((TimeStamp_NXT-EcEventTime)/3600000)),0.0)) ~> DerivedColumn6\nDerivedColumn4 filter(isNull(WorkTime)==false()) ~> Filter7\nDerivedColumn6 alterRow(upsertIf(true())) ~> AlterRow1\nFilter7 alterRow(upsertIf(true())) ~> AlterRow2\nDerivedColumn3 derive(ShiftStartTime = iif(Day_Of_Week==1 || Day_Of_Week==7,    iif(Time>=toString('06:00:00') && Time<toString('12:00:00'),        toTimestamp(concat(toString(ShiftDate),' ','06:00:00')),        iif(Time>=toString('12:00:00') && Time<toString('18:00:00'),            toTimestamp(concat(toString(ShiftDate),' ','12:00:00')),            iif(Time>=toString('18:00:00') && Time<toString('24:00:00'),                toTimestamp(concat(toString(ShiftDate),' ','18:00:00')),                toTimestamp(concat(toString(ShiftDate),' ','24:00:00'))))),    iif(Time>=toString('06:00:00') && Time<toString('14:00:00'),        toTimestamp(concat(toString(ShiftDate),' ','06:00:00')),        iif(Time>=toString('14:00:00') && Time<toString('22:00:00'),            toTimestamp(concat(toString(ShiftDate),' ','14:00:00')),            toTimestamp(concat(toString(ShiftDate),' ','22:00:00'))            ))),\n\t\tShiftEndTime = iif(Day_Of_Week==1 || Day_Of_Week==7,    iif(Time>=toString('06:00:00') && Time<toString('12:00:00'),        toTimestamp(concat(toString(ShiftDate),' ','11:59:59')),        iif(Time>=toString('12:00:00') && Time<toString('18:00:00'),            toTimestamp(concat(toString(ShiftDate),' ','17:59:59')),            iif(Time>=toString('18:00:00') && Time<toString('24:00:00'),                toTimestamp(concat(toString(ShiftDate),' ','23:59:59')),                toTimestamp(concat(toString(ShiftDate),' ','05:59:59'))))),    iif(Time>=toString('06:00:00') && Time<toString('14:00:00'),        toTimestamp(concat(toString(ShiftDate),' ','13:59:59')),        iif(Time>=toString('14:00:00') && Time<toString('22:00:00'),            toTimestamp(concat(toString(ShiftDate),' ','21:59:59')),toTimestamp(concat(toString(ShiftDate),' ','05:59:59'))            )))) ~> derivedColumn10\nderivedColumn10 derive(Shift = iif(toString(ShiftStartTime, 'HH:mm:ss')==toString('06:00:00'),1,iif(toString(ShiftStartTime, 'HH:mm:ss')==toString('14:00:00')||toString(ShiftStartTime, 'HH:mm:ss')==toString('12:00:00'),2,iif(toString(ShiftStartTime, 'HH:mm:ss')==toString('22:00:00')||toString(ShiftStartTime, 'HH:mm:ss')==toString('18:00:00'),3,4)))) ~> derivedColumn11\nDerivedColumn1 derive(ShiftStartTime = iif(Day_Of_Week==1 || Day_Of_Week==7,    iif(Time>=toString('06:00:00') && Time<toString('12:00:00'),        toTimestamp(concat(toString(ShiftDate),' ','06:00:00')),        iif(Time>=toString('12:00:00') && Time<toString('18:00:00'),            toTimestamp(concat(toString(ShiftDate),' ','12:00:00')),            iif(Time>=toString('18:00:00') && Time<toString('24:00:00'),                toTimestamp(concat(toString(ShiftDate),' ','18:00:00')),                toTimestamp(concat(toString(ShiftDate),' ','24:00:00'))))),    iif(Time>=toString('06:00:00') && Time<toString('14:00:00'),        toTimestamp(concat(toString(ShiftDate),' ','06:00:00')),        iif(Time>=toString('14:00:00') && Time<toString('22:00:00'),            toTimestamp(concat(toString(ShiftDate),' ','14:00:00')),            toTimestamp(concat(toString(ShiftDate),' ','22:00:00'))            ))),\n\t\tShiftEndTime = iif(Day_Of_Week==1 || Day_Of_Week==7,    iif(Time>=toString('06:00:00') && Time<toString('12:00:00'),        toTimestamp(concat(toString(ShiftDate),' ','11:59:59')),        iif(Time>=toString('12:00:00') && Time<toString('18:00:00'),            toTimestamp(concat(toString(ShiftDate),' ','17:59:59')),            iif(Time>=toString('18:00:00') && Time<toString('24:00:00'),                toTimestamp(concat(toString(ShiftDate),' ','23:59:59')),                toTimestamp(concat(toString(ShiftDate),' ','05:59:59'))))),    iif(Time>=toString('06:00:00') && Time<toString('14:00:00'),        toTimestamp(concat(toString(ShiftDate),' ','13:59:59')),        iif(Time>=toString('14:00:00') && Time<toString('22:00:00'),            toTimestamp(concat(toString(ShiftDate),' ','21:59:59')),toTimestamp(concat(toString(ShiftDate),' ','05:59:59'))            )))) ~> derivedColumn12\nderivedColumn12 derive(Shift = iif(toString(ShiftStartTime, 'HH:mm:ss')==toString('06:00:00'),1,iif(toString(ShiftStartTime, 'HH:mm:ss')==toString('14:00:00')||toString(ShiftStartTime, 'HH:mm:ss')==toString('12:00:00'),2,iif(toString(ShiftStartTime, 'HH:mm:ss')==toString('22:00:00')||toString(ShiftStartTime, 'HH:mm:ss')==toString('18:00:00'),3,4)))) ~> derivedColumn13\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'ptpbianalyticsdata',\n\tfolderPath: 'PTP/gold/rtg_ecevents_v2',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0767,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\teach(match(/* All input columns */true()),\n\t\t\t/* Input name */$$ = $$)\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> RTG\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tecEventGkey as long,\n\t\tyardGkey as string,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tCHE_Name as string,\n\t\tCHE_ID as long,\n\t\tTimeStamp as timestamp,\n\t\teventType as string,\n\t\teventSubType as string,\n\t\teventTypeDescription as string,\n\t\tunit as string,\n\t\tpow as string,\n\t\tpool as string,\n\t\tworkQueue as string,\n\t\tmoveKind as string,\n\t\tlocSlot as string,\n\t\tunladenLocSlot as string,\n\t\tladen_LocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\tWeekofYear as integer,\n\t\tDate as date,\n\t\tTime as string,\n\t\tShiftStartTime as timestamp,\n\t\tShiftEndTime as timestamp,\n\t\tShift as integer,\n\t\tShiftDate as date,\n\t\tBlock as string,\n\t\tCHE_ID_PREV as long,\n\t\tCHE_ID_NXT as long,\n\t\tTimeStamp_PREV as timestamp,\n\t\tTimeStamp_NXT as timestamp,\n\t\teventTypeDescription_PREV as string,\n\t\teventTypeDescription_NXT as string,\n\t\tLGOF as timestamp,\n\t\tLGON as timestamp,\n\t\tWorkTime as double\n\t),\n\tformat: 'delta',\n\tfileSystem: 'ptpbianalyticsdata',\n\tfolderPath: 'PTP/gold/rtg_workhours_v2',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['ecEventGkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\teach(match(/* All input columns */true()),\n\t\t\t/* Input name */$$ = $$)\n\t),\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> workhours"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/powerbianalyticsdata-WorkspaceDefaultStorage')]",
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SC_Productivity_seayard')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Using Moves as source data",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as long,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as boolean,\n\t\tstartDistance as short,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\toperator_id as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'seayard',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 filter(cheKind == 'SC' && poolName == \"Y-GATE\" && typeDescription == \"DROP\") ~> Filter1\nFilter1 derive(CarryCompleteTime = toString(EcEventTime,'HH:mm:ss'),\n\t\tCarryCompleteDate = toDate(toString(EcEventTime,'yyyy-MM-dd'))) ~> DerivedColumn2\nDerivedColumn2 aggregate(groupBy(cheID,\n\t\tCarryCompleteDate),\n\tFirst_Lift = min(EcEventTime),\n\t\tLast_Lift = max(EcEventTime),\n\t\tMove_Count = countDistinct(ecEventGkey)) ~> Aggregate1\nAggregate1 derive(WorkTime = Last_Lift-First_Lift,\n\t\tYear = iifNull(year(CarryCompleteDate),0),\n\t\tMonth = iifNull(month(CarryCompleteDate),0),\n\t\tWeek = iifNull(weekOfYear(CarryCompleteDate),0)) ~> DerivedColumn4\nDerivedColumn4 alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'seayard',\n\tfolderPath: 'gold/sc_productivity',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: false,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['cheID','CarryCompleteDate'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SC_Productivity_seayard_new')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Using Moves as source data",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\tecEventGkey as long,\n\t\tyardGkey as long,\n\t\tYardID as string,\n\t\tFcyID as string,\n\t\tcheKind as string,\n\t\tcheName as string,\n\t\tcheID as long,\n\t\tEcEventTime as timestamp,\n\t\ttype as short,\n\t\tsubType as short,\n\t\ttypeDescription as string,\n\t\tfromCheIdName as string,\n\t\tToCheIdName as string,\n\t\tunitIdName as string,\n\t\tpowName as string,\n\t\tpoolName as string,\n\t\tworkQueue as string,\n\t\ttravelDistance as short,\n\t\tmoveKind as string,\n\t\tisTwinMove as boolean,\n\t\tstartDistance as short,\n\t\tunitReference as string,\n\t\ttranId as string,\n\t\tlocType as string,\n\t\tlocId as string,\n\t\tlocSlot as string,\n\t\topsPosId as string,\n\t\tunladenLoctype as string,\n\t\tunladenLocid as string,\n\t\tunladenLocSlot as string,\n\t\tladenLoctype as string,\n\t\tladenLocid as string,\n\t\tladenLocSlot as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer,\n\t\toperator_id as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'seayard',\n\tfolderPath: 'silver/ecevents') ~> source1\nsource1 filter(cheKind == 'SC' && powName== \"GATE\" && typeDescription == \"DROP\") ~> Filter1\nFilter1 derive(CarryCompleteTime = toString(EcEventTime,'HH:mm:ss'),\n\t\tCarryCompleteDate = toDate(toString(EcEventTime,'yyyy-MM-dd'))) ~> DerivedColumn2\nDerivedColumn2 aggregate(groupBy(CarryCompleteDate),\n\tMove_Count = countDistinct(unitIdName),\n\t\tChe_Count = countDistinct(cheID)) ~> Aggregate1\nAggregate1 derive(sc_prod = Move_Count/Che_Count,\n\t\tYear = iifNull(year(CarryCompleteDate),0),\n\t\tMonth = iifNull(month(CarryCompleteDate),0),\n\t\tWeek = iifNull(weekOfYear(CarryCompleteDate),0)) ~> DerivedColumn4\nDerivedColumn4 alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'seayard',\n\tfolderPath: 'gold/sc_productivity_new',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: true,\n\tinsertable: false,\n\tupdateable: true,\n\tupsertable: true,\n\tkeys:['CarryCompleteDate'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SC_idle_time_MCT')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ecevents"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink5"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "select5"
						},
						{
							"name": "alterRow5"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "sort1"
						},
						{
							"name": "aggregate1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as integer,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          CHE_ID as short,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          workAssignment as string,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          lastEstMoveTime as string,",
						"          operator_name as string,",
						"          EcEventTime as timestamp,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'mct',",
						"     folderPath: 'silver/ecevents') ~> ecevents",
						"ecevents filter(cheKind == 'SC') ~> filter1",
						"derivedColumn4 window(over(CHE_ID,",
						"          EcEventDate),",
						"     asc(CHE_ID, true),",
						"     asc(EcEventTime, true),",
						"     EcEventTime_PREV = lag(EcEventTime, 1, null()),",
						"          EcEventTime_NEXT = lead(EcEventTime, 1, null()),",
						"          typeDescription_PREV = lag(eventTypeDescription, 1, null()),",
						"          typeDescription_NEXT = lead(eventTypeDescription, 1, null()),",
						"          cheID_PREV = lag(CHE_ID, 1, null()),",
						"          cheID_NEXT = lead(CHE_ID, 1, null()),",
						"          EcEventDate_PREV = lag(EcEventDate, 1, null()),",
						"          EcEventDate_NEXT = lead(EcEventDate, 1, null())) ~> window1",
						"sort1 derive(idle_time = iif(cheID_PREV == CHE_ID && CHE_ID == cheID_NEXT && EcEventDate_PREV == EcEventDate && EcEventDate == EcEventDate_NEXT\r",
						"    , iif(typeDescription_PREV==\"DROP\" && eventTypeDescription==\"DSPT\" &&  in([\"EAGD\", \"EARW\", \"EASH\", \"ETGD\", \"ETRL\", \"ETRW\", \"ETSH\"], typeDescription_NEXT), \r",
						"    iif(:time_delta_mins >= 0.0 , :time_delta_mins, toLong(0))\r",
						"    , toLong(0))\r",
						"    , toLong(0)),",
						"          time_delta_mins = :time_delta_mins,",
						"          time_delta_mins := (toLong(EcEventTime) - toLong(EcEventTime_PREV))/(60*1000)) ~> derivedColumn3",
						"aggregate1 select(mapColumn(",
						"          EcEventDate,",
						"          cheID = CHE_ID,",
						"          CHE_Name,",
						"          first_che_time,",
						"          last_che_time,",
						"          total_idle_time,",
						"          year,",
						"          month,",
						"          week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select5",
						"select5 alterRow(upsertIf(true())) ~> alterRow5",
						"filter1 derive(EcEventDate = toDate(toString(EcEventTime,'yyyy-MM-dd'))) ~> derivedColumn4",
						"window1 sort(asc(EcEventDate, true),",
						"     asc(CHE_ID, true),",
						"     asc(EcEventTime, true)) ~> sort1",
						"derivedColumn3 aggregate(groupBy(EcEventDate,",
						"          CHE_ID,",
						"          CHE_Name),",
						"     total_idle_time = sum(idle_time),",
						"          first_che_time = first(EcEventTime),",
						"          last_che_time = max(EcEventTime),",
						"          year = first(Year),",
						"          month = first(Month),",
						"          week = first(Week)) ~> aggregate1",
						"alterRow5 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mct',",
						"     folderPath: 'gold/sc_idle_time',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['EcEventDate','cheID'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('key',",
						"          0,",
						"          year,",
						"          month,",
						"          week",
						"     )) ~> sink5"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SC_idle_time_seayard')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ecevents"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink5"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "select5"
						},
						{
							"name": "alterRow5"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "sort1"
						},
						{
							"name": "aggregate1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as long,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as boolean,",
						"          startDistance as short,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer,",
						"          operator_id as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'seayard',",
						"     folderPath: 'silver/ecevents') ~> ecevents",
						"ecevents filter(cheKind == 'SC' && poolName == \"Y-GATE\") ~> filter1",
						"derivedColumn4 window(over(cheID,",
						"          EcEventDate),",
						"     asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     EcEventTime_PREV = lag(EcEventTime, 1, null()),",
						"          EcEventTime_NEXT = lead(EcEventTime, 1, null()),",
						"          typeDescription_PREV = lag(typeDescription, 1, null()),",
						"          typeDescription_NEXT = lead(typeDescription, 1, null()),",
						"          cheID_PREV = lag(cheID, 1, null()),",
						"          cheID_NEXT = lead(cheID, 1, null()),",
						"          EcEventDate_PREV = lag(EcEventDate, 1, null()),",
						"          EcEventDate_NEXT = lead(EcEventDate, 1, null())) ~> window1",
						"sort1 derive(idle_time = iif(cheID_PREV == cheID && cheID == cheID_NEXT && EcEventDate_PREV == EcEventDate && EcEventDate == EcEventDate_NEXT\r",
						"    , iif(typeDescription_PREV==\"DROP\" && typeDescription==\"DSPT\" &&  in([\"EAGD\", \"EARW\", \"EASH\", \"ETGD\", \"ETRL\", \"ETRW\", \"ETSH\"], typeDescription_NEXT), \r",
						"    iif(:time_delta_mins >= 0.0 , :time_delta_mins, toLong(0))\r",
						"    , toLong(0))\r",
						"    , toLong(0)),",
						"          time_delta_mins = :time_delta_mins,",
						"          time_delta_mins := (toLong(EcEventTime) - toLong(EcEventTime_PREV))/(60*1000)) ~> derivedColumn3",
						"aggregate1 select(mapColumn(",
						"          EcEventDate,",
						"          cheID,",
						"          first_che_time,",
						"          last_che_time,",
						"          total_idle_time,",
						"          year,",
						"          month,",
						"          week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select5",
						"select5 alterRow(upsertIf(true())) ~> alterRow5",
						"filter1 derive(EcEventDate = toDate(toString(EcEventTime,'yyyy-MM-dd'))) ~> derivedColumn4",
						"window1 sort(asc(EcEventDate, true),",
						"     asc(cheID, true),",
						"     asc(EcEventTime, true)) ~> sort1",
						"derivedColumn3 aggregate(groupBy(EcEventDate,",
						"          cheID),",
						"     total_idle_time = sum(idle_time),",
						"          first_che_time = first(EcEventTime),",
						"          last_che_time = max(EcEventTime),",
						"          year = first(Year),",
						"          month = first(Month),",
						"          week = first(Week)) ~> aggregate1",
						"alterRow5 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'seayard',",
						"     folderPath: 'gold/sc_idle_time',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['EcEventDate','cheID'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('key',",
						"          0,",
						"          year,",
						"          month,",
						"          week",
						"     )) ~> sink5"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SC_laden_unladen_time_dist_tauranga')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ecevents"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink2"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink3"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink4"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink5"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "pivot1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "split1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "MapDrifted1",
							"description": "Creates an explicit mapping for each drifted column"
						},
						{
							"name": "select1"
						},
						{
							"name": "split2"
						},
						{
							"name": "select2"
						},
						{
							"name": "split3"
						},
						{
							"name": "select3"
						},
						{
							"name": "select4"
						},
						{
							"name": "alterRow2"
						},
						{
							"name": "alterRow3"
						},
						{
							"name": "alterRow4"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "window2"
						},
						{
							"name": "filter3"
						},
						{
							"name": "filter4"
						},
						{
							"name": "filter5"
						},
						{
							"name": "filter6"
						},
						{
							"name": "MapDrifted2",
							"description": "Creates an explicit mapping for each drifted column"
						},
						{
							"name": "select5"
						},
						{
							"name": "alterRow5"
						},
						{
							"name": "filter7"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as long,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as boolean,",
						"          startDistance as short,",
						"          workAssignmentId as long,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'tauranga',",
						"     folderPath: 'silver/ecevents') ~> ecevents",
						"ecevents filter(cheKind == 'SC' && (moveKind == 'DSCH' || moveKind == 'LOAD') && (typeDescription=='EARW' || typeDescription=='EASH' || typeDescription=='DSPT' || typeDescription=='DROP' || typeDescription=='LTSH' || typeDescription=='LASH' || typeDescription=='LTRW' || typeDescription=='LARW')) ~> filter1",
						"select1 alterRow(upsertIf(true())) ~> alterRow1",
						"window2 pivot(groupBy(unitIdName,",
						"          GroupNumber,",
						"          moveKind),",
						"     pivotBy(typeDescription),",
						"     {_} = first(EcEventTime),",
						"          unladen = first(startDistance),",
						"          laden = first(travelDistance),",
						"     columnNaming: '$N$V_Time',",
						"     lateral: false) ~> pivot1",
						"split1@LoadMoves derive(ScLoadTime = :sc_load_time,",
						"          ScLoadUnladenTime = :sc_load_unladen_time,",
						"          ScLoadTimeRange = iif(:sc_load_time >= 0.0 && :sc_load_time <= 10.0, \"0 to 10 min\",iif(:sc_load_time > 10.0 && :sc_load_time <= 15.0, \"10 to 15 min\",iif(:sc_load_time > 15.0 && :sc_load_time <= 20.0, \"15 to 20 min\",iif(:sc_load_time > 20.0 && :sc_load_time <= 25.0, \"20 to 25 min\",iif(:sc_load_time > 25.0 && :sc_load_time <= 30.0, \"25 to 30 min\",iif(:sc_load_time > 30.0 && :sc_load_time <= 40.0, \"30 to 40 min\",iif(:sc_load_time > 40.0 && :sc_load_time <= 50.0, \"40 to 50 min\",iif(:sc_load_time > 50.0 ,\"50 & above\", \"\")))))))),",
						"          ScLoadUnladenTimeRange = iif(:sc_load_unladen_time >= 0.0 && :sc_load_unladen_time <= 10.0, \"0 to 10 min\",iif(:sc_load_unladen_time > 10.0 && :sc_load_unladen_time <= 15.0, \"10 to 15 min\",iif(:sc_load_unladen_time > 15.0 && :sc_load_unladen_time <= 20.0, \"15 to 20 min\",iif(:sc_load_unladen_time > 20.0 && :sc_load_unladen_time <= 25.0, \"20 to 25 min\",iif(:sc_load_unladen_time > 25.0 && :sc_load_unladen_time <= 30.0, \"25 to 30 min\",iif(:sc_load_unladen_time > 30.0 && :sc_load_unladen_time <= 40.0, \"30 to 40 min\",iif(:sc_load_unladen_time > 40.0 && :sc_load_unladen_time <= 50.0, \"40 to 50 min\",iif(:sc_load_unladen_time > 50.0 ,\"50 & above\", \"\")))))))),",
						"          sc_load_time := round((DROP_Time - DSPT_Time)/60000,2),",
						"          sc_load_unladen_time := round((EARW_Time - DSPT_Time)/60000,2)) ~> derivedColumn1",
						"MapDrifted1 split(moveKind  == \"LOAD\",",
						"     moveKind  == \"DSCH\",",
						"     disjoint: false) ~> split1@(LoadMoves, DschMoves)",
						"split1@DschMoves derive(ScDschTime = :sc_dsch_time,",
						"          ScDschUnladenTime = :sc_dsch_unladen_time,",
						"          ScDschTimeRange = iif(:sc_dsch_time >= 0.0 && :sc_dsch_time <= 10.0, \"0 to 10 min\",iif(:sc_dsch_time > 10.0 && :sc_dsch_time <= 15.0, \"10 to 15 min\",iif(:sc_dsch_time > 15.0 && :sc_dsch_time <= 20.0, \"15 to 20 min\",iif(:sc_dsch_time > 20.0 && :sc_dsch_time <= 25.0, \"20 to 25 min\",iif(:sc_dsch_time > 25.0 && :sc_dsch_time <= 30.0, \"25 to 30 min\",iif(:sc_dsch_time > 30.0 && :sc_dsch_time <= 40.0, \"30 to 40 min\",iif(:sc_dsch_time > 40.0 && :sc_dsch_time <= 50.0, \"40 to 50 min\",iif(:sc_dsch_time > 50.0 ,\"50 & above\", \"\")))))))),",
						"          ScDschUnladenTimeRange = iif(:sc_dsch_unladen_time>= 0.0 && :sc_dsch_unladen_time<= 10.0, \"0 to 10 min\",iif(:sc_dsch_unladen_time> 10.0 && :sc_dsch_unladen_time<= 15.0, \"10 to 15 min\",iif(:sc_dsch_unladen_time> 15.0 && :sc_dsch_unladen_time<= 20.0, \"15 to 20 min\",iif(:sc_dsch_unladen_time> 20.0 && :sc_dsch_unladen_time<= 25.0, \"20 to 25 min\",iif(:sc_dsch_unladen_time> 25.0 && :sc_dsch_unladen_time<= 30.0, \"25 to 30 min\",iif(:sc_dsch_unladen_time> 30.0 && :sc_dsch_unladen_time<= 40.0, \"30 to 40 min\",iif(:sc_dsch_unladen_time> 40.0 && :sc_dsch_unladen_time<= 50.0, \"40 to 50 min\",iif(:sc_dsch_unladen_time > 50.0 ,\"50 & above\", \"\")))))))),",
						"          sc_dsch_time := round((DROP_Time - DSPT_Time)/60000,2),",
						"          sc_dsch_unladen_time := round((EASH_Time - DSPT_Time)/60000,2)) ~> derivedColumn2",
						"MapDrifted2 derive(Timestamp = :Timestamp,",
						"          Date = toDate(toString(:TimeStamp)),",
						"          Year = year(:TimeStamp),",
						"          Month = month(:TimeStamp),",
						"          Week = weekOfYear(:TimeStamp),",
						"          TimeStamp = :TimeStamp,",
						"          Timestamp := iifNull(iifNull(toTimestamp(byName('_DSPT_Time')), toTimestamp(byName('_DROP_Time')), toTimestamp(byName('_EARW_Time'))), toTimestamp(byName('_EASH_Time'))),",
						"          TimeStamp := iifNull(iif(moveKind == 'DSCH', iifNull(toTimestamp(byName('_LTRW_Time')), toTimestamp(byName('_LARW_Time'))), iif(moveKind == 'LOAD', iifNull(toTimestamp(byName('_LTSH_Time')), toTimestamp(byName('_LASH_Time'))), toTimestamp(null()))), :Timestamp)) ~> MapDrifted1",
						"filter6 select(mapColumn(",
						"          unitIdName,",
						"          moveKind,",
						"          ScLoadUnladenTime,",
						"          ScLoadUnladenTimeRange,",
						"          Timestamp = split2@ScLoadUnladenTime@TimeStamp,",
						"          Date,",
						"          Year,",
						"          Month,",
						"          Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"derivedColumn1 split(not(isNull(ScLoadUnladenTime)),",
						"     not(isNull(ScLoadTime)),",
						"     disjoint: true) ~> split2@(ScLoadUnladenTime, ScLoadTime)",
						"filter5 select(mapColumn(",
						"          unitIdName,",
						"          moveKind,",
						"          Timestamp = split2@ScLoadTime@TimeStamp,",
						"          Date,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          ScLoadTime,",
						"          ScLoadTimeRange",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"derivedColumn2 split(not(isNull(ScDschUnladenTime)),",
						"     not(isNull(ScDschTime)),",
						"     disjoint: true) ~> split3@(ScDschUnladenTime, ScDschTime)",
						"filter4 select(mapColumn(",
						"          unitIdName,",
						"          moveKind,",
						"          Timestamp = split3@ScDschUnladenTime@TimeStamp,",
						"          Date,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          ScDschUnladenTime,",
						"          ScDschUnladenTimeRange",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select3",
						"filter3 select(mapColumn(",
						"          unitIdName,",
						"          moveKind,",
						"          Timestamp = split3@ScDschTime@TimeStamp,",
						"          Date,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          ScDschTime,",
						"          ScDschTimeRange",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select4",
						"select2 alterRow(upsertIf(true())) ~> alterRow2",
						"select3 alterRow(upsertIf(true())) ~> alterRow3",
						"select4 alterRow(upsertIf(true())) ~> alterRow4",
						"filter1 window(over(unitIdName),",
						"     asc(unitIdName, true),",
						"     asc(EcEventTime, true),",
						"     EcEventTime_PREV = lag(EcEventTime, 1, null())) ~> window1",
						"window1 derive(TimeDeltaMins = :time_delta_mins,",
						"          TimeGroupFlag = iif(isNull(EcEventTime_PREV) || :time_delta_mins > toLong(24*60), 1, 0),",
						"          time_delta_mins := (toLong(EcEventTime) - toLong(EcEventTime_PREV))/(60*1000)) ~> derivedColumn3",
						"derivedColumn3 window(over(unitIdName),",
						"     asc(EcEventTime, true),",
						"     GroupNumber = sum(TimeGroupFlag)) ~> window2",
						"split3@ScDschTime filter(ScDschTime >= 0.0) ~> filter3",
						"split3@ScDschUnladenTime filter(ScDschUnladenTime >= 0.0) ~> filter4",
						"split2@ScLoadTime filter(ScLoadTime >= 0.0) ~> filter5",
						"split2@ScLoadUnladenTime filter(ScLoadUnladenTime >=0.0) ~> filter6",
						"pivot1 derive(DROP_Time = toTimestamp(byName('_DROP_Time')),",
						"          DSPT_Time = toTimestamp(byName('_DSPT_Time')),",
						"          EARW_Time = toTimestamp(byName('_EARW_Time')),",
						"          EASH_Time = toTimestamp(byName('_EASH_Time')),",
						"          UnladenDistance = iif(moveKind == 'DSCH', iifNull(toShort(byName('unladenLTRW_Time')), toShort(byName('unladenLARW_Time'))), iif(moveKind == 'LOAD', iifNull(toShort(byName('unladenLTSH_Time')), toShort(byName('unladenLASH_Time'))), toShort(999))),",
						"          LadenDistance = iif(moveKind == 'DSCH', iifNull(toShort(byName('ladenLTRW_Time')), toShort(byName('ladenLARW_Time'))), iif(moveKind == 'LOAD', iifNull(toShort(byName('ladenLTSH_Time')), toShort(byName('ladenLASH_Time'))), toShort(999)))) ~> MapDrifted2",
						"MapDrifted1 select(mapColumn(",
						"          unitIdName,",
						"          GroupNumber,",
						"          moveKind,",
						"          UnladenDistance,",
						"          LadenDistance,",
						"          Timestamp = MapDrifted1@TimeStamp,",
						"          Date,",
						"          Year,",
						"          Month,",
						"          Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select5",
						"filter7 alterRow(upsertIf(true())) ~> alterRow5",
						"select5 filter(not(isNull(UnladenDistance) && isNull(LadenDistance))) ~> filter7",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'tauranga',",
						"     folderPath: 'gold/sc_load_unladen_time',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['unitIdName','moveKind','Timestamp'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1",
						"alterRow2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'tauranga',",
						"     folderPath: 'gold/sc_load_time',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['unitIdName','moveKind','Timestamp'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink2",
						"alterRow3 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'tauranga',",
						"     folderPath: 'gold/sc_dsch_unladen_time',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['unitIdName','moveKind','Timestamp'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink3",
						"alterRow4 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'tauranga',",
						"     folderPath: 'gold/sc_dsch_time',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['unitIdName','moveKind','Timestamp'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink4",
						"alterRow5 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'tauranga',",
						"     folderPath: 'gold/sc_laden_unladen',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['unitIdName','moveKind','Timestamp'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('key',",
						"          0,",
						"          Year,",
						"          Month,",
						"          Week",
						"     )) ~> sink5"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SC_load_dsch_tauranga_new')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ecevents"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink2"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink3"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink4"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "pivot1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "split1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "MapDrifted1",
							"description": "Creates an explicit mapping for each drifted column"
						},
						{
							"name": "select1"
						},
						{
							"name": "split2"
						},
						{
							"name": "select2"
						},
						{
							"name": "split3"
						},
						{
							"name": "select3"
						},
						{
							"name": "select4"
						},
						{
							"name": "alterRow2"
						},
						{
							"name": "alterRow3"
						},
						{
							"name": "alterRow4"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "window2"
						},
						{
							"name": "filter2"
						},
						{
							"name": "filter3"
						},
						{
							"name": "filter4"
						},
						{
							"name": "filter5"
						},
						{
							"name": "filter6"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as long,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as boolean,",
						"          startDistance as short,",
						"          workAssignmentId as long,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'tauranga',",
						"     folderPath: 'silver/ecevents') ~> ecevents",
						"ecevents filter(cheKind == 'SC' && (moveKind == 'DSCH' || moveKind == 'LOAD') && (typeDescription=='EARW' || typeDescription=='EASH' || typeDescription=='DSPT' || typeDescription=='DROP')) ~> filter1",
						"select1 alterRow(upsertIf(true())) ~> alterRow1",
						"window2 pivot(groupBy(unitIdName,",
						"          GroupNumber,",
						"          moveKind),",
						"     pivotBy(typeDescription),",
						"     {} = first(EcEventTime),",
						"     columnNaming: '$N$V_Time',",
						"     lateral: false) ~> pivot1",
						"split1@LoadMoves derive(ScLoadTime = :sc_load_time,",
						"          ScLoadUnladenTime = :sc_load_unladen_time,",
						"          ScLoadTimeRange = iif(:sc_load_time >= 0.0 && :sc_load_time <= 10.0, \"0 to 10 min\",iif(:sc_load_time > 10.0 && :sc_load_time <= 15.0, \"10 to 15 min\",iif(:sc_load_time > 15.0 && :sc_load_time <= 20.0, \"15 to 20 min\",iif(:sc_load_time > 20.0 && :sc_load_time <= 25.0, \"20 to 25 min\",iif(:sc_load_time > 25.0 && :sc_load_time <= 30.0, \"25 to 30 min\",iif(:sc_load_time > 30.0 && :sc_load_time <= 40.0, \"30 to 40 min\",iif(:sc_load_time > 40.0 && :sc_load_time <= 50.0, \"40 to 50 min\",iif(:sc_load_time > 50.0 ,\"50 & above\", \"\")))))))),",
						"          ScLoadUnladenTimeRange = iif(:sc_load_unladen_time >= 0.0 && :sc_load_unladen_time <= 10.0, \"0 to 10 min\",iif(:sc_load_unladen_time > 10.0 && :sc_load_unladen_time <= 15.0, \"10 to 15 min\",iif(:sc_load_unladen_time > 15.0 && :sc_load_unladen_time <= 20.0, \"15 to 20 min\",iif(:sc_load_unladen_time > 20.0 && :sc_load_unladen_time <= 25.0, \"20 to 25 min\",iif(:sc_load_unladen_time > 25.0 && :sc_load_unladen_time <= 30.0, \"25 to 30 min\",iif(:sc_load_unladen_time > 30.0 && :sc_load_unladen_time <= 40.0, \"30 to 40 min\",iif(:sc_load_unladen_time > 40.0 && :sc_load_unladen_time <= 50.0, \"40 to 50 min\",iif(:sc_load_unladen_time > 50.0 ,\"50 & above\", \"\")))))))),",
						"          sc_load_time := round((DROP_Time - DSPT_Time)/60000,2),",
						"          sc_load_unladen_time := round((EARW_Time - DSPT_Time)/60000,2)) ~> derivedColumn1",
						"filter2 split(moveKind  == \"LOAD\",",
						"     moveKind  == \"DSCH\",",
						"     disjoint: false) ~> split1@(LoadMoves, DschMoves)",
						"split1@DschMoves derive(ScDschTime = :sc_dsch_time,",
						"          ScDschUnladenTime = :sc_dsch_unladen_time,",
						"          ScDschTimeRange = iif(:sc_dsch_time >= 0.0 && :sc_dsch_time <= 10.0, \"0 to 10 min\",iif(:sc_dsch_time > 10.0 && :sc_dsch_time <= 15.0, \"10 to 15 min\",iif(:sc_dsch_time > 15.0 && :sc_dsch_time <= 20.0, \"15 to 20 min\",iif(:sc_dsch_time > 20.0 && :sc_dsch_time <= 25.0, \"20 to 25 min\",iif(:sc_dsch_time > 25.0 && :sc_dsch_time <= 30.0, \"25 to 30 min\",iif(:sc_dsch_time > 30.0 && :sc_dsch_time <= 40.0, \"30 to 40 min\",iif(:sc_dsch_time > 40.0 && :sc_dsch_time <= 50.0, \"40 to 50 min\",iif(:sc_dsch_time > 50.0 ,\"50 & above\", \"\")))))))),",
						"          ScDschUnladenTimeRange = iif(:sc_dsch_unladen_time>= 0.0 && :sc_dsch_unladen_time<= 10.0, \"0 to 10 min\",iif(:sc_dsch_unladen_time> 10.0 && :sc_dsch_unladen_time<= 15.0, \"10 to 15 min\",iif(:sc_dsch_unladen_time> 15.0 && :sc_dsch_unladen_time<= 20.0, \"15 to 20 min\",iif(:sc_dsch_unladen_time> 20.0 && :sc_dsch_unladen_time<= 25.0, \"20 to 25 min\",iif(:sc_dsch_unladen_time> 25.0 && :sc_dsch_unladen_time<= 30.0, \"25 to 30 min\",iif(:sc_dsch_unladen_time> 30.0 && :sc_dsch_unladen_time<= 40.0, \"30 to 40 min\",iif(:sc_dsch_unladen_time> 40.0 && :sc_dsch_unladen_time<= 50.0, \"40 to 50 min\",iif(:sc_dsch_unladen_time > 50.0 ,\"50 & above\", \"\")))))))),",
						"          sc_dsch_time := round((DROP_Time - DSPT_Time)/60000,2),",
						"          sc_dsch_unladen_time := round((EASH_Time - DSPT_Time)/60000,2)) ~> derivedColumn2",
						"pivot1 derive(DROP_Time = toTimestamp(byName('DROP_Time')),",
						"          DSPT_Time = toTimestamp(byName('DSPT_Time')),",
						"          EARW_Time = toTimestamp(byName('EARW_Time')),",
						"          EASH_Time = toTimestamp(byName('EASH_Time')),",
						"          Timestamp = :Timestamp,",
						"          Date = toDate(toString(:Timestamp)),",
						"          Year = year(:Timestamp),",
						"          Month = month(:Timestamp),",
						"          Week = weekOfYear(:Timestamp),",
						"          Timestamp := toTimestamp(byName('DSPT_Time'))) ~> MapDrifted1",
						"filter6 select(mapColumn(",
						"          unitIdName,",
						"          moveKind,",
						"          ScLoadUnladenTime,",
						"          ScLoadUnladenTimeRange,",
						"          Timestamp,",
						"          Date,",
						"          Year,",
						"          Month,",
						"          Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"derivedColumn1 split(not(isNull(ScLoadUnladenTime)),",
						"     not(isNull(ScLoadTime)),",
						"     disjoint: true) ~> split2@(ScLoadUnladenTime, ScLoadTime)",
						"filter5 select(mapColumn(",
						"          unitIdName,",
						"          moveKind,",
						"          Timestamp,",
						"          Date,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          ScLoadTime,",
						"          ScLoadTimeRange",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"derivedColumn2 split(not(isNull(ScDschUnladenTime)),",
						"     not(isNull(ScDschTime)),",
						"     disjoint: true) ~> split3@(ScDschUnladenTime, ScDschTime)",
						"filter4 select(mapColumn(",
						"          unitIdName,",
						"          moveKind,",
						"          Timestamp,",
						"          Date,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          ScDschUnladenTime,",
						"          ScDschUnladenTimeRange",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select3",
						"filter3 select(mapColumn(",
						"          unitIdName,",
						"          moveKind,",
						"          Timestamp,",
						"          Date,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          ScDschTime,",
						"          ScDschTimeRange",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select4",
						"select2 alterRow(upsertIf(true())) ~> alterRow2",
						"select3 alterRow(upsertIf(true())) ~> alterRow3",
						"select4 alterRow(upsertIf(true())) ~> alterRow4",
						"filter1 window(over(unitIdName),",
						"     asc(unitIdName, true),",
						"     asc(EcEventTime, true),",
						"     EcEventTime_PREV = lag(EcEventTime, 1, null())) ~> window1",
						"window1 derive(TimeDeltaMins = :time_delta_mins,",
						"          TimeGroupFlag = iif(isNull(EcEventTime_PREV) || :time_delta_mins > toLong(24*60), 1, 0),",
						"          time_delta_mins := (toLong(EcEventTime) - toLong(EcEventTime_PREV))/(60*1000)) ~> derivedColumn3",
						"derivedColumn3 window(over(unitIdName),",
						"     asc(EcEventTime, true),",
						"     GroupNumber = sum(TimeGroupFlag)) ~> window2",
						"MapDrifted1 filter(not(isNull(Timestamp))) ~> filter2",
						"split3@ScDschTime filter(ScDschTime >= 0.0) ~> filter3",
						"split3@ScDschUnladenTime filter(ScDschUnladenTime >= 0.0) ~> filter4",
						"split2@ScLoadTime filter(ScLoadTime >= 0.0) ~> filter5",
						"split2@ScLoadUnladenTime filter(ScLoadUnladenTime >=0.0) ~> filter6",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'tauranga',",
						"     folderPath: 'gold/sc_load_unladen_time',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['unitIdName','moveKind','Timestamp'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1",
						"alterRow2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'tauranga',",
						"     folderPath: 'gold/sc_load_time',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['unitIdName','moveKind','Timestamp'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink2",
						"alterRow3 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'tauranga',",
						"     folderPath: 'gold/sc_dsch_unladen_time',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['unitIdName','moveKind','Timestamp'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink3",
						"alterRow4 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'tauranga',",
						"     folderPath: 'gold/sc_dsch_time',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['unitIdName','moveKind','Timestamp'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink4"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Straddle_Prod')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink2"
						}
					],
					"transformations": [
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter4"
						},
						{
							"name": "filter1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn10"
						},
						{
							"name": "sort1"
						},
						{
							"name": "AlterRow2"
						},
						{
							"name": "aggregate10"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id,\n\t\tComplex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tpow,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\naggregate10 derive(Time_Completed_Date_Time = iif(Event_Type_Id== \"UNIT_LOAD\" || Event_Type_Id==\"UNIT_PAYLOAD_LOAD\",iif(Carry_CHE_Kind==\"SC\",t_carry_complete,iif(Fetch_CHE_Kind==\"SC\",t_fetch,iif(Put_CHE_Kind==\"SC\",t_put,toTimestamp(null())))),iif(Put_CHE_Kind==\"SC\",t_put,iif(Carry_CHE_Kind==\"SC\",iifNull(t_carry_complete,t_fetch),iif(Fetch_CHE_Kind==\"SC\",t_fetch,toTimestamp(null()))))),\n\t\tSC_Che_Id = iif(Event_Type_Id== \"UNIT_LOAD\" || Event_Type_Id==\"UNIT_PAYLOAD_LOAD\",iif(Carry_CHE_Kind==\"SC\",Carry_CHE_Id,iif(Fetch_CHE_Kind==\"SC\",Fetch_CHE_Id,iif(Put_CHE_Kind==\"SC\",Put_CHE_Id,toLong(null())))),iif(Put_CHE_Kind==\"SC\",Put_CHE_Id,iif(Carry_CHE_Kind==\"SC\",Carry_CHE_Id,iif(Fetch_CHE_Kind==\"SC\",Fetch_CHE_Id,toLong(null())))))) ~> DerivedColumn1\nfilter1 derive(Time = toString(Time_Completed_Date_Time,'HH:mm:ss'),\n\t\tDate = toDate(toString(Time_Completed_Date_Time,'yyyy-MM-dd'))) ~> DerivedColumn2\nDerivedColumn6 derive(Shift_Start_Time = iif(Day_Of_Week==1 || Day_Of_Week==7,    iif(Time>=toString('06:00:00') && Time<toString('12:00:00'),        toTimestamp(concat(toString(Date),' ','06:00:00')),        iif(Time>=toString('12:00:00') && Time<toString('18:00:00'),            toTimestamp(concat(toString(Date),' ','12:00:00')),            iif(Time>=toString('18:00:00') && Time<toString('24:00:00'),                toTimestamp(concat(toString(Date),' ','18:00:00')),                toTimestamp(concat(toString(subDays(Date,1)),' ','24:00:00'))))),    iif(Time>=toString('06:00:00') && Time<toString('14:00:00'),        toTimestamp(concat(toString(Date),' ','06:00:00')),        iif(Time>=toString('14:00:00') && Time<toString('22:00:00'),            toTimestamp(concat(toString(Date),' ','14:00:00')),            iif(Time>=toString('22:00:00'),                toTimestamp(concat(toString(Date),' ','22:00:00')),\t\t\t\ttoTimestamp(concat(toString(subDays(Date,1)),' ','22:00:00')))))),\n\t\tShift_End_Time = iif(Day_Of_Week==1 || Day_Of_Week==7,    iif(Time>=toString('06:00:00') && Time<toString('12:00:00'),        toTimestamp(concat(toString(Date),' ','11:59:59')),        iif(Time>=toString('12:00:00') && Time<toString('18:00:00'),            toTimestamp(concat(toString(Date),' ','17:59:59')),            iif(Time>=toString('18:00:00') && Time<toString('24:00:00'),                toTimestamp(concat(toString(Date),' ','23:59:59')),                toTimestamp(concat(toString(Date),' ','05:59:59'))))),    iif(Time>=toString('06:00:00') && Time<toString('14:00:00'),        toTimestamp(concat(toString(Date),' ','13:59:59')),        iif(Time>=toString('14:00:00') && Time<toString('22:00:00'),            toTimestamp(concat(toString(Date),' ','21:59:59')),            iif(Time>=toString('22:00:00'),                toTimestamp(concat(toString(addDays(Date,1)),' ','05:59:59')),\t\t\t\ttoTimestamp(concat(toString(Date),' ','05:59:59'))))))) ~> DerivedColumn3\nDerivedColumn5 aggregate(groupBy(SC_Che_Id,\n\t\tShift_Start_Time,\n\t\tShift_End_Time,\n\t\tShift_Date,\n\t\tShift),\n\tFirst_Lift = min(Time_Completed_Date_Time),\n\t\tLast_Lift = max(Time_Completed_Date_Time),\n\t\tMove_Count = count(mve_gkey)) ~> Aggregate1\nFilter4 derive(WorkTime = Last_Lift-First_Lift,\n\t\tYear = iifNull(year(Shift_Date),0),\n\t\tMonth = iifNull(month(Shift_Date),0),\n\t\tWeek = iifNull(weekOfYear(Shift_Date),0)) ~> DerivedColumn4\nDerivedColumn3 derive(Shift = iif(toString(Shift_Start_Time, 'HH:mm:ss')==toString('06:00:00'),1,\r\niif(toString(Shift_Start_Time, 'HH:mm:ss')==toString('14:00:00')||toString(Shift_Start_Time, 'HH:mm:ss')==toString('12:00:00'),2,\r\niif(toString(Shift_Start_Time, 'HH:mm:ss')==toString('22:00:00')||toString(Shift_Start_Time, 'HH:mm:ss')==toString('18:00:00'),3,4)))) ~> DerivedColumn5\nDerivedColumn2 derive(Day_Of_Week = dayOfWeek(iif(Time<toString('06:00:00'),subDays(Date,1),Date)),\n\t\tShift_Date = iif(Time<toString('06:00:00'),subDays(Date,1),Date)) ~> DerivedColumn6\nAggregate1 filter(isNull(SC_Che_Id)==false()) ~> Filter4\nDerivedColumn1 filter(isNull(SC_Che_Id)==false()) ~> filter1\nDerivedColumn4 alterRow(upsertIf(true())) ~> AlterRow1\nsort1 window(asc(SC_Che_Id, true),\n\tasc(Time_Completed_Date_Time, true),\n\tstartRowOffset: 1L,\n\tendRowOffset: 1L,\n\tSC_Che_Id_nxt = lead(SC_Che_Id),\n\t\tShift_Date_nxt = lead(Shift_Date),\n\t\tShift_nxt = lead(Shift),\n\t\tTime_Completed_Date_Time_nxt = lead(Time_Completed_Date_Time)) ~> window1\nwindow1 derive(SC_Idle_Time = iif(SC_Che_Id==SC_Che_Id_nxt && Shift_Date==Shift_Date_nxt && Shift==Shift_nxt,iif((Time_Completed_Date_Time_nxt-Time_Completed_Date_Time)<0,toLong(0),(Time_Completed_Date_Time_nxt-Time_Completed_Date_Time)),toLong(0))) ~> derivedColumn10\nDerivedColumn5 sort(asc(SC_Che_Id, true),\n\tasc(Time_Completed_Date_Time, true)) ~> sort1\nderivedColumn10 alterRow(upsertIf(true())) ~> AlterRow2\nSelect1 aggregate(groupBy(mve_gkey),\n\teach(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate10\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'gold/sc_prod',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['pow','Shift','Shift_Date'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'gold/sc_idle_time',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['mve_gkey'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink2"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TTViolation_Valencia')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "filter2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as string,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as string,",
						"          startDistance as short,",
						"          workAssignmentId as double,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'valencia',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"filter1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     typeDescription_nxt = lead(typeDescription),",
						"          cheID_nxt = lead(cheID),",
						"          powName_nxt = lead(powName),",
						"          moveKind_nxt = lead(moveKind)) ~> window1",
						"window1 derive(Violation1 = iif(cheID==cheID_nxt && typeDescription=='TVCO' && typeDescription_nxt=='TYDR' && moveKind=='DSCH' && moveKind_nxt=='DSCH' && powName!=powName_nxt,1,0),",
						"          Violation2 = iif(cheID==cheID_nxt && typeDescription=='TVCO' && typeDescription_nxt=='TVDR' && moveKind=='DSCH' && moveKind_nxt=='LOAD',1,0)) ~> derivedColumn1",
						"source1 filter(cheKind=='ITV') ~> filter1",
						"filter2 alterRow(upsertIf(true())) ~> AlterRow1",
						"derivedColumn1 filter(Violation1==1 || Violation2==1) ~> filter2",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'valencia',",
						"     folderPath: 'gold/ttviolation',",
						"     truncate: true,",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TTViolation_gti')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "aggregate1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as string,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as string,",
						"          startDistance as short,",
						"          workAssignmentId as double,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'gti',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"aggregate1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     startRowOffset: 1L,",
						"     endRowOffset: 1L,",
						"     typeDescription_nxt = lead(typeDescription),",
						"          cheID_nxt = lead(cheID),",
						"          powName_nxt = lead(powName),",
						"          moveKind_nxt = lead(moveKind)) ~> window1",
						"window1 derive(Violation1 = iif(cheID==cheID_nxt && typeDescription=='TVCO' && typeDescription_nxt=='TYDR' && moveKind=='DSCH' && moveKind_nxt=='DSCH' && powName!=powName_nxt,1,0),",
						"          Violation2 = iif(cheID==cheID_nxt && typeDescription=='TVCO' && typeDescription_nxt=='TVDR' && moveKind=='DSCH' && moveKind_nxt=='LOAD',1,0)) ~> derivedColumn1",
						"source1 filter(cheKind=='ITV') ~> filter1",
						"filter2 alterRow(upsertIf(true())) ~> AlterRow1",
						"derivedColumn1 filter(Violation1==1 || Violation2==1) ~> filter2",
						"filter1 aggregate(groupBy(ecEventGkey),",
						"     each(match(name!='ecEventGkey'), $$ = first($$))) ~> aggregate1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'gti',",
						"     folderPath: 'gold/ttviolation',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TTViolation_kssp')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "window1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "aggregate1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as string,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as string,",
						"          startDistance as short,",
						"          workAssignmentId as double,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'kssp',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"aggregate1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     startRowOffset: 1L,",
						"     endRowOffset: 1L,",
						"     typeDescription_nxt = lead(typeDescription),",
						"          cheID_nxt = lead(cheID),",
						"          powName_nxt = lead(powName),",
						"          moveKind_nxt = lead(moveKind)) ~> window1",
						"window1 derive(Violation1 = iif(cheID==cheID_nxt && typeDescription=='TVCO' && typeDescription_nxt=='TYDR' && moveKind=='DSCH' && moveKind_nxt=='DSCH' && powName!=powName_nxt,1,0),",
						"          Violation2 = iif(cheID==cheID_nxt && typeDescription=='TVCO' && typeDescription_nxt=='TVDR' && moveKind=='DSCH' && moveKind_nxt=='LOAD',1,0)) ~> derivedColumn1",
						"source1 filter(cheKind=='ITV') ~> filter1",
						"filter2 alterRow(insertIf(true())) ~> AlterRow1",
						"derivedColumn1 filter(Violation1==1 || Violation2==1) ~> filter2",
						"filter1 aggregate(groupBy(ecEventGkey),",
						"     each(match(name!='ecEventGkey'), $$ = first($$))) ~> aggregate1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'kssp',",
						"     folderPath: 'gold/ttviolation',",
						"     deltaTruncate: true,",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TTWaitTime_aqaba')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as short,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as boolean,",
						"          startDistance as short,",
						"          workAssignmentId as double,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'apmtaqaba',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source1 filter(cheKind==\"ITV\" && (typeDescription==\"AYDR\" || typeDescription==\"TYDR\" ||typeDescription==\"AVDR\" || typeDescription==\"TVDR\"|| typeDescription==\"CMPL\") && (moveKind==\"DSCH\" || moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     typeDescription_nxt = lead(typeDescription),",
						"          unitIdName_nxt = lead(unitIdName),",
						"          cheID_nxt = lead(cheID),",
						"          cheID_nxt2 = lead(cheID,2),",
						"          EcEventTime_nxt = lead(EcEventTime),",
						"          typeDescription_nxt2 = lead(typeDescription,2),",
						"          EcEventTime_nxt2 = lead(EcEventTime,2),",
						"          unitIdName_nxt2 = lead(unitIdName,2)) ~> window1",
						"filter1 sort(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(TTWaitTime = iif(cheID==cheID_nxt && cheID_nxt2==cheID_nxt && unitIdName==unitIdName_nxt \r",
						"&& unitIdName_nxt2==unitIdName_nxt && (typeDescription=='TYDR'||typeDescription=='TVDR') && (typeDescription_nxt=='AYDR'||typeDescription_nxt=='AVDR') \r",
						"&& typeDescription_nxt2=='CMPL', minus(EcEventTime_nxt2,EcEventTime_nxt)/60000,\r",
						"iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && (typeDescription=='TYDR'||typeDescription=='TVDR') \r",
						"&& typeDescription_nxt=='CMPL',(minus(EcEventTime_nxt,(EcEventTime+toInteger((travelDistance/(1000*20))*3600000)))/60000),toLong(0)))) ~> derivedColumn1",
						"derivedColumn1 alterRow(upsertIf(true())) ~> AlterRow1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'apmtaqaba',",
						"     folderPath: 'gold/ttwaittime',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TTWaitTime_cmsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as short,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as boolean,",
						"          startDistance as short,",
						"          workAssignmentId as double,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmsa',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source1 filter(cheKind==\"ITV\" && (typeDescription==\"AYDR\" || typeDescription==\"TYDR\" ||typeDescription==\"AVDR\" || typeDescription==\"TVDR\"|| typeDescription==\"CMPL\") && (moveKind==\"DSCH\" || moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     typeDescription_nxt = lead(typeDescription),",
						"          unitIdName_nxt = lead(unitIdName),",
						"          cheID_nxt = lead(cheID),",
						"          cheID_nxt2 = lead(cheID,2),",
						"          EcEventTime_nxt = lead(EcEventTime),",
						"          typeDescription_nxt2 = lead(typeDescription,2),",
						"          EcEventTime_nxt2 = lead(EcEventTime,2),",
						"          unitIdName_nxt2 = lead(unitIdName,2)) ~> window1",
						"filter1 sort(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(TTWaitTime = iif(cheID==cheID_nxt && cheID_nxt2==cheID_nxt && unitIdName==unitIdName_nxt \r",
						"&& unitIdName_nxt2==unitIdName_nxt && (typeDescription=='TYDR'||typeDescription=='TVDR') && (typeDescription_nxt=='AYDR'||typeDescription_nxt=='AVDR') \r",
						"&& typeDescription_nxt2=='CMPL', minus(EcEventTime_nxt2,EcEventTime_nxt)/60000,\r",
						"iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && (typeDescription=='TYDR'||typeDescription=='TVDR') \r",
						"&& typeDescription_nxt=='CMPL',(minus(EcEventTime_nxt,(EcEventTime+toInteger((travelDistance/(1000*20))*3600000)))/60000),toLong(0)))) ~> derivedColumn1",
						"derivedColumn1 alterRow(upsertIf(true())) ~> AlterRow1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmsa',",
						"     folderPath: 'gold/ttwaittime',",
						"     truncate: true,",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TTWaitTime_gti')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as short,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as boolean,",
						"          startDistance as short,",
						"          workAssignmentId as double,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'gti',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source1 filter(cheKind==\"ITV\" && (typeDescription==\"AYDR\" || typeDescription==\"TYDR\" ||typeDescription==\"AVDR\" || typeDescription==\"TVDR\"|| typeDescription==\"CMPL\") && (moveKind==\"DSCH\" || moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     typeDescription_nxt = lead(typeDescription),",
						"          unitIdName_nxt = lead(unitIdName),",
						"          cheID_nxt = lead(cheID),",
						"          cheID_nxt2 = lead(cheID,2),",
						"          EcEventTime_nxt = lead(EcEventTime),",
						"          typeDescription_nxt2 = lead(typeDescription,2),",
						"          EcEventTime_nxt2 = lead(EcEventTime,2),",
						"          unitIdName_nxt2 = lead(unitIdName,2)) ~> window1",
						"filter1 sort(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(TTWaitTime = iif(cheID==cheID_nxt && cheID_nxt2==cheID_nxt && unitIdName==unitIdName_nxt \r",
						"&& unitIdName_nxt2==unitIdName_nxt && (typeDescription=='TYDR'||typeDescription=='TVDR') && (typeDescription_nxt=='AYDR'||typeDescription_nxt=='AVDR') \r",
						"&& typeDescription_nxt2=='CMPL', minus(EcEventTime_nxt2,EcEventTime_nxt)/60000,\r",
						"iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && (typeDescription=='TYDR'||typeDescription=='TVDR') \r",
						"&& typeDescription_nxt=='CMPL',(minus(EcEventTime_nxt,(EcEventTime+toInteger((travelDistance/(1000*20))*3600000)))/60000),toLong(0)))) ~> derivedColumn1",
						"derivedColumn1 alterRow(upsertIf(true())) ~> AlterRow1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'gti',",
						"     folderPath: 'gold/ttwaittime',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TTWaitTime_mict')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as short,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as boolean,",
						"          startDistance as short,",
						"          workAssignmentId as double,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'mict',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source1 filter(cheKind==\"ITV\" && (typeDescription==\"AYDR\" || typeDescription==\"TYDR\" ||typeDescription==\"AVDR\" || typeDescription==\"TVDR\"|| typeDescription==\"CMPL\") && (moveKind==\"DSCH\" || moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     typeDescription_nxt = lead(typeDescription),",
						"          unitIdName_nxt = lead(unitIdName),",
						"          cheID_nxt = lead(cheID),",
						"          cheID_nxt2 = lead(cheID,2),",
						"          EcEventTime_nxt = lead(EcEventTime),",
						"          typeDescription_nxt2 = lead(typeDescription,2),",
						"          EcEventTime_nxt2 = lead(EcEventTime,2),",
						"          unitIdName_nxt2 = lead(unitIdName,2)) ~> window1",
						"filter1 sort(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(TTWaitTime = iif(cheID==cheID_nxt && cheID_nxt2==cheID_nxt && unitIdName==unitIdName_nxt \r",
						"&& unitIdName_nxt2==unitIdName_nxt && (typeDescription=='TYDR'||typeDescription=='TVDR') && (typeDescription_nxt=='AYDR'||typeDescription_nxt=='AVDR') \r",
						"&& typeDescription_nxt2=='CMPL', minus(EcEventTime_nxt2,EcEventTime_nxt)/60000,\r",
						"iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && (typeDescription=='TYDR'||typeDescription=='TVDR') \r",
						"&& typeDescription_nxt=='CMPL',(minus(EcEventTime_nxt,(EcEventTime+toInteger((travelDistance/(1000*20))*3600000)))/60000),toLong(0)))) ~> derivedColumn1",
						"derivedColumn1 alterRow(upsertIf(true())) ~> AlterRow1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mict',",
						"     folderPath: 'gold/ttwaittime',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TTWaitTime_mnhpi')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as long,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheShortName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as integer,",
						"          moveKind as string,",
						"          isTwinMove as boolean,",
						"          startDistance as integer,",
						"          workAssignmentId as long,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source1 filter(cheKind==\"ITV\" && (typeDescription==\"AYDR\" || typeDescription==\"TYDR\" ||typeDescription==\"AVDR\" || typeDescription==\"TVDR\"|| typeDescription==\"CMPL\") && (moveKind==\"DSCH\" || moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     typeDescription_nxt = lead(typeDescription),",
						"          unitIdName_nxt = lead(unitIdName),",
						"          cheID_nxt = lead(cheID),",
						"          cheID_nxt2 = lead(cheID,2),",
						"          EcEventTime_nxt = lead(EcEventTime),",
						"          typeDescription_nxt2 = lead(typeDescription,2),",
						"          EcEventTime_nxt2 = lead(EcEventTime,2),",
						"          unitIdName_nxt2 = lead(unitIdName,2)) ~> window1",
						"filter1 sort(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(TTWaitTime = iif(cheID==cheID_nxt && cheID_nxt2==cheID_nxt && unitIdName==unitIdName_nxt \r",
						"&& unitIdName_nxt2==unitIdName_nxt && (typeDescription=='TYDR'||typeDescription=='TVDR') && (typeDescription_nxt=='AYDR'||typeDescription_nxt=='AVDR') \r",
						"&& typeDescription_nxt2=='CMPL', minus(EcEventTime_nxt2,EcEventTime_nxt)/60000,\r",
						"iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && (typeDescription=='TYDR'||typeDescription=='TVDR') \r",
						"&& typeDescription_nxt=='CMPL',(minus(EcEventTime_nxt,(EcEventTime+toInteger((travelDistance/(1000*20))*3600000)))/60000),toLong(0)))) ~> derivedColumn1",
						"derivedColumn1 alterRow(upsertIf(true())) ~> AlterRow1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'gold/ttwaittime',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TT_Prod')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as long,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tmve_gkey as long,\n\t\tufv_gkey as long,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as long,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: true,\n\tformat: 'delta',\n\tfileSystem: 'arica',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(Carry_CHE_Kind==\"ITV\") ~> Filter1\nFilter1 derive(Time = toString(t_carry_complete,'HH:mm:ss'),\n\t\tDate = toDate(toString(t_carry_complete,'yyyy-MM-dd'))) ~> DerivedColumn2\nDerivedColumn2 aggregate(groupBy(Carry_CHE_Id,\n\t\tDate),\n\tFirst_Lift = min(t_carry_complete),\n\t\tLast_Lift = max(t_carry_complete),\n\t\tMove_Count = countDistinct(mve_gkey)) ~> Aggregate1\nAggregate1 derive(WorkTime = Last_Lift-First_Lift,\n\t\tYear = iifNull(year(Date),0),\n\t\tMonth = iifNull(month(Date),0),\n\t\tWeek = iifNull(weekOfYear(Date),0)) ~> DerivedColumn4\nDerivedColumn4 alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'arica',\n\tfolderPath: 'gold/tt_prod',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Carry_CHE_Id','Date'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TT_Productivity_CWIT')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Using Moves as source data",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "sort1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'cwit',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && like(pow, '%STS%')) ~> Filter1\nFilter1 derive(CarryCompleteTime = toString(t_put,'HH:mm:ss'),\n\t\tCarryCompleteDate = toDate(toString(t_put, 'yyyy-MM-dd')),\n\t\tEvent_Type_Id = iif(Event_Type_Id=='UNIT_YARD_MOVE' && Move_Kind=='DSCH', 'UNIT_DISCH', Event_Type_Id)) ~> DerivedColumn2\nsort1 aggregate(groupBy(CarryCompleteDate,\n\t\tCarry_CHE_Id),\n\tFirst_Lift = min(t_put),\n\t\tLast_Lift = max(t_put),\n\t\tMove_Count = countDistinct(mve_gkey)) ~> Aggregate1\nAggregate1 derive(WorkTime = Last_Lift-First_Lift,\n\t\tYear = iifNull(year(CarryCompleteDate),0),\n\t\tMonth = iifNull(month(CarryCompleteDate),0),\n\t\tWeek = iifNull(weekOfYear(CarryCompleteDate),0)) ~> DerivedColumn4\nDerivedColumn4 alterRow(upsertIf(true())) ~> AlterRow1\nDerivedColumn2 sort(asc(Carry_CHE_Id, true),\n\tasc(t_put, true)) ~> sort1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'cwit',\n\tfolderPath: 'gold/tt_productivity',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Carry_CHE_Id','CarryCompleteDate'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TT_Productivity_cmsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Using Moves as source data",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "filter2",
							"description": "Filtering rows using expressions in columns 'pow'"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tHazardous_Flag as boolean,\n\t\tATD as timestamp,\n\t\tATA as timestamp,\n\t\tService_Id as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(Carry_CHE_Kind==\"ITV\") ~> Filter1\nfilter2 derive(CarryCompleteTime = toString(t_carry_complete,'HH:mm:ss'),\n\t\tCarryCompleteDate = toDate(toString(t_carry_complete,'yyyy-MM-dd'))) ~> DerivedColumn2\nDerivedColumn2 aggregate(groupBy(Carry_CHE_Id,\n\t\tCarryCompleteDate),\n\tFirst_Lift = min(t_carry_complete),\n\t\tLast_Lift = max(t_carry_complete),\n\t\tMove_Count = countDistinct(mve_gkey)) ~> Aggregate1\nAggregate1 derive(WorkTime = Last_Lift-First_Lift,\n\t\tYear = iifNull(year(CarryCompleteDate),0),\n\t\tMonth = iifNull(month(CarryCompleteDate),0),\n\t\tWeek = iifNull(weekOfYear(CarryCompleteDate),0)) ~> DerivedColumn4\nDerivedColumn4 alterRow(upsertIf(true())) ~> AlterRow1\nFilter1 filter(like(pow, '%CR%')) ~> filter2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'gold/tt_productivity',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Carry_CHE_Id','CarryCompleteDate'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TT_Productivity_dpw_peru')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Using Moves as source data",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Filter2",
							"description": "Filtering rows using expressions in columns 'pow'"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'dpw-peru',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(Carry_CHE_Kind==\"ITV\") ~> Filter1\nFilter2 derive(CarryCompleteTime = toString(t_carry_complete,'HH:mm:ss'),\n\t\tCarryCompleteDate = toDate(toString(t_carry_complete,'yyyy-MM-dd'))) ~> DerivedColumn2\nDerivedColumn2 aggregate(groupBy(Carry_CHE_Id,\n\t\tCarryCompleteDate),\n\tFirst_Lift = min(t_carry_complete),\n\t\tLast_Lift = max(t_carry_complete),\n\t\tMove_Count = countDistinct(mve_gkey)) ~> Aggregate1\nAggregate1 derive(WorkTime = Last_Lift-First_Lift,\n\t\tYear = iifNull(year(CarryCompleteDate),0),\n\t\tMonth = iifNull(month(CarryCompleteDate),0),\n\t\tWeek = iifNull(weekOfYear(CarryCompleteDate),0)) ~> DerivedColumn4\nDerivedColumn4 alterRow(upsertIf(true())) ~> AlterRow1\nFilter1 filter(like(pow, '%QC%')) ~> Filter2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'dpw-peru',\n\tfolderPath: 'gold/tt_productivity',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Carry_CHE_Id','CarryCompleteDate'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TT_Productivity_hazira')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Using Moves as source data",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Filter2",
							"description": "Filtering rows using expressions in columns 'pow'"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'hazira',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(Carry_CHE_Kind==\"ITV\") ~> Filter1\nFilter2 derive(CarryCompleteTime = toString(t_carry_complete,'HH:mm:ss'),\n\t\tCarryCompleteDate = toDate(toString(t_carry_complete,'yyyy-MM-dd'))) ~> DerivedColumn2\nDerivedColumn2 aggregate(groupBy(Carry_CHE_Id,\n\t\tCarryCompleteDate),\n\tFirst_Lift = min(t_carry_complete),\n\t\tLast_Lift = max(t_carry_complete),\n\t\tMove_Count = countDistinct(mve_gkey)) ~> Aggregate1\nAggregate1 derive(WorkTime = Last_Lift-First_Lift,\n\t\tYear = iifNull(year(CarryCompleteDate),0),\n\t\tMonth = iifNull(month(CarryCompleteDate),0),\n\t\tWeek = iifNull(weekOfYear(CarryCompleteDate),0)) ~> DerivedColumn4\nDerivedColumn4 alterRow(upsertIf(true())) ~> AlterRow1\nFilter1 filter(like(pow, '%STS%')) ~> Filter2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'hazira',\n\tfolderPath: 'gold/tt_productivity',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Carry_CHE_Id','CarryCompleteDate'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TT_Productivity_mict')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Using Moves as source data",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Filter2",
							"description": "Filtering rows using expressions in columns 'pow'"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(Carry_CHE_Kind==\"ITV\") ~> Filter1\nFilter2 derive(CarryCompleteTime = toString(t_carry_complete,'HH:mm:ss'),\n\t\tCarryCompleteDate = toDate(toString(t_carry_complete,'yyyy-MM-dd'))) ~> DerivedColumn2\nDerivedColumn2 aggregate(groupBy(Carry_CHE_Id,\n\t\tCarryCompleteDate),\n\tFirst_Lift = min(t_carry_complete),\n\t\tLast_Lift = max(t_carry_complete),\n\t\tMove_Count = countDistinct(mve_gkey)) ~> Aggregate1\nAggregate1 derive(WorkTime = Last_Lift-First_Lift,\n\t\tYear = iifNull(year(CarryCompleteDate),0),\n\t\tMonth = iifNull(month(CarryCompleteDate),0),\n\t\tWeek = iifNull(weekOfYear(CarryCompleteDate),0)) ~> DerivedColumn4\nDerivedColumn4 alterRow(upsertIf(true())) ~> AlterRow1\nFilter1 filter(like(pow, '%QC%')) ~> Filter2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'gold/tt_productivity',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Carry_CHE_Id','CarryCompleteDate'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TT_Productivity_mnhpi')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Using Moves as source data",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Filter2",
							"description": "Filtering rows using expressions in columns 'pow'"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(Carry_CHE_Kind==\"ITV\") ~> Filter1\nFilter2 derive(CarryCompleteTime = toString(t_carry_complete,'HH:mm:ss'),\n\t\tCarryCompleteDate = toDate(toString(t_carry_complete,'yyyy-MM-dd'))) ~> DerivedColumn2\nDerivedColumn2 aggregate(groupBy(Carry_CHE_Id,\n\t\tCarryCompleteDate),\n\tFirst_Lift = min(t_carry_complete),\n\t\tLast_Lift = max(t_carry_complete),\n\t\tMove_Count = countDistinct(mve_gkey)) ~> Aggregate1\nAggregate1 derive(WorkTime = Last_Lift-First_Lift,\n\t\tYear = iifNull(year(CarryCompleteDate),0),\n\t\tMonth = iifNull(month(CarryCompleteDate),0),\n\t\tWeek = iifNull(weekOfYear(CarryCompleteDate),0)) ~> DerivedColumn4\nDerivedColumn4 alterRow(upsertIf(true())) ~> AlterRow1\nFilter1 filter(like(pow, '%QC%')) ~> Filter2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'gold/tt_productivity',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Carry_CHE_Id','CarryCompleteDate'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TT_Productivity_seayard')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Using Moves as source data",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as short,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as string,\n\t\tdist_start as string,\n\t\tTwin_Fetch as boolean,\n\t\tTwin_Carry as boolean,\n\t\tTwin_Put as boolean,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as boolean,\n\t\tOOG_Flag as boolean,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'seayard',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(Carry_CHE_Kind==\"SC\") ~> Filter1\nFilter1 derive(CarryCompleteTime = toString(t_carry_complete,'HH:mm:ss'),\n\t\tCarryCompleteDate = toDate(toString(t_carry_complete,'yyyy-MM-dd'))) ~> DerivedColumn2\nDerivedColumn2 aggregate(groupBy(Carry_CHE_Id,\n\t\tCarryCompleteDate),\n\tFirst_Lift = min(t_carry_complete),\n\t\tLast_Lift = max(t_carry_complete),\n\t\tMove_Count = countDistinct(mve_gkey)) ~> Aggregate1\nAggregate1 derive(WorkTime = Last_Lift-First_Lift,\n\t\tYear = iifNull(year(CarryCompleteDate),0),\n\t\tMonth = iifNull(month(CarryCompleteDate),0),\n\t\tWeek = iifNull(weekOfYear(CarryCompleteDate),0)) ~> DerivedColumn4\nDerivedColumn4 alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'seayard',\n\tfolderPath: 'gold/tt_productivity',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Carry_CHE_Id','CarryCompleteDate'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TT_Productivity_sgtd')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Using Moves as source data",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Filter2",
							"description": "Filtering rows using expressions in columns 'pow'"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'sgtd',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(Carry_CHE_Kind==\"ITV\") ~> Filter1\nFilter2 derive(CarryCompleteTime = toString(t_carry_complete,'HH:mm:ss'),\n\t\tCarryCompleteDate = toDate(toString(t_carry_complete,'yyyy-MM-dd'))) ~> DerivedColumn2\nDerivedColumn2 aggregate(groupBy(Carry_CHE_Id,\n\t\tCarryCompleteDate),\n\tFirst_Lift = min(t_carry_complete),\n\t\tLast_Lift = max(t_carry_complete),\n\t\tMove_Count = countDistinct(mve_gkey)) ~> Aggregate1\nAggregate1 derive(WorkTime = Last_Lift-First_Lift,\n\t\tYear = iifNull(year(CarryCompleteDate),0),\n\t\tMonth = iifNull(month(CarryCompleteDate),0),\n\t\tWeek = iifNull(weekOfYear(CarryCompleteDate),0)) ~> DerivedColumn4\nDerivedColumn4 alterRow(upsertIf(true())) ~> AlterRow1\nFilter1 filter(like(pow, '%PT%')) ~> Filter2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'sgtd',\n\tfolderPath: 'gold/tt_productivity',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Carry_CHE_Id','CarryCompleteDate'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TT_Productivity_socar')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Using Moves as source data",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as string,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as boolean,\n\t\tTwin_Carry as boolean,\n\t\tTwin_Put as boolean,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as string,\n\t\tfm_pos_gkey as string,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as short,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as boolean,\n\t\tOOG_Flag as boolean,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tATA as timestamp,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'socar',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(Carry_CHE_Kind==\"ITV\") ~> Filter1\nFilter1 derive(CarryCompleteTime = toString(t_carry_complete,'HH:mm:ss'),\n\t\tCarryCompleteDate = toDate(toString(t_carry_complete,'yyyy-MM-dd'))) ~> DerivedColumn2\nDerivedColumn2 aggregate(groupBy(Carry_CHE_Id,\n\t\tCarryCompleteDate),\n\tFirst_Lift = min(t_carry_complete),\n\t\tLast_Lift = max(t_carry_complete),\n\t\tMove_Count = countDistinct(mve_gkey)) ~> Aggregate1\nAggregate1 derive(WorkTime = Last_Lift-First_Lift,\n\t\tYear = iifNull(year(CarryCompleteDate),0),\n\t\tMonth = iifNull(month(CarryCompleteDate),0),\n\t\tWeek = iifNull(weekOfYear(CarryCompleteDate),0)) ~> DerivedColumn4\nDerivedColumn4 alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'socar',\n\tfolderPath: 'gold/tt_productivity',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Carry_CHE_Id','CarryCompleteDate'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TT_Productivity_tauranga')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Using Moves as source data",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "Filter2",
							"description": "Filtering rows using expressions in columns 'pow'"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'tauranga',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(Carry_CHE_Kind==\"SC\") ~> Filter1\nFilter2 derive(CarryCompleteTime = toString(t_carry_complete,'HH:mm:ss'),\n\t\tCarryCompleteDate = toDate(toString(t_carry_complete,'yyyy-MM-dd'))) ~> DerivedColumn2\nDerivedColumn2 aggregate(groupBy(Carry_CHE_Id,\n\t\tCarryCompleteDate),\n\tFirst_Lift = min(t_carry_complete),\n\t\tLast_Lift = max(t_carry_complete),\n\t\tMove_Count = countDistinct(mve_gkey)) ~> Aggregate1\nAggregate1 derive(WorkTime = Last_Lift-First_Lift,\n\t\tYear = iifNull(year(CarryCompleteDate),0),\n\t\tMonth = iifNull(month(CarryCompleteDate),0),\n\t\tWeek = iifNull(weekOfYear(CarryCompleteDate),0)) ~> DerivedColumn4\nDerivedColumn4 alterRow(upsertIf(true())) ~> AlterRow1\nFilter1 filter(like(pow, '%CR%')) ~> Filter2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'tauranga',\n\tfolderPath: 'gold/tt_productivity',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Carry_CHE_Id','CarryCompleteDate'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TT_Productivity_vizingham')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Using Moves as source data",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "sort1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'vizingham',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(equals(Carry_CHE_Kind,'ITV') && like(pow, '%STS%')) ~> Filter1\nFilter1 derive(CarryCompleteTime = toString(t_put,'HH:mm:ss'),\n\t\tCarryCompleteDate = toDate(toString(t_put, 'yyyy-MM-dd')),\n\t\tEvent_Type_Id = iif(Event_Type_Id=='UNIT_YARD_MOVE' && Move_Kind=='DSCH', 'UNIT_DISCH', Event_Type_Id)) ~> DerivedColumn2\nsort1 aggregate(groupBy(CarryCompleteDate,\n\t\tCarry_CHE_Id),\n\tFirst_Lift = min(t_put),\n\t\tLast_Lift = max(t_put),\n\t\tMove_Count = countDistinct(mve_gkey)) ~> Aggregate1\nAggregate1 derive(WorkTime = Last_Lift-First_Lift,\n\t\tYear = iifNull(year(CarryCompleteDate),0),\n\t\tMonth = iifNull(month(CarryCompleteDate),0),\n\t\tWeek = iifNull(weekOfYear(CarryCompleteDate),0)) ~> DerivedColumn4\nDerivedColumn4 alterRow(upsertIf(true())) ~> AlterRow1\nDerivedColumn2 sort(asc(Carry_CHE_Id, true),\n\tasc(t_put, true)) ~> sort1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'vizingham',\n\tfolderPath: 'gold/tt_productivity',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Carry_CHE_Id','CarryCompleteDate'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TrkVstStg_gpa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "CSV"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Aggregate1"
						},
						{
							"name": "Select2"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "join1"
						},
						{
							"name": "flattenedTrkVst"
						},
						{
							"name": "precheckRows"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "completedGCTVisits"
						},
						{
							"name": "inspectionRows"
						},
						{
							"name": "renameInspectionStageColumns"
						},
						{
							"name": "TurnTime"
						},
						{
							"name": "dedupeTVStgKey"
						}
					],
					"script": "source(output(\n\t\tCarrier_Visit_Key as string,\n\t\tTV_Stg_Key as string,\n\t\tFacility_Id as string,\n\t\tGate_Stage_Id as string,\n\t\tTV_Stg_Seq as string,\n\t\tTruck_Visit_Status_Id as string,\n\t\tTrk_Yard_Entered_Time as string,\n\t\tTrk_Yard_Exited_Time as string,\n\t\tTV_Stg_Start_Time as string,\n\t\tTV_Stg_End_Time as string,\n\t\tqueue_time as long,\n\t\tTV_Stg_Trouble as boolean,\n\t\tTV_Stg_Trouble_Resolve_Time as long,\n\t\tTV_Stg_Extra_Time_Minute as long\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/trkvststg/load/','bronze/trkvststg/archive/'],\n\tformat: 'delimited',\n\tfileSystem: 'gpa',\n\tfolderPath: 'bronze/trkvststg/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true,\n\tdateFormats: ['dd-MM-yyyy'],\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'']) ~> CSV\nTurnTime aggregate(groupBy(Carrier_Visit_Key),\n\teach(match(name!='Carrier_Visit_Key'), $$ = first($$))) ~> Aggregate1\nCSV select(mapColumn(\n\t\tCarrier_Visit_Key,\n\t\tTV_Stg_Key,\n\t\tFacility_Id,\n\t\tGate_Stage_Id,\n\t\tTV_Stg_Seq,\n\t\tTruck_Visit_Status_Id,\n\t\tTrk_Yard_Entered_Time,\n\t\tTrk_Yard_Exited_Time,\n\t\tTV_Stg_Start_Time,\n\t\tTV_Stg_End_Time,\n\t\tQUEUE_TIME = queue_time,\n\t\tTV_Stg_Trouble,\n\t\tTV_Stg_Trouble_Resolve_Time,\n\t\tTV_Stg_Extra_Time_Minute\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nAggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nprecheckRows, renameInspectionStageColumns join(Carrier_Visit_Key == insp_Carrier_Visit_Key,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> join1\njoin1 select(mapColumn(\n\t\tCarrier_Visit_Key,\n\t\tTV_Stg_Key,\n\t\tFacility_Id,\n\t\tGate_Stage_Id,\n\t\tTV_Stg_Seq,\n\t\tTruck_Visit_Status_Id,\n\t\tTrk_Yard_Entered_Time,\n\t\tTrk_Yard_Exited_Time,\n\t\tTV_Stg_Start_Time,\n\t\tTV_Stg_End_Time,\n\t\tQUEUE_TIME = insp_QUEUE_TIME,\n\t\tTV_Stg_Trouble,\n\t\tTV_Stg_Trouble_Resolve_Time,\n\t\tTV_Stg_Extra_Time_Minute,\n\t\tinsp_Carrier_Visit_Key,\n\t\tinsp_TV_Stg_Key,\n\t\tinsp_Facility_Id,\n\t\tinsp_Gate_Stage_Id,\n\t\tinsp_TV_Stg_Seq,\n\t\tinsp_Trk_Yard_Entered_Time,\n\t\tinsp_Trk_Yard_Exited_Time,\n\t\tinsp_TV_Stg_Start_Time,\n\t\tinsp_TV_Stg_End_Time\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> flattenedTrkVst\nderivedColumn1 filter(Gate_Stage_Id=='precheck'&&TV_Stg_Seq==1) ~> precheckRows\ndedupeTVStgKey derive(Carrier_Visit_Key = toLong(Carrier_Visit_Key),\n\t\tTV_Stg_Key = toLong(TV_Stg_Key),\n\t\tTV_Stg_Seq = toLong(TV_Stg_Seq),\n\t\tTrk_Yard_Entered_Time = toTimestamp(Trk_Yard_Entered_Time, 'MM/dd/yyyy HH:mm:ss'),\n\t\tTrk_Yard_Exited_Time = toTimestamp(Trk_Yard_Exited_Time,'MM/dd/yyyy HH:mm:ss'),\n\t\tTV_Stg_Start_Time = toTimestamp(TV_Stg_Start_Time,'MM/dd/yyyy HH:mm:ss'),\n\t\tTV_Stg_End_Time = toTimestamp(TV_Stg_End_Time,'MM/dd/yyyy HH:mm:ss')) ~> derivedColumn1\nSelect2 filter(Truck_Visit_Status_Id=='COMPLETE'&&Facility_Id=='GCT'&&(isNull(Trk_Yard_Exited_Time)==false())) ~> completedGCTVisits\nderivedColumn1 filter(Gate_Stage_Id=='inspection') ~> inspectionRows\ninspectionRows select(mapColumn(\n\t\tinsp_Carrier_Visit_Key = Carrier_Visit_Key,\n\t\tinsp_TV_Stg_Key = TV_Stg_Key,\n\t\tinsp_Facility_Id = Facility_Id,\n\t\tinsp_Gate_Stage_Id = Gate_Stage_Id,\n\t\tinsp_TV_Stg_Seq = TV_Stg_Seq,\n\t\tinsp_Trk_Yard_Entered_Time = Trk_Yard_Entered_Time,\n\t\tinsp_Trk_Yard_Exited_Time = Trk_Yard_Exited_Time,\n\t\tinsp_TV_Stg_Start_Time = TV_Stg_Start_Time,\n\t\tinsp_TV_Stg_End_Time = TV_Stg_End_Time,\n\t\tinsp_QUEUE_TIME = QUEUE_TIME\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> renameInspectionStageColumns\nflattenedTrkVst derive(TurnTimeSecond = round((minus(Trk_Yard_Exited_Time,coalesce(insp_TV_Stg_Start_Time,Trk_Yard_Entered_Time))/1000),0),\n\t\tYear = year(Trk_Yard_Exited_Time),\n\t\tMonth = month(Trk_Yard_Exited_Time),\n\t\tWeek = weekOfYear(Trk_Yard_Exited_Time)) ~> TurnTime\ncompletedGCTVisits aggregate(groupBy(TV_Stg_Key),\n\teach(match(name!='TV_Stg_Key'), $$ = first($$))) ~> dedupeTVStgKey\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/truckturntime',\n\tmergeSchema: false,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Carrier_Visit_Key'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tCarrier_Visit_Key,\n\t\tTV_Stg_Key,\n\t\tFacility_Id,\n\t\tGate_Stage_Id,\n\t\tTV_Stg_Seq,\n\t\tTruck_Visit_Status_Id,\n\t\tTrk_Yard_Entered_Time,\n\t\tTrk_Yard_Exited_Time,\n\t\tTV_Stg_Start_Time,\n\t\tTV_Stg_End_Time,\n\t\tQUEUE_TIME,\n\t\tTV_Stg_Trouble,\n\t\tTV_Stg_Trouble_Resolve_Time,\n\t\tTV_Stg_Extra_Time_Minute,\n\t\tinsp_Carrier_Visit_Key,\n\t\tinsp_TV_Stg_Key,\n\t\tinsp_Facility_Id,\n\t\tinsp_Gate_Stage_Id,\n\t\tinsp_TV_Stg_Seq,\n\t\tinsp_Trk_Yard_Entered_Time,\n\t\tinsp_Trk_Yard_Exited_Time,\n\t\tinsp_TV_Stg_Start_Time,\n\t\tinsp_TV_Stg_End_Time,\n\t\tTurnTimeSecond,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/VesselVisits')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "powerbianalyticsdata-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "powerbianalyticsdata-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "ColumnNameSpace"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as boolean,\n\t\t{Carrier Mode} as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tETA as timestamp,\n\t\tETD as timestamp,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as timestamp,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as timestamp,\n\t\t{Published ETD} as timestamp,\n\t\t{Start Work} as timestamp,\n\t\t{End Work} as timestamp,\n\t\t{Begin Receive_Date} as timestamp,\n\t\t{Cargo Cutoff Date} as timestamp,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as timestamp,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as short,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as short,\n\t\t{Est Discharge} as short,\n\t\t{Est Restow} as short,\n\t\t{Est Shift} as short,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as timestamp,\n\t\tvvFlexDate02 as timestamp,\n\t\tvvFlexDate03 as timestamp,\n\t\tvvFlexDate04 as timestamp,\n\t\tvvFlexDate05 as timestamp,\n\t\tvvFlexDate06 as timestamp,\n\t\tvvFlexDate07 as timestamp,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as long,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as short,\n\t\t{Vessel TEU Capacity} as short,\n\t\t{Lloyds Code} as integer\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/vessel_visits','bronze/vessel_visits/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'arica',\n\tfolderPath: 'bronze/vessel_visits',\n\tcolumnDelimiter: ';',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source1\nsource1 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ColumnNameSpace\nColumnNameSpace alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'arica',\n\tfolderPath: 'silver/vessel_visits',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Carrier_Visit_Key'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/powerbianalyticsdata-WorkspaceDefaultStorage')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/VesselVisits_CTB')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "ColumnNameSpace"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as string,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as short,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/vessel_visits/load','bronze/vessel_visits/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'bronze/vessel_visits/load',\n\tcolumnDelimiter: ';',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source1\nColumnNameSpace derive(ATA = coalesce(toTimestamp(ATA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss')),\n\t\tETA = coalesce(toTimestamp(ETA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tETD = coalesce(toTimestamp(ETD,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETD,'dd-MM-yy HH:mm:ss'),toTimestamp(ETD,'dd.MM.yy HH:mm:ss'),toTimestamp(ETD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ETD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tTimeFirstAvailabilty = coalesce(toTimestamp(Time_First_Availabilty,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(Time_First_Availabilty,'dd-MM-yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tStartWork = coalesce(toTimestamp(Start_Work,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(Start_Work,'dd-MM-yy HH:mm:ss'),toTimestamp(Start_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(Start_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tTimeDischargeComplete = coalesce(toTimestamp(Time_Discharge_Complete,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(Time_Discharge_Complete,'dd-MM-yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tEndWork = coalesce(toTimestamp(End_Work,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(End_Work,'dd-MM-yy HH:mm:ss'),toTimestamp(End_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(End_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tWeek = weekOfYear(iifNull(coalesce(toTimestamp(ATA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')))),\n\t\tYear = year(iifNull(coalesce(toTimestamp(ATA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')))),\n\t\tMonth = month(iifNull(coalesce(toTimestamp(ATA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss'))))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ColumnNameSpace\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nDerivedColumn1 aggregate(groupBy(Carrier_Visit_Key),\n\teach(match(name!='Carrier_Visit_Key'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'silver/vessel_visits',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Carrier_Visit_Key'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/VesselVisits_GTI')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "ColumnNameSpace"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "parameters{\n\tcustomer as string ('gti')\n}\nsource(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as string,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as short,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['/bronze/vessel_visits','bronze/vessel_visits/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'gti',\n\tfolderPath: 'bronze/vessel_visits',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source1\nColumnNameSpace derive(ATA = coalesce(toTimestamp(ATA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss')),\n\t\tETA = coalesce(toTimestamp(ETA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tETD = coalesce(toTimestamp(ETD,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETD,'dd-MM-yy HH:mm:ss'),toTimestamp(ETD,'dd.MM.yy HH:mm:ss'),toTimestamp(ETD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ETD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tTimeFirstAvailabilty = coalesce(toTimestamp(Time_First_Availabilty,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(Time_First_Availabilty,'dd-MM-yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tStartWork = coalesce(toTimestamp(Start_Work,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(Start_Work,'dd-MM-yy HH:mm:ss'),toTimestamp(Start_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(Start_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tTimeDischargeComplete = coalesce(toTimestamp(Time_Discharge_Complete,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(Time_Discharge_Complete,'dd-MM-yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tEndWork = coalesce(toTimestamp(End_Work,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(End_Work,'dd-MM-yy HH:mm:ss'),toTimestamp(End_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(End_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tWeek = weekOfYear(iifNull(coalesce(toTimestamp(ATA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss')),coalesce(currentTimestamp(),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')))),\n\t\tYear = year(iifNull(coalesce(toTimestamp(ATA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss')),coalesce(currentTimestamp(),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')))),\n\t\tMonth = month(iifNull(coalesce(toTimestamp(ATA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss')),coalesce(currentTimestamp(),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss'))))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ColumnNameSpace\nDerivedColumn1 alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'gti',\n\tfolderPath: 'silver/vesselvisits',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Carrier_Visit_Key'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/VesselVisits_Valencia')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "ColumnNameSpace"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as string,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as short,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/vesselvisits/','bronze/vesselvisits/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'valencia',\n\tfolderPath: 'bronze/vesselvisits',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source1\nColumnNameSpace derive(ATA = coalesce(toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss')),\n\t\tETA = coalesce(toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tETD = coalesce(toTimestamp(ETD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ETD,'dd-MM-yy HH:mm:ss'),toTimestamp(ETD,'dd.MM.yy HH:mm:ss'),toTimestamp(ETD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ETD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tTimeFirstAvailabilty = coalesce(toTimestamp(Time_First_Availabilty,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(Time_First_Availabilty,'MM/dd/yyyy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd-MM-yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tStartWork = coalesce(toTimestamp(Start_Work,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(Start_Work,'MM/dd/yyyy HH:mm:ss'),toTimestamp(Start_Work,'dd-MM-yy HH:mm:ss'),toTimestamp(Start_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(Start_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tTimeDischargeComplete = coalesce(toTimestamp(Time_Discharge_Complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(Time_Discharge_Complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd-MM-yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tEndWork = coalesce(toTimestamp(End_Work,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(End_Work,'MM/dd/yyyy HH:mm:ss'),toTimestamp(End_Work,'dd-MM-yy HH:mm:ss'),toTimestamp(End_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(End_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tWeek = weekOfYear(iifNull(coalesce(toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')))),\n\t\tYear = year(iifNull(coalesce(toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')))),\n\t\tMonth = month(iifNull(coalesce(toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss'))))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ColumnNameSpace\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nDerivedColumn1 aggregate(groupBy(Carrier_Visit_Key),\n\teach(match(name!='Carrier_Visit_Key'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'valencia',\n\tfolderPath: 'silver/vesselvisits',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['Carrier_Visit_Key'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/VesselVisits_aarhus')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "ColumnNameSpace"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as string,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as short,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['/bronze/vesselvisits/load','bronze/vesselvisits/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'apmtaarhus',\n\tfolderPath: 'bronze/vesselvisits/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source1\nColumnNameSpace derive(ATA = coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss')),\n\t\tETA = coalesce(toTimestamp(ETA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tETD = coalesce(toTimestamp(ETD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ETD,'dd-MM-yy HH:mm:ss'),toTimestamp(ETD,'dd.MM.yy HH:mm:ss'),toTimestamp(ETD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ETD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tTimeFirstAvailabilty = coalesce(toTimestamp(Time_First_Availabilty,'MM/dd/yyyy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd-MM-yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tStartWork = coalesce(toTimestamp(Start_Work,'MM/dd/yyyy HH:mm:ss'),toTimestamp(Start_Work,'dd-MM-yy HH:mm:ss'),toTimestamp(Start_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(Start_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tTimeDischargeComplete = coalesce(toTimestamp(Time_Discharge_Complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd-MM-yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tEndWork = coalesce(toTimestamp(End_Work,'MM/dd/yyyy HH:mm:ss'),toTimestamp(End_Work,'dd-MM-yy HH:mm:ss'),toTimestamp(End_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(End_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tWeek = weekOfYear(iifNull(coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')))),\n\t\tYear = year(iifNull(coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')))),\n\t\tMonth = month(iifNull(coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss'))))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ColumnNameSpace\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nDerivedColumn1 aggregate(groupBy(Carrier_Visit_Key),\n\teach(match(name!='Carrier_Visit_Key'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'apmtaarhus',\n\tfolderPath: 'silver/vesselvisits',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['Carrier_Visit_Key'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/VesselVisits_aqaba')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "ColumnNameSpace"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as string,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as short,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['/bronze/vesselvisits/load','bronze/vesselvisits/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'apmtaqaba',\n\tfolderPath: 'bronze/vesselvisits/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source1\nColumnNameSpace derive(ATA = coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss')),\n\t\tETA = coalesce(toTimestamp(ETA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tETD = coalesce(toTimestamp(ETD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ETD,'dd-MM-yy HH:mm:ss'),toTimestamp(ETD,'dd.MM.yy HH:mm:ss'),toTimestamp(ETD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ETD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tTimeFirstAvailabilty = coalesce(toTimestamp(Time_First_Availabilty,'MM/dd/yyyy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd-MM-yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tStartWork = coalesce(toTimestamp(Start_Work,'MM/dd/yyyy HH:mm:ss'),toTimestamp(Start_Work,'dd-MM-yy HH:mm:ss'),toTimestamp(Start_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(Start_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tTimeDischargeComplete = coalesce(toTimestamp(Time_Discharge_Complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd-MM-yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tEndWork = coalesce(toTimestamp(End_Work,'MM/dd/yyyy HH:mm:ss'),toTimestamp(End_Work,'dd-MM-yy HH:mm:ss'),toTimestamp(End_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(End_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tWeek = weekOfYear(iifNull(coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')))),\n\t\tYear = year(iifNull(coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')))),\n\t\tMonth = month(iifNull(coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss'))))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ColumnNameSpace\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nDerivedColumn1 aggregate(groupBy(Carrier_Visit_Key),\n\teach(match(name!='Carrier_Visit_Key'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'apmtaqaba',\n\tfolderPath: 'silver/vesselvisits',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['Carrier_Visit_Key'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/VesselVisits_cmsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "ColumnNameSpace"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as string,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as short,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/vesselvisits','bronze/vesselvisits/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'bronze/vesselvisits',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source1\nColumnNameSpace derive(ATA = coalesce( toTimestamp(ATA,'yyyy/MM/dd HH:mm:ss.SSS'), toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss')),\n\t\tETA = coalesce(toTimestamp(ETA,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(ETA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tETD = coalesce(toTimestamp(ETD,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(ETD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ETD,'dd-MM-yy HH:mm:ss'),toTimestamp(ETD,'dd.MM.yy HH:mm:ss'),toTimestamp(ETD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ETD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tTimeFirstAvailabilty = coalesce(toTimestamp(Time_First_Availabilty,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(Time_First_Availabilty,'dd-MM-yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tStartWork = coalesce(toTimestamp(Start_Work,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(Start_Work,'dd-MM-yy HH:mm:ss'),toTimestamp(Start_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(Start_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tTimeDischargeComplete = coalesce(toTimestamp(Time_Discharge_Complete,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(Time_Discharge_Complete,'dd-MM-yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tEndWork = coalesce(toTimestamp(End_Work,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(End_Work,'dd-MM-yy HH:mm:ss'),toTimestamp(End_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(End_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tWeek = weekOfYear(iifNull(coalesce(toTimestamp(ATA,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')))),\n\t\tYear = year(iifNull(coalesce(toTimestamp(ATA,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')))),\n\t\tMonth = month(iifNull(coalesce(toTimestamp(ATA,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss'))))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ColumnNameSpace\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nDerivedColumn1 aggregate(groupBy(Carrier_Visit_Key),\n\teach(match(name!='Carrier_Visit_Key'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'silver/vesselvisits',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['Carrier_Visit_Key'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/VesselVisits_gpa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "ColumnNameSpace"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\tFacility_Id as string,\n\t\tCarrier_Visit_Id as string,\n\t\tPhase as string,\n\t\tVisit_Nbr as string,\n\t\tCarrier_Mode as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tTime_First_Availabilty as string,\n\t\tTime_Discharge_Complete as string,\n\t\tService_Id as string,\n\t\tService_Name as string,\n\t\tVessel_Id as string,\n\t\tIB_VYG as string,\n\t\tOB_VYG as string,\n\t\tCarrier_Name as string,\n\t\tVessel_Class as string,\n\t\tPublished_ETA as string,\n\t\tPublished_ETD as string,\n\t\tStart_Work as string,\n\t\tEnd_Work as string,\n\t\tCarrier_Visit_Key as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/vesselvisits','bronze/vesselvisits/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'gpa',\n\tfolderPath: 'bronze/vesselvisits',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source1\nColumnNameSpace derive(ATA = coalesce( toTimestamp(ATA,'MM/dd/yyyy HH:mm'), toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss')),\n\t\tPublished_ETA = coalesce(toTimestamp(Published_ETA,'MM/dd/yyyy HH:mm'),toTimestamp(Published_ETA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(Published_ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(Published_ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(Published_ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tPublished_ETD = coalesce(toTimestamp(Published_ETD,'MM/dd/yyyy HH:mm'),toTimestamp(Published_ETD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(Published_ETD,'dd-MM-yy HH:mm:ss'), toTimestamp(Published_ETD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(Published_ETD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'MM/dd/yyyy HH:mm'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tTimeFirstAvailabilty = coalesce(toTimestamp(Time_First_Availabilty,'MM/dd/yyyy HH:mm'),toTimestamp(Time_First_Availabilty,'dd-MM-yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tStartWork = coalesce(toTimestamp(Start_Work,'MM/dd/yyyy HH:mm'),toTimestamp(Start_Work,'dd-MM-yy HH:mm:ss'),toTimestamp(Start_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(Start_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tTimeDischargeComplete = coalesce(toTimestamp(Time_Discharge_Complete,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(Time_Discharge_Complete,'dd-MM-yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tEndWork = coalesce(toTimestamp(End_Work,'MM/dd/yyyy HH:mm'),toTimestamp(End_Work,'dd-MM-yy HH:mm:ss'),toTimestamp(End_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(End_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tWeek = weekOfYear(iifNull(coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(Published_ETA,'MM/dd/yyyy HH:mm'),toTimestamp(Published_ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(Published_ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(Published_ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')))),\n\t\tYear = year(iifNull(coalesce(toTimestamp(ATA,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(Published_ETA,'MM/dd/yyyy HH:mm'),toTimestamp(Published_ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(Published_ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(Published_ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')))),\n\t\tMonth = month(iifNull(coalesce(toTimestamp(ATA,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(Published_ETA,'MM/dd/yyyy HH:mm'),toTimestamp(Published_ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(Published_ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(Published_ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')))),\n\t\tVisit_Nbr = toShort(Visit_Nbr),\n\t\tCarrier_Visit_Key = toLong(Carrier_Visit_Key)) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ColumnNameSpace\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nDerivedColumn1 aggregate(groupBy(Carrier_Visit_Key,\n\t\tFacility_Id),\n\teach(match(name!='Carrier_Visit_Key'&&name!='Facility_Id'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: true,\n\tformat: 'delta',\n\tfileSystem: 'gpa',\n\tfolderPath: 'silver/vesselvisits',\n\tmergeSchema: false,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Carrier_Visit_Key','Facility_Id'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tCarrier_Visit_Key,\n\t\tFacility_Id,\n\t\tCarrier_Visit_Id,\n\t\tPhase,\n\t\tVisit_Nbr,\n\t\tCarrier_Mode,\n\t\tATA,\n\t\tATD,\n\t\tTime_First_Availabilty,\n\t\tTime_Discharge_Complete,\n\t\tService_Id,\n\t\tService_Name,\n\t\tVessel_Id,\n\t\tIB_VYG,\n\t\tOB_VYG,\n\t\tCarrier_Name,\n\t\tVessel_Class,\n\t\tPublished_ETA,\n\t\tPublished_ETD,\n\t\tStart_Work,\n\t\tEnd_Work,\n\t\tTimeFirstAvailabilty,\n\t\tStartWork,\n\t\tTimeDischargeComplete,\n\t\tEndWork,\n\t\tWeek,\n\t\tYear,\n\t\tMonth\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/VesselVisits_haifa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "ColumnNameSpace"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as string,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as long,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as short,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/vesselvisits/load','bronze/vesselvisits/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'haifa',\n\tfolderPath: 'bronze/vesselvisits/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source1\nColumnNameSpace derive(ATA = coalesce(toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss')),\n\t\tETA = coalesce(toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tETD = coalesce(toTimestamp(ETD,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(ETD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETD,'dd.MM.yy HH:mm:ss'),toTimestamp(ETD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ETD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tTimeFirstAvailabilty = coalesce(toTimestamp(Time_First_Availabilty,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(Time_First_Availabilty,'dd/MM/yyyy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tStartWork = coalesce(toTimestamp(Start_Work,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(Start_Work,'dd/MM/yyyy HH:mm:ss'),toTimestamp(Start_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(Start_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tTimeDischargeComplete = coalesce(toTimestamp(Time_Discharge_Complete,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(Time_Discharge_Complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tEndWork = coalesce(toTimestamp(End_Work,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(End_Work,'dd/MM/yyyy HH:mm:ss'),toTimestamp(End_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(End_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tWeek = weekOfYear(iifNull(coalesce(toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss')))),\n\t\tYear = year(iifNull(coalesce(toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss')))),\n\t\tMonth = month(iifNull(coalesce(toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss'))))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ColumnNameSpace\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nDerivedColumn1 aggregate(groupBy(Carrier_Visit_Key),\n\teach(match(name!='Carrier_Visit_Key'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'haifa',\n\tfolderPath: 'silver/vesselvisits',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['Carrier_Visit_Key'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/VesselVisits_mict')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "ColumnNameSpace"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as boolean,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as short,\n\t\t{Est BBK Load} as short,\n\t\t{Est Load} as short,\n\t\t{Est Discharge} as short,\n\t\t{Est Restow} as short,\n\t\t{Est Shift} as string,\n\t\tVvFlexstring01 as string,\n\t\tVvFlexstring02 as string,\n\t\tVvFlexstring03 as string,\n\t\tVvFlexstring04 as string,\n\t\tVvFlexstring05 as short,\n\t\tVvFlexstring06 as string,\n\t\tVvFlexstring07 as short,\n\t\tVvFlexstring08 as string,\n\t\tVvFlexDate01 as string,\n\t\tVvFlexDate02 as string,\n\t\tVvFlexDate03 as string,\n\t\tVvFlexDate04 as string,\n\t\tVvFlexDate05 as string,\n\t\tVvFlexDate06 as string,\n\t\tVvFlexDate07 as string,\n\t\tVvFlexDate08 as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as short,\n\t\t{Vessel Class Beam cm} as short,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as integer\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/vesselvisits/load','bronze/vesselvisits/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'mict',\n\tfolderPath: 'bronze/vesselvisits/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source1\nColumnNameSpace derive(ATA = coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss')),\n\t\tETA = coalesce(toTimestamp(ETA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ETA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETA,'dd-MM-yyyy HH:mm:ss')),\n\t\tETD = coalesce(toTimestamp(ETD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ETD,'dd-MM-yy HH:mm:ss'),toTimestamp(ETD,'dd.MM.yy HH:mm:ss'),toTimestamp(ETD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ETD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tTimeFirstAvailabilty = coalesce(toTimestamp(Time_First_Availabilty,'MM/dd/yyyy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd-MM-yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(Time_First_Availabilty,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(Time_First_Availabilty,'dd/MM/yyyy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd-MM-yyyy HH:mm:ss')),\n\t\tStartWork = coalesce(toTimestamp(Start_Work,'MM/dd/yyyy HH:mm:ss'),toTimestamp(Start_Work,'dd-MM-yy HH:mm:ss'),toTimestamp(Start_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(Start_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(Start_Work,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(Start_Work,'dd/MM/yyyy HH:mm:ss'),toTimestamp(Start_Work,'dd-MM-yyyy HH:mm:ss')),\n\t\tTimeDischargeComplete = coalesce(toTimestamp(Time_Discharge_Complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd-MM-yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(Time_Discharge_Complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(Time_Discharge_Complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd-MM-yyyy HH:mm:ss')),\n\t\tEndWork = coalesce(toTimestamp(End_Work,'MM/dd/yyyy HH:mm:ss'),toTimestamp(End_Work,'dd-MM-yy HH:mm:ss'),toTimestamp(End_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(End_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(End_Work,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(End_Work,'dd/MM/yyyy HH:mm:ss'),toTimestamp(End_Work,'dd-MM-yyyy HH:mm:ss')),\n\t\tWeek = weekOfYear(iifNull(coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'),toTimestamp(ETA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ETA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETA,'dd-MM-yyyy HH:mm:ss')))),\n\t\tYear = year(iifNull(coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'),toTimestamp(ETA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ETA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETA,'dd-MM-yyyy HH:mm:ss')))),\n\t\tMonth = month(iifNull(coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss'),toTimestamp(ETA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ETA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETA,'dd-MM-yyyy HH:mm:ss'))))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ColumnNameSpace\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nDerivedColumn1 aggregate(groupBy(Carrier_Visit_Key),\n\teach(match(name!='Carrier_Visit_Key'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'silver/vesselvisits',\n\toverwrite: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['Carrier_Visit_Key'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/VesselVisits_mnhpi')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "ColumnNameSpace"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as string,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as short,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/vesselvisits/load','bronze/vesselvisits/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'bronze/vesselvisits/load',\n\tcolumnDelimiter: ';',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source1\nColumnNameSpace derive(ATA = coalesce( toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss'), toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss')),\n\t\tETA = coalesce(toTimestamp(ETA,'yyyy-MM-dd HH:mm:ss'),toTimestamp(ETA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tETD = coalesce(toTimestamp(ETD,'yyyy-MM-dd HH:mm:ss'),toTimestamp(ETD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ETD,'dd-MM-yy HH:mm:ss'),toTimestamp(ETD,'dd.MM.yy HH:mm:ss'),toTimestamp(ETD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ETD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tTimeFirstAvailabilty = coalesce(toTimestamp(Time_First_Availabilty,'yyyy-MM-dd HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd-MM-yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tStartWork = coalesce(toTimestamp(Start_Work,'yyyy-MM-dd HH:mm:ss'),toTimestamp(Start_Work,'dd-MM-yy HH:mm:ss'),toTimestamp(Start_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(Start_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tTimeDischargeComplete = coalesce(toTimestamp(Time_Discharge_Complete,'yyyy-MM-dd HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd-MM-yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tEndWork = coalesce(toTimestamp(End_Work,'yyyy-MM-dd HH:mm:ss'),toTimestamp(End_Work,'dd-MM-yy HH:mm:ss'),toTimestamp(End_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(End_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tWeek = weekOfYear(iifNull(coalesce(toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')))),\n\t\tYear = year(iifNull(coalesce(toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')))),\n\t\tMonth = month(iifNull(coalesce(toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'yyyy/MM/dd HH:mm:ss.SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss'))))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ColumnNameSpace\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nDerivedColumn1 aggregate(groupBy(Carrier_Visit_Key),\n\teach(match(name!='Carrier_Visit_Key'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'silver/vesselvisits',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Carrier_Visit_Key'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/VesselVisits_pdports')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "ColumnNameSpace"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as string,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as long,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as string,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['/bronze/vesselvisits/load','bronze/vesselvisits/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'pdports',\n\tfolderPath: 'bronze/vesselvisits/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source1\nColumnNameSpace derive(ATA = coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss')),\n\t\tETA = coalesce(toTimestamp(ETA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ETA,'dd-MM-yy HH:mm'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tETD = coalesce(toTimestamp(ETD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ETD,'dd-MM-yy HH:mm'),toTimestamp(ETD,'dd.MM.yy HH:mm:ss'),toTimestamp(ETD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ETD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tTimeFirstAvailabilty = coalesce(toTimestamp(Time_First_Availabilty,'MM/dd/yyyy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd-MM-yy HH:mm'),toTimestamp(Time_First_Availabilty,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tStartWork = coalesce(toTimestamp(Start_Work,'MM/dd/yyyy HH:mm:ss'),toTimestamp(Start_Work,'dd-MM-yy HH:mm'),toTimestamp(Start_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(Start_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tTimeDischargeComplete = coalesce(toTimestamp(Time_Discharge_Complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd-MM-yy HH:mm'),toTimestamp(Time_Discharge_Complete,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tEndWork = coalesce(toTimestamp(End_Work,'MM/dd/yyyy HH:mm:ss'),toTimestamp(End_Work,'dd-MM-yy HH:mm'),toTimestamp(End_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(End_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tWeek = weekOfYear(iifNull(coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')))),\n\t\tYear = year(iifNull(coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')))),\n\t\tMonth = month(iifNull(coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss'))))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ColumnNameSpace\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nDerivedColumn1 aggregate(groupBy(Carrier_Visit_Key),\n\teach(match(name!='Carrier_Visit_Key'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'pdports',\n\tfolderPath: 'silver/vesselvisits',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['Carrier_Visit_Key'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/VesselVisits_plipdeco')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "ColumnNameSpace"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as string,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as integer,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as short,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/vesselvisits/load','bronze/vesselvisits/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'plipdeco',\n\tfolderPath: 'bronze/vesselvisits/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source1\nColumnNameSpace derive(ATA = coalesce(toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss')),\n\t\tETA = coalesce(toTimestamp(ETA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tETD = coalesce(toTimestamp(ETD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ETD,'dd-MM-yy HH:mm:ss'),toTimestamp(ETD,'dd.MM.yy HH:mm:ss'),toTimestamp(ETD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ETD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tTimeFirstAvailabilty = coalesce(toTimestamp(Time_First_Availabilty,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(Time_First_Availabilty,'MM/dd/yyyy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd-MM-yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tStartWork = coalesce(toTimestamp(Start_Work,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(Start_Work,'MM/dd/yyyy HH:mm:ss'),toTimestamp(Start_Work,'dd-MM-yy HH:mm:ss'),toTimestamp(Start_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(Start_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tTimeDischargeComplete = coalesce(toTimestamp(Time_Discharge_Complete,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(Time_Discharge_Complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd-MM-yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tEndWork = coalesce(toTimestamp(End_Work,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(End_Work,'MM/dd/yyyy HH:mm:ss'),toTimestamp(End_Work,'dd-MM-yy HH:mm:ss'),toTimestamp(End_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(End_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tWeek = weekOfYear(iifNull(coalesce(toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')))),\n\t\tYear = year(iifNull(coalesce(toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')))),\n\t\tMonth = month(iifNull(coalesce(toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss'))))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ColumnNameSpace\naggregate1 alterRow(upsertIf(true()),\n\tinsertIf(true())) ~> AlterRow1\nDerivedColumn1 aggregate(groupBy(Carrier_Visit_Key),\n\teach(match(name!='Carrier_Visit_Key'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'plipdeco',\n\tfolderPath: 'silver/vesselvisits',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Carrier_Visit_Key'],\n\tumask: 0222,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/VesselVisits_salalah')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "ColumnNameSpace"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as string,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as long,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as string,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['/bronze/vesselvisits/load','bronze/vesselvisits/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'salalah',\n\tfolderPath: 'bronze/vesselvisits/load',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source1\nColumnNameSpace derive(ATA = coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss')),\n\t\tETA = coalesce(toTimestamp(ETA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ETA,'dd-MM-yy HH:mm'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tETD = coalesce(toTimestamp(ETD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ETD,'dd-MM-yy HH:mm'),toTimestamp(ETD,'dd.MM.yy HH:mm:ss'),toTimestamp(ETD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ETD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yy HH:mm'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tTimeFirstAvailabilty = coalesce(toTimestamp(Time_First_Availabilty,'MM/dd/yyyy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd-MM-yy HH:mm'),toTimestamp(Time_First_Availabilty,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tStartWork = coalesce(toTimestamp(Start_Work,'MM/dd/yyyy HH:mm:ss'),toTimestamp(Start_Work,'dd-MM-yy HH:mm'),toTimestamp(Start_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(Start_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tTimeDischargeComplete = coalesce(toTimestamp(Time_Discharge_Complete,'MM/dd/yyyy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd-MM-yy HH:mm'),toTimestamp(Time_Discharge_Complete,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tEndWork = coalesce(toTimestamp(End_Work,'MM/dd/yyyy HH:mm:ss'),toTimestamp(End_Work,'dd-MM-yy HH:mm'),toTimestamp(End_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(End_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tWeek = weekOfYear(iifNull(coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')))),\n\t\tYear = year(iifNull(coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')))),\n\t\tMonth = month(iifNull(coalesce(toTimestamp(ATA,'MM/dd/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yy HH:mm'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'dd.MM.yy HH:mm:ss,SSS'),toTimestamp(ETA,'dd-MM-yy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss'))))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ColumnNameSpace\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nDerivedColumn1 aggregate(groupBy(Carrier_Visit_Key),\n\teach(match(name!='Carrier_Visit_Key'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'salalah',\n\tfolderPath: 'silver/vesselvisits',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['Carrier_Visit_Key'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/VesselVisits_tdt')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "ColumnNameSpace"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate1"
						}
					],
					"script": "source(output(\n\t\t{Complex Id} as string,\n\t\t{Facility Id} as string,\n\t\t{Carrier Visit Id} as string,\n\t\tPhase as string,\n\t\t{Visit Nbr} as string,\n\t\t{Carrier Mode} as string,\n\t\tATA as string,\n\t\tATD as string,\n\t\tETA as string,\n\t\tETD as string,\n\t\t{Operator Line Id} as string,\n\t\t{Operator Line Role} as string,\n\t\t{Operator Line Name} as string,\n\t\t{Time First Availabilty} as string,\n\t\t{Time Discharge Complete} as string,\n\t\t{Service Id} as string,\n\t\t{Service Name} as string,\n\t\t{Vessel Id} as string,\n\t\t{IB VYG} as string,\n\t\t{OB VYG} as string,\n\t\t{Carrier Name} as string,\n\t\t{Vessel Class} as string,\n\t\t{Published ETA} as string,\n\t\t{Published ETD} as string,\n\t\t{Start Work} as string,\n\t\t{End Work} as string,\n\t\t{Begin Receive_Date} as string,\n\t\t{Cargo Cutoff Date} as string,\n\t\t{Hazard Cutoff Date} as string,\n\t\t{Reefer Cutoff Date} as string,\n\t\t{Labor On Board Date} as string,\n\t\t{Labor Off Board Date} as string,\n\t\t{Off Port Arrival Date} as string,\n\t\t{Off Port Departure} as string,\n\t\t{Pilot On Board Date} as string,\n\t\t{Pilot Off Board Date} as string,\n\t\t{Est BBK Discharge} as string,\n\t\t{Est BBK Load} as string,\n\t\t{Est Load} as string,\n\t\t{Est Discharge} as string,\n\t\t{Est Restow} as string,\n\t\t{Est Shift} as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\t{Carrier Visit Key} as long,\n\t\t{Vessel Classification} as string,\n\t\t{Vessel Class Length Overall cm} as integer,\n\t\t{Vessel Class Beam cm} as short,\n\t\t{Vessel TEU Capacity} as string,\n\t\t{Lloyds Code} as string\n\t),\n\tuseSchema: false,\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tmoveFiles: ['bronze/vesselvisits','bronze/vesselvisits/archive'],\n\tformat: 'delimited',\n\tfileSystem: 'tdt',\n\tfolderPath: 'bronze/vesselvisits',\n\tcolumnDelimiter: ',',\n\tescapeChar: '\\\\',\n\tquoteChar: '\\\"',\n\tcolumnNamesAsHeader: true) ~> source1\nColumnNameSpace derive(ATA = coalesce( toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd-MM-yyyy HH:mm:ss')),\n\t\tETA = coalesce(toTimestamp(ETA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tETD = coalesce(toTimestamp(ETD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETD,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(ETD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETD,'dd.MM.yy HH:mm:ss'),toTimestamp(ETD,'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(ETD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETD,'dd-MM-yyyy HH:mm:ss')),\n\t\tATD = coalesce(toTimestamp(ATD,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd.MM.yy HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(ATD,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATD,'dd-MM-yyyy HH:mm:ss')),\n\t\tTimeFirstAvailabilty = coalesce(toTimestamp(Time_First_Availabilty,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(Time_First_Availabilty,'dd/MM/yyyy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_First_Availabilty,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tStartWork = coalesce( toTimestamp(Start_Work,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(Start_Work,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(Start_Work,'dd/MM/yyyy HH:mm:ss'),toTimestamp(Start_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(Start_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tTimeDischargeComplete = coalesce(toTimestamp(Time_Discharge_Complete,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(Time_Discharge_Complete,'dd/MM/yyyy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd.MM.yy HH:mm:ss'),toTimestamp(Time_Discharge_Complete,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tEndWork = coalesce( toTimestamp(End_Work,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(End_Work,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(End_Work,'dd/MM/yyyy HH:mm:ss'),toTimestamp(End_Work,'dd.MM.yy HH:mm:ss'),toTimestamp(End_Work,'dd/MM/yyyy\\'T\\'HH:mm:ss')),\n\t\tWeek = weekOfYear(iifNull(coalesce( toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce( toTimestamp(ETA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss')))),\n\t\tYear = year(iifNull(coalesce( toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce(toTimestamp(ETA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss')))),\n\t\tMonth = month(iifNull(coalesce( toTimestamp(ATA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(ATA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ATA,'dd.MM.yy HH:mm:ss'),toTimestamp(ATA,'dd/MM/yyyy\\'T\\'HH:mm:ss')),coalesce( toTimestamp(ETA,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss:SSSSS'),toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss'),toTimestamp(ETA,'dd.MM.yy HH:mm:ss'),toTimestamp(ETA,'dd/MM/yyyy HH:mm:ss'))))) ~> DerivedColumn1\nsource1 select(mapColumn(\n\t\teach(match(true()),\n\t\t\tregexReplace($$,' ','_') = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ColumnNameSpace\naggregate1 alterRow(upsertIf(true())) ~> AlterRow1\nDerivedColumn1 aggregate(groupBy(Carrier_Visit_Key),\n\teach(match(name!='Carrier_Visit_Key'), $$ = first($$))) ~> aggregate1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'tdt',\n\tfolderPath: 'silver/vesselvisits',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['Carrier_Visit_Key'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Vessel_GMPH_CTB')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "powerbianalyticsdata-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "powerbianalyticsdata-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						},
						{
							"linkedService": {
								"referenceName": "powerbianalyticsdata-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "source3"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "powerbianalyticsdata-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1"
						},
						{
							"name": "Join1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "DerivedColumn5"
						},
						{
							"name": "DerivedColumn6"
						},
						{
							"name": "Filter3"
						},
						{
							"name": "Filter4"
						},
						{
							"name": "DerivedColumn7"
						},
						{
							"name": "Join2"
						},
						{
							"name": "DerivedColumn8"
						},
						{
							"name": "DerivedColumn9"
						},
						{
							"name": "Select2"
						},
						{
							"name": "Filter5"
						},
						{
							"name": "Select3"
						},
						{
							"name": "aggregate2"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'silver/moves') ~> source1\nsource(output(\n\t\tComplex_Id as string,\n\t\tFacility_Id as string,\n\t\tCarrier_Visit_Id as string,\n\t\tPhase as string,\n\t\tVisit_Nbr as string,\n\t\tCarrier_Mode as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tETA as timestamp,\n\t\tETD as timestamp,\n\t\tOperator_Line_Id as string,\n\t\tOperator_Line_Role as string,\n\t\tOperator_Line_Name as string,\n\t\tTime_First_Availabilty as string,\n\t\tTime_Discharge_Complete as string,\n\t\tService_Id as string,\n\t\tService_Name as string,\n\t\tVessel_Id as string,\n\t\tIB_VYG as string,\n\t\tOB_VYG as string,\n\t\tCarrier_Name as string,\n\t\tVessel_Class as string,\n\t\tPublished_ETA as string,\n\t\tPublished_ETD as string,\n\t\tStart_Work as string,\n\t\tEnd_Work as string,\n\t\tBegin_Receive_Date as string,\n\t\tCargo_Cutoff_Date as string,\n\t\tHazard_Cutoff_Date as string,\n\t\tReefer_Cutoff_Date as string,\n\t\tLabor_On_Board_Date as string,\n\t\tLabor_Off_Board_Date as string,\n\t\tOff_Port_Arrival_Date as string,\n\t\tOff_Port_Departure as string,\n\t\tPilot_On_Board_Date as string,\n\t\tPilot_Off_Board_Date as string,\n\t\tEst_BBK_Discharge as string,\n\t\tEst_BBK_Load as string,\n\t\tEst_Load as string,\n\t\tEst_Discharge as string,\n\t\tEst_Restow as string,\n\t\tEst_Shift as string,\n\t\tvvFlexString01 as string,\n\t\tvvFlexString02 as string,\n\t\tvvFlexString03 as string,\n\t\tvvFlexString04 as string,\n\t\tvvFlexString05 as string,\n\t\tvvFlexString06 as string,\n\t\tvvFlexString07 as string,\n\t\tvvFlexString08 as string,\n\t\tvvFlexDate01 as string,\n\t\tvvFlexDate02 as string,\n\t\tvvFlexDate03 as string,\n\t\tvvFlexDate04 as string,\n\t\tvvFlexDate05 as string,\n\t\tvvFlexDate06 as string,\n\t\tvvFlexDate07 as string,\n\t\tvvFlexDate08 as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tVessel_Classification as string,\n\t\tVessel_Class_Length_Overall_cm as integer,\n\t\tVessel_Class_Beam_cm as short,\n\t\tVessel_TEU_Capacity as string,\n\t\tLloyds_Code as string,\n\t\tTimeFirstAvailabilty as timestamp,\n\t\tStartWork as timestamp,\n\t\tTimeDischargeComplete as timestamp,\n\t\tEndWork as timestamp,\n\t\tWeek as integer,\n\t\tYear as integer,\n\t\tMonth as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'silver/vessel_visits') ~> source2\nsource(output(\n\t\tdate_of_gang as date,\n\t\tGang as short,\n\t\tCall_Sign as string,\n\t\tVessel_name as string,\n\t\tImp_Voy as string,\n\t\tExp_Voy as string,\n\t\tQuay_Crane as short,\n\t\tvessel_Ops as string,\n\t\tZeile as short,\n\t\tCategory as string,\n\t\tCategory_description as string,\n\t\tSite as string,\n\t\tID as integer,\n\t\tvon_Call_Sign as string,\n\t\t{von_Brcke} as short,\n\t\tTeam as string,\n\t\tCode as string,\n\t\tStart as string,\n\t\tStop as string,\n\t\tAccounting as string,\n\t\tAktiv_Stunden as double,\n\t\tZeitsteuerung as string,\n\t\tVerz as string,\n\t\tLabour_No as integer,\n\t\tDuration as double,\n\t\tTDR as string,\n\t\tOperation_Report as integer,\n\t\tSystem as string,\n\t\tReise as integer,\n\t\taktiv_von as string,\n\t\taktiv_bis as string,\n\t\tStatus as string,\n\t\tStapler_B as boolean,\n\t\tStd_Stapler_B as boolean,\n\t\t{Letzte_nderung} as string,\n\t\tVA as short,\n\t\tAR as short,\n\t\tCB as boolean,\n\t\tVC as short,\n\t\tZM as boolean,\n\t\tST as boolean,\n\t\tRS as boolean,\n\t\tSpr as short,\n\t\tStd_VA as double,\n\t\tStd_AR as double,\n\t\tStd_CB as double,\n\t\tStd_VC as double,\n\t\tStd_ZM as boolean,\n\t\tStd_RS as boolean,\n\t\tST_Std as boolean,\n\t\tStd_Spr as double,\n\t\tBemerkung as string,\n\t\tBrutto_Zeit as short,\n\t\tNetto_Zeit as boolean,\n\t\tStammcode as string,\n\t\tTerminal as string,\n\t\tDokument_Nr as boolean,\n\t\tnew_category as string,\n\t\tdesription_of_activity as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'silver/delays') ~> source3\nsource1 filter(Event_Type_Id==\"UNIT_DISCH\" || Event_Type_Id == \"UNIT_LOAD\") ~> Filter1\nFilter1, source2 join(source1@Carrier_Visit_Key == source2@Carrier_Visit_Key,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tFacility_Id = source1@Facility_Id,\n\t\tComplex_Id = source1@Complex_Id,\n\t\tYard_Id,\n\t\tCarrier_Visit_Key = source1@Carrier_Visit_Key,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Location,\n\t\tTo_Location,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tCarry_CHE_Operator_Id,\n\t\tFetch_CHE_Operator_Id,\n\t\tPut_CHE_Operator_Id,\n\t\tFetch_CHE_Id,\n\t\tFetch_CHE_Kind,\n\t\tCarry_CHE_Id,\n\t\tCarry_CHE_Kind,\n\t\tPut_CHE_Id,\n\t\tPut_CHE_Kind,\n\t\tQC_CHE_Id,\n\t\tQC_CHE_Kind,\n\t\tt_carry_complete,\n\t\tt_put,\n\t\tt_fetch,\n\t\tt_dispatch,\n\t\tt_discharge,\n\t\tt_carry_dispatch,\n\t\tt_carry_fetch_ready,\n\t\tt_carry_put_ready,\n\t\tdist_carry,\n\t\tdist_start,\n\t\tTwin_Fetch,\n\t\tTwin_Carry,\n\t\tTwin_Put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tto_pos_gkey,\n\t\tfm_pos_gkey,\n\t\tRestow_Reason,\n\t\tContainer_Line_Id,\n\t\tContainer_Line_Role,\n\t\tpow,\n\t\tufv_gkey,\n\t\tBerth_Id,\n\t\tGoods_And_Ctr_Wt_Kg,\n\t\tactive_ufv,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tShipper_Id,\n\t\tConsignee_Id,\n\t\tCommodity_Id,\n\t\tATA = source1@ATA,\n\t\tATD = source1@ATD,\n\t\tRehandles,\n\t\tYear = source1@Year,\n\t\tMonth = source1@Month,\n\t\tWeek = source1@Week,\n\t\tCarrier_Visit_Id,\n\t\tCarrier_Mode,\n\t\tOperator_Line_Id,\n\t\tOperator_Line_Name,\n\t\tService_Name,\n\t\tVessel_Id,\n\t\tCarrier_Name,\n\t\tVessel_Class,\n\t\tVessel_Classification,\n\t\tVisit_Nbr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(Time_Completed_Date_Time = iif(Event_Type_Id== \"UNIT_LOAD\", iifNull(t_put,t_carry_complete),iifNull(t_fetch,t_discharge))) ~> DerivedColumn1\nDerivedColumn1 derive(Time = toString(Time_Completed_Date_Time,'HH:mm:ss'),\n\t\tDate = toDate(toString(Time_Completed_Date_Time,'yyyy-MM-dd'))) ~> DerivedColumn2\nDerivedColumn6 derive(Shift_Start_Time = iif(Day_Of_Week==1 || Day_Of_Week==7,\r\n    iif(Time>=toString('06:00:00') && Time<toString('12:00:00'),\r\n        toTimestamp(concat(toString(Date),' ','06:00:00')),\r\n        iif(Time>=toString('12:00:00') && Time<toString('18:00:00'),\r\n            toTimestamp(concat(toString(Date),' ','12:00:00')),\r\n            iif(Time>=toString('18:00:00') && Time<toString('24:00:00'),\r\n                toTimestamp(concat(toString(Date),' ','18:00:00')),\r\n                toTimestamp(concat(toString(subDays(Date,1)),' ','24:00:00'))))),\r\n    iif(Time>=toString('06:00:00') && Time<toString('14:00:00'),\r\n        toTimestamp(concat(toString(Date),' ','06:00:00')),\r\n        iif(Time>=toString('14:00:00') && Time<toString('22:00:00'),\r\n            toTimestamp(concat(toString(Date),' ','14:00:00')),\r\n            iif(Time>=toString('22:00:00'),\r\n                toTimestamp(concat(toString(Date),' ','22:00:00')),\r\n\t\t\t\ttoTimestamp(concat(toString(subDays(Date,1)),' ','22:00:00')))))),\n\t\tShift_End_Time = iif(Day_Of_Week==1 || Day_Of_Week==7,\r\n    iif(Time>=toString('06:00:00') && Time<toString('12:00:00'),\r\n        toTimestamp(concat(toString(Date),' ','11:59:59')),\r\n        iif(Time>=toString('12:00:00') && Time<toString('18:00:00'),\r\n            toTimestamp(concat(toString(Date),' ','17:59:59')),\r\n            iif(Time>=toString('18:00:00') && Time<toString('24:00:00'),\r\n                toTimestamp(concat(toString(Date),' ','23:59:59')),\r\n                toTimestamp(concat(toString(Date),' ','05:59:59'))))),\r\n    iif(Time>=toString('06:00:00') && Time<toString('14:00:00'),\r\n        toTimestamp(concat(toString(Date),' ','13:59:59')),\r\n        iif(Time>=toString('14:00:00') && Time<toString('22:00:00'),\r\n            toTimestamp(concat(toString(Date),' ','21:59:59')),\r\n            iif(Time>=toString('22:00:00'),\r\n                toTimestamp(concat(toString(addDays(Date,1)),' ','05:59:59')),\r\n\t\t\t\ttoTimestamp(concat(toString(Date),' ','05:59:59'))))))) ~> DerivedColumn3\nDerivedColumn5 aggregate(groupBy(Carrier_Visit_Id,\n\t\tpow,\n\t\tShift_Start_Time,\n\t\tShift_End_Time,\n\t\tShift_Date,\n\t\tShift),\n\tFirst_Lift = min(Time_Completed_Date_Time),\n\t\tLast_Lift = max(Time_Completed_Date_Time),\n\t\tMove_Count = countDistinct(mve_gkey)) ~> Aggregate1\nFilter4 derive(WorkTime = Last_Lift-First_Lift,\n\t\tYear = iifNull(year(Shift_Date),0),\n\t\tMonth = iifNull(month(Shift_Date),0),\n\t\tWeek = iifNull(weekOfYear(Shift_Date),0),\n\t\tPow_No = toInteger(iif(left(pow,2)=='SK',substring(pow, 3),iif(left(pow,1)=='M',substring(pow, 2),'0')))) ~> DerivedColumn4\nDerivedColumn3 derive(Shift = iif(toString(Shift_Start_Time, 'HH:mm:ss')==toString('06:00:00'),1,\r\niif(toString(Shift_Start_Time, 'HH:mm:ss')==toString('14:00:00')||toString(Shift_Start_Time, 'HH:mm:ss')==toString('12:00:00'),2,\r\niif(toString(Shift_Start_Time, 'HH:mm:ss')==toString('22:00:00')||toString(Shift_Start_Time, 'HH:mm:ss')==toString('18:00:00'),3,4)))) ~> DerivedColumn5\nDerivedColumn2 derive(Day_Of_Week = dayOfWeek(iif(Time<toString('06:00:00'),subDays(Date,1),Date)),\n\t\tShift_Date = iif(Time<toString('06:00:00'),subDays(Date,1),Date)) ~> DerivedColumn6\nsource3 filter(Code=='BKO' || Code=='MTG'|| Code=='OFF'||Code=='AIT'||Code=='BBK'||Code=='LBR'||Code=='AIL' || Code=='COS'|| Code=='DTW'||Code=='INC'||Code=='LCA'||Code=='MTW'\r\n|| Code=='OTL'||Code=='WCC'||Code=='WEA'||Code=='WTG'||Code=='WVL') ~> Filter3\nAggregate1 filter(pow!='') ~> Filter4\nFilter3 derive(Start_datetime = toTimestamp(concat(toString(date_of_gang),' ',Start)),\n\t\tStop_datetime = iif(Stop<Start,toTimestamp(concat(toString(addDays(date_of_gang,1)),' ',Stop)),toTimestamp(concat(toString(date_of_gang),' ',Stop)))) ~> DerivedColumn7\nFilter5, Select2 join(Pow_No == Quay_Crane\n\t&& First_Lift <= Start_datetime\n\t&& Last_Lift >= Start_datetime,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'right')~> Join2\nDerivedColumn7 derive(Delay = Stop_datetime-Start_datetime) ~> DerivedColumn8\naggregate2 derive(Final_WorkTime = WorkTime-iifNull(Delay,0)) ~> DerivedColumn9\nDerivedColumn8 select(mapColumn(\n\t\tdate_of_gang,\n\t\tVessel_name,\n\t\tQuay_Crane,\n\t\tCode,\n\t\tStart,\n\t\tStop,\n\t\tDuration,\n\t\tdesription_of_activity,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tStart_datetime,\n\t\tStop_datetime,\n\t\tDelay\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nDerivedColumn4 filter(Pow_No!=0) ~> Filter5\nJoin2 select(mapColumn(\n\t\tpow,\n\t\tCarrier_Visit_Id,\n\t\tShift_Start_Time,\n\t\tShift_End_Time,\n\t\tShift_Date,\n\t\tShift,\n\t\tFirst_Lift,\n\t\tLast_Lift,\n\t\tMove_Count,\n\t\tWorkTime,\n\t\tYear = DerivedColumn4@Year,\n\t\tMonth = DerivedColumn4@Month,\n\t\tWeek = DerivedColumn4@Week,\n\t\tPow_No,\n\t\tdate_of_gang,\n\t\tVessel_name,\n\t\tQuay_Crane,\n\t\tCode,\n\t\tStart,\n\t\tStop,\n\t\tDuration,\n\t\tdesription_of_activity,\n\t\tStart_datetime,\n\t\tStop_datetime,\n\t\tDelay\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select3\nSelect3 aggregate(groupBy(Carrier_Visit_Id,\n\t\tpow,\n\t\tShift_Start_Time,\n\t\tShift_End_Time,\n\t\tShift_Date,\n\t\tShift,\n\t\tFirst_Lift,\n\t\tLast_Lift,\n\t\tMove_Count,\n\t\tWorkTime,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tPow_No),\n\tDelay = sum(Delay)) ~> aggregate2\nDerivedColumn9 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'eurogatectb',\n\tfolderPath: 'gold/vessel_gmph',\n\ttruncate: true,\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/powerbianalyticsdata-WorkspaceDefaultStorage')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/YardBlocks_gpa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          Complex_Id as string,",
						"          Facility_Id as string,",
						"          Yard_Id as string,",
						"          mdl_bin_subclass as string,",
						"          mdl_bin_level as short,",
						"          mdl_status as string,",
						"          mdl_pos_name as string,",
						"          mdl_pos_gkey as long,",
						"          blk_bin_subclass as string,",
						"          blk_bin_level as short,",
						"          blk_status as string,",
						"          blk_block_type as string,",
						"          label_scheme_full_position as string,",
						"          blk_pos_name as string,",
						"          blk_pos_gkey as long,",
						"          sect_bin_subclass as string,",
						"          sect_bin_level as short,",
						"          sect_status as string,",
						"          sect_pos_name as string,",
						"          sect_pos_gkey as long,",
						"          stk_bin_subclass as string,",
						"          stk_bin_level as short,",
						"          stk_status as string,",
						"          stk_pos_name as string,",
						"          stk_pos_gkey as long,",
						"          bin_type as string,",
						"          pos_gkey as long",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'gpa',",
						"     folderPath: 'bronze/yardblock',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> source1",
						"source1 filter(Facility_Id=='GCT' && blk_status=='ACT') ~> filter1",
						"filter1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'gpa',",
						"     folderPath: 'silver/yardblock',",
						"     truncate: true,",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/YardInventory_gpa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "yardblock"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "vsl"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "invInYard"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select2"
						},
						{
							"name": "join2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ufv_gkey as long,",
						"          Facility_Id as string,",
						"          Unit_Nbr as string,",
						"          Freight_Kind_Id as string,",
						"          Category_Id as string,",
						"          Unit_Visit_State_Id as string,",
						"          Unit_Transit_State_Id as string,",
						"          Unit_In_Facility_Time as string,",
						"          Unit_Facility_Departed_Time as string,",
						"          Time_Of_Last_Move as string,",
						"          Unit_Facility_Visit_Retired as string,",
						"          Arrive_Pos_Loctype as string,",
						"          Last_Pos_Loctype as string,",
						"          LAST_POS_BIN as long,",
						"          Actual_Inbound_CV_Key as long,",
						"          Actual_Outbound_CV_Key as long,",
						"          Intended_Outbound_CV_Key as long,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          POD as string,",
						"          POL as string,",
						"          Damage_Flag as string,",
						"          Hazardous_Flag as string,",
						"          Requires_Power_Flag as short,",
						"          OOG_Flag as short",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'gpa',",
						"     folderPath: 'bronze/invInYard/load/',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> source1",
						"source(output(",
						"          Complex_Id as string,",
						"          Facility_Id as string,",
						"          Yard_Id as string,",
						"          mdl_bin_subclass as string,",
						"          mdl_bin_level as short,",
						"          mdl_status as string,",
						"          mdl_pos_name as string,",
						"          mdl_pos_gkey as long,",
						"          blk_bin_subclass as string,",
						"          blk_bin_level as short,",
						"          blk_status as string,",
						"          blk_block_type as string,",
						"          label_scheme_full_position as string,",
						"          blk_pos_name as string,",
						"          blk_pos_gkey as long,",
						"          sect_bin_subclass as string,",
						"          sect_bin_level as short,",
						"          sect_status as string,",
						"          sect_pos_name as string,",
						"          sect_pos_gkey as long,",
						"          stk_bin_subclass as string,",
						"          stk_bin_level as short,",
						"          stk_status as string,",
						"          stk_pos_name as string,",
						"          stk_pos_gkey as long,",
						"          bin_type as string,",
						"          pos_gkey as long",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'gpa',",
						"     folderPath: 'silver/yardblock') ~> yardblock",
						"source(output(",
						"          Carrier_Visit_Key as long,",
						"          Facility_Id as string,",
						"          Carrier_Visit_Id as string,",
						"          Phase as string,",
						"          Visit_Nbr as short,",
						"          Carrier_Mode as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Time_First_Availabilty as string,",
						"          Time_Discharge_Complete as string,",
						"          Service_Id as string,",
						"          Service_Name as string,",
						"          Vessel_Id as string,",
						"          IB_VYG as string,",
						"          OB_VYG as string,",
						"          Carrier_Name as string,",
						"          Vessel_Class as string,",
						"          Published_ETA as timestamp,",
						"          Published_ETD as timestamp,",
						"          Start_Work as string,",
						"          End_Work as string,",
						"          TimeFirstAvailabilty as timestamp,",
						"          StartWork as timestamp,",
						"          TimeDischargeComplete as timestamp,",
						"          EndWork as timestamp,",
						"          Week as integer,",
						"          Year as integer,",
						"          Month as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'gpa',",
						"     folderPath: 'silver/vesselvisits') ~> vsl",
						"source1 filter(Facility_Id=='GCT') ~> filter1",
						"filter1, yardblock join(LAST_POS_BIN == pos_gkey,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join2 select(mapColumn(",
						"          ufv_gkey,",
						"          Facility_Id = source1@Facility_Id,",
						"          Unit_Nbr,",
						"          Freight_Kind_Id,",
						"          Category_Id,",
						"          Unit_Visit_State_Id,",
						"          Unit_Transit_State_Id,",
						"          Unit_In_Facility_Time,",
						"          Unit_Facility_Departed_Time,",
						"          Time_Of_Last_Move,",
						"          Unit_Facility_Visit_Retired,",
						"          Arrive_Pos_Loctype,",
						"          Last_Pos_Loctype,",
						"          LAST_POS_BIN,",
						"          Actual_Inbound_CV_Key,",
						"          Actual_Outbound_CV_Key,",
						"          Intended_Outbound_CV_Key,",
						"          Goods_And_Ctr_Wt_Kg,",
						"          POD,",
						"          POL,",
						"          Damage_Flag,",
						"          Hazardous_Flag,",
						"          Requires_Power_Flag,",
						"          OOG_Flag,",
						"          Complex_Id,",
						"          mdl_status,",
						"          mdl_pos_name,",
						"          mdl_pos_gkey,",
						"          blk_bin_level,",
						"          blk_status,",
						"          blk_block_type,",
						"          label_scheme_full_position,",
						"          blk_pos_name,",
						"          blk_pos_gkey,",
						"          sect_bin_level,",
						"          sect_status,",
						"          sect_pos_name,",
						"          sect_pos_gkey,",
						"          stk_bin_level,",
						"          stk_status,",
						"          stk_pos_name,",
						"          stk_pos_gkey,",
						"          pos_gkey,",
						"          Carrier_Visit_Id,",
						"          Service_Id,",
						"          Carrier_Mode,",
						"          Vessel_Id",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"derivedColumn1 alterRow(upsertIf(true())) ~> alterRow1",
						"select1 derive(SnapshotDate = currentDate()) ~> derivedColumn1",
						"vsl select(mapColumn(",
						"          Carrier_Visit_Key,",
						"          Facility_Id,",
						"          Carrier_Visit_Id,",
						"          Phase,",
						"          Visit_Nbr,",
						"          Carrier_Mode,",
						"          Service_Id,",
						"          Service_Name,",
						"          Vessel_Id,",
						"          Carrier_Name,",
						"          Vessel_Class,",
						"          Published_ETA,",
						"          Published_ETD",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"join1, select2 join(Intended_Outbound_CV_Key == Carrier_Visit_Key,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'right')~> join2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     input(",
						"          Complex_Id as string,",
						"          Facility_Id as string,",
						"          Yard_Id as string,",
						"          mdl_bin_subclass as string,",
						"          mdl_bin_level as short,",
						"          mdl_status as string,",
						"          mdl_pos_name as string,",
						"          mdl_pos_gkey as long,",
						"          blk_bin_subclass as string,",
						"          blk_bin_level as short,",
						"          blk_status as string,",
						"          blk_block_type as string,",
						"          label_scheme_full_position as string,",
						"          blk_pos_name as string,",
						"          blk_pos_gkey as long,",
						"          sect_bin_subclass as string,",
						"          sect_bin_level as short,",
						"          sect_status as string,",
						"          sect_pos_name as string,",
						"          sect_pos_gkey as long,",
						"          stk_bin_subclass as string,",
						"          stk_bin_level as short,",
						"          stk_status as string,",
						"          stk_pos_name as string,",
						"          stk_pos_gkey as long,",
						"          bin_type as string,",
						"          pos_gkey as long",
						"     ),",
						"     format: 'delta',",
						"     fileSystem: 'gpa',",
						"     folderPath: 'silver/invInYard',",
						"     truncate: true,",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> invInYard"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Yard_che_productivity_cmsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Using Moves as source data",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1",
							"description": "Filtering rows using expressions on columns 'Fetch_CHE_Kind' and 'Put_CHE_Kind' "
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: true,\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(Fetch_CHE_Kind==\"RTG\" || Put_CHE_Kind==\"RTG\") ~> Filter1\nFilter1 derive(CarryCompleteTime = toString(t_carry_complete,'HH:mm:ss'),\n\t\tCarryCompleteDate = toDate(toString(t_carry_complete,'yyyy-MM-dd'))) ~> DerivedColumn2\nDerivedColumn2 aggregate(groupBy(Fetch_CHE_Id,\n\t\tPut_CHE_Id,\n\t\tCarryCompleteDate),\n\tFirst_Lift = min(t_carry_complete),\n\t\tLast_Lift = max(t_carry_complete),\n\t\tMove_Count = countDistinct(mve_gkey)) ~> Aggregate1\nAggregate1 derive(WorkTime = Last_Lift-First_Lift,\n\t\tYear = iifNull(year(CarryCompleteDate),0),\n\t\tMonth = iifNull(month(CarryCompleteDate),0),\n\t\tWeek = iifNull(weekOfYear(CarryCompleteDate),0)) ~> DerivedColumn4\nDerivedColumn4 alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'gold/yard_che_productivity',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Fetch_CHE_Id','Put_CHE_Id','CarryCompleteDate'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Yard_che_productivity_mict')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Using Moves as source data",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1",
							"description": "Filtering rows using expressions on columns 'Fetch_CHE_Kind' and 'Put_CHE_Kind' "
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "filter2"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: true,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(Fetch_CHE_Kind==\"RTG\" || Put_CHE_Kind==\"RTG\") ~> Filter1\nFilter1 derive(CarryCompleteTime = toString(t_carry_complete,'HH:mm:ss'),\n\t\tCarryCompleteDate = toDate(toString(t_carry_complete,'yyyy-MM-dd'))) ~> DerivedColumn2\nDerivedColumn2 aggregate(groupBy(Fetch_CHE_Id,\n\t\tPut_CHE_Id,\n\t\tCarryCompleteDate),\n\tFirst_Lift = min(t_carry_complete),\n\t\tLast_Lift = max(t_carry_complete),\n\t\tMove_Count = countDistinct(mve_gkey)) ~> Aggregate1\nAggregate1 derive(WorkTime = Last_Lift-First_Lift,\n\t\tYear = iifNull(year(CarryCompleteDate),0),\n\t\tMonth = iifNull(month(CarryCompleteDate),0),\n\t\tWeek = iifNull(weekOfYear(CarryCompleteDate),0)) ~> DerivedColumn4\nfilter2 alterRow(upsertIf(true())) ~> AlterRow1\nDerivedColumn4 filter(WorkTime > 0) ~> filter2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mict',\n\tfolderPath: 'gold/yard_che_productivity',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Fetch_CHE_Id','Put_CHE_Id','CarryCompleteDate'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Yard_che_productivity_mnhpi')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Using Moves as source data",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Filter1",
							"description": "Filtering rows using expressions on columns 'Fetch_CHE_Kind' and 'Put_CHE_Kind' "
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Aggregate1"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as short,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as integer,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as double,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as string,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as string,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: true,\n\tformat: 'delta',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'silver/moves') ~> source1\nsource1 filter(Fetch_CHE_Kind==\"RTG\" || Put_CHE_Kind==\"RTG\") ~> Filter1\nFilter1 derive(CarryCompleteTime = toString(t_carry_complete,'HH:mm:ss'),\n\t\tCarryCompleteDate = toDate(toString(t_carry_complete,'yyyy-MM-dd'))) ~> DerivedColumn2\nDerivedColumn2 aggregate(groupBy(Fetch_CHE_Id,\n\t\tPut_CHE_Id,\n\t\tCarryCompleteDate),\n\tFirst_Lift = min(t_carry_complete),\n\t\tLast_Lift = max(t_carry_complete),\n\t\tMove_Count = countDistinct(mve_gkey)) ~> Aggregate1\nAggregate1 derive(WorkTime = Last_Lift-First_Lift,\n\t\tYear = iifNull(year(CarryCompleteDate),0),\n\t\tMonth = iifNull(month(CarryCompleteDate),0),\n\t\tWeek = iifNull(weekOfYear(CarryCompleteDate),0)) ~> DerivedColumn4\nDerivedColumn4 alterRow(upsertIf(true())) ~> AlterRow1\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'mnhpi',\n\tfolderPath: 'gold/yard_che_productivity',\n\tmergeSchema: true,\n\tautoCompact: true,\n\toptimizedWrite: true,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: false,\n\tupdateable: false,\n\tupsertable: true,\n\tkeys:['Fetch_CHE_Id','Put_CHE_Id','CarryCompleteDate'],\n\tumask: 0777,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tpartitionBy('key',\n\t\t0,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/cmsa_violations')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "deckingfile"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1",
							"rejectedDataLinkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							}
						}
					],
					"transformations": [
						{
							"name": "RemoveExtraColumns"
						},
						{
							"name": "DHDeckingPos"
						},
						{
							"name": "DH4",
							"description": "RemoveTOPOSNameANDTimeStamp\n\nRemove TOPOSName\nand \nTimeStamp"
						},
						{
							"name": "MH2",
							"description": "MERemoveExtraColumns\nRenaming MoveHistory to MH2 with columns 'Unit Nbr, t_put, Event Type Id, Move Kind, From Position Name, To Position Name, Put CHE Operator Id, Put CHE Id'"
						},
						{
							"name": "MH4",
							"description": "TPutDate\nCreating/updating the columns 'Unit Nbr, t_put, Event Type Id, Move Kind, From Position Name, To Position Name, Put CHE Operator Id, Put CHE Id'"
						},
						{
							"name": "MH5",
							"description": "SortUnitId\nSorting rows on columns 'Unit Nbr, t_put'"
						},
						{
							"name": "MH6",
							"description": "MHDeckingPosName\nCreating/updating the columns 'Unit Nbr, t_put, Event Type Id, Move Kind, From Position Name, To Position Name'"
						},
						{
							"name": "DH6"
						},
						{
							"name": "DH7"
						},
						{
							"name": "DH8"
						},
						{
							"name": "DH9a"
						},
						{
							"name": "DH11"
						},
						{
							"name": "MH3"
						},
						{
							"name": "DH5"
						}
					],
					"scriptLines": [
						"source(output(",
						"          gkey as integer,",
						"          uyv_gkey as integer,",
						"          unit_id as string,",
						"          time_stamp as string,",
						"          decking_type as string,",
						"          node_id as string,",
						"          yard as string,",
						"          from_pos_loctype as string,",
						"          from_pos_locid as string,",
						"          from_pos_loc_gkey as integer,",
						"          from_pos_slot as string,",
						"          from_pos_name as string,",
						"          from_pos_bin as string,",
						"          from_pos_tier as short,",
						"          to_pos_loctype as string,",
						"          to_pos_locid as string,",
						"          to_pos_loc_gkey as integer,",
						"          to_pos_slot as string,",
						"          to_pos_name as string,",
						"          to_pos_bin as string,",
						"          to_pos_tier as short,",
						"          total_score as short,",
						"          execution_time as short,",
						"          details as string,",
						"          phase as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'cmsa-violations',",
						"     folderPath: 'bronze/violations-decking/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> deckingfile",
						"source(output(",
						"          {Unit Nbr} as string,",
						"          {Facility Id} as string,",
						"          {Complex Id} as string,",
						"          {Yard Id} as string,",
						"          {Carrier Visit Key} as string,",
						"          {Event Type Id} as string,",
						"          {Move Kind} as string,",
						"          {From Location} as string,",
						"          {To Location} as string,",
						"          {From Position Name} as string,",
						"          {To Position Name} as string,",
						"          {Carry CHE Operator Id} as string,",
						"          {Fetch CHE Operator Id} as string,",
						"          {Put CHE Operator Id} as string,",
						"          {Fetch CHE Id} as string,",
						"          {Fetch CHE Kind} as string,",
						"          {Carry CHE Id} as string,",
						"          {Carry CHE Kind} as string,",
						"          {Put CHE Id} as string,",
						"          {Put CHE Kind} as string,",
						"          {QC CHE Id} as string,",
						"          {QC CHE Kind} as string,",
						"          t_carry_complete as string,",
						"          t_put as string,",
						"          t_fetch as string,",
						"          t_dispatch as string,",
						"          t_discharge as string,",
						"          t_carry_dispatch as string,",
						"          t_carry_fetch_ready as string,",
						"          t_carry_put_ready as string,",
						"          dist_carry as short,",
						"          dist_start as short,",
						"          {Twin Fetch} as boolean,",
						"          {Twin Carry} as boolean,",
						"          {Twin Put} as boolean,",
						"          {Category Id} as string,",
						"          {Freight Kind Id} as string,",
						"          to_pos_gkey as string,",
						"          fm_pos_gkey as string,",
						"          {Restow Reason} as string,",
						"          {Container Line Id} as string,",
						"          {Container Line Role} as string,",
						"          pow as string,",
						"          mve_gkey as integer,",
						"          ufv_gkey as integer,",
						"          {Berth Id} as string,",
						"          {Goods And Ctr Wt Kg} as double,",
						"          active_ufv as integer,",
						"          {Requires Power Flag} as boolean,",
						"          {OOG Flag} as boolean,",
						"          {Shipper Id} as string,",
						"          {Consignee Id} as string,",
						"          {Commodity Id} as string,",
						"          ATA as string,",
						"          ATD as string,",
						"          Rehandles as short",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'cmsa-violations',",
						"     folderPath: 'bronze/violations-moves/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> MoveHistory",
						"deckingfile select(mapColumn(",
						"          gkey,",
						"          unit_id,",
						"          time_stamp,",
						"          decking_type,",
						"          to_pos_name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> RemoveExtraColumns",
						"RemoveExtraColumns derive(DeckingPosName = substring(to_pos_name,8),",
						"          DeckingDateTime = toTimestamp(time_stamp,'yyyy mm dd HH:mm:ss.SSS'),",
						"          Decking_Time_Outer_Limit = toTimestamp(time_stamp,'yyyy mm dd HH:mm:ss.SSS') + hours(5)) ~> DHDeckingPos",
						"DHDeckingPos select(mapColumn(",
						"          Gkey = gkey,",
						"          Unit_Id = unit_id,",
						"          Decking_Date_Time = DeckingDateTime,",
						"          Decking_Type = decking_type,",
						"          Decking_Pos_Name = DeckingPosName,",
						"          Decking_Time_Outer_Limit",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> DH4",
						"MoveHistory select(mapColumn(",
						"          Unit_Nbr = {Unit Nbr},",
						"          T_Put = t_put,",
						"          Event_Type_Id = {Event Type Id},",
						"          Move_Kind = {Move Kind},",
						"          From_Position_Name = {From Position Name},",
						"          To_Position_Name = {To Position Name},",
						"          Put_CHE_Operator_Id = {Put CHE Operator Id},",
						"          Put_CHE_Id = {Put CHE Id}",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> MH2",
						"MH3 derive(MH_Date = toTimestamp(T_Put,'yyyy mm dd HH:mm:ss.SSS'),",
						"          MH_Date_Less_3_Hours = toTimestamp(T_Put,'yyyy mm dd HH:mm:ss.SSS') - hours(3)) ~> MH4",
						"MH4 sort(asc(Unit_Nbr, true),",
						"     asc(MH_Date, true)) ~> MH5",
						"MH5 derive(To_Position_Name = substring(To_Position_Name,8)) ~> MH6",
						"DH5, MH6 join(Unit_Id == Unit_Nbr,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'right')~> DH6",
						"DH6 select(mapColumn(",
						"          Gkey,",
						"          Unit_Id,",
						"          Decking_Date_Time,",
						"          Decking_Type,",
						"          Decking_Pos_Name,",
						"          Decking_Time_Outer_Limit,",
						"          Unit_Nbr,",
						"          T_Put,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Position_Name,",
						"          To_Position_Name,",
						"          Put_CHE_Operator_Id,",
						"          Put_CHE_Id,",
						"          MH_Date,",
						"          MH_Date_Less_3_Hours",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> DH7",
						"DH7 window(over({Unit Id} = Unit_Id),",
						"     asc(Unit_Id, true),",
						"     asc(Decking_Date_Time, true),",
						"     Unit_Id_Row_Num = rowNumber()) ~> DH8",
						"DH8 derive(Time_Gap_in_Minutes = round((MH_Date-Decking_Date_Time)/(1000*60),2),",
						"          Pass_01_POS_Name_Match = iif(Decking_Pos_Name==To_Position_Name, 'PASS', 'FAIL'),",
						"          Decking_Type_To_be_Used_or_Not = iif(\r",
						"Decking_Type=='Vessel Discharge' && Move_Kind=='RECV', 'FAIL', \r",
						"     iif(\r",
						"     Decking_Type=='Vessel Discharge' && Move_Kind=='DSCH', 'PASS',\r",
						"          iif(\r",
						"          Decking_Type=='XD Rehandle Request' && Move_Kind=='RECV', 'FAIL', \r",
						"               iif(\r",
						"               Decking_Type=='XD Rehandle Request' && Move_Kind=='RECV', 'FAIL',\r",
						"                    iif(\r",
						"                    Decking_Type=='Gate Receival Assign Position' && Move_Kind=='RECV', 'PASS',\r",
						"                         iif(\r",
						"                         Decking_Type=='Gate Receival Assign Position' && Move_Kind=='RECV', 'FAIL', \r",
						"                              iif(\r",
						"                              Decking_Type=='XD Refine Request' && Move_Kind=='RECV', 'PASS', \r",
						"                                   iif(\r",
						"                                   Decking_Type=='XD Refine Request' && Move_Kind=='RECV', 'PASS',\r",
						"                                        iif(\r",
						"                                        Decking_Type=='XD Drop if Floating Refinen' && Move_Kind=='RECV', 'PASS',\r",
						"                                             iif(\r",
						"                                             Decking_Type=='XD Drop if Floating Refine' && Move_Kind=='RECV', 'PASS',\r",
						"                                                  iif(\r",
						"                                                  Decking_Type=='Bump Intruder' && Move_Kind=='RECV', 'PASS',\r",
						"                                                       iif(\r",
						"                                                       Decking_Type=='Bump Intruder' && Move_Kind=='RECV', 'PASS',\r",
						"                                                            iif(\r",
						"                                                            Decking_Type=='User <Ctrl>-A' && Move_Kind=='RECV', 'FAIL',\r",
						"                                                                 iif(\r",
						"                                                                 Decking_Type=='User <Ctrl>-A' && Move_Kind=='RECV', 'FAIL'\r",
						"                                                                      ,'FAIL'\r",
						"                                                                      )\r",
						"                                                                 )\r",
						"                                                            )\r",
						"                                                       )\r",
						"                                                  )\r",
						"                                             )\r",
						"                                        )\r",
						"                                   )     \r",
						"                              )\r",
						"                         )\r",
						"                    )\r",
						"               )\r",
						"          )\r",
						"     ),",
						"          DH_To_Pos_Name = substring(Decking_Pos_Name, 1, 5),",
						"          MH_To_POS_Name = substring(To_Position_Name, 1, 5)) ~> DH9a",
						"DH9a alterRow(insertIf(true())) ~> DH11",
						"MH2 filter((Move_Kind == 'RECV' || Move_Kind == 'DSCH')) ~> MH3",
						"DH4 filter(Decking_Pos_Name!='FLD') ~> DH5",
						"DH11 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmsa-violations',",
						"     folderPath: 'silver/cmsa-violations-output',",
						"     deltaTruncate: true,",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     keys:['gkey'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     mapColumn(",
						"          Gkey,",
						"          Unit_Id,",
						"          Decking_Date_Time,",
						"          Decking_Type,",
						"          Decking_Pos_Name,",
						"          Decking_Time_Outer_Limit,",
						"          Unit_Nbr,",
						"          T_Put,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Position_Name,",
						"          To_Position_Name,",
						"          Put_CHE_Operator_Id,",
						"          Put_CHE_Id,",
						"          MH_Date,",
						"          MH_Date_Less_3_Hours,",
						"          Unit_Id_Row_Num,",
						"          Time_Gap_in_Minutes,",
						"          Pass_01_POS_Name_Match,",
						"          Decking_Type_To_be_Used_or_Not,",
						"          DH_To_Pos_Name,",
						"          MH_To_POS_Name",
						"     )) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/cmsa_violations__upto_merge')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "deckingfile"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "DHSink",
							"rejectedDataLinkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							}
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "MHSink",
							"rejectedDataLinkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							}
						}
					],
					"transformations": [
						{
							"name": "RemoveExtraColumns"
						},
						{
							"name": "DHDeckingPos"
						},
						{
							"name": "DH4",
							"description": "RemoveTOPOSNameANDTimeStamp\n\nRemove TOPOSName\nand \nTimeStamp"
						},
						{
							"name": "MH2",
							"description": "MERemoveExtraColumns\nRenaming MoveHistory to MH2 with columns 'Unit Nbr, t_put, Event Type Id, Move Kind, From Position Name, To Position Name, Put CHE Operator Id, Put CHE Id'"
						},
						{
							"name": "MH4",
							"description": "TPutDate\nCreating/updating the columns 'Unit Nbr, t_put, Event Type Id, Move Kind, From Position Name, To Position Name, Put CHE Operator Id, Put CHE Id'"
						},
						{
							"name": "MH5",
							"description": "SortUnitId\nSorting rows on columns 'Unit Nbr, t_put'"
						},
						{
							"name": "MH6",
							"description": "MHDeckingPosName\nCreating/updating the columns 'Unit Nbr, t_put, Event Type Id, Move Kind, From Position Name, To Position Name'"
						},
						{
							"name": "DH6"
						},
						{
							"name": "DH7"
						},
						{
							"name": "DH11"
						},
						{
							"name": "MH3"
						},
						{
							"name": "DH5"
						},
						{
							"name": "MH7Alter"
						}
					],
					"scriptLines": [
						"source(output(",
						"          gkey as integer,",
						"          uyv_gkey as integer,",
						"          unit_id as string,",
						"          time_stamp as string,",
						"          decking_type as string,",
						"          node_id as string,",
						"          yard as string,",
						"          from_pos_loctype as string,",
						"          from_pos_locid as string,",
						"          from_pos_loc_gkey as integer,",
						"          from_pos_slot as string,",
						"          from_pos_name as string,",
						"          from_pos_bin as string,",
						"          from_pos_tier as short,",
						"          to_pos_loctype as string,",
						"          to_pos_locid as string,",
						"          to_pos_loc_gkey as integer,",
						"          to_pos_slot as string,",
						"          to_pos_name as string,",
						"          to_pos_bin as string,",
						"          to_pos_tier as short,",
						"          total_score as short,",
						"          execution_time as short,",
						"          details as string,",
						"          phase as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'cmsa-violations',",
						"     folderPath: 'bronze/violations-decking/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> deckingfile",
						"source(output(",
						"          {Unit Nbr} as string,",
						"          {Facility Id} as string,",
						"          {Complex Id} as string,",
						"          {Yard Id} as string,",
						"          {Carrier Visit Key} as string,",
						"          {Event Type Id} as string,",
						"          {Move Kind} as string,",
						"          {From Location} as string,",
						"          {To Location} as string,",
						"          {From Position Name} as string,",
						"          {To Position Name} as string,",
						"          {Carry CHE Operator Id} as string,",
						"          {Fetch CHE Operator Id} as string,",
						"          {Put CHE Operator Id} as string,",
						"          {Fetch CHE Id} as string,",
						"          {Fetch CHE Kind} as string,",
						"          {Carry CHE Id} as string,",
						"          {Carry CHE Kind} as string,",
						"          {Put CHE Id} as string,",
						"          {Put CHE Kind} as string,",
						"          {QC CHE Id} as string,",
						"          {QC CHE Kind} as string,",
						"          t_carry_complete as string,",
						"          t_put as string,",
						"          t_fetch as string,",
						"          t_dispatch as string,",
						"          t_discharge as string,",
						"          t_carry_dispatch as string,",
						"          t_carry_fetch_ready as string,",
						"          t_carry_put_ready as string,",
						"          dist_carry as short,",
						"          dist_start as short,",
						"          {Twin Fetch} as boolean,",
						"          {Twin Carry} as boolean,",
						"          {Twin Put} as boolean,",
						"          {Category Id} as string,",
						"          {Freight Kind Id} as string,",
						"          to_pos_gkey as string,",
						"          fm_pos_gkey as string,",
						"          {Restow Reason} as string,",
						"          {Container Line Id} as string,",
						"          {Container Line Role} as string,",
						"          pow as string,",
						"          mve_gkey as integer,",
						"          ufv_gkey as integer,",
						"          {Berth Id} as string,",
						"          {Goods And Ctr Wt Kg} as double,",
						"          active_ufv as integer,",
						"          {Requires Power Flag} as boolean,",
						"          {OOG Flag} as boolean,",
						"          {Shipper Id} as string,",
						"          {Consignee Id} as string,",
						"          {Commodity Id} as string,",
						"          ATA as string,",
						"          ATD as string,",
						"          Rehandles as short",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'cmsa-violations',",
						"     folderPath: 'bronze/violations-moves/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> MoveHistory",
						"deckingfile select(mapColumn(",
						"          gkey,",
						"          unit_id,",
						"          time_stamp,",
						"          decking_type,",
						"          to_pos_name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> RemoveExtraColumns",
						"RemoveExtraColumns derive(DeckingPosName = substring(to_pos_name,8),",
						"          DeckingDateTime = toTimestamp(time_stamp,'yyyy mm dd HH:mm:ss.SSS'),",
						"          Decking_Time_Outer_Limit = toTimestamp(time_stamp,'yyyy mm dd HH:mm:ss.SSS') + hours(5)) ~> DHDeckingPos",
						"DHDeckingPos select(mapColumn(",
						"          Gkey = gkey,",
						"          Unit_Id = unit_id,",
						"          Decking_Date_Time = DeckingDateTime,",
						"          Decking_Type = decking_type,",
						"          Decking_Pos_Name = DeckingPosName,",
						"          Decking_Time_Outer_Limit",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> DH4",
						"MoveHistory select(mapColumn(",
						"          Unit_Nbr = {Unit Nbr},",
						"          T_Put = t_put,",
						"          Event_Type_Id = {Event Type Id},",
						"          Move_Kind = {Move Kind},",
						"          From_Position_Name = {From Position Name},",
						"          To_Position_Name = {To Position Name},",
						"          Put_CHE_Operator_Id = {Put CHE Operator Id},",
						"          Put_CHE_Id = {Put CHE Id}",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> MH2",
						"MH3 derive(MH_Date = toTimestamp(T_Put,'yyyy mm dd HH:mm:ss.SSS'),",
						"          MH_Date_Less_3_Hours = toTimestamp(T_Put,'yyyy mm dd HH:mm:ss.SSS') - hours(3)) ~> MH4",
						"MH4 sort(asc(Unit_Nbr, true),",
						"     asc(MH_Date, true)) ~> MH5",
						"MH5 derive(To_Position_Name = substring(To_Position_Name,8)) ~> MH6",
						"DH5, MH6 join(Unit_Id == Unit_Nbr,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'right')~> DH6",
						"DH6 select(mapColumn(",
						"          Gkey,",
						"          Unit_Id,",
						"          Decking_Date_Time,",
						"          Decking_Type,",
						"          Decking_Pos_Name,",
						"          Decking_Time_Outer_Limit,",
						"          Unit_Nbr,",
						"          T_Put,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Position_Name,",
						"          To_Position_Name,",
						"          Put_CHE_Operator_Id,",
						"          Put_CHE_Id,",
						"          MH_Date,",
						"          MH_Date_Less_3_Hours",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> DH7",
						"DH7 alterRow(insertIf(true())) ~> DH11",
						"MH2 filter((Move_Kind == 'RECV' || Move_Kind == 'DSCH')) ~> MH3",
						"DH4 filter(Decking_Pos_Name!='FLD') ~> DH5",
						"MH6 alterRow(upsertIf(true())) ~> MH7Alter",
						"DH11 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     input(",
						"          gkey as integer,",
						"          Unit_Id as string,",
						"          Decking_Date_Time as timestamp,",
						"          Decking_Type as string,",
						"          DH_To_Pos_Name as string,",
						"          MH_Move_Kind as string,",
						"          MH_To_POS_Name as string,",
						"          Previous_Row_Decking_Date_Time as timestamp,",
						"          Unit_Id_Row_Num as integer,",
						"          Time_Gap_in_Minutes as double,",
						"          Pass_01_POS_Name_Match as string,",
						"          Decking_Type_To_be_Used_or_Not as string",
						"     ),",
						"     format: 'delta',",
						"     fileSystem: 'cmsa-violations',",
						"     folderPath: 'silver/cmsa-violations-output',",
						"     deltaTruncate: true,",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     keys:['gkey'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> DHSink",
						"MH7Alter sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmsa-violations',",
						"     folderPath: 'silver/cmsa-violations-output',",
						"     deltaTruncate: true,",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> MHSink"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/cmsa_violations_test_DH6')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "deckingfile"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1",
							"rejectedDataLinkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							}
						}
					],
					"transformations": [
						{
							"name": "RemoveExtraColumns"
						},
						{
							"name": "DHDeckingPos"
						},
						{
							"name": "DH4",
							"description": "RemoveTOPOSNameANDTimeStamp\n\nRemove TOPOSName\nand \nTimeStamp"
						},
						{
							"name": "MH2",
							"description": "MERemoveExtraColumns\nRenaming MoveHistory to MH2 with columns 'Unit Nbr, t_put, Event Type Id, Move Kind, From Position Name, To Position Name, Put CHE Operator Id, Put CHE Id'"
						},
						{
							"name": "MH4",
							"description": "TPutDate\nCreating/updating the columns 'Unit Nbr, t_put, Event Type Id, Move Kind, From Position Name, To Position Name, Put CHE Operator Id, Put CHE Id'"
						},
						{
							"name": "MH5",
							"description": "SortUnitId\nSorting rows on columns 'Unit Nbr, t_put'"
						},
						{
							"name": "MH6",
							"description": "MHDeckingPosName\nCreating/updating the columns 'Unit Nbr, t_put, Event Type Id, Move Kind, From Position Name, To Position Name'"
						},
						{
							"name": "DH6"
						},
						{
							"name": "DH11"
						},
						{
							"name": "MH3"
						},
						{
							"name": "DH5"
						}
					],
					"scriptLines": [
						"source(output(",
						"          gkey as integer,",
						"          uyv_gkey as integer,",
						"          unit_id as string,",
						"          time_stamp as string,",
						"          decking_type as string,",
						"          node_id as string,",
						"          yard as string,",
						"          from_pos_loctype as string,",
						"          from_pos_locid as string,",
						"          from_pos_loc_gkey as integer,",
						"          from_pos_slot as string,",
						"          from_pos_name as string,",
						"          from_pos_bin as string,",
						"          from_pos_tier as short,",
						"          to_pos_loctype as string,",
						"          to_pos_locid as string,",
						"          to_pos_loc_gkey as integer,",
						"          to_pos_slot as string,",
						"          to_pos_name as string,",
						"          to_pos_bin as string,",
						"          to_pos_tier as short,",
						"          total_score as short,",
						"          execution_time as short,",
						"          details as string,",
						"          phase as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'cmsa-violations',",
						"     folderPath: 'bronze/violations-decking/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> deckingfile",
						"source(output(",
						"          {Unit Nbr} as string,",
						"          {Facility Id} as string,",
						"          {Complex Id} as string,",
						"          {Yard Id} as string,",
						"          {Carrier Visit Key} as string,",
						"          {Event Type Id} as string,",
						"          {Move Kind} as string,",
						"          {From Location} as string,",
						"          {To Location} as string,",
						"          {From Position Name} as string,",
						"          {To Position Name} as string,",
						"          {Carry CHE Operator Id} as string,",
						"          {Fetch CHE Operator Id} as string,",
						"          {Put CHE Operator Id} as string,",
						"          {Fetch CHE Id} as string,",
						"          {Fetch CHE Kind} as string,",
						"          {Carry CHE Id} as string,",
						"          {Carry CHE Kind} as string,",
						"          {Put CHE Id} as string,",
						"          {Put CHE Kind} as string,",
						"          {QC CHE Id} as string,",
						"          {QC CHE Kind} as string,",
						"          t_carry_complete as string,",
						"          t_put as string,",
						"          t_fetch as string,",
						"          t_dispatch as string,",
						"          t_discharge as string,",
						"          t_carry_dispatch as string,",
						"          t_carry_fetch_ready as string,",
						"          t_carry_put_ready as string,",
						"          dist_carry as short,",
						"          dist_start as short,",
						"          {Twin Fetch} as boolean,",
						"          {Twin Carry} as boolean,",
						"          {Twin Put} as boolean,",
						"          {Category Id} as string,",
						"          {Freight Kind Id} as string,",
						"          to_pos_gkey as string,",
						"          fm_pos_gkey as string,",
						"          {Restow Reason} as string,",
						"          {Container Line Id} as string,",
						"          {Container Line Role} as string,",
						"          pow as string,",
						"          mve_gkey as integer,",
						"          ufv_gkey as integer,",
						"          {Berth Id} as string,",
						"          {Goods And Ctr Wt Kg} as double,",
						"          active_ufv as integer,",
						"          {Requires Power Flag} as boolean,",
						"          {OOG Flag} as boolean,",
						"          {Shipper Id} as string,",
						"          {Consignee Id} as string,",
						"          {Commodity Id} as string,",
						"          ATA as string,",
						"          ATD as string,",
						"          Rehandles as short",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'cmsa-violations',",
						"     folderPath: 'bronze/violations-moves/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> MoveHistory",
						"deckingfile select(mapColumn(",
						"          gkey,",
						"          unit_id,",
						"          time_stamp,",
						"          decking_type,",
						"          to_pos_name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> RemoveExtraColumns",
						"RemoveExtraColumns derive(DeckingPosName = substring(to_pos_name,8),",
						"          DeckingDateTime = toTimestamp(time_stamp,'yyyy mm dd HH:mm:ss.SSS'),",
						"          Decking_Time_Outer_Limit = toTimestamp(time_stamp,'yyyy mm dd HH:mm:ss.SSS') + hours(5)) ~> DHDeckingPos",
						"DHDeckingPos select(mapColumn(",
						"          Gkey = gkey,",
						"          Unit_Id = unit_id,",
						"          Decking_Date_Time = DeckingDateTime,",
						"          Decking_Type = decking_type,",
						"          Decking_Pos_Name = DeckingPosName,",
						"          Decking_Time_Outer_Limit",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> DH4",
						"MoveHistory select(mapColumn(",
						"          Unit_Nbr = {Unit Nbr},",
						"          T_Put = t_put,",
						"          Event_Type_Id = {Event Type Id},",
						"          Move_Kind = {Move Kind},",
						"          From_Position_Name = {From Position Name},",
						"          To_Position_Name = {To Position Name},",
						"          Put_CHE_Operator_Id = {Put CHE Operator Id},",
						"          Put_CHE_Id = {Put CHE Id}",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> MH2",
						"MH3 derive(MH_Date = toTimestamp(T_Put,'yyyy mm dd HH:mm:ss.SSS'),",
						"          MH_Date_Less_3_Hours = toTimestamp(T_Put,'yyyy mm dd HH:mm:ss.SSS') - hours(3)) ~> MH4",
						"MH4 sort(asc(Unit_Nbr, true),",
						"     asc(MH_Date, true)) ~> MH5",
						"MH5 derive(To_Position_Name = substring(To_Position_Name,8)) ~> MH6",
						"DH5, MH6 join(Unit_Id == Unit_Nbr",
						"     && Decking_Date_Time >= MH_Date_Less_3_Hours",
						"     && Decking_Date_Time <= MH_Date,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'left')~> DH6",
						"DH6 alterRow(insertIf(true())) ~> DH11",
						"MH2 filter((Move_Kind == 'RECV' || Move_Kind == 'DSCH')) ~> MH3",
						"DH4 filter(Decking_Pos_Name!='FLD') ~> DH5",
						"DH11 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmsa-violations',",
						"     folderPath: 'silver/DH6Test',",
						"     deltaTruncate: true,",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     keys:['gkey'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     mapColumn(",
						"          Gkey,",
						"          Unit_Id,",
						"          Decking_Date_Time,",
						"          Decking_Type,",
						"          Decking_Pos_Name,",
						"          Decking_Time_Outer_Limit,",
						"          Unit_Nbr,",
						"          T_Put,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Position_Name,",
						"          To_Position_Name,",
						"          Put_CHE_Operator_Id,",
						"          Put_CHE_Id,",
						"          MH_Date",
						"     )) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/delete_flow_mnhpi')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "violation"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "moves"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "decking"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "rehandle"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "ttprod"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "movesrc"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink2"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink3"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "alterRow2"
						},
						{
							"name": "filter3"
						},
						{
							"name": "alterRow3"
						}
					],
					"scriptLines": [
						"source(output(",
						"          D_H_Decking_Type as string,",
						"          MH_ToPosName_Short_5Char as string,",
						"          DH_ToPosName_Short_5Char as string,",
						"          MH_Unit_Nbr as string,",
						"          MH_Move_Kind as string,",
						"          Category_Id as string,",
						"          MH_T_Put_DateTime as timestamp,",
						"          MH_Put_CHE_Operator_Id as string,",
						"          mve_gkey as integer,",
						"          MH_Put_CHE_Id as short,",
						"          Freight_Kind_Id as string,",
						"          MaxDHTime as timestamp,",
						"          Location_Match_or_Not as string,",
						"          Shift_Id as string,",
						"          Shift_Date as date,",
						"          Week_of_Year as integer,",
						"          {XPS_ECUser.name} as string,",
						"          Block_To_Block_Violation as boolean,",
						"          Same_Block_Violation as boolean,",
						"          Stack_Violation as boolean",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'gold/violation') ~> violation",
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Position_Name as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Put_CHE_Id as short,",
						"          MH_T_Put_DateTime as timestamp,",
						"          Freight_Kind_Id as string,",
						"          Category_Id as string,",
						"          ufv_gkey as integer,",
						"          Year_Month as integer,",
						"          Year_Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'gold/move') ~> moves",
						"source(output(",
						"          gkey as integer,",
						"          unit_id as string,",
						"          DH_TimeStamp as timestamp,",
						"          Decking_Type as string,",
						"          to_pos_name as string,",
						"          Year_Month as integer,",
						"          Year_Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'gold/decking') ~> decking",
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          t_put as timestamp,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          Date as date,",
						"          Year_Week as integer,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'gold/rehandle') ~> rehandle",
						"source(output(",
						"          Carry_CHE_Id as long,",
						"          CarryCompleteDate as date,",
						"          First_Lift as timestamp,",
						"          Last_Lift as timestamp,",
						"          Move_Count as long,",
						"          WorkTime as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'gold/tt_productivity') ~> ttprod",
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as integer,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as short,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as integer,",
						"          dist_start as short,",
						"          Twin_Fetch as string,",
						"          Twin_Carry as string,",
						"          Twin_Put as string,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as string,",
						"          OOG_Flag as string,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'silver/moves') ~> movesrc",
						"violation filter(Week_of_Year <= 202431) ~> filter1",
						"filter1 alterRow(upsertIf(true())) ~> alterRow1",
						"moves filter(Year_Week <= 202431) ~> filter2",
						"filter2 alterRow(upsertIf(true())) ~> alterRow2",
						"decking filter(Year_Week <= 202431) ~> filter3",
						"filter3 alterRow(upsertIf(true())) ~> alterRow3",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'gold/violations',",
						"     overwrite: true,",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: true,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['mve_gkey','MH_T_Put_DateTime','Shift_Date','Week_of_Year'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1",
						"alterRow2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'gold/moves',",
						"     overwrite: true,",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: true,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink2",
						"alterRow3 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'gold/deckings',",
						"     overwrite: true,",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: true,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink3"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/delete_flow_sgtd')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "violation"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "moves"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "decking"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink2"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink3"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "alterRow2"
						},
						{
							"name": "filter3"
						},
						{
							"name": "alterRow3"
						}
					],
					"scriptLines": [
						"source(output(",
						"          D_H_Decking_Type as string,",
						"          MH_ToPosName_Short_5Char as string,",
						"          DH_ToPosName_Short_5Char as string,",
						"          MH_Unit_Nbr as string,",
						"          MH_Move_Kind as string,",
						"          Category_Id as string,",
						"          MH_T_Put_DateTime as timestamp,",
						"          MH_Put_CHE_Operator_Id as string,",
						"          mve_gkey as integer,",
						"          MH_Put_CHE_Id as short,",
						"          Freight_Kind_Id as string,",
						"          MaxDHTime as timestamp,",
						"          Location_Match_or_Not as string,",
						"          Shift_Id as string,",
						"          Shift_Date as date,",
						"          Week_of_Year as integer,",
						"          {XPS_ECUser.name} as string,",
						"          Block_To_Block_Violation as boolean,",
						"          Same_Block_Violation as boolean,",
						"          Stack_Violation as boolean",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'gold/violation') ~> violation",
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Position_Name as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Put_CHE_Id as short,",
						"          MH_T_Put_DateTime as timestamp,",
						"          Freight_Kind_Id as string,",
						"          Category_Id as string,",
						"          ufv_gkey as integer,",
						"          Year_Month as integer,",
						"          Year_Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'gold/move') ~> moves",
						"source(output(",
						"          gkey as integer,",
						"          unit_id as string,",
						"          DH_TimeStamp as timestamp,",
						"          Decking_Type as string,",
						"          to_pos_name as string,",
						"          Year_Month as integer,",
						"          Year_Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'gold/decking') ~> decking",
						"violation filter((Shift_Date < toDate(\"01-08-2025\",\"dd-MM-yyyy\")) && (not(isNull(Shift_Date)))) ~> filter1",
						"filter1 alterRow(upsertIf(true())) ~> alterRow1",
						"moves filter((toDate(MH_T_Put_DateTime) < toDate(\"01-08-2025\",\"dd-MM-yyyy\"))  && (not(isNull(toDate(MH_T_Put_DateTime))))) ~> filter2",
						"filter2 alterRow(upsertIf(true())) ~> alterRow2",
						"decking filter((toDate(DH_TimeStamp) < toDate(\"01-08-2025\",\"dd-MM-yyyy\")) && (not(isNull(toDate(DH_TimeStamp))))) ~> filter3",
						"filter3 alterRow(upsertIf(true())) ~> alterRow3",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'gold/violations',",
						"     overwrite: true,",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: true,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1",
						"alterRow2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'gold/moves',",
						"     overwrite: true,",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: true,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink2",
						"alterRow3 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'gold/deckings',",
						"     overwrite: true,",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: true,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink3"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/delete_flow_sgtd_ecevents')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "moves"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "ecevents"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink2"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink3"
						}
					],
					"transformations": [
						{
							"name": "filter2"
						},
						{
							"name": "alterRow2"
						},
						{
							"name": "filter3"
						},
						{
							"name": "alterRow3"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as integer,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as short,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as integer,",
						"          dist_start as short,",
						"          Twin_Fetch as string,",
						"          Twin_Carry as string,",
						"          Twin_Put as string,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as string,",
						"          OOG_Flag as string,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'silver/moves') ~> moves",
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as integer,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          workAssignment as long,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          lastEstMoveTime as string,",
						"          EcEventTime as timestamp,",
						"          cheID as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'silver/ecevents_v2') ~> ecevents",
						"moves filter(not(isNull(t_put)) && (toDate(t_put) <= toDate(\"11-06-2025\", \"dd-MM-yyyy\")) && (toDate(t_put) <= toDate(\"01-08-2025\", \"dd-MM-yyyy\"))) ~> filter2",
						"filter2 alterRow(upsertIf(true())) ~> alterRow2",
						"ecevents filter(not(isNull(EcEventTime))) ~> filter3",
						"filter3 alterRow(upsertIf(true())) ~> alterRow3",
						"alterRow2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'silver/move',",
						"     overwrite: true,",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: true,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink2",
						"alterRow3 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'silver/ecevent_v2',",
						"     overwrite: true,",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: true,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink3"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/dpw_peru_moves_time_delta')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "dpw"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink2"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "split1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as integer,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as short,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as integer,",
						"          dist_start as short,",
						"          Twin_Fetch as string,",
						"          Twin_Carry as string,",
						"          Twin_Put as string,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as string,",
						"          OOG_Flag as string,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'dpw-peru',",
						"     folderPath: 'silver/moves') ~> dpw",
						"filter1 derive(exec_delta_16 = iif(:exec_time > 16, true(), false()),",
						"          t_execution_delta = :exec_time,",
						"          exec_time := (t_carry_complete - t_fetch)/60000) ~> derivedColumn1",
						"dpw filter(Carry_CHE_Kind==\"ITV\") ~> filter1",
						"derivedColumn1 select(mapColumn(",
						"          mve_gkey,",
						"          Unit_Nbr,",
						"          Facility_Id,",
						"          Yard_Id,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Location,",
						"          To_Location,",
						"          From_Position_Name,",
						"          To_Position_Name,",
						"          Carry_CHE_Kind,",
						"          t_carry_complete,",
						"          t_put,",
						"          t_fetch,",
						"          Category_Id,",
						"          Freight_Kind_Id,",
						"          pow,",
						"          Commodity_Id,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          exec_delta_16,",
						"          t_execution_delta",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"filter2 alterRow(upsertIf(true())) ~> alterRow1",
						"select1 filter((t_execution_delta >= 0.0) || (t_execution_delta >= 0)) ~> filter2",
						"alterRow1 split(Event_Type_Id == \"UNIT_LOAD\",",
						"     Event_Type_Id == \"UNIT_DISCH\",",
						"     disjoint: false) ~> split1@(load, discharge)",
						"split1@load sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'dpw-peru',",
						"     folderPath: 'gold/load_time_delta',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1",
						"split1@discharge sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'dpw-peru',",
						"     folderPath: 'gold/dsch_time_delta',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink2"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/failtodeck_mict')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "DeckingHistory"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "decking"
						}
					],
					"transformations": [
						{
							"name": "select2"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "AlterRow2"
						},
						{
							"name": "select6"
						},
						{
							"name": "aggregate2"
						},
						{
							"name": "filter5"
						}
					],
					"scriptLines": [
						"source(output(",
						"          Gkey as integer,",
						"          uyv_gkey as integer,",
						"          unit_id as string,",
						"          time_stamp as timestamp,",
						"          decking_type as string,",
						"          node_id as string,",
						"          Yard as string,",
						"          from_pos_loctype as string,",
						"          from_pos_locid as string,",
						"          from_pos_loc_gkey as integer,",
						"          from_pos_slot as string,",
						"          from_pos_name as string,",
						"          from_pos_bin as integer,",
						"          from_pos_tier as short,",
						"          to_pos_loctype as string,",
						"          to_pos_locid as string,",
						"          to_pos_loc_gkey as integer,",
						"          to_pos_slot as string,",
						"          to_pos_name as string,",
						"          to_pos_bin as short,",
						"          to_pos_tier as string,",
						"          total_score as short,",
						"          execution_time as short,",
						"          Details as string,",
						"          Phase as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/deckinghistory/load','bronze/deckinghistory/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'mict',",
						"     folderPath: 'bronze/deckinghistory/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> DeckingHistory",
						"DeckingHistory select(mapColumn(",
						"          gkey = Gkey,",
						"          uyv_gkey,",
						"          unit_id,",
						"          time_stamp,",
						"          decking_type,",
						"          node_id,",
						"          Yard,",
						"          from_pos_loctype,",
						"          from_pos_locid,",
						"          from_pos_slot,",
						"          from_pos_name,",
						"          to_pos_loctype,",
						"          to_pos_locid,",
						"          to_pos_slot,",
						"          to_pos_name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"filter5 derive(Year_Month = (year(time_stamp) * 100) + month(time_stamp),",
						"          Year_Week = (year(time_stamp) * 100) + weekOfYear(time_stamp)) ~> derivedColumn2",
						"select6 alterRow(upsertIf(true())) ~> AlterRow2",
						"derivedColumn2 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select6",
						"select2 aggregate(groupBy(gkey),",
						"     each(match(name!='gkey'), $$ = first($$))) ~> aggregate2",
						"aggregate2 filter(not(isNull(gkey)) && to_pos_locid == \"DCT\") ~> filter5",
						"AlterRow2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mict',",
						"     folderPath: 'gold/failtodeck',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> decking"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/hazira_moves_time_delta')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "hazira"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink2"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "split1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as integer,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as short,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as integer,",
						"          dist_start as short,",
						"          Twin_Fetch as string,",
						"          Twin_Carry as string,",
						"          Twin_Put as string,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as string,",
						"          OOG_Flag as string,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'hazira',",
						"     folderPath: 'silver/moves') ~> hazira",
						"filter1 derive(exec_delta_16 = iif(:exec_time > 16, true(), false()),",
						"          t_execution_delta = :exec_time,",
						"          exec_time := (t_carry_complete - t_fetch)/60000) ~> derivedColumn1",
						"hazira filter(Carry_CHE_Kind==\"ITV\") ~> filter1",
						"derivedColumn1 select(mapColumn(",
						"          mve_gkey,",
						"          Unit_Nbr,",
						"          Facility_Id,",
						"          Yard_Id,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Location,",
						"          To_Location,",
						"          From_Position_Name,",
						"          To_Position_Name,",
						"          Carry_CHE_Kind,",
						"          t_carry_complete,",
						"          t_put,",
						"          t_fetch,",
						"          Category_Id,",
						"          Freight_Kind_Id,",
						"          pow,",
						"          Commodity_Id,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          exec_delta_16,",
						"          t_execution_delta",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"filter2 alterRow(upsertIf(true())) ~> alterRow1",
						"select1 filter((t_execution_delta >= 0.0) || (t_execution_delta >= 0)) ~> filter2",
						"alterRow1 split(Event_Type_Id == \"UNIT_LOAD\",",
						"     Event_Type_Id == \"UNIT_DISCH\",",
						"     disjoint: false) ~> split1@(load, discharge)",
						"split1@load sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'hazira',",
						"     folderPath: 'gold/load_time_delta',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1",
						"split1@discharge sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'hazira',",
						"     folderPath: 'gold/dsch_time_delta',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink2"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/jobstepping_CMATK')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "xpseceuser"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "filter2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as string,",
						"          yardGkey as string,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          CHE_ID as string,",
						"          TimeStamp as string,",
						"          eventType as string,",
						"          eventSubType as string,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as string,",
						"          moveKind as string,",
						"          isTwin as string,",
						"          startDistance as string,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          OPERATOR_ID as string,",
						"          EcEventTime as timestamp,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer,",
						"          client_id as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmatk',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source(output(",
						"          gkey as short,",
						"          user_id as string,",
						"          name as string,",
						"          yard as boolean",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'cmatk',",
						"     folderPath: 'bronze/xpsecuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> xpseceuser",
						"source1 filter(cheKind==\"ITV\" && (eventTypeDescription==\"AYDR\" || eventTypeDescription==\"TYDR\" || eventTypeDescription==\"AYCO\" || eventTypeDescription==\"TYCO\" || eventTypeDescription==\"AVDR\" || eventTypeDescription==\"TVDR\" || eventTypeDescription==\"AVCO\" || eventTypeDescription==\"TVCO\") && (moveKind==\"DSCH\"||moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(CHE_ID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     startRowOffset: 1L,",
						"     endRowOffset: 1L,",
						"     eventTypeDescription_nxt = lead(eventTypeDescription),",
						"          unit_nxt = lead(unit),",
						"          cheID_nxt = lead(CHE_ID),",
						"          EcEventTime_nxt = lead(EcEventTime)) ~> window1",
						"filter1 sort(asc(CHE_ID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(jobStep = iif(CHE_ID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYCO' && eventTypeDescription_nxt=='AYCO', 1,iif(CHE_ID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVDR' && eventTypeDescription_nxt=='AVDR',1,iif(CHE_ID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYDR' && eventTypeDescription_nxt=='AYDR',1,iif(CHE_ID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVCO' && eventTypeDescription_nxt=='AVCO',1,0))))) ~> derivedColumn1",
						"select1 alterRow(upsertIf(true()),",
						"     insertIf(true())) ~> AlterRow1",
						"derivedColumn1, filter2 join(lower(OPERATOR_ID) == lower(USER_ID),",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          CHE_Name,",
						"          eventType,",
						"          eventSubType,",
						"          eventTypeDescription,",
						"          unit,",
						"          pow,",
						"          pool,",
						"          travelDistance,",
						"          moveKind,",
						"          startDistance,",
						"          EcEventTime,",
						"          cheID = CHE_ID,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          OperatorID = OPERATOR_ID,",
						"          eventTypeDescription_nxt,",
						"          unit_nxt,",
						"          cheID_nxt,",
						"          EcEventTime_nxt,",
						"          OperatorName = NAME,",
						"          jobStep",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"derivedColumn2 aggregate(groupBy(derivedColumn2@USER_ID),",
						"     NAME = first(derivedColumn2@NAME)) ~> aggregate1",
						"xpseceuser derive(USER_ID = regexReplace(user_id, `[^a-zA-Z0-9]`, ''),",
						"          NAME = regexReplace(name, `[^a-zA-Z0-9]`, ' ')) ~> derivedColumn2",
						"aggregate1 filter(not(isNull(USER_ID))) ~> filter2",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmatk',",
						"     folderPath: 'gold/jobstep',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/jobstepping_TEAGTL')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "navispowerbidata2-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "select1"
						},
						{
							"name": "select2"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "filter2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as string,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          operator as string,",
						"          EcEventTime as timestamp,",
						"          cheID as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source(output(",
						"          gkey as short,",
						"          user_id as string,",
						"          name as string,",
						"          yard as string,",
						"          {_c4} as string,",
						"          {_c5} as string,",
						"          {_c6} as string,",
						"          {_c7} as string,",
						"          {_c8} as string,",
						"          {_c9} as string,",
						"          {_c10} as string,",
						"          {_c11} as string,",
						"          {_c12} as string,",
						"          {_c13} as string,",
						"          {_c14} as string,",
						"          {_c15} as string,",
						"          {_c16} as string,",
						"          {_c17} as string,",
						"          {_c18} as string,",
						"          {_c19} as string,",
						"          {_c20} as string,",
						"          {_c21} as string,",
						"          {_c22} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'bronze/xpsecuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> source2",
						"source1 filter(cheKind==\"ITV\" && (eventTypeDescription==\"AYDR\" || eventTypeDescription==\"TYDR\" || eventTypeDescription==\"AYCO\" || eventTypeDescription==\"TYCO\" || eventTypeDescription==\"AVDR\" || eventTypeDescription==\"TVDR\" || eventTypeDescription==\"AVCO\" || eventTypeDescription==\"TVCO\") && (moveKind==\"DSCH\"||moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     startRowOffset: 1L,",
						"     endRowOffset: 1L,",
						"     eventTypeDescription_nxt = lead(eventTypeDescription),",
						"          unit_nxt = lead(unit),",
						"          cheID_nxt = lead(cheID),",
						"          EcEventTime_nxt = lead(EcEventTime)) ~> window1",
						"filter1 sort(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(jobStep = iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYCO' && eventTypeDescription_nxt=='AYCO', 1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVDR' && eventTypeDescription_nxt=='AVDR',1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYDR' && eventTypeDescription_nxt=='AYDR',1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVCO' && eventTypeDescription_nxt=='AVCO',1,0)))),",
						"          operator = lower(operator)) ~> derivedColumn1",
						"select1 alterRow(upsertIf(true())) ~> AlterRow1",
						"join1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          CHE_Name,",
						"          eventType,",
						"          eventSubType,",
						"          eventTypeDescription,",
						"          unit,",
						"          pow,",
						"          pool,",
						"          travelDistance,",
						"          moveKind,",
						"          startDistance,",
						"          EcEventTime,",
						"          cheID,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          eventTypeDescription_nxt,",
						"          unit_nxt,",
						"          cheID_nxt,",
						"          EcEventTime_nxt,",
						"          operator_id = operator,",
						"          operator_name = name,",
						"          jobStep",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"source2 select(mapColumn(",
						"          user_id,",
						"          name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"select2 aggregate(groupBy(user_id),",
						"     name = last(name)) ~> aggregate1",
						"filter2, derivedColumn1 join(lower(trim(user_id)) == lower(trim(operator)),",
						"     joinType:'right',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"aggregate1 filter(not(isNull(user_id))) ~> filter2",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'gold/jobstep',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]",
				"[concat(variables('workspaceId'), '/linkedServices/navispowerbidata2-WorkspaceDefaultStorage')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/jobstepping_cgsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "xpseceuser"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "filter2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as boolean,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          EcEventTime as timestamp,",
						"          cheID as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer,",
						"          OPERATOR_ID as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'cgsa',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source(output(",
						"          gkey as short,",
						"          user_id as string,",
						"          name as string,",
						"          yard as boolean",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'cgsa',",
						"     folderPath: 'bronze/xpseceuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> xpseceuser",
						"source1 filter(cheKind==\"ITV\" && (eventTypeDescription==\"AYDR\" || eventTypeDescription==\"TYDR\" || eventTypeDescription==\"AYCO\" || eventTypeDescription==\"TYCO\" || eventTypeDescription==\"AVDR\" || eventTypeDescription==\"TVDR\" || eventTypeDescription==\"AVCO\" || eventTypeDescription==\"TVCO\") && (moveKind==\"DSCH\"||moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     startRowOffset: 1L,",
						"     endRowOffset: 1L,",
						"     eventTypeDescription_nxt = lead(eventTypeDescription),",
						"          unit_nxt = lead(unit),",
						"          cheID_nxt = lead(cheID),",
						"          EcEventTime_nxt = lead(EcEventTime)) ~> window1",
						"filter1 sort(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(jobStep = iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYCO' && eventTypeDescription_nxt=='AYCO', 1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVDR' && eventTypeDescription_nxt=='AVDR',1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYDR' && eventTypeDescription_nxt=='AYDR',1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVCO' && eventTypeDescription_nxt=='AVCO',1,0))))) ~> derivedColumn1",
						"select1 alterRow(upsertIf(true()),",
						"     insertIf(true())) ~> AlterRow1",
						"derivedColumn1, filter2 join(lower(OPERATOR_ID) == lower(USER_ID),",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          CHE_Name,",
						"          eventType,",
						"          eventSubType,",
						"          eventTypeDescription,",
						"          unit,",
						"          pow,",
						"          pool,",
						"          travelDistance,",
						"          moveKind,",
						"          startDistance,",
						"          EcEventTime,",
						"          cheID,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          OperatorID = OPERATOR_ID,",
						"          eventTypeDescription_nxt,",
						"          unit_nxt,",
						"          cheID_nxt,",
						"          EcEventTime_nxt,",
						"          OperatorName = NAME,",
						"          jobStep",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"derivedColumn2 aggregate(groupBy(derivedColumn2@USER_ID),",
						"     NAME = first(derivedColumn2@NAME)) ~> aggregate1",
						"xpseceuser derive(USER_ID = regexReplace(user_id, `[^a-zA-Z0-9]`, ''),",
						"          NAME = regexReplace(name, `[^a-zA-Z0-9]`, ' ')) ~> derivedColumn2",
						"aggregate1 filter(not(isNull(USER_ID))) ~> filter2",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cgsa',",
						"     folderPath: 'gold/jobstep',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/jobstepping_cmsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as short,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as boolean,",
						"          startDistance as short,",
						"          workAssignmentId as double,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmsa',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source1 filter(cheKind==\"ITV\" && (typeDescription==\"AYDR\" || typeDescription==\"TYDR\" || typeDescription==\"AYCO\" || typeDescription==\"TYCO\" || typeDescription==\"AVDR\" || typeDescription==\"TVDR\" || typeDescription==\"AVCO\" || typeDescription==\"TVCO\") && (moveKind==\"DSCH\"||moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     startRowOffset: 1L,",
						"     endRowOffset: 1L,",
						"     typeDescription_nxt = lead(typeDescription),",
						"          unitIdName_nxt = lead(unitIdName),",
						"          cheID_nxt = lead(cheID),",
						"          EcEventTime_nxt = lead(EcEventTime)) ~> window1",
						"filter1 sort(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(jobStep = iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && typeDescription=='TYCO' && typeDescription_nxt=='AYCO', 1,iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && typeDescription=='TVDR' && typeDescription_nxt=='AVDR',1,iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && typeDescription=='TYDR' && typeDescription_nxt=='AYDR',1,iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && typeDescription=='TVCO' && typeDescription_nxt=='AVCO',1,0))))) ~> derivedColumn1",
						"derivedColumn1 alterRow(upsertIf(true())) ~> AlterRow1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmsa',",
						"     folderPath: 'gold/jobstep',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('key',",
						"          0,",
						"          Year,",
						"          Month,",
						"          Week",
						"     )) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/jobstepping_cmsa_v2')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "xpseceuser"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "filter2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as string,",
						"          yardGkey as string,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          CHE_ID as string,",
						"          TimeStamp as string,",
						"          eventType as string,",
						"          eventSubType as string,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as string,",
						"          moveKind as string,",
						"          isTwin as string,",
						"          startDistance as string,",
						"          workAssignment as string,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          lastEstMoveTime as string,",
						"          operator_name as string,",
						"          client_id as string,",
						"          EcEventTime as timestamp,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmsa',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source(output(",
						"          gkey as short,",
						"          user_id as string,",
						"          name as string,",
						"          yard as boolean",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'cmsa',",
						"     folderPath: 'bronze/xpseceuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> xpseceuser",
						"source1 filter(cheKind==\"ITV\" && (eventTypeDescription==\"AYDR\" || eventTypeDescription==\"TYDR\" || eventTypeDescription==\"AYCO\" || eventTypeDescription==\"TYCO\" || eventTypeDescription==\"AVDR\" || eventTypeDescription==\"TVDR\" || eventTypeDescription==\"AVCO\" || eventTypeDescription==\"TVCO\") && (moveKind==\"DSCH\"||moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(CHE_ID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     startRowOffset: 1L,",
						"     endRowOffset: 1L,",
						"     eventTypeDescription_nxt = lead(eventTypeDescription),",
						"          unit_nxt = lead(unit),",
						"          cheID_nxt = lead(CHE_ID),",
						"          EcEventTime_nxt = lead(EcEventTime)) ~> window1",
						"filter1 sort(asc(CHE_ID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(jobStep = iif(CHE_ID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYCO' && eventTypeDescription_nxt=='AYCO', 1,iif(CHE_ID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVDR' && eventTypeDescription_nxt=='AVDR',1,iif(CHE_ID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYDR' && eventTypeDescription_nxt=='AYDR',1,iif(CHE_ID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVCO' && eventTypeDescription_nxt=='AVCO',1,0))))) ~> derivedColumn1",
						"select1 alterRow(upsertIf(true()),",
						"     insertIf(true())) ~> AlterRow1",
						"derivedColumn1, filter2 join(lower(operator_name) == lower(USER_ID),",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          CHE_Name,",
						"          eventType,",
						"          eventSubType,",
						"          eventTypeDescription,",
						"          unit,",
						"          pow,",
						"          pool,",
						"          travelDistance,",
						"          moveKind,",
						"          startDistance,",
						"          EcEventTime,",
						"          cheID = CHE_ID,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          OperatorID = operator_name,",
						"          eventTypeDescription_nxt,",
						"          unit_nxt,",
						"          cheID_nxt,",
						"          EcEventTime_nxt,",
						"          OperatorName = NAME,",
						"          jobStep",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"derivedColumn2 aggregate(groupBy(derivedColumn2@USER_ID),",
						"     NAME = first(derivedColumn2@NAME)) ~> aggregate1",
						"xpseceuser derive(USER_ID = regexReplace(user_id, `[^a-zA-Z0-9]`, ''),",
						"          NAME = regexReplace(name, `[^a-zA-Z0-9]`, ' ')) ~> derivedColumn2",
						"aggregate1 filter(not(isNull(USER_ID))) ~> filter2",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmsa',",
						"     folderPath: 'gold/jobstep',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/jobstepping_dpw_peru')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "xpseceuser"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "filter2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as integer,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          EcEventTime as timestamp,",
						"          cheID as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer,",
						"          OPERATOR_ID as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'dpw-peru',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source(output(",
						"          GKEY as string,",
						"          USER_ID as string,",
						"          NAME as string,",
						"          YARD as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'dpw-peru',",
						"     folderPath: 'bronze/xpsecuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> xpseceuser",
						"source1 filter(cheKind==\"ITV\" && (eventTypeDescription==\"AYDR\" || eventTypeDescription==\"TYDR\" || eventTypeDescription==\"AYCO\" || eventTypeDescription==\"TYCO\" || eventTypeDescription==\"AVDR\" || eventTypeDescription==\"TVDR\" || eventTypeDescription==\"AVCO\" || eventTypeDescription==\"TVCO\") && (moveKind==\"DSCH\"||moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     startRowOffset: 1L,",
						"     endRowOffset: 1L,",
						"     eventTypeDescription_nxt = lead(eventTypeDescription),",
						"          unit_nxt = lead(unit),",
						"          cheID_nxt = lead(cheID),",
						"          EcEventTime_nxt = lead(EcEventTime)) ~> window1",
						"filter1 sort(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(jobStep = iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYCO' && eventTypeDescription_nxt=='AYCO', 1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVDR' && eventTypeDescription_nxt=='AVDR',1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYDR' && eventTypeDescription_nxt=='AYDR',1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVCO' && eventTypeDescription_nxt=='AVCO',1,0))))) ~> derivedColumn1",
						"select1 alterRow(upsertIf(true()),",
						"     insertIf(true())) ~> AlterRow1",
						"derivedColumn1, filter2 join(OPERATOR_ID == USER_ID,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          CHE_Name,",
						"          eventType,",
						"          eventSubType,",
						"          eventTypeDescription,",
						"          unit,",
						"          pow,",
						"          pool,",
						"          travelDistance,",
						"          moveKind,",
						"          startDistance,",
						"          EcEventTime,",
						"          cheID,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          OperatorID = OPERATOR_ID,",
						"          eventTypeDescription_nxt,",
						"          unit_nxt,",
						"          cheID_nxt,",
						"          EcEventTime_nxt,",
						"          OperatorName = NAME,",
						"          jobStep",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"derivedColumn2 aggregate(groupBy(USER_ID),",
						"     NAME = first(NAME)) ~> aggregate1",
						"xpseceuser derive(USER_ID = regexReplace(USER_ID, `[^a-zA-Z0-9]`, ''),",
						"          NAME = regexReplace(NAME, `[^a-zA-Z0-9]`, ' ')) ~> derivedColumn2",
						"aggregate1 filter(not(isNull(USER_ID))) ~> filter2",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'dpw-peru',",
						"     folderPath: 'gold/jobstep',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/jobstepping_ennore')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "select1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as short,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          workAssignment as double,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          EcEventTime as timestamp,",
						"          cheID as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer,",
						"          OPERATOR_ID as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'ennore',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source1 filter(cheKind==\"ITV\" && (eventTypeDescription==\"AYDR\" || eventTypeDescription==\"TYDR\" || eventTypeDescription==\"AYCO\" || eventTypeDescription==\"TYCO\" || eventTypeDescription==\"AVDR\" || eventTypeDescription==\"TVDR\" || eventTypeDescription==\"AVCO\" || eventTypeDescription==\"TVCO\") && (moveKind==\"DSCH\"||moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     startRowOffset: 1L,",
						"     endRowOffset: 1L,",
						"     eventTypeDescription_nxt = lead(eventTypeDescription),",
						"          unit_nxt = lead(unit),",
						"          cheID_nxt = lead(cheID),",
						"          EcEventTime_nxt = lead(EcEventTime)) ~> window1",
						"filter1 sort(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(jobStep = iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYCO' && eventTypeDescription_nxt=='AYCO', 1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVDR' && eventTypeDescription_nxt=='AVDR',1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYDR' && eventTypeDescription_nxt=='AYDR',1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVCO' && eventTypeDescription_nxt=='AVCO',1,0))))) ~> derivedColumn1",
						"select1 alterRow(upsertIf(true())) ~> AlterRow1",
						"derivedColumn1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          CHE_Name,",
						"          eventType,",
						"          eventSubType,",
						"          eventTypeDescription,",
						"          unit,",
						"          pow,",
						"          pool,",
						"          travelDistance,",
						"          moveKind,",
						"          startDistance,",
						"          EcEventTime,",
						"          cheID,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          OperatorID = OPERATOR_ID,",
						"          eventTypeDescription_nxt,",
						"          unit_nxt,",
						"          cheID_nxt,",
						"          EcEventTime_nxt,",
						"          jobStep",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'ennore',",
						"     folderPath: 'gold/jobstep',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/jobstepping_gti')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as short,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as boolean,",
						"          startDistance as short,",
						"          workAssignmentId as double,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'gti',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source1 filter(cheKind==\"ITV\" && (typeDescription==\"AYDR\" || typeDescription==\"TYDR\" || typeDescription==\"AYCO\" || typeDescription==\"TYCO\" || typeDescription==\"AVDR\" || typeDescription==\"TVDR\" || typeDescription==\"AVCO\" || typeDescription==\"TVCO\") && (moveKind==\"DSCH\"||moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     startRowOffset: 1L,",
						"     endRowOffset: 1L,",
						"     typeDescription_nxt = lead(typeDescription),",
						"          unitIdName_nxt = lead(unitIdName),",
						"          cheID_nxt = lead(cheID),",
						"          EcEventTime_nxt = lead(EcEventTime)) ~> window1",
						"filter1 sort(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(jobStep = iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && typeDescription=='TYCO' && typeDescription_nxt=='AYCO', 1,iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && typeDescription=='TVDR' && typeDescription_nxt=='AVDR',1,iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && typeDescription=='TYDR' && typeDescription_nxt=='AYDR',1,iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && typeDescription=='TVCO' && typeDescription_nxt=='AVCO',1,0))))) ~> derivedColumn1",
						"derivedColumn1 alterRow(upsertIf(true())) ~> AlterRow1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'gti',",
						"     folderPath: 'gold/jobstep',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('key',",
						"          0,",
						"          Year,",
						"          Month,",
						"          Week",
						"     )) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/jobstepping_hazira')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "select1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as boolean,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as integer,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          EcEventTime as timestamp,",
						"          cheID as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer,",
						"          OPERATOR_ID as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'hazira',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source1 filter(cheKind==\"ITV\" && (eventTypeDescription==\"AYDR\" || eventTypeDescription==\"TYDR\" || eventTypeDescription==\"AYCO\" || eventTypeDescription==\"TYCO\" || eventTypeDescription==\"AVDR\" || eventTypeDescription==\"TVDR\" || eventTypeDescription==\"AVCO\" || eventTypeDescription==\"TVCO\") && (moveKind==\"DSCH\"||moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     startRowOffset: 1L,",
						"     endRowOffset: 1L,",
						"     eventTypeDescription_nxt = lead(eventTypeDescription),",
						"          unit_nxt = lead(unit),",
						"          cheID_nxt = lead(cheID),",
						"          EcEventTime_nxt = lead(EcEventTime)) ~> window1",
						"filter1 sort(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(jobStep = iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYCO' && eventTypeDescription_nxt=='AYCO', 1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVDR' && eventTypeDescription_nxt=='AVDR',1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYDR' && eventTypeDescription_nxt=='AYDR',1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVCO' && eventTypeDescription_nxt=='AVCO',1,0))))) ~> derivedColumn1",
						"select1 alterRow(upsertIf(true())) ~> AlterRow1",
						"derivedColumn1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          CHE_Name,",
						"          eventType,",
						"          eventSubType,",
						"          eventTypeDescription,",
						"          unit,",
						"          pow,",
						"          pool,",
						"          travelDistance,",
						"          moveKind,",
						"          startDistance,",
						"          EcEventTime,",
						"          cheID,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          OperatorID = OPERATOR_ID,",
						"          eventTypeDescription_nxt,",
						"          unit_nxt,",
						"          cheID_nxt,",
						"          EcEventTime_nxt,",
						"          jobStep",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'hazira',",
						"     folderPath: 'gold/jobstep',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/jobstepping_kattupalli')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "select1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as short,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          workAssignment as double,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          EcEventTime as timestamp,",
						"          cheID as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer,",
						"          OPERATOR_ID as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'kattupalli',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source1 filter(cheKind==\"ITV\" && (eventTypeDescription==\"AYDR\" || eventTypeDescription==\"TYDR\" || eventTypeDescription==\"AYCO\" || eventTypeDescription==\"TYCO\" || eventTypeDescription==\"AVDR\" || eventTypeDescription==\"TVDR\" || eventTypeDescription==\"AVCO\" || eventTypeDescription==\"TVCO\") && (moveKind==\"DSCH\"||moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     startRowOffset: 1L,",
						"     endRowOffset: 1L,",
						"     eventTypeDescription_nxt = lead(eventTypeDescription),",
						"          unit_nxt = lead(unit),",
						"          cheID_nxt = lead(cheID),",
						"          EcEventTime_nxt = lead(EcEventTime)) ~> window1",
						"filter1 sort(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(jobStep = iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYCO' && eventTypeDescription_nxt=='AYCO', 1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVDR' && eventTypeDescription_nxt=='AVDR',1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYDR' && eventTypeDescription_nxt=='AYDR',1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVCO' && eventTypeDescription_nxt=='AVCO',1,0))))) ~> derivedColumn1",
						"select1 alterRow(upsertIf(true())) ~> AlterRow1",
						"derivedColumn1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          CHE_Name,",
						"          eventType,",
						"          eventSubType,",
						"          eventTypeDescription,",
						"          unit,",
						"          pow,",
						"          pool,",
						"          travelDistance,",
						"          moveKind,",
						"          startDistance,",
						"          EcEventTime,",
						"          cheID,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          OperatorID = OPERATOR_ID,",
						"          eventTypeDescription_nxt,",
						"          unit_nxt,",
						"          cheID_nxt,",
						"          EcEventTime_nxt,",
						"          jobStep",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'kattupalli',",
						"     folderPath: 'gold/jobstep',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/jobstepping_kssp')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "aggregate2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as short,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as boolean,",
						"          startDistance as short,",
						"          workAssignmentId as double,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'kssp',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source1 filter(cheKind==\"ITV\" && (typeDescription==\"AYDR\" || typeDescription==\"TYDR\" || typeDescription==\"AYCO\" || typeDescription==\"TYCO\" || typeDescription==\"AVDR\" || typeDescription==\"TVDR\" || typeDescription==\"AVCO\" || typeDescription==\"TVCO\") && (moveKind==\"DSCH\"||moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     startRowOffset: 1L,",
						"     endRowOffset: 1L,",
						"     typeDescription_nxt = lead(typeDescription),",
						"          unitIdName_nxt = lead(unitIdName),",
						"          cheID_nxt = lead(cheID),",
						"          EcEventTime_nxt = lead(EcEventTime)) ~> window1",
						"aggregate2 sort(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(jobStep = iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && typeDescription=='TYCO' && typeDescription_nxt=='AYCO', 1,iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && typeDescription=='TVDR' && typeDescription_nxt=='AVDR',1,iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && typeDescription=='TYDR' && typeDescription_nxt=='AYDR',1,iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && typeDescription=='TVCO' && typeDescription_nxt=='AVCO',1,0))))) ~> derivedColumn1",
						"derivedColumn1 alterRow(upsertIf(true())) ~> AlterRow1",
						"filter1 aggregate(groupBy(ecEventGkey),",
						"     each(match(name!='ecEventGkey'), $$ = first($$))) ~> aggregate2",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'kssp',",
						"     folderPath: 'gold/jobstep',",
						"     deltaTruncate: true,",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('key',",
						"          0,",
						"          Year,",
						"          Month,",
						"          Week",
						"     )) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/jobstepping_malta')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "xpseceuser"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "filter2"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as long,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as short,",
						"          ToCheIdName as short,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocId as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocId as string,",
						"          laden_LocSlot as string,",
						"          operatorName as string,",
						"          EcEventTime as timestamp,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'malta',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source(output(",
						"          GKEY as long,",
						"          USER_ID as string,",
						"          NAME as string,",
						"          YARD as integer",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'malta',",
						"     folderPath: 'bronze/xpsecuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> xpseceuser",
						"select2 filter(not(isNull(ecEventGkey)) && cheKind==\"ITV\" && (eventTypeDescription==\"AYDR\" || eventTypeDescription==\"TYDR\" || eventTypeDescription==\"AYCO\" || eventTypeDescription==\"TYCO\" || eventTypeDescription==\"AVDR\" || eventTypeDescription==\"TVDR\" || eventTypeDescription==\"AVCO\" || eventTypeDescription==\"TVCO\") && (moveKind==\"DSCH\"||moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     startRowOffset: 1L,",
						"     endRowOffset: 1L,",
						"     eventTypeDescription_nxt = lead(eventTypeDescription),",
						"          unit_nxt = lead(unit),",
						"          cheID_nxt = lead(cheID),",
						"          EcEventTime_nxt = lead(EcEventTime)) ~> window1",
						"filter1 sort(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(jobStep = iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYCO' && eventTypeDescription_nxt=='AYCO', 1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVDR' && eventTypeDescription_nxt=='AVDR',1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYDR' && eventTypeDescription_nxt=='AYDR',1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVCO' && eventTypeDescription_nxt=='AVCO',1,0)))),",
						"          operatorName = regexReplace(operatorName, `[^a-zA-Z0-9]`, '')) ~> derivedColumn1",
						"select1 alterRow(upsertIf(true()),",
						"     insertIf(true())) ~> AlterRow1",
						"derivedColumn1, filter2 join(operatorName == USER_ID,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          CHE_Name = cheName,",
						"          eventType = type,",
						"          eventSubType = subType,",
						"          eventTypeDescription,",
						"          unit,",
						"          pow = powName,",
						"          pool = poolName,",
						"          travelDistance,",
						"          moveKind,",
						"          startDistance,",
						"          EcEventTime,",
						"          cheID,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          OperatorID = operatorName,",
						"          eventTypeDescription_nxt,",
						"          unit_nxt,",
						"          cheID_nxt,",
						"          EcEventTime_nxt,",
						"          OperatorName = NAME,",
						"          jobStep",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"derivedColumn2 aggregate(groupBy(USER_ID),",
						"     NAME = last(NAME)) ~> aggregate1",
						"xpseceuser derive(USER_ID = regexReplace(USER_ID, `[^a-zA-Z0-9]`, ''),",
						"          NAME = regexReplace(NAME, `[^a-zA-Z0-9]`, ' ')) ~> derivedColumn2",
						"aggregate1 filter(not(isNull(USER_ID))) ~> filter2",
						"source1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          cheName,",
						"          cheID,",
						"          type,",
						"          subType,",
						"          eventTypeDescription = typeDescription,",
						"          fromCheIdName,",
						"          ToCheIdName,",
						"          unit = unitIdName,",
						"          powName,",
						"          poolName,",
						"          workQueue,",
						"          travelDistance,",
						"          moveKind,",
						"          isTwin,",
						"          startDistance,",
						"          unitReference,",
						"          tranId,",
						"          locType,",
						"          locId,",
						"          locSlot,",
						"          opsPosId,",
						"          unladenLoctype,",
						"          unladenLocId,",
						"          unladenLocSlot,",
						"          ladenLoctype,",
						"          ladenLocId,",
						"          laden_LocSlot,",
						"          operatorName,",
						"          EcEventTime,",
						"          Year,",
						"          Month,",
						"          Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'malta',",
						"     folderPath: 'gold/jobstep',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/jobstepping_mict')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as short,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as boolean,",
						"          startDistance as short,",
						"          workAssignmentId as double,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'mict',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source1 filter(cheKind==\"ITV\" && (typeDescription==\"AYDR\" || typeDescription==\"TYDR\" || typeDescription==\"AYCO\" || typeDescription==\"TYCO\" || typeDescription==\"AVDR\" || typeDescription==\"TVDR\" || typeDescription==\"AVCO\" || typeDescription==\"TVCO\") && (moveKind==\"DSCH\"||moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     startRowOffset: 1L,",
						"     endRowOffset: 1L,",
						"     typeDescription_nxt = lead(typeDescription),",
						"          unitIdName_nxt = lead(unitIdName),",
						"          cheID_nxt = lead(cheID),",
						"          EcEventTime_nxt = lead(EcEventTime)) ~> window1",
						"filter1 sort(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(jobStep = iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && typeDescription=='TYCO' && typeDescription_nxt=='AYCO', 1,iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && typeDescription=='TVDR' && typeDescription_nxt=='AVDR',1,iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && typeDescription=='TYDR' && typeDescription_nxt=='AYDR',1,iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && typeDescription=='TVCO' && typeDescription_nxt=='AVCO',1,0))))) ~> derivedColumn1",
						"derivedColumn1 alterRow(upsertIf(true())) ~> AlterRow1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mict',",
						"     folderPath: 'gold/jobstep',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('key',",
						"          0,",
						"          Year,",
						"          Month,",
						"          Week",
						"     )) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/jobstepping_mict_v2')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "xpseceuser"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "filter2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as string,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as string,",
						"          startDistance as short,",
						"          workAssignment as float,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          lastEstMoveTime as string,",
						"          EcEventTime as timestamp,",
						"          cheID as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer,",
						"          operator as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'mict',",
						"     folderPath: 'silver/ecevents_v2') ~> source1",
						"source(output(",
						"          gkey as string,",
						"          user_id as string,",
						"          name as string,",
						"          yard as boolean",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'mict',",
						"     folderPath: 'bronze/xpsecuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> xpseceuser",
						"source1 filter(not(isNull(ecEventGkey)) && cheKind==\"ITV\" && (eventTypeDescription==\"AYDR\" || eventTypeDescription==\"TYDR\" || eventTypeDescription==\"AYCO\" || eventTypeDescription==\"TYCO\" || eventTypeDescription==\"AVDR\" || eventTypeDescription==\"TVDR\" || eventTypeDescription==\"AVCO\" || eventTypeDescription==\"TVCO\") && (moveKind==\"DSCH\"||moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     startRowOffset: 1L,",
						"     endRowOffset: 1L,",
						"     eventTypeDescription_nxt = lead(eventTypeDescription),",
						"          unit_nxt = lead(unit),",
						"          cheID_nxt = lead(cheID),",
						"          EcEventTime_nxt = lead(EcEventTime)) ~> window1",
						"filter1 sort(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(jobStep = iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYCO' && eventTypeDescription_nxt=='AYCO', 1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVDR' && eventTypeDescription_nxt=='AVDR',1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYDR' && eventTypeDescription_nxt=='AYDR',1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVCO' && eventTypeDescription_nxt=='AVCO',1,0)))),",
						"          operator = regexReplace(operator, `[^a-zA-Z0-9]`, '')) ~> derivedColumn1",
						"select1 alterRow(upsertIf(true())) ~> AlterRow1",
						"derivedColumn1, filter2 join(operator == USER_ID,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          CHE_Name,",
						"          eventType,",
						"          eventSubType,",
						"          eventTypeDescription,",
						"          unit,",
						"          pow,",
						"          pool,",
						"          travelDistance,",
						"          moveKind,",
						"          startDistance,",
						"          EcEventTime,",
						"          cheID,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          OperatorID = operator,",
						"          eventTypeDescription_nxt,",
						"          unit_nxt,",
						"          cheID_nxt,",
						"          EcEventTime_nxt,",
						"          OperatorName = NAME,",
						"          jobStep",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"derivedColumn2 aggregate(groupBy(derivedColumn2@USER_ID),",
						"     NAME = last(derivedColumn2@NAME)) ~> aggregate1",
						"xpseceuser derive(USER_ID = regexReplace(user_id, `[^a-zA-Z0-9]`, ''),",
						"          NAME = regexReplace(name, `[^a-zA-Z0-9]`, ' ')) ~> derivedColumn2",
						"aggregate1 filter(not(isNull(USER_ID))) ~> filter2",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mict',",
						"     folderPath: 'gold/jobstep',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/jobstepping_mnhpi')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as short,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as boolean,",
						"          startDistance as short,",
						"          workAssignmentId as double,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source1 filter(cheKind==\"ITV\" && (typeDescription==\"AYDR\" || typeDescription==\"TYDR\" || typeDescription==\"AYCO\" || typeDescription==\"TYCO\" || typeDescription==\"AVDR\" || typeDescription==\"TVDR\" || typeDescription==\"AVCO\" || typeDescription==\"TVCO\") && (moveKind==\"DSCH\"||moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     startRowOffset: 1L,",
						"     endRowOffset: 1L,",
						"     typeDescription_nxt = lead(typeDescription),",
						"          unitIdName_nxt = lead(unitIdName),",
						"          cheID_nxt = lead(cheID),",
						"          EcEventTime_nxt = lead(EcEventTime)) ~> window1",
						"filter1 sort(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(jobStep = iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && typeDescription=='TYCO' && typeDescription_nxt=='AYCO', 1,iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && typeDescription=='TVDR' && typeDescription_nxt=='AVDR',1,iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && typeDescription=='TYDR' && typeDescription_nxt=='AYDR',1,iif(cheID==cheID_nxt && unitIdName==unitIdName_nxt && typeDescription=='TVCO' && typeDescription_nxt=='AVCO',1,0))))) ~> derivedColumn1",
						"derivedColumn1 alterRow(upsertIf(true())) ~> AlterRow1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'gold/jobstep',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('key',",
						"          0,",
						"          Year,",
						"          Month,",
						"          Week",
						"     )) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/jobstepping_rio')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "xpseceuser"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "filter2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as boolean,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          workAssignment as long,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          EcEventTime as timestamp,",
						"          cheID as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer,",
						"          OPERATOR_ID as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'rio',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source(output(",
						"          gkey as string,",
						"          user_id as string,",
						"          name as string,",
						"          yard as boolean",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'rio',",
						"     folderPath: 'bronze/xpsecuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> xpseceuser",
						"source1 filter(not(isNull(ecEventGkey)) && cheKind==\"ITV\" && (eventTypeDescription==\"AYDR\" || eventTypeDescription==\"TYDR\" || eventTypeDescription==\"AYCO\" || eventTypeDescription==\"TYCO\" || eventTypeDescription==\"AVDR\" || eventTypeDescription==\"TVDR\" || eventTypeDescription==\"AVCO\" || eventTypeDescription==\"TVCO\") && (moveKind==\"DSCH\"||moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     startRowOffset: 1L,",
						"     endRowOffset: 1L,",
						"     eventTypeDescription_nxt = lead(eventTypeDescription),",
						"          unit_nxt = lead(unit),",
						"          cheID_nxt = lead(cheID),",
						"          EcEventTime_nxt = lead(EcEventTime)) ~> window1",
						"filter1 sort(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(jobStep = iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYCO' && eventTypeDescription_nxt=='AYCO', 1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVDR' && eventTypeDescription_nxt=='AVDR',1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYDR' && eventTypeDescription_nxt=='AYDR',1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVCO' && eventTypeDescription_nxt=='AVCO',1,0)))),",
						"          OPERATOR_ID = regexReplace(OPERATOR_ID, `[^a-zA-Z0-9]`, '')) ~> derivedColumn1",
						"select1 alterRow(upsertIf(true()),",
						"     insertIf(true())) ~> AlterRow1",
						"derivedColumn1, filter2 join(OPERATOR_ID == USER_ID,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          CHE_Name,",
						"          eventType,",
						"          eventSubType,",
						"          eventTypeDescription,",
						"          unit,",
						"          pow,",
						"          pool,",
						"          travelDistance,",
						"          moveKind,",
						"          startDistance,",
						"          EcEventTime,",
						"          cheID,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          OperatorID = OPERATOR_ID,",
						"          eventTypeDescription_nxt,",
						"          unit_nxt,",
						"          cheID_nxt,",
						"          EcEventTime_nxt,",
						"          OperatorName = NAME,",
						"          jobStep",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"derivedColumn2 aggregate(groupBy(derivedColumn2@USER_ID),",
						"     NAME = last(derivedColumn2@NAME)) ~> aggregate1",
						"xpseceuser derive(USER_ID = regexReplace(user_id, `[^a-zA-Z0-9]`, ''),",
						"          NAME = regexReplace(name, `[^a-zA-Z0-9]`, ' ')) ~> derivedColumn2",
						"aggregate1 filter(not(isNull(USER_ID))) ~> filter2",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'rio',",
						"     folderPath: 'gold/jobstep',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/jobstepping_sgtd')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "select1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as integer,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          workAssignment as long,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          lastEstMoveTime as string,",
						"          EcEventTime as timestamp,",
						"          cheID as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source1 filter(cheKind==\"ITV\" && (eventTypeDescription==\"AYDR\" || eventTypeDescription==\"TYDR\" || eventTypeDescription==\"AYCO\" || eventTypeDescription==\"TYCO\" || eventTypeDescription==\"AVDR\" || eventTypeDescription==\"TVDR\" || eventTypeDescription==\"AVCO\" || eventTypeDescription==\"TVCO\") && (moveKind==\"DSCH\"||moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     startRowOffset: 1L,",
						"     endRowOffset: 1L,",
						"     eventTypeDescription_nxt = lead(eventTypeDescription),",
						"          unit_nxt = lead(unit),",
						"          cheID_nxt = lead(cheID),",
						"          EcEventTime_nxt = lead(EcEventTime)) ~> window1",
						"filter1 sort(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(jobStep = iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYCO' && eventTypeDescription_nxt=='AYCO', 1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVDR' && eventTypeDescription_nxt=='AVDR',1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYDR' && eventTypeDescription_nxt=='AYDR',1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVCO' && eventTypeDescription_nxt=='AVCO',1,0))))) ~> derivedColumn1",
						"select1 alterRow(upsertIf(true())) ~> AlterRow1",
						"derivedColumn1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          CHE_Name,",
						"          eventType,",
						"          eventSubType,",
						"          eventTypeDescription,",
						"          unit,",
						"          pow,",
						"          pool,",
						"          workQueue,",
						"          travelDistance,",
						"          moveKind,",
						"          isTwin,",
						"          startDistance,",
						"          EcEventTime,",
						"          cheID,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          eventTypeDescription_nxt,",
						"          unit_nxt,",
						"          cheID_nxt,",
						"          EcEventTime_nxt,",
						"          jobStep",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'gold/jobstep',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('key',",
						"          0,",
						"          Year,",
						"          Month,",
						"          Week",
						"     )) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/jobstepping_sgtd_v2')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "navispowerbidata2-WorkspaceDefaultStorage",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "select1"
						},
						{
							"name": "select2"
						},
						{
							"name": "join1"
						},
						{
							"name": "filter2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as integer,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          workAssignment as long,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          lastEstMoveTime as string,",
						"          EcEventTime as timestamp,",
						"          cheID as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer,",
						"          operator_name as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'silver/ecevents_v2') ~> source1",
						"source(output(",
						"          GKEY as integer,",
						"          USER_ID as string,",
						"          NAME as string,",
						"          YARD as integer",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delimited',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'bronze/xpsecuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> source2",
						"filter2 filter(cheKind==\"ITV\" && (eventTypeDescription==\"AYDR\" || eventTypeDescription==\"TYDR\" || eventTypeDescription==\"AYCO\" || eventTypeDescription==\"TYCO\" || eventTypeDescription==\"AVDR\" || eventTypeDescription==\"TVDR\" || eventTypeDescription==\"AVCO\" || eventTypeDescription==\"TVCO\") && (moveKind==\"DSCH\"||moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     startRowOffset: 1L,",
						"     endRowOffset: 1L,",
						"     eventTypeDescription_nxt = lead(eventTypeDescription),",
						"          unit_nxt = lead(unit),",
						"          cheID_nxt = lead(cheID),",
						"          EcEventTime_nxt = lead(EcEventTime)) ~> window1",
						"filter1 sort(asc(cheID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(jobStep = iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYCO' && eventTypeDescription_nxt=='AYCO', 1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVDR' && eventTypeDescription_nxt=='AVDR',1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYDR' && eventTypeDescription_nxt=='AYDR',1,iif(cheID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVCO' && eventTypeDescription_nxt=='AVCO',1,0))))) ~> derivedColumn1",
						"select1 alterRow(upsertIf(true())) ~> AlterRow1",
						"join1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          CHE_Name,",
						"          eventType,",
						"          eventSubType,",
						"          eventTypeDescription,",
						"          unit,",
						"          pow,",
						"          pool,",
						"          workQueue,",
						"          travelDistance,",
						"          moveKind,",
						"          isTwin,",
						"          startDistance,",
						"          EcEventTime,",
						"          cheID,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          eventTypeDescription_nxt,",
						"          unit_nxt,",
						"          cheID_nxt,",
						"          EcEventTime_nxt,",
						"          jobStep,",
						"          OPERATOR_ID = operator_name,",
						"          USER_ID,",
						"          OPERATOR_NAME = NAME",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"source2 select(mapColumn(",
						"          GKEY,",
						"          USER_ID,",
						"          NAME,",
						"          YARD",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"derivedColumn1, select2 join(lower(operator_name) == lower(USER_ID),",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'off')~> join1",
						"source1 filter(Year >=2025 && Week >=28 && Month >= 7) ~> filter2",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'gold/jobstep_v2',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('key',",
						"          0,",
						"          Year,",
						"          Month,",
						"          Week",
						"     )) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]",
				"[concat(variables('workspaceId'), '/linkedServices/navispowerbidata2-WorkspaceDefaultStorage')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/jobstepping_socar')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "xpseceuser"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "window1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "filter2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as string,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          CHE_ID as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as integer,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          workAssignment as long,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          lastEstMoveTime as string,",
						"          operator_name as string,",
						"          EcEventTime as timestamp,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'socar',",
						"     folderPath: 'silver/ecevents') ~> source1",
						"source(output(",
						"          gkey as string,",
						"          user_id as string,",
						"          name as string,",
						"          yard as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'socar',",
						"     folderPath: 'bronze/xpsecuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> xpseceuser",
						"source1 filter(not(isNull(ecEventGkey)) && cheKind==\"ITV\" && (eventTypeDescription==\"AYDR\" || eventTypeDescription==\"TYDR\" || eventTypeDescription==\"AYCO\" || eventTypeDescription==\"TYCO\" || eventTypeDescription==\"AVDR\" || eventTypeDescription==\"TVDR\" || eventTypeDescription==\"AVCO\" || eventTypeDescription==\"TVCO\") && (moveKind==\"DSCH\"||moveKind==\"LOAD\")) ~> filter1",
						"sort1 window(asc(CHE_ID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true),",
						"     startRowOffset: 1L,",
						"     endRowOffset: 1L,",
						"     eventTypeDescription_nxt = lead(eventTypeDescription),",
						"          unit_nxt = lead(unit),",
						"          cheID_nxt = lead(CHE_ID),",
						"          EcEventTime_nxt = lead(EcEventTime)) ~> window1",
						"filter1 sort(asc(CHE_ID, true),",
						"     asc(EcEventTime, true),",
						"     asc(ecEventGkey, true)) ~> sort1",
						"window1 derive(jobStep = iif(CHE_ID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYCO' && eventTypeDescription_nxt=='AYCO', 1,iif(CHE_ID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVDR' && eventTypeDescription_nxt=='AVDR',1,iif(CHE_ID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TYDR' && eventTypeDescription_nxt=='AYDR',1,iif(CHE_ID==cheID_nxt && unit==unit_nxt && eventTypeDescription=='TVCO' && eventTypeDescription_nxt=='AVCO',1,0)))),",
						"          OPERATOR_ID = regexReplace(operator_name, `[^a-zA-Z0-9]`, '')) ~> derivedColumn1",
						"select1 alterRow(upsertIf(true()),",
						"     insertIf(true())) ~> AlterRow1",
						"derivedColumn1, filter2 join(OPERATOR_ID == USER_ID,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          CHE_Name,",
						"          eventType,",
						"          eventSubType,",
						"          eventTypeDescription,",
						"          unit,",
						"          pow,",
						"          pool,",
						"          travelDistance,",
						"          moveKind,",
						"          startDistance,",
						"          EcEventTime,",
						"          cheID = CHE_ID,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          OperatorID = OPERATOR_ID,",
						"          eventTypeDescription_nxt,",
						"          unit_nxt,",
						"          cheID_nxt,",
						"          EcEventTime_nxt,",
						"          OperatorName = NAME,",
						"          jobStep",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"derivedColumn2 aggregate(groupBy(derivedColumn2@USER_ID),",
						"     NAME = last(derivedColumn2@NAME)) ~> aggregate1",
						"xpseceuser derive(USER_ID = regexReplace(user_id, `[^a-zA-Z0-9]`, ''),",
						"          NAME = regexReplace(name, `[^a-zA-Z0-9]`, ' ')) ~> derivedColumn2",
						"aggregate1 filter(not(isNull(USER_ID))) ~> filter2",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'socar',",
						"     folderPath: 'gold/jobstep',",
						"     mergeSchema: true,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ladenUnladen_MCT')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ecevents"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as integer,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          CHE_ID as short,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          workAssignment as string,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          lastEstMoveTime as string,",
						"          operator_name as string,",
						"          EcEventTime as timestamp,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'mct',",
						"     folderPath: 'silver/ecevents') ~> ecevents",
						"ecevents filter(cheKind == 'SC' && ((moveKind == 'DSCH' && eventTypeDescription == 'LTRW') || (moveKind == 'LOAD' && eventTypeDescription == 'LTSH'))) ~> filter1",
						"filter1 derive(Date = toDate(EcEventTime),",
						"          Day_of_Week = dayOfWeek(EcEventTime)) ~> derivedColumn1",
						"derivedColumn1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          FcyID,",
						"          CHE_Name,",
						"          YardID,",
						"          CHE_ID,",
						"          cheKind,",
						"          eventType,",
						"          eventSubType,",
						"          eventTypeDescription,",
						"          fromCheIdName,",
						"          ToCheIdName,",
						"          unit,",
						"          pow,",
						"          pool,",
						"          workQueue,",
						"          startDistance,",
						"          travelDistance,",
						"          moveKind,",
						"          isTwin,",
						"          workAssignment,",
						"          locSlot,",
						"          operator_name,",
						"          EcEventTime,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          Date,",
						"          Day_of_Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 alterRow(upsertIf(true())) ~> alterRow1",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mct',",
						"     folderPath: 'gold/laden_unladen',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ladenUnladen_dpw_lg')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ecevents"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as boolean,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          EcEventTime as timestamp,",
						"          cheID as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer,",
						"          OPERATOR_ID as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'dpw-lg',",
						"     folderPath: 'silver/ecevents') ~> ecevents",
						"ecevents filter(equals(cheKind, 'SC')  && (moveKind == 'DSCH' || moveKind == 'LOAD') && (eventTypeDescription  =='LARW' || eventTypeDescription  =='LASH')) ~> filter1",
						"filter1 derive(Date = toDate(EcEventTime),",
						"          Day_of_Week = dayOfWeek(EcEventTime)) ~> derivedColumn1",
						"derivedColumn1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          cheName = CHE_Name,",
						"          cheID,",
						"          EcEventTime,",
						"          type = eventType,",
						"          subType = eventSubType,",
						"          typeDescription = eventTypeDescription,",
						"          fromCheIdName,",
						"          ToCheIdName,",
						"          unitIdName = unit,",
						"          powName = pow,",
						"          poolName = pool,",
						"          workQueue,",
						"          Laden = travelDistance,",
						"          moveKind,",
						"          isTwinMove = isTwin,",
						"          UnLaden = startDistance,",
						"          unitReference = unitRef,",
						"          tranId = tran_ID,",
						"          locType,",
						"          locId = locID,",
						"          locSlot,",
						"          opsPosId = opsPosID,",
						"          unladenLoctype,",
						"          unladenLocid = unladenLocID,",
						"          unladenLocSlot,",
						"          ladenLoctype,",
						"          ladenLocid = ladenLocID,",
						"          ladenLocSlot = laden_LocSlot,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          Date,",
						"          Day_of_Week,",
						"          OperatorId = OPERATOR_ID",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 alterRow(upsertIf(true()),",
						"     insertIf(true())) ~> alterRow1",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'dpw-lg',",
						"     folderPath: 'gold/laden_unladen',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ladenUnladen_dpw_peru')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ecevents"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as integer,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          EcEventTime as timestamp,",
						"          cheID as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer,",
						"          OPERATOR_ID as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'dpw-peru',",
						"     folderPath: 'silver/ecevents') ~> ecevents",
						"ecevents filter(cheKind == 'ITV' && (moveKind == 'DSCH' || moveKind == 'LOAD') && (eventTypeDescription == 'TVCO' || eventTypeDescription == 'TYCO')) ~> filter1",
						"filter1 derive(Date = toDate(EcEventTime),",
						"          Day_of_Week = dayOfWeek(EcEventTime)) ~> derivedColumn1",
						"derivedColumn1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          cheName = CHE_Name,",
						"          cheID,",
						"          EcEventTime,",
						"          type = eventType,",
						"          subType = eventSubType,",
						"          typeDescription = eventTypeDescription,",
						"          fromCheIdName,",
						"          ToCheIdName,",
						"          unitIdName = unit,",
						"          powName = pow,",
						"          poolName = pool,",
						"          workQueue,",
						"          Laden = travelDistance,",
						"          moveKind,",
						"          isTwinMove = isTwin,",
						"          UnLaden = startDistance,",
						"          unitReference = unitRef,",
						"          tranId = tran_ID,",
						"          locType,",
						"          locId = locID,",
						"          locSlot,",
						"          opsPosId = opsPosID,",
						"          unladenLoctype,",
						"          unladenLocid = unladenLocID,",
						"          unladenLocSlot,",
						"          ladenLoctype,",
						"          ladenLocid = ladenLocID,",
						"          ladenLocSlot = laden_LocSlot,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          Date,",
						"          Day_of_Week,",
						"          OperatorId = OPERATOR_ID",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 alterRow(upsertIf(true()),",
						"     insertIf(true())) ~> alterRow1",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'dpw-peru',",
						"     folderPath: 'gold/laden_unladen',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ladenUnladen_ennore')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ecevents"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as short,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          workAssignment as double,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          EcEventTime as timestamp,",
						"          cheID as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer,",
						"          OPERATOR_ID as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'ennore',",
						"     folderPath: 'silver/ecevents') ~> ecevents",
						"ecevents filter(cheKind == 'ITV' && (moveKind == 'DSCH' || moveKind == 'LOAD') && (eventTypeDescription == 'TVCO' || eventTypeDescription == 'TYCO')) ~> filter1",
						"filter1 derive(Date = toDate(EcEventTime),",
						"          Day_of_Week = dayOfWeek(EcEventTime)) ~> derivedColumn1",
						"derivedColumn1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          cheName = CHE_Name,",
						"          cheID,",
						"          EcEventTime,",
						"          type = eventType,",
						"          subType = eventSubType,",
						"          typeDescription = eventTypeDescription,",
						"          fromCheIdName,",
						"          ToCheIdName,",
						"          unitIdName = unit,",
						"          powName = pow,",
						"          poolName = pool,",
						"          workQueue,",
						"          Laden = travelDistance,",
						"          moveKind,",
						"          isTwinMove = isTwin,",
						"          UnLaden = startDistance,",
						"          unitReference = unitRef,",
						"          tranId = tran_ID,",
						"          locType,",
						"          locId = locID,",
						"          locSlot,",
						"          opsPosId = opsPosID,",
						"          unladenLoctype,",
						"          unladenLocid = unladenLocID,",
						"          unladenLocSlot,",
						"          ladenLoctype,",
						"          ladenLocid = ladenLocID,",
						"          ladenLocSlot = laden_LocSlot,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          Date,",
						"          Day_of_Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 alterRow(upsertIf(true()),",
						"     insertIf(true())) ~> alterRow1",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'ennore',",
						"     folderPath: 'gold/laden_unladen',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ladenUnladen_hazira')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ecevents"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as boolean,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as integer,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          EcEventTime as timestamp,",
						"          cheID as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer,",
						"          OPERATOR_ID as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'hazira',",
						"     folderPath: 'silver/ecevents') ~> ecevents",
						"ecevents filter(cheKind == 'ITV' && (moveKind == 'DSCH' || moveKind == 'LOAD') && (eventTypeDescription == 'TVCO' || eventTypeDescription == 'TYCO')) ~> filter1",
						"filter1 derive(Date = toDate(EcEventTime),",
						"          Day_of_Week = dayOfWeek(EcEventTime)) ~> derivedColumn1",
						"derivedColumn1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          cheName = CHE_Name,",
						"          cheID,",
						"          EcEventTime,",
						"          type = eventType,",
						"          subType = eventSubType,",
						"          typeDescription = eventTypeDescription,",
						"          fromCheIdName,",
						"          ToCheIdName,",
						"          unitIdName = unit,",
						"          powName = pow,",
						"          poolName = pool,",
						"          workQueue,",
						"          Laden = travelDistance,",
						"          moveKind,",
						"          isTwinMove = isTwin,",
						"          UnLaden = startDistance,",
						"          unitReference = unitRef,",
						"          tranId = tran_ID,",
						"          locType,",
						"          locId = locID,",
						"          locSlot,",
						"          opsPosId = opsPosID,",
						"          unladenLoctype,",
						"          unladenLocid = unladenLocID,",
						"          unladenLocSlot,",
						"          ladenLoctype,",
						"          ladenLocid = ladenLocID,",
						"          ladenLocSlot = laden_LocSlot,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          Date,",
						"          Day_of_Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 alterRow(upsertIf(true()),",
						"     insertIf(true())) ~> alterRow1",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'hazira',",
						"     folderPath: 'gold/laden_unladen',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ladenUnladen_kattupalli')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ecevents"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as short,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          workAssignment as double,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          EcEventTime as timestamp,",
						"          cheID as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer,",
						"          OPERATOR_ID as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'kattupalli',",
						"     folderPath: 'silver/ecevents') ~> ecevents",
						"ecevents filter(cheKind == 'ITV' && (moveKind == 'DSCH' || moveKind == 'LOAD') && (eventTypeDescription == 'TVCO' || eventTypeDescription == 'TYCO')) ~> filter1",
						"filter1 derive(Date = toDate(EcEventTime),",
						"          Day_of_Week = dayOfWeek(EcEventTime)) ~> derivedColumn1",
						"derivedColumn1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          cheName = CHE_Name,",
						"          cheID,",
						"          EcEventTime,",
						"          type = eventType,",
						"          subType = eventSubType,",
						"          typeDescription = eventTypeDescription,",
						"          fromCheIdName,",
						"          ToCheIdName,",
						"          unitIdName = unit,",
						"          powName = pow,",
						"          poolName = pool,",
						"          workQueue,",
						"          Laden = travelDistance,",
						"          moveKind,",
						"          isTwinMove = isTwin,",
						"          UnLaden = startDistance,",
						"          unitReference = unitRef,",
						"          tranId = tran_ID,",
						"          locType,",
						"          locId = locID,",
						"          locSlot,",
						"          opsPosId = opsPosID,",
						"          unladenLoctype,",
						"          unladenLocid = unladenLocID,",
						"          unladenLocSlot,",
						"          ladenLoctype,",
						"          ladenLocid = ladenLocID,",
						"          ladenLocSlot = laden_LocSlot,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          Date,",
						"          Day_of_Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 alterRow(upsertIf(true()),",
						"     insertIf(true())) ~> alterRow1",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'kattupalli',",
						"     folderPath: 'gold/laden_unladen',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ladenUnladen_malta')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ecevents"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as long,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as short,",
						"          ToCheIdName as short,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocId as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocId as string,",
						"          laden_LocSlot as string,",
						"          operatorName as string,",
						"          EcEventTime as timestamp,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'malta',",
						"     folderPath: 'silver/ecevents') ~> ecevents",
						"ecevents filter(cheKind == 'ITV' && (moveKind == 'DSCH' || moveKind == 'LOAD') && (typeDescription == 'TVCO' || typeDescription == 'TYCO')) ~> filter1",
						"filter1 derive(Date = toDate(EcEventTime),",
						"          Day_of_Week = dayOfWeek(EcEventTime)) ~> derivedColumn1",
						"derivedColumn1 select(mapColumn(",
						"          ecEventGkey,",
						"          cheKind,",
						"          cheName,",
						"          cheID,",
						"          EcEventTime,",
						"          type,",
						"          subType,",
						"          typeDescription,",
						"          unitIdName,",
						"          powName,",
						"          poolName,",
						"          Laden = travelDistance,",
						"          moveKind,",
						"          UnLaden = startDistance,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          Date,",
						"          Day_of_Week,",
						"          OperatorId = operatorName",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 alterRow(upsertIf(true()),",
						"     insertIf(true())) ~> alterRow1",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'malta',",
						"     folderPath: 'gold/laden_unladen',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ladenUnladen_mict')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ecevents"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as string,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as string,",
						"          startDistance as short,",
						"          workAssignment as float,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          lastEstMoveTime as string,",
						"          EcEventTime as timestamp,",
						"          cheID as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'mict',",
						"     folderPath: 'silver/ecevents') ~> ecevents",
						"ecevents filter(cheKind == 'ITV' && (moveKind == 'DSCH' || moveKind == 'LOAD') && (eventTypeDescription == 'TVCO' || eventTypeDescription == 'TYCO')) ~> filter1",
						"filter1 derive(Date = toDate(EcEventTime),",
						"          Day_of_Week = dayOfWeek(EcEventTime)) ~> derivedColumn1",
						"derivedColumn1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          cheName = CHE_Name,",
						"          cheID,",
						"          EcEventTime,",
						"          type = eventType,",
						"          subType = eventSubType,",
						"          typeDescription = eventTypeDescription,",
						"          fromCheIdName,",
						"          ToCheIdName,",
						"          unitIdName = unit,",
						"          powName = pow,",
						"          poolName = pool,",
						"          workQueue,",
						"          Laden = travelDistance,",
						"          moveKind,",
						"          isTwinMove = isTwin,",
						"          UnLaden = startDistance,",
						"          workAssignmentId = workAssignment,",
						"          unitReference = unitRef,",
						"          tranId = tran_ID,",
						"          locType,",
						"          locId = locID,",
						"          locSlot,",
						"          opsPosId = opsPosID,",
						"          unladenLoctype,",
						"          unladenLocid = unladenLocID,",
						"          unladenLocSlot,",
						"          ladenLoctype,",
						"          ladenLocid = ladenLocID,",
						"          ladenLocSlot = laden_LocSlot,",
						"          lastEstMoveTime,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          Date,",
						"          Day_of_Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 alterRow(upsertIf(true()),",
						"     insertIf(true())) ~> alterRow1",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mict',",
						"     folderPath: 'gold/laden_unladen',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ladenUnladen_mundra_ct02')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ecevents"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as short,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          workAssignment as double,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          EcEventTime as timestamp,",
						"          cheID as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer,",
						"          OPERATOR_ID as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'mundra-ct02',",
						"     folderPath: 'silver/ecevents') ~> ecevents",
						"ecevents filter(cheKind == 'ITV' && (moveKind == 'DSCH' || moveKind == 'LOAD') && (eventTypeDescription == 'TVCO' || eventTypeDescription == 'TYCO')) ~> filter1",
						"filter1 derive(Date = toDate(EcEventTime),",
						"          Day_of_Week = dayOfWeek(EcEventTime)) ~> derivedColumn1",
						"derivedColumn1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          cheName = CHE_Name,",
						"          cheID,",
						"          EcEventTime,",
						"          type = eventType,",
						"          subType = eventSubType,",
						"          typeDescription = eventTypeDescription,",
						"          fromCheIdName,",
						"          ToCheIdName,",
						"          unitIdName = unit,",
						"          powName = pow,",
						"          poolName = pool,",
						"          workQueue,",
						"          Laden = travelDistance,",
						"          moveKind,",
						"          isTwinMove = isTwin,",
						"          UnLaden = startDistance,",
						"          unitReference = unitRef,",
						"          tranId = tran_ID,",
						"          locType,",
						"          locId = locID,",
						"          locSlot,",
						"          opsPosId = opsPosID,",
						"          unladenLoctype,",
						"          unladenLocid = unladenLocID,",
						"          unladenLocSlot,",
						"          ladenLoctype,",
						"          ladenLocid = ladenLocID,",
						"          ladenLocSlot = laden_LocSlot,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          Date,",
						"          Day_of_Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 alterRow(upsertIf(true()),",
						"     insertIf(true())) ~> alterRow1",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mundra-ct02',",
						"     folderPath: 'gold/laden_unladen',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ladenUnladen_mundra_ct04')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ecevents"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as short,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          workAssignment as double,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          EcEventTime as timestamp,",
						"          cheID as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer,",
						"          OPERATOR_ID as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'mundra-ct04',",
						"     folderPath: 'silver/ecevents') ~> ecevents",
						"ecevents filter(cheKind == 'ITV' && (moveKind == 'DSCH' || moveKind == 'LOAD') && (eventTypeDescription == 'TVCO' || eventTypeDescription == 'TYCO')) ~> filter1",
						"filter1 derive(Date = toDate(EcEventTime),",
						"          Day_of_Week = dayOfWeek(EcEventTime)) ~> derivedColumn1",
						"derivedColumn1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          cheName = CHE_Name,",
						"          cheID,",
						"          EcEventTime,",
						"          type = eventType,",
						"          subType = eventSubType,",
						"          typeDescription = eventTypeDescription,",
						"          fromCheIdName,",
						"          ToCheIdName,",
						"          unitIdName = unit,",
						"          powName = pow,",
						"          poolName = pool,",
						"          workQueue,",
						"          Laden = travelDistance,",
						"          moveKind,",
						"          isTwinMove = isTwin,",
						"          UnLaden = startDistance,",
						"          unitReference = unitRef,",
						"          tranId = tran_ID,",
						"          locType,",
						"          locId = locID,",
						"          locSlot,",
						"          opsPosId = opsPosID,",
						"          unladenLoctype,",
						"          unladenLocid = unladenLocID,",
						"          unladenLocSlot,",
						"          ladenLoctype,",
						"          ladenLocid = ladenLocID,",
						"          ladenLocSlot = laden_LocSlot,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          Date,",
						"          Day_of_Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 alterRow(upsertIf(true()),",
						"     insertIf(true())) ~> alterRow1",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mundra-ct04',",
						"     folderPath: 'gold/laden_unladen',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ladenUnladen_rio')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ecevents"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as boolean,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          workAssignment as long,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          EcEventTime as timestamp,",
						"          cheID as long,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer,",
						"          OPERATOR_ID as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'rio',",
						"     folderPath: 'silver/ecevents') ~> ecevents",
						"ecevents filter(cheKind == 'ITV' && (moveKind == 'DSCH' || moveKind == 'LOAD') && (eventTypeDescription == 'TVCO' || eventTypeDescription == 'TYCO')) ~> filter1",
						"filter1 derive(Date = toDate(EcEventTime),",
						"          Day_of_Week = dayOfWeek(EcEventTime)) ~> derivedColumn1",
						"derivedColumn1 select(mapColumn(",
						"          ecEventGkey,",
						"          cheKind,",
						"          cheName = CHE_Name,",
						"          cheID,",
						"          EcEventTime,",
						"          type = eventType,",
						"          subType = eventSubType,",
						"          typeDescription = eventTypeDescription,",
						"          unitIdName = unit,",
						"          powName = pow,",
						"          poolName = pool,",
						"          Laden = travelDistance,",
						"          moveKind,",
						"          UnLaden = startDistance,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          Date,",
						"          Day_of_Week,",
						"          OperatorId = OPERATOR_ID",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 alterRow(upsertIf(true())) ~> alterRow1",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'rio',",
						"     folderPath: 'gold/laden_unladen',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ladenUnladen_socar')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ecevents"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as string,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          CHE_Name as string,",
						"          CHE_ID as string,",
						"          eventType as short,",
						"          eventSubType as short,",
						"          eventTypeDescription as string,",
						"          fromCheIdName as string,",
						"          ToCheIdName as string,",
						"          unit as string,",
						"          pow as string,",
						"          pool as string,",
						"          workQueue as string,",
						"          travelDistance as integer,",
						"          moveKind as string,",
						"          isTwin as boolean,",
						"          startDistance as short,",
						"          workAssignment as long,",
						"          unitRef as string,",
						"          tran_ID as string,",
						"          locType as string,",
						"          locID as string,",
						"          locSlot as string,",
						"          opsPosID as string,",
						"          unladenLoctype as string,",
						"          unladenLocID as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocID as string,",
						"          laden_LocSlot as string,",
						"          lastEstMoveTime as string,",
						"          operator_name as string,",
						"          EcEventTime as timestamp,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'socar',",
						"     folderPath: 'silver/ecevents') ~> ecevents",
						"ecevents filter(cheKind == 'ITV' && (moveKind == 'DSCH' || moveKind == 'LOAD') && (eventTypeDescription == 'TVCO' || eventTypeDescription == 'TYCO')) ~> filter1",
						"filter1 derive(Date = toDate(EcEventTime),",
						"          Day_of_Week = dayOfWeek(EcEventTime)) ~> derivedColumn1",
						"derivedColumn1 select(mapColumn(",
						"          ecEventGkey,",
						"          cheKind,",
						"          cheName = CHE_Name,",
						"          cheID = CHE_ID,",
						"          EcEventTime,",
						"          type = eventType,",
						"          subType = eventSubType,",
						"          typeDescription = eventTypeDescription,",
						"          unitIdName = unit,",
						"          powName = pow,",
						"          poolName = pool,",
						"          Laden = travelDistance,",
						"          moveKind,",
						"          UnLaden = startDistance,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          Date,",
						"          Day_of_Week,",
						"          OperatorId = operator_name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 alterRow(upsertIf(true())) ~> alterRow1",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'socar',",
						"     folderPath: 'gold/laden_unladen',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ladenUnladen_tauranga')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ecevents"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ecEventGkey as long,",
						"          yardGkey as long,",
						"          YardID as string,",
						"          FcyID as string,",
						"          cheKind as string,",
						"          cheName as string,",
						"          cheID as long,",
						"          EcEventTime as timestamp,",
						"          type as short,",
						"          subType as short,",
						"          typeDescription as string,",
						"          fromCheIdName as boolean,",
						"          ToCheIdName as boolean,",
						"          unitIdName as string,",
						"          powName as string,",
						"          poolName as string,",
						"          workQueue as string,",
						"          travelDistance as short,",
						"          moveKind as string,",
						"          isTwinMove as boolean,",
						"          startDistance as short,",
						"          workAssignmentId as long,",
						"          unitReference as string,",
						"          tranId as string,",
						"          locType as string,",
						"          locId as string,",
						"          locSlot as string,",
						"          opsPosId as string,",
						"          unladenLoctype as string,",
						"          unladenLocid as string,",
						"          unladenLocSlot as string,",
						"          ladenLoctype as string,",
						"          ladenLocid as string,",
						"          ladenLocSlot as string,",
						"          lastEstMoveTime as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'tauranga',",
						"     folderPath: 'silver/ecevents') ~> ecevents",
						"ecevents filter(cheKind == 'SC' && ((moveKind == 'DSCH' && typeDescription == 'LTRW') || (moveKind == 'LOAD' && typeDescription == 'LTSH'))) ~> filter1",
						"filter1 derive(Date = toDate(EcEventTime),",
						"          Day_of_Week = dayOfWeek(EcEventTime)) ~> derivedColumn1",
						"derivedColumn1 select(mapColumn(",
						"          ecEventGkey,",
						"          yardGkey,",
						"          YardID,",
						"          FcyID,",
						"          cheKind,",
						"          cheName,",
						"          cheID,",
						"          EcEventTime,",
						"          type,",
						"          subType,",
						"          typeDescription,",
						"          fromCheIdName,",
						"          ToCheIdName,",
						"          unitIdName,",
						"          powName,",
						"          poolName,",
						"          workQueue,",
						"          Laden = travelDistance,",
						"          moveKind,",
						"          isTwinMove,",
						"          UnLaden = startDistance,",
						"          workAssignmentId,",
						"          unitReference,",
						"          tranId,",
						"          locType,",
						"          locId,",
						"          locSlot,",
						"          opsPosId,",
						"          unladenLoctype,",
						"          unladenLocid,",
						"          unladenLocSlot,",
						"          ladenLoctype,",
						"          ladenLocid,",
						"          ladenLocSlot,",
						"          lastEstMoveTime,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          Date,",
						"          Day_of_Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 alterRow(upsertIf(true())) ~> alterRow1",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'tauranga',",
						"     folderPath: 'gold/laden_unladen',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['ecEventGkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/malta_moves_time_delta')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "malta"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "LOAD"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "DSCH"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "split1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as string,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as string,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as string,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as string,",
						"          dist_start as string,",
						"          Twin_Fetch as string,",
						"          Twin_Carry as string,",
						"          Twin_Put as string,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as string,",
						"          fm_pos_gkey as string,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as string,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as string,",
						"          active_ufv as string,",
						"          Requires_Power_Flag as string,",
						"          OOG_Flag as string,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as string,",
						"          ATD as timestamp,",
						"          Rehandles as string,",
						"          ATA as timestamp,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'malta',",
						"     folderPath: 'silver/moves') ~> malta",
						"filter1 derive(exec_delta_16 = iif(:exec_time > 16, true(), false()),",
						"          t_execution_delta = :exec_time,",
						"          exec_time := (t_carry_complete - t_fetch)/60000) ~> derivedColumn1",
						"malta filter(Carry_CHE_Kind==\"ITV\") ~> filter1",
						"derivedColumn1 select(mapColumn(",
						"          mve_gkey,",
						"          Unit_Nbr,",
						"          Facility_Id,",
						"          Yard_Id,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Location,",
						"          To_Location,",
						"          From_Position_Name,",
						"          To_Position_Name,",
						"          Carry_CHE_Kind,",
						"          t_carry_complete,",
						"          t_put,",
						"          t_fetch,",
						"          Category_Id,",
						"          Freight_Kind_Id,",
						"          pow,",
						"          Commodity_Id,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          exec_delta_16,",
						"          t_execution_delta",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"filter2 alterRow(upsertIf(true())) ~> alterRow1",
						"select1 filter((t_execution_delta >= 0.0) || (t_execution_delta >= 0)) ~> filter2",
						"alterRow1 split(Event_Type_Id == \"UNIT_LOAD\",",
						"     Event_Type_Id == \"UNIT_DISCH\",",
						"     disjoint: false) ~> split1@(load, discharge)",
						"split1@load sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'malta',",
						"     folderPath: 'gold/load_time_delta',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> LOAD",
						"split1@discharge sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'malta',",
						"     folderPath: 'gold/dsch_time_delta',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> DSCH"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/mct_moves_time_delta')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "mct"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "LOAD"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "DSCH"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "split1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as integer,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as string,",
						"          Fetch_CHE_Operator_Id as integer,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as short,",
						"          dist_start as short,",
						"          Twin_Fetch as boolean,",
						"          Twin_Carry as boolean,",
						"          Twin_Put as boolean,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as boolean,",
						"          OOG_Flag as boolean,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as short,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as short,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'mct',",
						"     folderPath: 'silver/moves') ~> mct",
						"filter1 derive(exec_delta_10 = iif(:exec_time > 10, true(), false()),",
						"          t_execution_delta = :exec_time,",
						"          exec_time := (t_carry_complete - t_fetch)/60000) ~> derivedColumn1",
						"mct filter(Carry_CHE_Kind==\"SC\" && not(isNull(t_fetch)) && not(isNull(t_carry_complete))) ~> filter1",
						"derivedColumn1 select(mapColumn(",
						"          mve_gkey,",
						"          Unit_Nbr,",
						"          Facility_Id,",
						"          Yard_Id,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Location,",
						"          To_Location,",
						"          From_Position_Name,",
						"          To_Position_Name,",
						"          Carry_CHE_Kind,",
						"          t_carry_complete,",
						"          t_put,",
						"          t_fetch,",
						"          Category_Id,",
						"          Freight_Kind_Id,",
						"          pow,",
						"          Commodity_Id,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          exec_delta_16 = exec_delta_10,",
						"          t_execution_delta",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"filter2 alterRow(upsertIf(true())) ~> alterRow1",
						"select1 filter((t_execution_delta >= 0.0) && (t_execution_delta >= 0) && not(isNull(t_execution_delta))) ~> filter2",
						"alterRow1 split(Event_Type_Id == \"UNIT_LOAD\",",
						"     Event_Type_Id == \"UNIT_DISCH\",",
						"     disjoint: false) ~> split1@(load, discharge)",
						"split1@load sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mct',",
						"     folderPath: 'gold/load_time_delta',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> LOAD",
						"split1@discharge sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mct',",
						"     folderPath: 'gold/dsch_time_delta',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> DSCH"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/mict_moves_time_delta')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "mict"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink2"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "split1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as integer,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as short,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as integer,",
						"          dist_start as short,",
						"          Twin_Fetch as string,",
						"          Twin_Carry as string,",
						"          Twin_Put as string,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as string,",
						"          OOG_Flag as string,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'mict',",
						"     folderPath: 'silver/moves') ~> mict",
						"filter1 derive(exec_delta_16 = iif(:exec_time > 16, true(), false()),",
						"          t_execution_delta = :exec_time,",
						"          exec_time := (t_carry_complete - t_fetch)/60000) ~> derivedColumn1",
						"mict filter(Carry_CHE_Kind==\"ITV\") ~> filter1",
						"derivedColumn1 select(mapColumn(",
						"          mve_gkey,",
						"          Unit_Nbr,",
						"          Facility_Id,",
						"          Yard_Id,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Location,",
						"          To_Location,",
						"          From_Position_Name,",
						"          To_Position_Name,",
						"          Carry_CHE_Kind,",
						"          t_carry_complete,",
						"          t_put,",
						"          t_fetch,",
						"          Category_Id,",
						"          Freight_Kind_Id,",
						"          pow,",
						"          Commodity_Id,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          exec_delta_16,",
						"          t_execution_delta",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"filter2 alterRow(upsertIf(true())) ~> alterRow1",
						"select1 filter((t_execution_delta >= 0.0) || (t_execution_delta >= 0)) ~> filter2",
						"alterRow1 split(Event_Type_Id == \"UNIT_LOAD\",",
						"     Event_Type_Id == \"UNIT_DISCH\",",
						"     disjoint: false) ~> split1@(load, discharge)",
						"split1@load sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mict',",
						"     folderPath: 'gold/load_time_delta',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1",
						"split1@discharge sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mict',",
						"     folderPath: 'gold/dsch_time_delta',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink2"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/movesPerUfv_cmsa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Move counts Grouping by UFV to be used for Unproductive Moves report",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "Sort2"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "window1"
						},
						{
							"name": "select2"
						}
					],
					"script": "parameters{\n\tcustomer as string ('cmsa')\n}\nsource(output(\n\t\tmve_gkey as integer,\n\t\tUnit_Nbr as string,\n\t\tFacility_Id as string,\n\t\tComplex_Id as string,\n\t\tYard_Id as string,\n\t\tCarrier_Visit_Key as integer,\n\t\tEvent_Type_Id as string,\n\t\tMove_Kind as string,\n\t\tFrom_Location as string,\n\t\tTo_Location as string,\n\t\tFrom_Position_Name as string,\n\t\tTo_Position_Name as string,\n\t\tCarry_CHE_Operator_Id as string,\n\t\tFetch_CHE_Operator_Id as string,\n\t\tPut_CHE_Operator_Id as string,\n\t\tFetch_CHE_Id as long,\n\t\tFetch_CHE_Kind as string,\n\t\tCarry_CHE_Id as long,\n\t\tCarry_CHE_Kind as string,\n\t\tPut_CHE_Id as long,\n\t\tPut_CHE_Kind as string,\n\t\tQC_CHE_Id as long,\n\t\tQC_CHE_Kind as string,\n\t\tt_carry_complete as timestamp,\n\t\tt_put as timestamp,\n\t\tt_fetch as timestamp,\n\t\tt_dispatch as timestamp,\n\t\tt_discharge as timestamp,\n\t\tt_carry_dispatch as timestamp,\n\t\tt_carry_fetch_ready as timestamp,\n\t\tt_carry_put_ready as timestamp,\n\t\tdist_carry as short,\n\t\tdist_start as short,\n\t\tTwin_Fetch as string,\n\t\tTwin_Carry as string,\n\t\tTwin_Put as string,\n\t\tCategory_Id as string,\n\t\tFreight_Kind_Id as string,\n\t\tto_pos_gkey as integer,\n\t\tfm_pos_gkey as integer,\n\t\tRestow_Reason as string,\n\t\tContainer_Line_Id as string,\n\t\tContainer_Line_Role as string,\n\t\tpow as string,\n\t\tufv_gkey as integer,\n\t\tBerth_Id as string,\n\t\tGoods_And_Ctr_Wt_Kg as string,\n\t\tactive_ufv as integer,\n\t\tRequires_Power_Flag as string,\n\t\tOOG_Flag as string,\n\t\tShipper_Id as long,\n\t\tConsignee_Id as string,\n\t\tCommodity_Id as string,\n\t\tATA as timestamp,\n\t\tATD as timestamp,\n\t\tRehandles as short,\n\t\tYear as integer,\n\t\tMonth as integer,\n\t\tWeek as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'silver/moves',\n\tmode: 'read') ~> source1\nselect2 sort(asc(ufv_gkey, true),\n\tasc(t_put, true)) ~> Sort2\nwindow1 alterRow(upsertIf(true())) ~> AlterRow1\nSort2 window(over(ufv_gkey),\n\tasc(t_put, true),\n\tasc(mve_gkey, true),\n\tRNumber = rowNumber(),\n\t\tMovesPerFcyVisit = count(mve_gkey)) ~> window1\nsource1 select(mapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tt_put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tufv_gkey,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tYear,\n\t\tMonth,\n\t\tWeek\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> select2\nAlterRow1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'delta',\n\tfileSystem: 'cmsa',\n\tfolderPath: 'gold/movesPerUfv',\n\ttruncate: true,\n\tmergeSchema: false,\n\tautoCompact: false,\n\toptimizedWrite: false,\n\tvacuum: 0,\n\tdeletable: false,\n\tinsertable: true,\n\tupdateable: false,\n\tupsertable: false,\n\tkeys:['ufv_gkey','mve_gkey'],\n\tumask: 0022,\n\tpreCommands: [],\n\tpostCommands: [],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tmve_gkey,\n\t\tUnit_Nbr,\n\t\tEvent_Type_Id,\n\t\tMove_Kind,\n\t\tFrom_Position_Name,\n\t\tTo_Position_Name,\n\t\tt_put,\n\t\tCategory_Id,\n\t\tFreight_Kind_Id,\n\t\tufv_gkey,\n\t\tRequires_Power_Flag,\n\t\tOOG_Flag,\n\t\tYear,\n\t\tMonth,\n\t\tWeek,\n\t\tRNumber,\n\t\tMovesPerFcyVisit\n\t)) ~> sink1"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/renomination_sgtd')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "source2"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "RenominationHkDone"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "RenominationHkNotDone"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "RenominationLoadMoves"
						}
					],
					"transformations": [
						{
							"name": "select1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "split1"
						},
						{
							"name": "join1"
						},
						{
							"name": "join2"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "alterRow2"
						},
						{
							"name": "alterRow3"
						}
					],
					"scriptLines": [
						"source(output(",
						"          GKEY as long,",
						"          OPERATOR_GKEY as long,",
						"          COMPLEX_GKEY as long,",
						"          FACILITY_GKEY as long,",
						"          YARD_GKEY as long,",
						"          PLACED_BY as string,",
						"          PLACED_TIME as string,",
						"          EVENT_TYPE_GKEY as double,",
						"          APPLIED_TO_CLASS as string,",
						"          APPLIED_TO_GKEY as double,",
						"          APPLIED_TO_NATURAL_KEY as string,",
						"          NOTE as string,",
						"          BILLING_EXTRACT_BATCH_ID as double,",
						"          QUANTITY as string,",
						"          QUANTITY_UNIT as string,",
						"          RESPONSIBLE_PARTY as string,",
						"          RELATED_ENTITY_GKEY as double,",
						"          RELATED_ENTITY_ID as string,",
						"          RELATED_ENTITY_CLASS as string,",
						"          RELATED_BATCH_ID as double,",
						"          ACKNOWLEDGED as string,",
						"          ACKNOWLEDGED_BY as string,",
						"          FLEX_STRING01 as string,",
						"          FLEX_STRING02 as string,",
						"          FLEX_STRING03 as string,",
						"          FLEX_STRING04 as string,",
						"          FLEX_STRING05 as string,",
						"          FLEX_DATE01 as string,",
						"          FLEX_DATE02 as string,",
						"          FLEX_DATE03 as string,",
						"          FLEX_DOUBLE01 as string,",
						"          FLEX_DOUBLE02 as string,",
						"          FLEX_DOUBLE03 as string,",
						"          FLEX_DOUBLE04 as string,",
						"          FLEX_DOUBLE05 as string,",
						"          CREATED as string,",
						"          CREATOR as string,",
						"          CHANGED as string,",
						"          CHANGER as string,",
						"          PRIMARY_EVENT_GKEY as string,",
						"          NODE_ID as string,",
						"          {Unnamed: 0} as string,",
						"          {Unnamed: 1} as string,",
						"          {Unnamed: 2} as string,",
						"          {Unnamed: 3} as string,",
						"          {Unnamed: 4} as string,",
						"          {Unnamed: 5} as string,",
						"          {Unnamed: 6} as string,",
						"          {Unnamed: 7} as string,",
						"          {Unnamed: 8} as string,",
						"          {Unnamed: 9} as string,",
						"          {Unnamed: 10} as string,",
						"          {Unnamed: 11} as string,",
						"          {Unnamed: 12} as string,",
						"          {Unnamed: 13} as string,",
						"          {Unnamed: 14} as string,",
						"          {Unnamed: 15} as string,",
						"          {Unnamed: 16} as string,",
						"          {Unnamed: 17} as string,",
						"          {Unnamed: 18} as string,",
						"          {Unnamed: 19} as string,",
						"          {Unnamed: 20} as string,",
						"          {Unnamed: 21} as string,",
						"          {Unnamed: 22} as string,",
						"          {Unnamed: 23} as string,",
						"          {Unnamed: 24} as string,",
						"          {Unnamed: 25} as string,",
						"          {Unnamed: 26} as string,",
						"          {Unnamed: 27} as string,",
						"          {Unnamed: 28} as string,",
						"          {Unnamed: 29} as string,",
						"          {Unnamed: 30} as string,",
						"          {Unnamed: 31} as string,",
						"          {Unnamed: 32} as string,",
						"          {Unnamed: 33} as string,",
						"          {Unnamed: 34} as string,",
						"          {Unnamed: 35} as string,",
						"          {Unnamed: 36} as string,",
						"          {Unnamed: 37} as string,",
						"          {Unnamed: 38} as string,",
						"          {Unnamed: 39} as string,",
						"          {Unnamed: 40} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     moveFiles: ['/bronze/renomination/load','/bronze/renomination/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'bronze/renomination/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> source1",
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as integer,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as short,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as integer,",
						"          dist_start as short,",
						"          Twin_Fetch as string,",
						"          Twin_Carry as string,",
						"          Twin_Put as string,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as string,",
						"          OOG_Flag as string,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/moves/load','/bronze/moves/archive'],",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'silver/moves') ~> source2",
						"source1 select(mapColumn(",
						"          GKEY,",
						"          UNIT_ID = APPLIED_TO_NATURAL_KEY,",
						"          NOTE,",
						"          PLACED = PLACED_TIME",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"source2 select(mapColumn(",
						"          mve_gkey,",
						"          Unit_Nbr,",
						"          Yard_Id,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          t_carry_complete,",
						"          t_put,",
						"          Carry_CHE_Kind,",
						"          Carry_CHE_Id,",
						"          Category_Id,",
						"          Freight_Kind_Id,",
						"          pow,",
						"          Year,",
						"          Month,",
						"          Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"select1 filter(not(isNull(GKEY)) && not(isNull(UNIT_ID)) && (NOTE==\"SRV_UNIT_POD_CHANGE Event Updated\" || NOTE==\"SRV_UNIT_VESSEL_CHANGE Event Updated\")) ~> filter1",
						"select2 filter(not(isNull(Unit_Nbr)) && (Category_Id == \"TRSHP\" || Category_Id == \"EXPRT\") && (Freight_Kind_Id == \"FCL\" || Freight_Kind_Id == \"LCL\")) ~> filter2",
						"filter2 split(Event_Type_Id == \"UNIT_YARD_MOVE\",",
						"     Event_Type_Id != \"UNIT_YARD_MOVE\",",
						"     Event_Type_Id != \"UNIT_LOAD\",",
						"     disjoint: true) ~> split1@(RenominationHkDone, RenominationHkNotDone, RenominationLoadMoves)",
						"split1@RenominationHkDone, derivedColumn1 join(Unit_Nbr == UNIT_ID",
						"     && t_put >= PLACED,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'right')~> join1",
						"split1@RenominationHkNotDone, derivedColumn1 join(Unit_Nbr == UNIT_ID",
						"     && t_put >= PLACED,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'right')~> join2",
						"filter1 derive(PLACED = coalesce(toTimestamp(concat(substring(PLACED, 1, 22), ' ', substring(PLACED, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),toTimestamp(PLACED,'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(PLACED,'MM/dd/yyyy HH:mm:ss'),toTimestamp(PLACED,'dd-MM-yy HH:mm:ss'),toTimestamp(PLACED,'dd/MM/yyyy\\'T\\'HH:mm:ss'),toTimestamp(PLACED,'dd/MM/yyyy HH:mm:ss'),toTimestamp(PLACED,'dd-MM-yyyy HH:mm:ss'))) ~> derivedColumn1",
						"join1 derive(POD_CHANGE_FLAG = iif((NOTE==\"SRV_UNIT_POD_CHANGE Event Updated\"), true(), false()),",
						"          VESSEL_CHANGE_FLAG = iif((NOTE==\"SRV_UNIT_VESSEL_CHANGE Event Updated\"), true(), false())) ~> derivedColumn2",
						"join2 derive(POD_CHANGE_FLAG = iif(NOTE==\"SRV_UNIT_POD_CHANGE Event Updated\", true(), false()),",
						"          VESSEL_CHANGE_FLAG = iif(NOTE==\"SRV_UNIT_VESSEL_CHANGE Event Updated\", true(), false())) ~> derivedColumn3",
						"split1@RenominationLoadMoves alterRow(upsertIf(true())) ~> alterRow1",
						"derivedColumn2 alterRow(upsertIf(true())) ~> alterRow2",
						"derivedColumn3 alterRow(upsertIf(true())) ~> alterRow3",
						"alterRow2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'gold/renomination_hk_done',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey','GKEY'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> RenominationHkDone",
						"alterRow3 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'gold/renomination_hk_not_done',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey','GKEY'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> RenominationHkNotDone",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'gold/renomination_load_moves',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> RenominationLoadMoves"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/rio_moves_time_delta')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "rio"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "LOAD"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "DSCH"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "split1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as integer,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as string,",
						"          Fetch_CHE_Operator_Id as integer,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as short,",
						"          dist_start as short,",
						"          Twin_Fetch as boolean,",
						"          Twin_Carry as boolean,",
						"          Twin_Put as boolean,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as boolean,",
						"          OOG_Flag as boolean,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as short,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as short,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'rio',",
						"     folderPath: 'silver/moves') ~> rio",
						"filter1 derive(exec_delta_16 = iif(:exec_time > 16, true(), false()),",
						"          t_execution_delta = :exec_time,",
						"          exec_time := (t_carry_complete - t_fetch)/60000) ~> derivedColumn1",
						"rio filter(Carry_CHE_Kind==\"ITV\") ~> filter1",
						"derivedColumn1 select(mapColumn(",
						"          mve_gkey,",
						"          Unit_Nbr,",
						"          Facility_Id,",
						"          Yard_Id,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Location,",
						"          To_Location,",
						"          From_Position_Name,",
						"          To_Position_Name,",
						"          Carry_CHE_Kind,",
						"          t_carry_complete,",
						"          t_put,",
						"          t_fetch,",
						"          Category_Id,",
						"          Freight_Kind_Id,",
						"          pow,",
						"          Commodity_Id,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          exec_delta_16,",
						"          t_execution_delta",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"filter2 alterRow(upsertIf(true())) ~> alterRow1",
						"select1 filter((t_execution_delta >= 0.0) || (t_execution_delta >= 0)) ~> filter2",
						"alterRow1 split(Event_Type_Id == \"UNIT_LOAD\",",
						"     Event_Type_Id == \"UNIT_DISCH\",",
						"     disjoint: false) ~> split1@(load, discharge)",
						"split1@load sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'rio',",
						"     folderPath: 'gold/load_time_delta',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> LOAD",
						"split1@discharge sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'rio',",
						"     folderPath: 'gold/dsch_time_delta',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> DSCH"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/section_confirmity_AGCT')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "SectionConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "SectionConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Equipment ID} as string,",
						"          {Stacking Factor} as string,",
						"          CHE as string,",
						"          {Blk Typ} as string,",
						"          Type as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['bronze/sectionconformity/load','bronze/stackconformity/archive'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'agct',",
						"     folderPath: 'bronze/sectionconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> SectionConfirmity",
						"SectionConfirmity derive(Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          {Yard Row}),",
						"     asc({Section Factor}, true),",
						"     sectionrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          {Yard Row}),",
						"     Section_conformity = iif(max(sectionrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && SectionConfirmity@{Yard Row} == aggregate1@{Yard Row},",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.} = {Equipment ID},",
						"          {Stacking Factor},",
						"          CHE,",
						"          {Blk Typ},",
						"          Type,",
						"          {Current position} = {Current Position},",
						"          {Yard Row} = SectionConfirmity@{Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Section_conformity",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Equipment ID})) && not(isNull({Equipment ID})) && {Equipment ID} != '') ~> filter1",
						"select2 alterRow(insertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'agct',",
						"     folderPath: 'gold/section_conformity',",
						"     mergeSchema: true,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SectionConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/section_confirmity_CGSA')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "SectionConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "SectionConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Equipment ID} as string,",
						"          {Stacking Factor} as string,",
						"          CHE as string,",
						"          {Blk Typ} as string,",
						"          Type as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/sectionconformity/load','bronze/stackconformity/archive'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'cgsa',",
						"     folderPath: 'bronze/sectionconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> SectionConfirmity",
						"SectionConfirmity derive(Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          {Yard Row}),",
						"     asc({Section Factor}, true),",
						"     sectionrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          {Yard Row}),",
						"     Section_conformity = iif(max(sectionrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && SectionConfirmity@{Yard Row} == aggregate1@{Yard Row},",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.} = {Equipment ID},",
						"          {Stacking Factor},",
						"          CHE,",
						"          {Blk Typ},",
						"          Type,",
						"          {Current position} = {Current Position},",
						"          {Yard Row} = SectionConfirmity@{Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Section_conformity",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Equipment ID})) && not(isNull({Equipment ID})) && {Equipment ID} != '') ~> filter1",
						"select2 alterRow(upsertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cgsa',",
						"     folderPath: 'gold/section_conformity',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SectionConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/section_confirmity_CMATK')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "SectionConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "SectionConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Container No.} as string,",
						"          {Stacking Factor} as string,",
						"          CHE as string,",
						"          {Blk Typ} as string,",
						"          {Equip Class} as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Category as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['bronze/sectionconformity/load','bronze/stackconformity/archive'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'cmatk',",
						"     folderPath: 'bronze/sectionconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> SectionConfirmity",
						"SectionConfirmity derive(Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          Yard_Block = left({Yard Row}, 3),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          {Yard Row}),",
						"     asc({Section Factor}, true),",
						"     sectionrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          {Yard Row}),",
						"     Section_conformity = iif(max(sectionrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && SectionConfirmity@{Yard Row} == aggregate1@{Yard Row},",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No} = {Container No.},",
						"          {Stacking Factor},",
						"          CHE,",
						"          {Blk Typ},",
						"          {Equip Class},",
						"          {Current Position},",
						"          Category,",
						"          Sts,",
						"          {Section Factor},",
						"          Week,",
						"          sectionrank,",
						"          Date = aggregate1@Date,",
						"          {Yard Row} = aggregate1@{Yard Row},",
						"          Yard_Block,",
						"          Section_conformity",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No}, true)) ~> sort1",
						"join1 filter(not(isDate({Container No.})) && not(isNull({Container No.})) && {Container No.} != '') ~> filter1",
						"select2 alterRow(insertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmatk',",
						"     folderPath: 'gold/section_conformity',",
						"     mergeSchema: true,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SectionConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/section_confirmity_MICT')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "SectionConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "SectionConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Container No.} as string,",
						"          {Stacking Factor} as string,",
						"          CHE as string,",
						"          {Blk Typ} as string,",
						"          Type as string,",
						"          {Current position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/sectionconformity/load','bronze/stackconformity/archive'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'mict',",
						"     folderPath: 'bronze/sectionconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> SectionConfirmity",
						"SectionConfirmity derive(Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          {Yard Row}),",
						"     asc({Section Factor}, true),",
						"     sectionrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          {Yard Row}),",
						"     Section_conformity = iif(max(sectionrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && SectionConfirmity@{Yard Row} == aggregate1@{Yard Row},",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.},",
						"          {Stacking Factor},",
						"          CHE,",
						"          {Blk Typ},",
						"          Type,",
						"          {Current position},",
						"          {Yard Row} = SectionConfirmity@{Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Section_conformity",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Container No.})) && not(isNull({Container No.})) && {Container No.} != '') ~> filter1",
						"select2 alterRow(upsertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mict',",
						"     folderPath: 'gold/section_conformity',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SectionConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/section_confirmity_MNHPI')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "SectionConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "SectionConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Equipment ID} as string,",
						"          {Stacking Factor} as string,",
						"          CHE as string,",
						"          {Blk Typ} as string,",
						"          Type as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/sectionconformity/load','bronze/stackconformity/archive'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'bronze/sectionconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> SectionConfirmity",
						"SectionConfirmity derive(Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          {Yard Row}),",
						"     asc({Section Factor}, true),",
						"     sectionrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          {Yard Row}),",
						"     Section_conformity = iif(max(sectionrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && SectionConfirmity@{Yard Row} == aggregate1@{Yard Row},",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.} = {Equipment ID},",
						"          {Stacking Factor},",
						"          CHE,",
						"          {Blk Typ},",
						"          Type,",
						"          {Current position} = {Current Position},",
						"          {Yard Row} = SectionConfirmity@{Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Section_conformity",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Equipment ID})) && not(isNull({Equipment ID})) && {Equipment ID} != '') ~> filter1",
						"select2 alterRow(insertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'gold/section_conformity',",
						"     mergeSchema: true,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SectionConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/section_confirmity_RIO')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "SectionConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "SectionConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Equipment ID} as string,",
						"          {Stacking Factor} as string,",
						"          CHE as string,",
						"          {Blk Typ} as string,",
						"          Type as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/sectionconformity/load','bronze/stackconformity/archive'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'rio',",
						"     folderPath: 'bronze/sectionconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> SectionConfirmity",
						"SectionConfirmity derive(Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          {Yard Row}),",
						"     asc({Section Factor}, true),",
						"     sectionrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          {Yard Row}),",
						"     Section_conformity = iif(max(sectionrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && SectionConfirmity@{Yard Row} == aggregate1@{Yard Row},",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.} = {Equipment ID},",
						"          {Stacking Factor},",
						"          CHE,",
						"          {Blk Typ},",
						"          Type,",
						"          {Current position} = {Current Position},",
						"          {Yard Row} = SectionConfirmity@{Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Section_conformity",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Equipment ID})) && not(isNull({Equipment ID})) && {Equipment ID} != '') ~> filter1",
						"select2 alterRow(insertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'rio',",
						"     folderPath: 'gold/section_conformity',",
						"     mergeSchema: true,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SectionConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/section_confirmity_VICT')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "SectionConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "SectionConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Equipment ID} as string,",
						"          {Stacking Factor} as string,",
						"          {Assigned CHE} as string,",
						"          {Blk Typ} as string,",
						"          Type as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/sectionconformity/load','bronze/stackconformity/archive'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'vict',",
						"     folderPath: 'bronze/sectionconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> SectionConfirmity",
						"SectionConfirmity derive(Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          {Yard Row}),",
						"     asc({Section Factor}, true),",
						"     sectionrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          {Yard Row}),",
						"     Section_conformity = iif(max(sectionrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && SectionConfirmity@{Yard Row} == aggregate1@{Yard Row},",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.} = {Equipment ID},",
						"          {Stacking Factor},",
						"          CHE = {Assigned CHE},",
						"          {Blk Typ},",
						"          Type,",
						"          {Current position} = {Current Position},",
						"          {Yard Row} = SectionConfirmity@{Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Section_conformity",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Equipment ID})) && not(isNull({Equipment ID})) && {Equipment ID} != '') ~> filter1",
						"select2 alterRow(upsertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'vict',",
						"     folderPath: 'gold/section_conformity',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SectionConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/section_confirmity_hazira')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "SectionConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "SectionConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Container No.} as string,",
						"          {Stacking Factor} as string,",
						"          {Assigned CHE} as string,",
						"          {Blk Typ} as string,",
						"          Class as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['bronze/sectionconformity/load','bronze/stackconformity/archive'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'hazira',",
						"     folderPath: 'bronze/sectionconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> SectionConfirmity",
						"SectionConfirmity derive(Date = toDate(substring(FileDate, -10, 6), 'ddMMyy'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -10, 6), 'ddMMyy')) == 1,  weekOfYear(toDate(substring(FileDate, -10, 6), 'ddMMyy')) + 1, weekOfYear(toDate(substring(FileDate, -10, 6), 'ddMMyy'))),",
						"          Yard_Block = left({Yard Row}, 3),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          {Yard Row}),",
						"     asc({Section Factor}, true),",
						"     sectionrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          {Yard Row}),",
						"     Section_conformity = iif(max(sectionrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && SectionConfirmity@{Yard Row} == aggregate1@{Yard Row},",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No} = {Container No.},",
						"          {Stacking Factor},",
						"          CHE = {Assigned CHE},",
						"          {Blk Typ},",
						"          {Equip Class} = Class,",
						"          {Current Position},",
						"          Category = Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Week,",
						"          sectionrank,",
						"          Date = aggregate1@Date,",
						"          {Yard Row} = aggregate1@{Yard Row},",
						"          Yard_Block,",
						"          Section_conformity",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No}, true)) ~> sort1",
						"join1 filter(not(isDate({Container No.})) && not(isNull({Container No.})) && {Container No.} != '') ~> filter1",
						"select2 alterRow(insertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'hazira',",
						"     folderPath: 'gold/section_conformity',",
						"     mergeSchema: true,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SectionConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/sgtd_moves_time_delta_new')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sgtd"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink2"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "split1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as integer,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as short,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as integer,",
						"          dist_start as short,",
						"          Twin_Fetch as string,",
						"          Twin_Carry as string,",
						"          Twin_Put as string,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as string,",
						"          OOG_Flag as string,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'silver/moves') ~> sgtd",
						"filter1 derive(exec_delta_16 = iif(:exec_time > 16, true(), false()),",
						"          t_execution_delta = :exec_time,",
						"          exec_time := (t_carry_complete - t_fetch)/60000) ~> derivedColumn1",
						"sgtd filter(Carry_CHE_Kind==\"ITV\") ~> filter1",
						"derivedColumn1 select(mapColumn(",
						"          mve_gkey,",
						"          Unit_Nbr,",
						"          Facility_Id,",
						"          Yard_Id,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Location,",
						"          To_Location,",
						"          From_Position_Name,",
						"          To_Position_Name,",
						"          Carry_CHE_Kind,",
						"          t_carry_complete,",
						"          t_put,",
						"          t_fetch,",
						"          Category_Id,",
						"          Freight_Kind_Id,",
						"          pow,",
						"          Commodity_Id,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          exec_delta_16,",
						"          t_execution_delta",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"filter2 alterRow(upsertIf(true())) ~> alterRow1",
						"select1 filter((t_execution_delta >= 0.0) || (t_execution_delta >= 0)) ~> filter2",
						"alterRow1 split(Event_Type_Id == \"UNIT_LOAD\",",
						"     Event_Type_Id == \"UNIT_DISCH\",",
						"     disjoint: false) ~> split1@(load, discharge)",
						"split1@load sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'gold/load_time_delta',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1",
						"split1@discharge sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'gold/dsch_time_delta',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink2"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/sgtd_moves_time_delta_temp')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sgtd"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "filter2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as integer,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as short,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as integer,",
						"          dist_start as short,",
						"          Twin_Fetch as string,",
						"          Twin_Carry as string,",
						"          Twin_Put as string,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as double,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as string,",
						"          OOG_Flag as string,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as string,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'silver/moves') ~> sgtd",
						"filter1 derive(exec_delta_16 = iif(:exec_time > 16, true(), false()),",
						"          t_execution_delta = :exec_time,",
						"          exec_time := (t_carry_complete - t_fetch)/60000) ~> derivedColumn1",
						"sgtd filter(Carry_CHE_Kind==\"ITV\") ~> filter1",
						"filter2 select(mapColumn(",
						"          mve_gkey,",
						"          Unit_Nbr,",
						"          Facility_Id,",
						"          Yard_Id,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Location,",
						"          To_Location,",
						"          From_Position_Name,",
						"          To_Position_Name,",
						"          Carry_CHE_Kind,",
						"          t_carry_complete,",
						"          t_put,",
						"          t_fetch,",
						"          Category_Id,",
						"          Freight_Kind_Id,",
						"          pow,",
						"          Commodity_Id,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          exec_delta_16,",
						"          t_execution_delta",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 alterRow(upsertIf(true())) ~> alterRow1",
						"derivedColumn1 filter(Event_Type_Id == \"UNIT_LOAD\" && not(isNull(t_put)) && toDate(t_put) < toDate(\"01-08-2025\", \"dd-MM-yyyy\") && toDate(t_put) > toDate(\"12-06-2025\", \"dd-MM-yyyy\")) ~> filter2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'gold/load_time_delta',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sink1"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/socar_moves_time_delta')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "socar"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "LOAD"
						},
						{
							"linkedService": {
								"referenceName": "linkedService1",
								"type": "LinkedServiceReference"
							},
							"name": "DSCH"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "select1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "split1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          mve_gkey as integer,",
						"          Unit_Nbr as string,",
						"          Facility_Id as string,",
						"          Complex_Id as string,",
						"          Yard_Id as string,",
						"          Carrier_Visit_Key as string,",
						"          Event_Type_Id as string,",
						"          Move_Kind as string,",
						"          From_Location as string,",
						"          To_Location as string,",
						"          From_Position_Name as string,",
						"          To_Position_Name as string,",
						"          Carry_CHE_Operator_Id as string,",
						"          Fetch_CHE_Operator_Id as string,",
						"          Put_CHE_Operator_Id as string,",
						"          Fetch_CHE_Id as long,",
						"          Fetch_CHE_Kind as string,",
						"          Carry_CHE_Id as long,",
						"          Carry_CHE_Kind as string,",
						"          Put_CHE_Id as long,",
						"          Put_CHE_Kind as string,",
						"          QC_CHE_Id as long,",
						"          QC_CHE_Kind as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as short,",
						"          dist_start as short,",
						"          Twin_Fetch as boolean,",
						"          Twin_Carry as boolean,",
						"          Twin_Put as boolean,",
						"          Category_Id as string,",
						"          Freight_Kind_Id as string,",
						"          to_pos_gkey as string,",
						"          fm_pos_gkey as string,",
						"          Restow_Reason as string,",
						"          Container_Line_Id as string,",
						"          Container_Line_Role as string,",
						"          pow as string,",
						"          ufv_gkey as integer,",
						"          Berth_Id as string,",
						"          Goods_And_Ctr_Wt_Kg as short,",
						"          active_ufv as integer,",
						"          Requires_Power_Flag as boolean,",
						"          OOG_Flag as boolean,",
						"          Shipper_Id as string,",
						"          Consignee_Id as string,",
						"          Commodity_Id as string,",
						"          ATD as timestamp,",
						"          Rehandles as short,",
						"          ATA as timestamp,",
						"          Year as integer,",
						"          Month as integer,",
						"          Week as integer",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delta',",
						"     fileSystem: 'socar',",
						"     folderPath: 'silver/moves') ~> socar",
						"filter1 derive(exec_delta_16 = iif(:exec_time > 16, true(), false()),",
						"          t_execution_delta = :exec_time,",
						"          exec_time := (t_carry_complete - t_fetch)/60000) ~> derivedColumn1",
						"socar filter(Carry_CHE_Kind==\"ITV\") ~> filter1",
						"derivedColumn1 select(mapColumn(",
						"          mve_gkey,",
						"          Unit_Nbr,",
						"          Facility_Id,",
						"          Yard_Id,",
						"          Event_Type_Id,",
						"          Move_Kind,",
						"          From_Location,",
						"          To_Location,",
						"          From_Position_Name,",
						"          To_Position_Name,",
						"          Carry_CHE_Kind,",
						"          t_carry_complete,",
						"          t_put,",
						"          t_fetch,",
						"          Category_Id,",
						"          Freight_Kind_Id,",
						"          pow,",
						"          Commodity_Id,",
						"          Year,",
						"          Month,",
						"          Week,",
						"          exec_delta_16,",
						"          t_execution_delta",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"filter2 alterRow(upsertIf(true())) ~> alterRow1",
						"select1 filter((t_execution_delta >= 0.0) && (t_execution_delta >= 0) && not(isNull(t_execution_delta))) ~> filter2",
						"alterRow1 split(Event_Type_Id == \"UNIT_LOAD\",",
						"     Event_Type_Id == \"UNIT_DISCH\",",
						"     disjoint: false) ~> split1@(load, discharge)",
						"split1@load sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'socar',",
						"     folderPath: 'gold/load_time_delta',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> LOAD",
						"split1@discharge sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'socar',",
						"     folderPath: 'gold/dsch_time_delta',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> DSCH"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/stack_confirmity_AGCT')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Equipment ID} as string,",
						"          {Stacking Factor} as string,",
						"          CHE as string,",
						"          {Blk Typ} as string,",
						"          Type as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/stackconformity/load','bronze/sectionconformity/load'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'agct',",
						"     folderPath: 'bronze/stackconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> StackConfirmity",
						"StackConfirmity derive(Pos_WO_Tier = iif(isInteger(right({Current Position}, 1)), left({Current Position}, length({Current Position}) - 1), {Current Position}),",
						"          Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          Pos_WO_Tier),",
						"     asc({Stacking Factor}, true),",
						"     stackrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          Pos_WO_Tier),",
						"     Stack_confirmty = iif(max(stackrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && derivedColumn1@Pos_WO_Tier == aggregate1@Pos_WO_Tier,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.} = {Equipment ID},",
						"          {Stacking Factor},",
						"          CHE,",
						"          {Blk Typ},",
						"          Type,",
						"          {Current position} = {Current Position},",
						"          {Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Pos_WO_Tier = derivedColumn1@Pos_WO_Tier,",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Stack_confirmty",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Equipment ID})) && not(isNull({Equipment ID})) && {Equipment ID} != '') ~> filter1",
						"select2 alterRow(upsertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'agct',",
						"     folderPath: 'gold/stack_conformity',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> StackConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/stack_confirmity_CGSA')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Equipment ID} as string,",
						"          {Stacking Factor} as string,",
						"          CHE as string,",
						"          {Blk Typ} as string,",
						"          Type as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/stackconformity/load','bronze/sectionconformity/load'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'cgsa',",
						"     folderPath: 'bronze/stackconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> StackConfirmity",
						"StackConfirmity derive(Pos_WO_Tier = iif(isInteger(right({Current Position}, 1)), left({Current Position}, length({Current Position}) - 1), {Current Position}),",
						"          Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          Pos_WO_Tier),",
						"     asc({Stacking Factor}, true),",
						"     stackrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          Pos_WO_Tier),",
						"     Stack_confirmty = iif(max(stackrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && derivedColumn1@Pos_WO_Tier == aggregate1@Pos_WO_Tier,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.} = {Equipment ID},",
						"          {Stacking Factor},",
						"          CHE,",
						"          {Blk Typ},",
						"          Type,",
						"          {Current position} = {Current Position},",
						"          {Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Pos_WO_Tier = derivedColumn1@Pos_WO_Tier,",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Stack_confirmty",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Equipment ID})) && not(isNull({Equipment ID})) && {Equipment ID} != '') ~> filter1",
						"select2 alterRow(upsertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cgsa',",
						"     folderPath: 'gold/stack_confirmity',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> StackConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/stack_confirmity_CIT_Ivory_Coast')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Container ID} as string,",
						"          {Stacking Factor} as string,",
						"          CHE as string,",
						"          {Blk Typ} as string,",
						"          Type as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/stackconformity/load','bronze/stackconformity/archive'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'cit-ivory-coast',",
						"     folderPath: 'bronze/stackconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> StackConfirmity",
						"StackConfirmity derive(Pos_WO_Tier = iif(isInteger(right({Current Position}, 1)), left({Current Position}, length({Current Position}) - 1), {Current Position}),",
						"          Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          Pos_WO_Tier),",
						"     asc({Stacking Factor}, true),",
						"     stackrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          Pos_WO_Tier),",
						"     Stack_confirmty = iif(max(stackrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && derivedColumn1@Pos_WO_Tier == aggregate1@Pos_WO_Tier,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.} = {Container ID},",
						"          {Stacking Factor},",
						"          CHE,",
						"          {Blk Typ},",
						"          Type,",
						"          {Current position} = {Current Position},",
						"          {Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Pos_WO_Tier = derivedColumn1@Pos_WO_Tier,",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Stack_confirmty",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Container ID})) && not(isNull({Container ID})) && {Container ID} != '') ~> filter1",
						"select2 alterRow(insertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cit-ivory-coast',",
						"     folderPath: 'gold/stack_confirmity_new',",
						"     mergeSchema: true,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> StackConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/stack_confirmity_CMATK')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Container No.} as string,",
						"          {Stacking Factor} as string,",
						"          CHE as string,",
						"          {Blk Typ} as string,",
						"          {Equip Class} as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Category as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['bronze/stackconformity/load','bronze/sectionconformity/load'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'cmatk',",
						"     folderPath: 'bronze/stackconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> StackConfirmity",
						"StackConfirmity derive(Pos_WO_Tier = (iif(isInteger(right({Current Position}, 1)), left({Current Position}, length({Current Position}) - 2), {Current Position})),",
						"          Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          Pos_WO_Tier),",
						"     asc({Stacking Factor}, true),",
						"     stackrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          Pos_WO_Tier),",
						"     Stack_confirmty = iif(max(stackrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && derivedColumn1@Pos_WO_Tier == aggregate1@Pos_WO_Tier,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.},",
						"          {Stacking Factor},",
						"          CHE,",
						"          {Blk Typ},",
						"          Type = {Equip Class},",
						"          {Current position} = {Current Position},",
						"          {Yard Row},",
						"          Cat = Category,",
						"          Sts,",
						"          {Section Factor},",
						"          Pos_WO_Tier = derivedColumn1@Pos_WO_Tier,",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Stack_confirmty",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Container No.})) && not(isNull({Container No.})) && {Container No.} != '') ~> filter1",
						"select2 alterRow(insertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmatk',",
						"     folderPath: 'gold/stack_confirmity',",
						"     mergeSchema: true,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> StackConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/stack_confirmity_CMSA')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Container No.} as string,",
						"          {Stacking Factor} as string,",
						"          {Assigned CHE} as string,",
						"          {Blk Typ} as string,",
						"          Class as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/stackconformity/load','bronze/stackconformity/archive'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'cmsa',",
						"     folderPath: 'bronze/stackconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> StackConfirmity",
						"StackConfirmity derive(Pos_WO_Tier = iif(isInteger(right({Current Position}, 1)), left({Current Position}, length({Current Position}) - 1), {Current Position}),",
						"          Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          Pos_WO_Tier),",
						"     asc({Stacking Factor}, true),",
						"     stackrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          Pos_WO_Tier),",
						"     Stack_confirmty = iif(max(stackrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && derivedColumn1@Pos_WO_Tier == aggregate1@Pos_WO_Tier,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.},",
						"          {Stacking Factor},",
						"          CHE = {Assigned CHE},",
						"          {Blk Typ},",
						"          Type = Class,",
						"          {Current position} = {Current Position},",
						"          {Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Pos_WO_Tier = derivedColumn1@Pos_WO_Tier,",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Stack_confirmty",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Container No.})) && not(isNull({Container No.})) && {Container No.} != '') ~> filter1",
						"select2 alterRow(upsertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmsa',",
						"     folderPath: 'gold/stack_confirmity',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> StackConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/stack_confirmity_CWIT')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Container No.} as string,",
						"          {Stacking Factor} as string,",
						"          {Assigned CHE} as string,",
						"          {Blk Typ} as string,",
						"          Type as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/stackconformity/load','bronze/stackconformity/archive'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'cwit',",
						"     folderPath: 'bronze/stackconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> StackConfirmity",
						"StackConfirmity derive(Pos_WO_Tier = (iif(isInteger(right({Current Position}, 1)), left({Current Position}, length({Current Position}) - 2), {Current Position})),",
						"          Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          Pos_WO_Tier),",
						"     asc({Stacking Factor}, true),",
						"     stackrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          Pos_WO_Tier),",
						"     Stack_confirmty = iif(max(stackrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && derivedColumn1@Pos_WO_Tier == aggregate1@Pos_WO_Tier,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.},",
						"          {Stacking Factor},",
						"          CHE = {Assigned CHE},",
						"          {Blk Typ},",
						"          Type,",
						"          {Current position} = {Current Position},",
						"          {Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Pos_WO_Tier = derivedColumn1@Pos_WO_Tier,",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Stack_confirmty",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Container No.})) && not(isNull({Container No.})) && {Container No.} != '') ~> filter1",
						"select2 alterRow(insertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cwit',",
						"     folderPath: 'gold/stack_confirmity',",
						"     mergeSchema: true,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> StackConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/stack_confirmity_DPW_LG')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Container No.  } as string,",
						"          {Stacking Factor} as string,",
						"          {Assigned CHE} as string,",
						"          {Blk Typ} as string,",
						"          Type as string,",
						"          {Current Position} as string,",
						"          {Yard Stack} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/stackconformity/load','bronze/stackconformity/archive'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'dpw-lg',",
						"     folderPath: 'bronze/stackconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> StackConfirmity",
						"StackConfirmity derive(Pos_WO_Tier = at(split({Current Position}, \".\"), 1),",
						"          Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          Stacking_factor = dropLeft(toString(reduce(slice(:stacking_array , 1, iif(size(:stacking_array)>1,size(:stacking_array)-1, size(:stacking_array))), '', #acc + '/' + #item, #result)), 1),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          Pos_WO_Tier),",
						"     asc(Stacking_factor, true),",
						"     stackrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          Pos_WO_Tier),",
						"     Stack_confirmty = iif(max(stackrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && derivedColumn1@Pos_WO_Tier == aggregate1@Pos_WO_Tier,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.} = {Container No.  },",
						"          {Stacking Factor},",
						"          CHE = {Assigned CHE},",
						"          {Blk Typ},",
						"          Type,",
						"          {Current position} = {Current Position},",
						"          {Yard Row} = {Yard Stack},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Pos_WO_Tier = derivedColumn1@Pos_WO_Tier,",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Adjusted_Stacking_factor = Stacking_factor,",
						"          Stack_confirmty",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Container No.  })) && not(isNull({Container No.  })) && {Container No.  } != '') ~> filter1",
						"select2 alterRow(upsertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'dpw-lg',",
						"     folderPath: 'gold/stack_confirmity',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> StackConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/stack_confirmity_DPW_peru')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Container No.} as string,",
						"          {Stacking Factor} as string,",
						"          {Assigned CHE} as string,",
						"          {Blk Typ} as string,",
						"          Type as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/stackconformity/load','bronze/stackconformity/archive'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'dpw-peru',",
						"     folderPath: 'bronze/stackconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> StackConfirmity",
						"StackConfirmity derive(Pos_WO_Tier = iif(isInteger(right({Current Position}, 1)), left({Current Position}, length({Current Position}) - 1), {Current Position}),",
						"          Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          Pos_WO_Tier),",
						"     asc({Stacking Factor}, true),",
						"     stackrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          Pos_WO_Tier),",
						"     Stack_confirmty = iif(max(stackrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && derivedColumn1@Pos_WO_Tier == aggregate1@Pos_WO_Tier,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.},",
						"          {Stacking Factor},",
						"          CHE = {Assigned CHE},",
						"          {Blk Typ},",
						"          Type,",
						"          {Current position} = {Current Position},",
						"          {Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Pos_WO_Tier = derivedColumn1@Pos_WO_Tier,",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Stack_confirmty",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Container No.})) && not(isNull({Container No.})) && {Container No.} != '') ~> filter1",
						"select2 alterRow(upsertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'dpw-peru',",
						"     folderPath: 'gold/stack_confirmity',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> StackConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/stack_confirmity_MICT')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Container No.} as string,",
						"          {Stacking Factor} as string,",
						"          CHE as string,",
						"          {Blk Typ} as string,",
						"          Type as string,",
						"          {Current position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/stackconformity/load','bronze/sectionconformity/load'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'mict',",
						"     folderPath: 'bronze/stackconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> StackConfirmity",
						"StackConfirmity derive(Pos_WO_Tier = iif(isInteger(right({Current position}, 1)), left({Current position}, length({Current position}) - 1), {Current position}),",
						"          Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          Pos_WO_Tier),",
						"     asc({Stacking Factor}, true),",
						"     stackrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          Pos_WO_Tier),",
						"     Stack_confirmty = iif(max(stackrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && derivedColumn1@Pos_WO_Tier == aggregate1@Pos_WO_Tier,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.},",
						"          {Stacking Factor},",
						"          CHE,",
						"          {Blk Typ},",
						"          Type,",
						"          {Current position},",
						"          {Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Pos_WO_Tier = derivedColumn1@Pos_WO_Tier,",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Stack_confirmty",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Container No.})) && not(isNull({Container No.})) && {Container No.} != '') ~> filter1",
						"select2 alterRow(upsertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mict',",
						"     folderPath: 'gold/stack_confirmity',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> StackConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/stack_confirmity_MNHPI')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Equipment ID} as string,",
						"          {Stacking Factor} as string,",
						"          CHE as string,",
						"          {Blk Typ} as string,",
						"          Type as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/stackconformity/load','bronze/sectionconformity/load'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'bronze/stackconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> StackConfirmity",
						"StackConfirmity derive(Pos_WO_Tier = iif(isInteger(right({Current Position}, 1)), left({Current Position}, length({Current Position}) - 1), {Current Position}),",
						"          Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          Pos_WO_Tier),",
						"     asc({Stacking Factor}, true),",
						"     stackrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          Pos_WO_Tier),",
						"     Stack_confirmty = iif(max(stackrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && derivedColumn1@Pos_WO_Tier == aggregate1@Pos_WO_Tier,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.} = {Equipment ID},",
						"          {Stacking Factor},",
						"          CHE,",
						"          {Blk Typ},",
						"          Type,",
						"          {Current position} = {Current Position},",
						"          {Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Pos_WO_Tier = derivedColumn1@Pos_WO_Tier,",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Stack_confirmty",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Equipment ID})) && not(isNull({Equipment ID})) && {Equipment ID} != '') ~> filter1",
						"select2 alterRow(insertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'gold/stack_confirmity',",
						"     mergeSchema: true,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> StackConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/stack_confirmity_Malta')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						},
						{
							"name": "select3"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Move Hour} as string,",
						"          {Container No.} as string,",
						"          {Stacking Factor} as string,",
						"          {Assigned CHE} as string,",
						"          {Blk Typ} as boolean,",
						"          Type as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/stackconformity/load','bronze/stackconformity/archive'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'malta',",
						"     folderPath: 'bronze/stackconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> StackConfirmity",
						"select3 derive(Pos_WO_Tier = (iif(isInteger(right({Current Position}, 1)), left({Current Position}, length({Current Position}) - 2), {Current Position})),",
						"          Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          Pos_WO_Tier),",
						"     asc({Stacking Factor}, true),",
						"     stackrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          Pos_WO_Tier),",
						"     Stack_confirmty = iif(max(stackrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && derivedColumn1@Pos_WO_Tier == aggregate1@Pos_WO_Tier,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.},",
						"          {Stacking Factor},",
						"          CHE = {Assigned CHE},",
						"          {Blk Typ},",
						"          Type,",
						"          {Current position} = {Current Position},",
						"          {Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Pos_WO_Tier = derivedColumn1@Pos_WO_Tier,",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Stack_confirmty",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Container No.})) && not(isNull({Container No.})) && {Container No.} != '') ~> filter1",
						"select2 alterRow(insertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"StackConfirmity select(mapColumn(",
						"          {Container No.},",
						"          {Stacking Factor},",
						"          {Assigned CHE},",
						"          {Blk Typ},",
						"          Type,",
						"          {Current Position},",
						"          {Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          FileDate",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select3",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'malta',",
						"     folderPath: 'gold/stack_confirmity',",
						"     mergeSchema: true,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> StackConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/stack_confirmity_Mundra_CT02')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Container No.} as string,",
						"          {Stacking Factor} as string,",
						"          {Assigned CHE} as string,",
						"          {Blk Typ} as string,",
						"          Class as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/stackconformity/load','bronze/stackconformity/archive'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'mundra-ct02',",
						"     folderPath: 'bronze/stackconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> StackConfirmity",
						"StackConfirmity derive(Pos_WO_Tier = iif(isInteger(right({Current Position}, 1)), left({Current Position}, length({Current Position}) - 1), {Current Position}),",
						"          Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          Stacking_Factor = {Stacking Factor},",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          Pos_WO_Tier),",
						"     asc(Stacking_Factor, true),",
						"     stackrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          Pos_WO_Tier),",
						"     Stack_confirmty = iif(max(stackrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && derivedColumn1@Pos_WO_Tier == aggregate1@Pos_WO_Tier,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          Date = derivedColumn1@Date,",
						"          {Container No.},",
						"          {Stacking Factor},",
						"          CHE = {Assigned CHE},",
						"          {Blk Typ},",
						"          Type = Class,",
						"          {Current Position},",
						"          {Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Pos_WO_Tier = derivedColumn1@Pos_WO_Tier,",
						"          Stack_confirmty,",
						"          Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Container No.})) && not(isNull({Container No.})) && {Container No.} != '') ~> filter1",
						"select2 alterRow(upsertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mundra-ct02',",
						"     folderPath: 'gold/stack_confirmity',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> StackConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/stack_confirmity_Mundra_CT04')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Container No.} as string,",
						"          {Stacking Factor} as string,",
						"          {Assigned CHE} as string,",
						"          {Blk Typ} as string,",
						"          Class as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/stackconformity/load','bronze/stackconformity/archive'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'mundra-ct04',",
						"     folderPath: 'bronze/stackconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> StackConfirmity",
						"StackConfirmity derive(Pos_WO_Tier = iif(isInteger(right({Current Position}, 1)), left({Current Position}, length({Current Position}) - 1), {Current Position}),",
						"          Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          Stacking_Factor = {Stacking Factor},",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          Pos_WO_Tier),",
						"     asc(Stacking_Factor, true),",
						"     stackrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          Pos_WO_Tier),",
						"     Stack_confirmty = iif(max(stackrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && derivedColumn1@Pos_WO_Tier == aggregate1@Pos_WO_Tier,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          Date = derivedColumn1@Date,",
						"          {Container No.},",
						"          {Stacking Factor},",
						"          CHE = {Assigned CHE},",
						"          {Blk Typ},",
						"          Type = Class,",
						"          {Current Position},",
						"          {Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Pos_WO_Tier = derivedColumn1@Pos_WO_Tier,",
						"          Stack_confirmty,",
						"          Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Container No.})) && not(isNull({Container No.})) && {Container No.} != '') ~> filter1",
						"select2 alterRow(upsertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mundra-ct04',",
						"     folderPath: 'gold/stack_confirmity',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> StackConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/stack_confirmity_SGTD')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Equipment ID} as string,",
						"          {Stacking Factor} as string,",
						"          {Assigned CHE} as string,",
						"          {Blk Typ} as string,",
						"          Class as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/stackconformity/load','bronze/stackconformity/archive'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'bronze/stackconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> StackConfirmity",
						"StackConfirmity derive(Pos_WO_Tier = iif(isInteger(right({Current Position}, 1)), left({Current Position}, length({Current Position}) - 1), {Current Position}),",
						"          Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          Pos_WO_Tier),",
						"     asc({Stacking Factor}, true),",
						"     stackrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          Pos_WO_Tier),",
						"     Stack_confirmty = iif(max(stackrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && derivedColumn1@Pos_WO_Tier == aggregate1@Pos_WO_Tier,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.} = {Equipment ID},",
						"          {Stacking Factor},",
						"          CHE = {Assigned CHE},",
						"          {Blk Typ},",
						"          Type = Class,",
						"          {Current position} = {Current Position},",
						"          {Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Pos_WO_Tier = derivedColumn1@Pos_WO_Tier,",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Stack_confirmty",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Equipment ID})) && not(isNull({Equipment ID})) && {Equipment ID} != '') ~> filter1",
						"select2 alterRow(insertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'gold/stack_confirmity',",
						"     mergeSchema: true,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> StackConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/stack_confirmity_SGTD_new')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "derivedColumn2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Equipment ID} as string,",
						"          {Stacking Factor} as string,",
						"          {Assigned CHE} as string,",
						"          {Blk Typ} as string,",
						"          Class as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/stackconformity/load','/bronze/stackconformity/archive'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'bronze/stackconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> StackConfirmity",
						"filter2 derive(Pos_WO_Tier = iif(isInteger(right({Current Position}, 1)), left({Current Position}, length({Current Position}) - 1), {Current Position}),",
						"          Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          stacking_factor_new = iif(\r",
						"    length(substringIndex({Stacking Factor}, '/', 1)) == 1 && \r",
						"    (ascii(substringIndex({Stacking Factor}, '/', 1)) >= 65 && ascii(substringIndex({Stacking Factor}, '/', 1)) <= 90 || \r",
						"     ascii(substringIndex({Stacking Factor}, '/', 1)) >= 97 && ascii(substringIndex({Stacking Factor}, '/', 1)) <= 122),\r",
						"    substringIndex(substringIndex({Stacking Factor}, '/', 4), '/', -3),\r",
						"    substringIndex({Stacking Factor}, '/', 3)\r",
						"),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          Pos_WO_Tier),",
						"     asc(stacking_factor_new, true),",
						"     stackrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          Pos_WO_Tier),",
						"     Stack_confirmty = iif(max(stackrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"derivedColumn2 sort(asc(Date, true)) ~> sort1",
						"select1 alterRow(insertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          Date,",
						"          Stack = Pos_WO_Tier,",
						"          Stack_confirmty,",
						"          Year,",
						"          Month,",
						"          Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"StackConfirmity filter((Cat == \"EXPORT\" || Cat == \"TRANSSHIP\") && (Sts == \"FCL\" || Sts == \"LCL\") && ({Blk Typ} == \"T\") && (Class == \"20DR\" || Class == \"40HC\" || Class == \"40DR\") && not(startsWith({Yard Row}, \"01T\")) && not(startsWith({Yard Row}, \"01X\")) && not(startsWith({Yard Row}, \"02X\")) && not(startsWith({Yard Row}, \"03X\"))) ~> filter2",
						"aggregate1 derive(Year = year(Date),",
						"          Month = month(Date),",
						"          Week = iif(dayOfWeek(Date) == 1,  weekOfYear(Date) + 1, weekOfYear(Date))) ~> derivedColumn2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'gold/stack_confirmity_new',",
						"     mergeSchema: true,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> StackConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/stack_confirmity_SGTD_test')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Equipment ID} as string,",
						"          {Stacking Factor} as string,",
						"          {Assigned CHE} as string,",
						"          {Blk Typ} as string,",
						"          Class as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/stackconformity/load','bronze/stackconformity/archive'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'bronze/stackconformity_test/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> StackConfirmity",
						"filter2 derive(Pos_WO_Tier = iif(isInteger(right({Current Position}, 1)), left({Current Position}, length({Current Position}) - 1), {Current Position}),",
						"          Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          stacking_factor_new = iif(\r",
						"    length(substringIndex({Stacking Factor}, '/', 1)) == 1 && \r",
						"    (ascii(substringIndex({Stacking Factor}, '/', 1)) >= 65 && ascii(substringIndex({Stacking Factor}, '/', 1)) <= 90 || \r",
						"     ascii(substringIndex({Stacking Factor}, '/', 1)) >= 97 && ascii(substringIndex({Stacking Factor}, '/', 1)) <= 122),\r",
						"    substringIndex(substringIndex({Stacking Factor}, '/', 4), '/', -3),\r",
						"    substringIndex({Stacking Factor}, '/', 3)\r",
						"),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          Pos_WO_Tier),",
						"     asc(stacking_factor_new, true),",
						"     stackrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          Pos_WO_Tier),",
						"     Stack_confirmty = iif(max(stackrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && derivedColumn1@Pos_WO_Tier == aggregate1@Pos_WO_Tier,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.} = {Equipment ID},",
						"          {Stacking Factor} = stacking_factor_new,",
						"          CHE = {Assigned CHE},",
						"          {Blk Typ},",
						"          Type = Class,",
						"          {Current position} = {Current Position},",
						"          {Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Pos_WO_Tier = derivedColumn1@Pos_WO_Tier,",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Stack_confirmty",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Equipment ID})) && not(isNull({Equipment ID})) && {Equipment ID} != '') ~> filter1",
						"select2 alterRow(insertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"StackConfirmity filter((Cat == \"EXPORT\" || Cat == \"TRANSSHIP\") && (Sts == \"FCL\" || Sts == \"LCL\")) ~> filter2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'gold/stack_confirmity_test',",
						"     mergeSchema: true,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> StackConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/stack_confirmity_SGTD_updated')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Equipment ID} as string,",
						"          {Stacking Factor} as string,",
						"          {Assigned CHE} as string,",
						"          {Blk Typ} as string,",
						"          Class as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/stackconformity/load','bronze/stackconformity/archive'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'bronze/stackconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> StackConfirmity",
						"filter2 derive(Pos_WO_Tier = iif(isInteger(right({Current Position}, 1)), left({Current Position}, length({Current Position}) - 1), {Current Position}),",
						"          Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          stacking_factor_new = iif(\r",
						"    length(substringIndex({Stacking Factor}, '/', 1)) == 1 && \r",
						"    (ascii(substringIndex({Stacking Factor}, '/', 1)) >= 65 && ascii(substringIndex({Stacking Factor}, '/', 1)) <= 90 || \r",
						"     ascii(substringIndex({Stacking Factor}, '/', 1)) >= 97 && ascii(substringIndex({Stacking Factor}, '/', 1)) <= 122),\r",
						"    substringIndex(substringIndex({Stacking Factor}, '/', 4), '/', -3),\r",
						"    substringIndex({Stacking Factor}, '/', 3)\r",
						"),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          Pos_WO_Tier),",
						"     asc(stacking_factor_new, true),",
						"     stackrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          Pos_WO_Tier),",
						"     Stack_confirmty = iif(max(stackrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && derivedColumn1@Pos_WO_Tier == aggregate1@Pos_WO_Tier,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.} = {Equipment ID},",
						"          {Stacking Factor} = stacking_factor_new,",
						"          CHE = {Assigned CHE},",
						"          {Blk Typ},",
						"          Type = Class,",
						"          {Current position} = {Current Position},",
						"          {Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Pos_WO_Tier = derivedColumn1@Pos_WO_Tier,",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Stack_confirmty",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Equipment ID})) && not(isNull({Equipment ID})) && {Equipment ID} != '') ~> filter1",
						"select2 alterRow(insertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"StackConfirmity filter((Cat == \"EXPORT\" || Cat == \"TRANSSHIP\") && (Sts == \"FCL\" || Sts == \"LCL\")) ~> filter2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'gold/stack_confirmity',",
						"     mergeSchema: true,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> StackConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/stack_confirmity_TEAGTL')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Equipment ID} as string,",
						"          {Stacking Factor} as string,",
						"          CHE as string,",
						"          {Blk Typ} as string,",
						"          Type as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/stackconformity/load','bronze/stackconformity/archive'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'bronze/stackconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> StackConfirmity",
						"StackConfirmity derive(Pos_WO_Tier = iif(isInteger(right({Current Position}, 1)), left({Current Position}, length({Current Position}) - 1), {Current Position}),",
						"          Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          Stacking_Factor = iif(size(:stacking_array) >= 4,\r",
						"dropLeft(toString(reduce(slice(:stacking_array, 1, 3) + slice(:stacking_array, 5), '', #acc + '/' + #item, #result)), 1),\r",
						"{Stacking Factor}),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          Pos_WO_Tier),",
						"     asc(Stacking_Factor, true),",
						"     stackrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          Pos_WO_Tier),",
						"     Stack_confirmty = iif(max(stackrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && derivedColumn1@Pos_WO_Tier == aggregate1@Pos_WO_Tier,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          Date = derivedColumn1@Date,",
						"          {Container No.} = {Equipment ID},",
						"          {Stacking Factor},",
						"          CHE,",
						"          {Blk Typ},",
						"          Type,",
						"          {Current Position},",
						"          {Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Pos_WO_Tier = derivedColumn1@Pos_WO_Tier,",
						"          Stack_confirmty,",
						"          Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Equipment ID})) && not(isNull({Equipment ID})) && {Equipment ID} != '') ~> filter1",
						"select2 alterRow(upsertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'gold/stack_confirmity',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> StackConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/stack_confirmity_VICT')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Equipment ID} as string,",
						"          {Stacking Factor} as string,",
						"          {Assigned CHE} as string,",
						"          {Blk Typ} as string,",
						"          Type as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/stackconformity/load','bronze/sectionconformity/load'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'vict',",
						"     folderPath: 'bronze/stackconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> StackConfirmity",
						"StackConfirmity derive(Pos_WO_Tier = trim(iif(isInteger(right({Current Position}, 1)), left({Current Position}, length({Current Position}) - 1), {Current Position}), \".\"),",
						"          Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          Pos_WO_Tier),",
						"     asc({Stacking Factor}, true),",
						"     stackrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          Pos_WO_Tier),",
						"     Stack_confirmty = iif(max(stackrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && derivedColumn1@Pos_WO_Tier == aggregate1@Pos_WO_Tier,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.} = {Equipment ID},",
						"          {Stacking Factor},",
						"          CHE = {Assigned CHE},",
						"          {Blk Typ},",
						"          Type,",
						"          {Current position} = {Current Position},",
						"          {Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Pos_WO_Tier = derivedColumn1@Pos_WO_Tier,",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Stack_confirmty",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Equipment ID})) && not(isNull({Equipment ID})) && {Equipment ID} != '') ~> filter1",
						"select2 alterRow(upsertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'vict',",
						"     folderPath: 'gold/stack_confirmity',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> StackConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/stack_confirmity_hazira')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Container No.} as string,",
						"          {Stacking Factor} as string,",
						"          {Assigned CHE} as string,",
						"          {Blk Typ} as string,",
						"          Class as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/stackconformity/load','bronze/sectionconformity/load'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'hazira',",
						"     folderPath: 'bronze/stackconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> StackConfirmity",
						"StackConfirmity derive(Pos_WO_Tier = iif(isInteger(right({Current Position}, 1)), left({Current Position}, length({Current Position}) - 1), {Current Position}),",
						"          Date = :stack_date,",
						"          Week = iif(dayOfWeek(:stack_date) == 1,  weekOfYear(:stack_date) + 1, weekOfYear(:stack_date)),",
						"          Stacking_Factor = {Stacking Factor},",
						"          stacking_array := split({Stacking Factor}, '/'),",
						"          stack_date := toDate(substring(FileDate, -10, 6), 'ddMMyy')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          Pos_WO_Tier),",
						"     asc(Stacking_Factor, true),",
						"     stackrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          Pos_WO_Tier),",
						"     Stack_confirmty = iif(max(stackrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && derivedColumn1@Pos_WO_Tier == aggregate1@Pos_WO_Tier,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          Date = derivedColumn1@Date,",
						"          {Container No.},",
						"          {Stacking Factor},",
						"          CHE = {Assigned CHE},",
						"          {Blk Typ},",
						"          Type = Class,",
						"          {Current Position},",
						"          {Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Pos_WO_Tier = derivedColumn1@Pos_WO_Tier,",
						"          Stack_confirmty,",
						"          Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Container No.})) && not(isNull({Container No.})) && {Container No.} != '') ~> filter1",
						"select2 alterRow(upsertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'hazira',",
						"     folderPath: 'gold/stack_confirmity',",
						"     mergeSchema: false,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> StackConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/stack_confirmity_new_CWIT')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          ContainerNo as string,",
						"          StackingFactor as string,",
						"          AssignedCHE as string,",
						"          BlockType as string,",
						"          Type as string,",
						"          CurrentPosition as string,",
						"          YardRow as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          SectionFactor as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/stackconformitycsvs/load','bronze/stackconformitycsvs/archive'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'cwit',",
						"     folderPath: 'bronze/stackconformitycsvs/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true) ~> StackConfirmity",
						"StackConfirmity derive(Pos_WO_Tier = (iif(isInteger(right({CurrentPosition}, 1)), left({CurrentPosition}, length({CurrentPosition}) - 2), {CurrentPosition})),",
						"          Date = :created_date,",
						"          Week = iif(dayOfWeek(:created_date) == 1,  weekOfYear(:created_date) + 1, weekOfYear(:created_date)),",
						"          stacking_array := split(StackingFactor, '/'),",
						"          created_date := toDate(split(split(FileDate, \"_\")[2],\".\")[1], 'ddMMyyyy')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          Pos_WO_Tier),",
						"     asc(StackingFactor, true),",
						"     stackrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          Pos_WO_Tier),",
						"     Stack_confirmty = iif(max(stackrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && derivedColumn1@Pos_WO_Tier == aggregate1@Pos_WO_Tier,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.} = ContainerNo,",
						"          {Stacking Factor} = StackingFactor,",
						"          Type,",
						"          {Current position} = CurrentPosition,",
						"          {Yard Row} = YardRow,",
						"          Cat,",
						"          Sts,",
						"          {Section Factor} = SectionFactor,",
						"          Pos_WO_Tier = derivedColumn1@Pos_WO_Tier,",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Stack_confirmty",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({ContainerNo})) && not(isNull({ContainerNo})) && {ContainerNo} != '') ~> filter1",
						"select2 alterRow(insertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cwit',",
						"     folderPath: 'gold/stack_confirmity_new',",
						"     mergeSchema: true,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> StackConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/stack_confirmity_vizingham')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						},
						{
							"name": "select3"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Container No.} as string,",
						"          {Stacking Factor} as string,",
						"          CHE as string,",
						"          {Blk Typ} as string,",
						"          Class as short,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/stackconformity/load','bronze/stackconformity/archive'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'vizingham',",
						"     folderPath: 'bronze/stackconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> StackConfirmity",
						"select3 derive(Pos_WO_Tier = iif(isInteger(right({Current Position}, 1)), left({Current Position}, length({Current Position}) - 2), {Current Position}),",
						"          Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          Pos_WO_Tier),",
						"     asc({Stacking Factor}, true),",
						"     stackrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          Pos_WO_Tier),",
						"     Stack_confirmty = iif(max(stackrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && derivedColumn1@Pos_WO_Tier == aggregate1@Pos_WO_Tier,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.} = {Equipment ID},",
						"          {Stacking Factor},",
						"          CHE,",
						"          {Blk Typ},",
						"          Type = Class,",
						"          {Current position} = {Current Position},",
						"          {Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Pos_WO_Tier = derivedColumn1@Pos_WO_Tier,",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Stack_confirmty",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Equipment ID})) && not(isNull({Equipment ID})) && {Equipment ID} != '') ~> filter1",
						"select2 alterRow(insertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"StackConfirmity select(mapColumn(",
						"          {Equipment ID} = {Container No.},",
						"          {Stacking Factor},",
						"          CHE,",
						"          {Blk Typ},",
						"          Class,",
						"          {Current Position},",
						"          {Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          FileDate",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select3",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'vizingham',",
						"     folderPath: 'gold/stack_confirmity',",
						"     mergeSchema: true,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> StackConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/stack_conformity_RIO')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConfirmity"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "StackConformity"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "window1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join1"
						},
						{
							"name": "select1"
						},
						{
							"name": "sort1"
						},
						{
							"name": "filter1"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "select2"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Equipment ID} as string,",
						"          {Stacking Factor} as string,",
						"          CHE as string,",
						"          {Blk Typ} as string,",
						"          Type as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/stackconformity/load','bronze/sectionconformity/load'],",
						"     rowUrlColumn: 'FileDate',",
						"     format: 'delimited',",
						"     fileSystem: 'rio',",
						"     folderPath: 'bronze/stackconformity/load',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> StackConfirmity",
						"StackConfirmity derive(Pos_WO_Tier = iif(isInteger(right({Current Position}, 1)), left({Current Position}, length({Current Position}) - 1), {Current Position}),",
						"          Date = toDate(substring(FileDate, -12, 8), 'yyyyMMdd'),",
						"          Week = iif(dayOfWeek(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) == 1,  weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd')) + 1, weekOfYear(toDate(substring(FileDate, -12, 8), 'yyyyMMdd'))),",
						"          stacking_array := split({Stacking Factor}, '/')) ~> derivedColumn1",
						"derivedColumn1 window(over(Date,",
						"          Pos_WO_Tier),",
						"     asc({Stacking Factor}, true),",
						"     stackrank = rank()) ~> window1",
						"window1 aggregate(groupBy(Date,",
						"          Pos_WO_Tier),",
						"     Stack_confirmty = iif(max(stackrank) > 1, 'Mix', 'Pure')) ~> aggregate1",
						"window1, aggregate1 join(derivedColumn1@Date == aggregate1@Date",
						"     && derivedColumn1@Pos_WO_Tier == aggregate1@Pos_WO_Tier,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"filter1 select(mapColumn(",
						"          {Container No.} = {Equipment ID},",
						"          {Stacking Factor},",
						"          CHE,",
						"          {Blk Typ},",
						"          Type,",
						"          {Current position} = {Current Position},",
						"          {Yard Row},",
						"          Cat,",
						"          Sts,",
						"          {Section Factor},",
						"          Pos_WO_Tier = derivedColumn1@Pos_WO_Tier,",
						"          Date = derivedColumn1@Date,",
						"          Week,",
						"          Stack_confirmty",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sort(asc(Date, true),",
						"     asc({Container No.}, true)) ~> sort1",
						"join1 filter(not(isDate({Equipment ID})) && not(isNull({Equipment ID})) && {Equipment ID} != '') ~> filter1",
						"select2 alterRow(insertIf(true())) ~> alterRow1",
						"sort1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'rio',",
						"     folderPath: 'gold/stack_confirmity',",
						"     mergeSchema: true,",
						"     autoCompact: false,",
						"     optimizedWrite: false,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> StackConformity"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/text_to_csv')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "text"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "csv"
						}
					],
					"transformations": [],
					"scriptLines": [
						"source(output(",
						"          {Equipment ID} as string,",
						"          {Stacking Factor} as string,",
						"          CHE as string,",
						"          {Blk Typ} as string,",
						"          Type as string,",
						"          {Current Position} as string,",
						"          {Yard Row} as string,",
						"          Cat as string,",
						"          Sts as string,",
						"          {Section Factor} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delimited',",
						"     fileSystem: 'teagtl-stack-confirmity',",
						"     columnDelimiter: '\\t',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true,",
						"     skipLines: -2) ~> text",
						"text sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delimited',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'bronze/stackconformity/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: false,",
						"     umask: 0022,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> csv"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/violations_CMATK')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "DeckingHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "XpsEcUser"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "violation"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "decking"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "move"
						}
					],
					"transformations": [
						{
							"name": "select1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "join1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter3"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join2"
						},
						{
							"name": "select3"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "select4"
						},
						{
							"name": "join6"
						},
						{
							"name": "select5"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "AlterRow2"
						},
						{
							"name": "alterRow3"
						},
						{
							"name": "select6"
						},
						{
							"name": "select7"
						},
						{
							"name": "aggregate2"
						},
						{
							"name": "filter4"
						},
						{
							"name": "aggregate3"
						},
						{
							"name": "filter5"
						},
						{
							"name": "derivedColumn6"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Unit Nbr} as string,",
						"          {Facility Id} as string,",
						"          {Complex Id} as string,",
						"          {Yard Id} as string,",
						"          {Carrier Visit Key} as string,",
						"          {Event Type Id} as string,",
						"          {Move Kind} as string,",
						"          {From Location} as string,",
						"          {To Location} as string,",
						"          {From Position Name} as string,",
						"          {To Position Name} as string,",
						"          {Carry CHE Operator Id} as string,",
						"          {Fetch CHE Operator Id} as string,",
						"          {Put CHE Operator Id} as string,",
						"          {Fetch CHE Id} as string,",
						"          {Fetch CHE Kind} as string,",
						"          {Carry CHE Id} as string,",
						"          {Carry CHE Kind} as string,",
						"          {Put CHE Id} as string,",
						"          {Put CHE Kind} as string,",
						"          {QC CHE Id} as string,",
						"          {QC CHE Kind} as string,",
						"          t_carry_complete as string,",
						"          t_put as string,",
						"          t_fetch as string,",
						"          t_dispatch as string,",
						"          t_discharge as string,",
						"          t_carry_dispatch as string,",
						"          t_carry_fetch_ready as string,",
						"          t_carry_put_ready as string,",
						"          dist_carry as string,",
						"          dist_start as string,",
						"          {Twin Fetch} as boolean,",
						"          {Twin Carry} as boolean,",
						"          {Twin Put} as boolean,",
						"          {Category Id} as string,",
						"          {Freight Kind Id} as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          {Restow Reason} as string,",
						"          {Container Line Id} as string,",
						"          {Container Line Role} as string,",
						"          pow as string,",
						"          mve_gkey as integer,",
						"          ufv_gkey as integer,",
						"          {Berth Id} as string,",
						"          {Goods And Ctr Wt Kg} as double,",
						"          active_ufv as integer,",
						"          {Requires Power Flag} as boolean,",
						"          {OOG Flag} as boolean,",
						"          {Shipper Id} as string,",
						"          {Consignee Id} as string,",
						"          {Commodity Id} as string,",
						"          ATA as string,",
						"          ATD as string,",
						"          Rehandles as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delimited',",
						"     fileSystem: 'cmatk',",
						"     folderPath: 'bronze/moves/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> MoveHistory",
						"source(output(",
						"          gkey as integer,",
						"          uyv_gkey as integer,",
						"          unit_id as string,",
						"          time_stamp as string,",
						"          decking_type as string,",
						"          node_id as string,",
						"          yard as string,",
						"          from_pos_loctype as string,",
						"          from_pos_locid as string,",
						"          from_pos_loc_gkey as integer,",
						"          from_pos_slot as string,",
						"          from_pos_name as string,",
						"          from_pos_bin as string,",
						"          from_pos_tier as short,",
						"          to_pos_loctype as string,",
						"          to_pos_locid as string,",
						"          to_pos_loc_gkey as boolean,",
						"          to_pos_slot as string,",
						"          to_pos_name as string,",
						"          to_pos_bin as string,",
						"          to_pos_tier as boolean,",
						"          total_score as integer,",
						"          execution_time as short,",
						"          details as string,",
						"          phase as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/deckinghistory/load','bronze/deckinghistory/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'cmatk',",
						"     folderPath: 'bronze/deckinghistory/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> DeckingHistory",
						"source(output(",
						"          gkey as short,",
						"          user_id as string,",
						"          name as string,",
						"          yard as short",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'cmatk',",
						"     folderPath: 'bronze/xpsecuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> XpsEcUser",
						"MoveHistory select(mapColumn(",
						"          mve_gkey,",
						"          {Unit Nbr},",
						"          {Event Type Id},",
						"          {Move Kind},",
						"          {From Location},",
						"          {To Position Name},",
						"          {Put CHE Operator Id},",
						"          {Put CHE Id},",
						"          {MH T_Put DateTime} = t_put,",
						"          {Freight Kind Id},",
						"          {Category Id},",
						"          ufv_gkey",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"aggregate3 derive(Year_Month = (year(:datetime) * 100) + month(:datetime),",
						"          Year_Week = (year(:datetime) * 100) + weekOfYear(:datetime),",
						"          {MH T_Put DateTime} = :datetime,",
						"          datetime := coalesce(toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss'))) ~> derivedColumn1",
						"DeckingHistory select(mapColumn(",
						"          gkey,",
						"          unit_id,",
						"          {DH TimeStamp} = time_stamp,",
						"          Decking_Type = decking_type,",
						"          to_pos_name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"aggregate2 filter(Decking_Type == 'Bump Intruder' || Decking_Type == 'Vessel Discharge' || Decking_Type == 'Vessel Discharge - Twin' || Decking_Type == 'XD Drop if Floating Refine' || Decking_Type == 'XD Refine Request' || Decking_Type == 'XD Rehandle Request') ~> filter1",
						"filter1 derive(Year_Month = (year(:datetime_dh) * 100) + month(:datetime_dh),",
						"          Year_Week = (year(:datetime_dh) * 100) + weekOfYear(:datetime_dh),",
						"          {DH TimeStamp} = :datetime_dh,",
						"          datetime_dh := coalesce(toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm'),toTimestamp({DH TimeStamp},'MM-dd-yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), \r",
						"toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss'))) ~> derivedColumn2",
						"derivedColumn1, derivedColumn2 join({Unit Nbr} == unit_id,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 filter({From Location} != 'YARD' && unit_id != '' && not(isNull(unit_id)) && !startsWith(split({To Position Name}, \"-\")[3], 'CR') && {MH T_Put DateTime} > addDays({DH TimeStamp}, -15)) ~> filter2",
						"filter2 derive({MH TPut Less 4 hours} = add({MH T_Put DateTime} , -4*60*60*1000),",
						"          {DH TimeStamp Within 4 Hours} = iif(({DH TimeStamp} >= add({MH T_Put DateTime} , -4*60*60*1000)) && ({DH TimeStamp} <= {MH T_Put DateTime}), 1, 0),",
						"          {MH ToPosName Short} = split({To Position Name}, \"-\")[3],",
						"          {MH ToPosName Short 5Char} = iif(length(split({To Position Name}, \"-\")[3]) == 8, substring(split({To Position Name}, \"-\")[3], 0, 7), split({To Position Name}, \"-\")[3]),",
						"          {DH ToPosName Shorrt} = split(to_pos_name, \"-\")[3],",
						"          {DH ToPosName Short 5Char} = iif(length(split(to_pos_name, \"-\")[3]) == 8, substring(split(to_pos_name, \"-\")[3], 0, 7), split(to_pos_name, \"-\")[3])) ~> derivedColumn3",
						"derivedColumn3 filter({DH TimeStamp Within 4 Hours} == 1 && {DH ToPosName Short 5Char} != \"FLD\") ~> filter3",
						"filter3 aggregate(groupBy({Unit Nbr},",
						"          {Move Kind},",
						"          {Category Id},",
						"          {MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime},",
						"          {Put CHE Operator Id},",
						"          mve_gkey,",
						"          {Put CHE Id},",
						"          {Freight Kind Id}),",
						"     MaxDHTime = max({DH TimeStamp})) ~> aggregate1",
						"filter3, aggregate1 join(aggregate3@{Unit Nbr} == aggregate1@{Unit Nbr}",
						"     && aggregate3@{Move Kind} == aggregate1@{Move Kind}",
						"     && aggregate3@{Category Id} == aggregate1@{Category Id}",
						"     && derivedColumn3@{MH ToPosName Short 5Char} == aggregate1@{MH ToPosName Short 5Char}",
						"     && derivedColumn1@{MH T_Put DateTime} == aggregate1@{MH T_Put DateTime}",
						"     && aggregate3@{Put CHE Operator Id} == aggregate1@{Put CHE Operator Id}",
						"     && aggregate3@mve_gkey == aggregate1@mve_gkey",
						"     && aggregate3@{Put CHE Id} == aggregate1@{Put CHE Id}",
						"     && aggregate3@{Freight Kind Id} == aggregate1@{Freight Kind Id}",
						"     && {DH TimeStamp} == MaxDHTime,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join2",
						"join2 select(mapColumn(",
						"          {MH Event Type Id} = {Event Type Id},",
						"          {From Location},",
						"          {MH To Position Name} = {To Position Name},",
						"          ufv_gkey,",
						"          gkey,",
						"          unit_id,",
						"          {D H TimeStamp} = {DH TimeStamp},",
						"          {D H Decking Type} = Decking_Type,",
						"          {D H To Pos Name} = to_pos_name,",
						"          Year_Month = derivedColumn2@Year_Month,",
						"          Year_Week = derivedColumn2@Year_Week,",
						"          {MH TPut Less 4 hours},",
						"          {DH TimeStamp Within 4 Hours},",
						"          {MH ToPosName Short},",
						"          {MH ToPosName Short 5Char} = derivedColumn3@{MH ToPosName Short 5Char},",
						"          {DH ToPosName Shorrt},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr} = aggregate1@{Unit Nbr},",
						"          {MH Move Kind} = aggregate1@{Move Kind},",
						"          {Category Id} = aggregate1@{Category Id},",
						"          {MH ToPosName Short 5Char} = aggregate1@{MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime} = aggregate1@{MH T_Put DateTime},",
						"          {MH Put CHE Operator Id} = aggregate1@{Put CHE Operator Id},",
						"          mve_gkey = aggregate1@mve_gkey,",
						"          {MH Put CHE Id} = aggregate1@{Put CHE Id},",
						"          {Freight Kind Id} = aggregate1@{Freight Kind Id},",
						"          MaxDHTime",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select3",
						"select3 derive({Location Match or Not} = iif(substring({MH ToPosName Short 5Char},1, 5) == substring({DH ToPosName Short 5Char},1,5), 'Position Followed', 'Position Not Followed'),",
						"          Shift_Date = toDate({MH T_Put DateTime}),",
						"          {T Put Time} = MaxDHTime,",
						"          {T Put Hour} = hour(MaxDHTime),",
						"          {T Put Minute} = minute(MaxDHTime),",
						"          {T Put Second} = second(MaxDHTime)) ~> derivedColumn4",
						"derivedColumn6 select(mapColumn(",
						"          {MH Event Type Id},",
						"          {D H Decking Type},",
						"          gkey = select3@gkey,",
						"          Year_Month,",
						"          Year_Week,",
						"          {MH ToPosName Short 5Char},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr},",
						"          {MH Move Kind},",
						"          {Category Id},",
						"          {MH T_Put DateTime},",
						"          {MH Put CHE Operator Id},",
						"          mve_gkey,",
						"          {MH Put CHE Id},",
						"          {Freight Kind Id},",
						"          MaxDHTime,",
						"          Block_To_Block_Violation,",
						"          Same_Block_Violation,",
						"          Stack_Violation,",
						"          {Location Match or Not},",
						"          user_id,",
						"          {User Name} = name,",
						"          Shift_Date",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select4",
						"derivedColumn4, XpsEcUser join(lower({MH Put CHE Operator Id}) == lower(user_id),",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join6",
						"select4 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select5",
						"select5 alterRow(upsertIf(true())) ~> alterRow1",
						"select6 alterRow(upsertIf(true())) ~> AlterRow2",
						"select7 alterRow(upsertIf(true())) ~> alterRow3",
						"derivedColumn2 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select6",
						"derivedColumn1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select7",
						"filter5 aggregate(groupBy(gkey),",
						"     each(match(name!='gkey'), $$ = first($$))) ~> aggregate2",
						"select1 filter(not(isNull(mve_gkey))) ~> filter4",
						"filter4 aggregate(groupBy(mve_gkey),",
						"     each(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate3",
						"select2 filter(not(isNull(gkey))) ~> filter5",
						"join6 derive(Block_To_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 2) != substring({DH ToPosName Short 5Char}, 1, 2), true(), false()),",
						"          Same_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 4) != substring({DH ToPosName Short 5Char}, 1, 4), true(), false()),",
						"          Stack_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 5) != substring({DH ToPosName Short 5Char}, 1, 5), true(), false())) ~> derivedColumn6",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmatk',",
						"     folderPath: 'gold/violation',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> violation",
						"AlterRow2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmatk',",
						"     folderPath: 'gold/decking',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> decking",
						"alterRow3 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'cmatk',",
						"     folderPath: 'gold/move',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> move"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/violations_DPW_peru')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "DeckingHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ShiftData"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ShiftInfo"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "XpsEcUser"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "violation"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "decking"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "move"
						}
					],
					"transformations": [
						{
							"name": "select1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "join1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter3"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join2"
						},
						{
							"name": "select3"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "join3"
						},
						{
							"name": "join4"
						},
						{
							"name": "derivedColumn5"
						},
						{
							"name": "select4"
						},
						{
							"name": "join6"
						},
						{
							"name": "select5"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "AlterRow2"
						},
						{
							"name": "alterRow3"
						},
						{
							"name": "select6"
						},
						{
							"name": "select7"
						},
						{
							"name": "aggregate2"
						},
						{
							"name": "filter4"
						},
						{
							"name": "aggregate3"
						},
						{
							"name": "filter5"
						},
						{
							"name": "derivedColumn6"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Unit Nbr} as string,",
						"          {Facility Id} as string,",
						"          {Complex Id} as string,",
						"          {Yard Id} as string,",
						"          {Carrier Visit Key} as long,",
						"          {Event Type Id} as string,",
						"          {Move Kind} as string,",
						"          {From Location} as string,",
						"          {To Location} as string,",
						"          {From Position Name} as string,",
						"          {To Position Name} as string,",
						"          {Carry CHE Operator Id} as string,",
						"          {Fetch CHE Operator Id} as string,",
						"          {Put CHE Operator Id} as string,",
						"          {Fetch CHE Id} as short,",
						"          {Fetch CHE Kind} as string,",
						"          {Carry CHE Id} as short,",
						"          {Carry CHE Kind} as string,",
						"          {Put CHE Id} as short,",
						"          {Put CHE Kind} as string,",
						"          {QC CHE Id} as short,",
						"          {QC CHE Kind} as string,",
						"          t_carry_complete as string,",
						"          t_put as string,",
						"          t_fetch as string,",
						"          t_dispatch as string,",
						"          t_discharge as string,",
						"          t_carry_dispatch as string,",
						"          t_carry_fetch_ready as string,",
						"          t_carry_put_ready as string,",
						"          dist_carry as short,",
						"          dist_start as short,",
						"          {Twin Fetch} as boolean,",
						"          {Twin Carry} as boolean,",
						"          {Twin Put} as boolean,",
						"          {Category Id} as string,",
						"          {Freight Kind Id} as string,",
						"          to_pos_gkey as string,",
						"          fm_pos_gkey as long,",
						"          {Restow Reason} as string,",
						"          {Container Line Id} as string,",
						"          {Container Line Role} as string,",
						"          pow as string,",
						"          mve_gkey as long,",
						"          ufv_gkey as long,",
						"          {Berth Id} as string,",
						"          {Goods And Ctr Wt Kg} as integer,",
						"          active_ufv as long,",
						"          {Requires Power Flag} as boolean,",
						"          {OOG Flag} as boolean,",
						"          {Shipper Id} as string,",
						"          {Consignee Id} as string,",
						"          {Commodity Id} as string,",
						"          ATA as string,",
						"          ATD as string,",
						"          Rehandles as boolean",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/movehistory/load','bronze/moves/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'dpw-peru',",
						"     folderPath: 'bronze/movehistory/load/',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> MoveHistory",
						"source(output(",
						"          GKEY as long,",
						"          UYV_GKEY as long,",
						"          UNIT_ID as string,",
						"          TIMESTAMP as string,",
						"          NODE_ID as string,",
						"          DECKING_TYPE as string,",
						"          YARD as integer,",
						"          FROM_POS_LOCTYPE as string,",
						"          FROM_POS_LOCID as string,",
						"          FROM_POS_LOC_GKEY as long,",
						"          FROM_POS_SLOT as string,",
						"          FROM_POS_NAME as string,",
						"          FROM_POS_BIN as long,",
						"          FROM_POS_TIER as short,",
						"          TO_POS_LOCTYPE as string,",
						"          TO_POS_LOCID as string,",
						"          TO_POS_LOC_GKEY as integer,",
						"          TO_POS_SLOT as string,",
						"          TO_POS_NAME as string,",
						"          TO_POS_BIN as long,",
						"          TO_POS_TIER as string,",
						"          TOTAL_SCORE as integer,",
						"          EXECUTION_TIME as short,",
						"          DETAILS as string,",
						"          PHASE as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/deckinghistory/load','bronze/deckinghistory/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'dpw-peru',",
						"     folderPath: 'bronze/deckinghistory/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> DeckingHistory",
						"source(output(",
						"          {Shift Id} as string,",
						"          Hour as integer,",
						"          Minute as integer",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'dpw-peru',",
						"     folderPath: 'bronze/shiftdata',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> ShiftData",
						"source(output(",
						"          {Shift Name} as string,",
						"          {Shift Start Hour} as short,",
						"          {Shift Start Minute} as short,",
						"          {Shift Start} as string,",
						"          {Shift End Hour} as short,",
						"          {Shift End Minute} as short,",
						"          {Shift End} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delimited',",
						"     fileSystem: 'dpw-peru',",
						"     folderPath: 'bronze/shiftinfo',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> ShiftInfo",
						"source(output(",
						"          GKEY as string,",
						"          USER_ID as string,",
						"          NAME as string,",
						"          YARD as integer",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'dpw-peru',",
						"     folderPath: 'bronze/xpsecuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> XpsEcUser",
						"MoveHistory select(mapColumn(",
						"          mve_gkey,",
						"          {Unit Nbr},",
						"          {Event Type Id},",
						"          {Move Kind},",
						"          {From Location},",
						"          {To Position Name},",
						"          {Put CHE Operator Id},",
						"          {Put CHE Id},",
						"          {MH T_Put DateTime} = t_put,",
						"          {Freight Kind Id},",
						"          {Category Id},",
						"          ufv_gkey",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"aggregate3 derive(Year_Month = (year(coalesce(toTimestamp(concat(substring({MH T_Put DateTime}, 1, 21), ' ', substring({MH T_Put DateTime}, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd.MM.yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss')))*100) + month(coalesce(toTimestamp(concat(substring({MH T_Put DateTime}, 1, 21), ' ', substring({MH T_Put DateTime}, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd.MM.yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss'))),",
						"          Year_Week = (year(coalesce(toTimestamp(concat(substring({MH T_Put DateTime}, 1, 21), ' ', substring({MH T_Put DateTime}, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd.MM.yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss')))*100) + weekOfYear(coalesce(toTimestamp(concat(substring({MH T_Put DateTime}, 1, 21), ' ', substring({MH T_Put DateTime}, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd.MM.yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss'))),",
						"          {MH T_Put DateTime} = coalesce(toTimestamp(concat(substring({MH T_Put DateTime}, 1, 21), ' ', substring({MH T_Put DateTime}, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd.MM.yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss'))) ~> derivedColumn1",
						"DeckingHistory select(mapColumn(",
						"          gkey = GKEY,",
						"          unit_id = UNIT_ID,",
						"          {DH TimeStamp} = TIMESTAMP,",
						"          Decking_Type = NODE_ID,",
						"          to_pos_name = TO_POS_NAME",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"aggregate2 filter(Decking_Type == 'Bump Intruder' || Decking_Type == 'Vessel Discharge' || Decking_Type == 'Vessel Discharge - Twin' || Decking_Type == 'XD Drop if Floating Refine' || Decking_Type == 'XD Refine Request' || Decking_Type == 'XD Rehandle Request') ~> filter1",
						"filter1 derive(Year_Month = (year(coalesce(toTimestamp(concat(substring({DH TimeStamp}, 1, 21), ' ', substring({DH TimeStamp}, 29, 2)), 'dd/MM/yy hh:mm:ss.SSS a'),toTimestamp(trim({DH TimeStamp}), 'dd/MM/yy HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'MM/dd/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yyyy HH:mm:ss')))*100) + month(coalesce(toTimestamp(concat(substring({DH TimeStamp}, 1, 21), ' ', substring({DH TimeStamp}, 29, 2)), 'dd/MM/yy hh:mm:ss.SSS a'),toTimestamp(trim({DH TimeStamp}), 'dd/MM/yy HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'MM/dd/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yyyy HH:mm:ss'))),",
						"          Year_Week = (year(coalesce(toTimestamp(concat(substring({DH TimeStamp}, 1, 21), ' ', substring({DH TimeStamp}, 29, 2)), 'dd/MM/yy hh:mm:ss.SSS a'),toTimestamp(trim({DH TimeStamp}), 'dd/MM/yy HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'MM/dd/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yyyy HH:mm:ss')))*100) + weekOfYear(coalesce(toTimestamp(concat(substring({DH TimeStamp}, 1, 21), ' ', substring({DH TimeStamp}, 29, 2)), 'dd/MM/yy hh:mm:ss.SSS a'),toTimestamp(trim({DH TimeStamp}), 'dd/MM/yy HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'MM/dd/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yyyy HH:mm:ss'))),",
						"          {DH TimeStamp} = coalesce(toTimestamp(concat(substring({DH TimeStamp}, 1, 21), ' ', substring({DH TimeStamp}, 29, 2)), 'dd/MM/yy hh:mm:ss.SSS a'),toTimestamp(trim({DH TimeStamp}), 'dd/MM/yy HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'MM/dd/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yyyy HH:mm:ss'))) ~> derivedColumn2",
						"derivedColumn1, derivedColumn2 join({Unit Nbr} == unit_id,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 filter({From Location} != 'YARD' && unit_id != '' && not(isNull(unit_id)) && !startsWith(split({To Position Name}, \"-\")[3], 'CR') && {MH T_Put DateTime} > addDays({DH TimeStamp}, -15)) ~> filter2",
						"filter2 derive({MH TPut Less 4 hours} = add({MH T_Put DateTime} , -4*60*60*1000),",
						"          {DH TimeStamp Within 4 Hours} = iif(({DH TimeStamp} >= add({MH T_Put DateTime} , -4*60*60*1000)) && ({DH TimeStamp} <= {MH T_Put DateTime}), 1, 0),",
						"          {MH ToPosName Short} = split({To Position Name}, \"-\")[3],",
						"          {MH ToPosName Short 5Char} = iif(length(split({To Position Name}, \"-\")[3]) == 8, substring(split({To Position Name}, \"-\")[3], 0, 7), split({To Position Name}, \"-\")[3]),",
						"          {DH ToPosName Shorrt} = split(to_pos_name, \"-\")[3],",
						"          {DH ToPosName Short 5Char} = iif(length(split(to_pos_name, \"-\")[3]) == 8, substring(split(to_pos_name, \"-\")[3], 0, 7), split(to_pos_name, \"-\")[3])) ~> derivedColumn3",
						"derivedColumn3 filter({DH TimeStamp Within 4 Hours} == 1 && {DH ToPosName Short 5Char} != \"FLD\" && not(like({DH ToPosName Short 5Char}, \"Fail%\"))) ~> filter3",
						"filter3 aggregate(groupBy({Unit Nbr},",
						"          {Move Kind},",
						"          {Category Id},",
						"          {MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime},",
						"          {Put CHE Operator Id},",
						"          mve_gkey,",
						"          {Put CHE Id},",
						"          {Freight Kind Id}),",
						"     MaxDHTime = max({DH TimeStamp})) ~> aggregate1",
						"filter3, aggregate1 join(aggregate3@{Unit Nbr} == aggregate1@{Unit Nbr}",
						"     && aggregate3@{Move Kind} == aggregate1@{Move Kind}",
						"     && aggregate3@{Category Id} == aggregate1@{Category Id}",
						"     && derivedColumn3@{MH ToPosName Short 5Char} == aggregate1@{MH ToPosName Short 5Char}",
						"     && derivedColumn1@{MH T_Put DateTime} == aggregate1@{MH T_Put DateTime}",
						"     && aggregate3@{Put CHE Operator Id} == aggregate1@{Put CHE Operator Id}",
						"     && aggregate3@mve_gkey == aggregate1@mve_gkey",
						"     && aggregate3@{Put CHE Id} == aggregate1@{Put CHE Id}",
						"     && aggregate3@{Freight Kind Id} == aggregate1@{Freight Kind Id}",
						"     && {DH TimeStamp} == MaxDHTime,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join2",
						"join2 select(mapColumn(",
						"          {MH Event Type Id} = {Event Type Id},",
						"          {From Location},",
						"          {MH To Position Name} = {To Position Name},",
						"          ufv_gkey,",
						"          gkey,",
						"          unit_id,",
						"          {D H TimeStamp} = {DH TimeStamp},",
						"          {D H Decking Type} = Decking_Type,",
						"          {D H To Pos Name} = to_pos_name,",
						"          Year_Month = derivedColumn2@Year_Month,",
						"          Year_Week = derivedColumn2@Year_Week,",
						"          {MH TPut Less 4 hours},",
						"          {DH TimeStamp Within 4 Hours},",
						"          {MH ToPosName Short},",
						"          {MH ToPosName Short 5Char} = derivedColumn3@{MH ToPosName Short 5Char},",
						"          {DH ToPosName Shorrt},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr} = aggregate1@{Unit Nbr},",
						"          {MH Move Kind} = aggregate1@{Move Kind},",
						"          {Category Id} = aggregate1@{Category Id},",
						"          {MH ToPosName Short 5Char} = aggregate1@{MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime} = aggregate1@{MH T_Put DateTime},",
						"          {MH Put CHE Operator Id} = aggregate1@{Put CHE Operator Id},",
						"          mve_gkey = aggregate1@mve_gkey,",
						"          {MH Put CHE Id} = aggregate1@{Put CHE Id},",
						"          {Freight Kind Id} = aggregate1@{Freight Kind Id},",
						"          MaxDHTime",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select3",
						"select3 derive({Location Match or Not} = iif(substring({MH ToPosName Short 5Char}, 1, 6) == substring({DH ToPosName Short 5Char}, 1, 6), 'Position Followed', 'Position Not Followed'),",
						"          Shift_Date = toDate({MH T_Put DateTime}),",
						"          {T Put Time} = MaxDHTime,",
						"          {T Put Hour} = hour(MaxDHTime),",
						"          {T Put Minute} = minute(MaxDHTime),",
						"          {T Put Second} = second(MaxDHTime)) ~> derivedColumn4",
						"derivedColumn4, ShiftData join({T Put Hour} == Hour",
						"     && {T Put Minute} == Minute,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join3",
						"join3, ShiftInfo join({Shift Id} == {Shift Name},",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join4",
						"join4 derive({Shift Date} = iif({MH T_Put DateTime} - toTimestamp(toString(Shift_Date) + {Shift End}) > 0, addDays(Shift_Date, -1), Shift_Date),",
						"          Week_of_Year = year(iif({MH T_Put DateTime} - toTimestamp(toString(Shift_Date) + {Shift End}) > 0, addDays(Shift_Date, -1), Shift_Date))*100 + weekOfYear(iif({MH T_Put DateTime} - toTimestamp(toString(Shift_Date) + {Shift End}) > 0, addDays(Shift_Date, -1), Shift_Date))) ~> derivedColumn5",
						"derivedColumn6 select(mapColumn(",
						"          {D H Decking Type},",
						"          {MH ToPosName Short 5Char},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr},",
						"          {MH Move Kind},",
						"          {Category Id},",
						"          {MH T_Put DateTime},",
						"          {MH Put CHE Operator Id},",
						"          mve_gkey,",
						"          {MH Put CHE Id},",
						"          {Freight Kind Id},",
						"          MaxDHTime,",
						"          {Location Match or Not},",
						"          {Shift Id},",
						"          {Shift Date},",
						"          Week_of_Year,",
						"          {XPS_ECUser.name} = NAME,",
						"          Block_To_Block_Violation,",
						"          Same_Block_Violation,",
						"          Stack_Violation",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select4",
						"derivedColumn5, XpsEcUser join({MH Put CHE Operator Id} == USER_ID,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join6",
						"select4 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select5",
						"select5 alterRow(upsertIf(true())) ~> alterRow1",
						"select6 alterRow(upsertIf(true())) ~> AlterRow2",
						"select7 alterRow(upsertIf(true())) ~> alterRow3",
						"derivedColumn2 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select6",
						"derivedColumn1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select7",
						"filter5 aggregate(groupBy(gkey),",
						"     each(match(name!='gkey'), $$ = first($$))) ~> aggregate2",
						"select1 filter(not(isNull(mve_gkey))) ~> filter4",
						"filter4 aggregate(groupBy(mve_gkey),",
						"     each(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate3",
						"select2 filter(not(isNull(gkey))) ~> filter5",
						"join6 derive(Block_To_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 3) != substring({DH ToPosName Short 5Char}, 1, 3), true(), false()),",
						"          Same_Block_Violation = iif( (substring({MH ToPosName Short 5Char}, 1, 3) == substring({DH ToPosName Short 5Char}, 1, 3)) && (substring({MH ToPosName Short 5Char}, 5, 2) == substring({DH ToPosName Short 5Char}, 5, 2)), false(), true()),",
						"          Stack_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 6) != substring({DH ToPosName Short 5Char}, 1, 6), true(), false())) ~> derivedColumn6",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'dpw-peru',",
						"     folderPath: 'gold/violation',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> violation",
						"AlterRow2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'dpw-peru',",
						"     folderPath: 'gold/decking',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> decking",
						"alterRow3 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'dpw-peru',",
						"     folderPath: 'gold/move',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> move"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/violations_agct')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "DeckingHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "XpsEcUser"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "violation"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "decking"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "move"
						}
					],
					"transformations": [
						{
							"name": "select1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "join1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter3"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join2"
						},
						{
							"name": "select3"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "select4"
						},
						{
							"name": "join6"
						},
						{
							"name": "select5"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "AlterRow2"
						},
						{
							"name": "alterRow3"
						},
						{
							"name": "select6"
						},
						{
							"name": "select7"
						},
						{
							"name": "aggregate2"
						},
						{
							"name": "filter4"
						},
						{
							"name": "aggregate3"
						},
						{
							"name": "filter5"
						},
						{
							"name": "derivedColumn6"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Unit Nbr} as string,",
						"          {Facility Id} as string,",
						"          {Complex Id} as string,",
						"          {Yard Id} as string,",
						"          {Carrier Visit Key} as string,",
						"          {Event Type Id} as string,",
						"          {Move Kind} as string,",
						"          {From Location} as string,",
						"          {To Location} as string,",
						"          {From Position Name} as string,",
						"          {To Position Name} as string,",
						"          {Carry CHE Operator Id} as string,",
						"          {Fetch CHE Operator Id} as string,",
						"          {Put CHE Operator Id} as string,",
						"          {Fetch CHE Id} as string,",
						"          {Fetch CHE Kind} as string,",
						"          {Carry CHE Id} as string,",
						"          {Carry CHE Kind} as string,",
						"          {Put CHE Id} as string,",
						"          {Put CHE Kind} as string,",
						"          {QC CHE Id} as string,",
						"          {QC CHE Kind} as string,",
						"          t_carry_complete as string,",
						"          t_put as string,",
						"          t_fetch as string,",
						"          t_dispatch as string,",
						"          t_discharge as string,",
						"          t_carry_dispatch as string,",
						"          t_carry_fetch_ready as string,",
						"          t_carry_put_ready as string,",
						"          dist_carry as string,",
						"          dist_start as string,",
						"          {Twin Fetch} as boolean,",
						"          {Twin Carry} as boolean,",
						"          {Twin Put} as boolean,",
						"          {Category Id} as string,",
						"          {Freight Kind Id} as string,",
						"          to_pos_gkey as string,",
						"          fm_pos_gkey as string,",
						"          {Restow Reason} as string,",
						"          {Container Line Id} as string,",
						"          {Container Line Role} as string,",
						"          pow as string,",
						"          mve_gkey as integer,",
						"          ufv_gkey as integer,",
						"          {Berth Id} as string,",
						"          {Goods And Ctr Wt Kg} as integer,",
						"          active_ufv as integer,",
						"          {Requires Power Flag} as string,",
						"          {OOG Flag} as boolean,",
						"          {Shipper Id} as string,",
						"          {Consignee Id} as string,",
						"          {Commodity Id} as string,",
						"          ATA as string,",
						"          ATD as string,",
						"          Rehandles as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/moves/load','bronze/moves/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'agct',",
						"     folderPath: 'bronze/movehistory/load',",
						"     columnDelimiter: ';',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> MoveHistory",
						"source(output(",
						"          gkey as integer,",
						"          uyv_gkey as integer,",
						"          unit_id as string,",
						"          time_stamp as string,",
						"          decking_type as string,",
						"          node_id as string,",
						"          yard as string,",
						"          from_pos_loctype as string,",
						"          from_pos_locid as string,",
						"          from_pos_loc_gkey as integer,",
						"          from_pos_slot as string,",
						"          from_pos_name as string,",
						"          from_pos_bin as string,",
						"          from_pos_tier as short,",
						"          to_pos_loctype as string,",
						"          to_pos_locid as string,",
						"          to_pos_loc_gkey as boolean,",
						"          to_pos_slot as string,",
						"          to_pos_name as string,",
						"          to_pos_bin as string,",
						"          to_pos_tier as boolean,",
						"          total_score as integer,",
						"          execution_time as short,",
						"          details as string,",
						"          phase as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/deckinghistory/load','bronze/deckinghistory/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'agct',",
						"     folderPath: 'bronze/deckinghistory/load',",
						"     columnDelimiter: ';',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> DeckingHistory",
						"source(output(",
						"          gkey as short,",
						"          user_id as string,",
						"          name as string,",
						"          yard as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'agct',",
						"     folderPath: 'bronze/xpsecuser',",
						"     columnDelimiter: ';',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> XpsEcUser",
						"MoveHistory select(mapColumn(",
						"          mve_gkey,",
						"          {Unit Nbr},",
						"          {Event Type Id},",
						"          {Move Kind},",
						"          {From Location},",
						"          {To Position Name},",
						"          {Put CHE Operator Id},",
						"          {Put CHE Id},",
						"          {MH T_Put DateTime} = t_put,",
						"          {Freight Kind Id},",
						"          {Category Id},",
						"          ufv_gkey",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"aggregate3 derive(Year_Month = (year(coalesce(toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss'))\r",
						") * 100) + month(coalesce(toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss'))\r",
						"),",
						"          Year_Week = (year(coalesce(toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss'))\r",
						") * 100) + weekOfYear(coalesce(toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss'))\r",
						"),",
						"          {MH T_Put DateTime} = coalesce(toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss'))) ~> derivedColumn1",
						"DeckingHistory select(mapColumn(",
						"          gkey,",
						"          unit_id,",
						"          {DH TimeStamp} = time_stamp,",
						"          Decking_Type = decking_type,",
						"          to_pos_name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"aggregate2 filter(Decking_Type == 'Bump Intruder' || Decking_Type == 'Vessel Discharge' || Decking_Type == 'Vessel Discharge - Twin' || Decking_Type == 'XD Drop if Floating Refine' || Decking_Type == 'XD Refine Request' || Decking_Type == 'XD Rehandle Request') ~> filter1",
						"filter1 derive(Year_Month = (year(coalesce(toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss')) ) * 100) + month(coalesce(toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss')) ),",
						"          Year_Week = (year(coalesce(toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss')) ) * 100) + weekOfYear(coalesce(toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss')) ),",
						"          {DH TimeStamp} = coalesce(toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss'))) ~> derivedColumn2",
						"derivedColumn1, derivedColumn2 join({Unit Nbr} == unit_id,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 filter({From Location} != 'YARD' && unit_id != '' && not(isNull(unit_id)) && !startsWith(split({To Position Name}, \"-\")[3], 'CR') && {MH T_Put DateTime} > addDays({DH TimeStamp}, -15)) ~> filter2",
						"filter2 derive({MH TPut Less 4 hours} = add({MH T_Put DateTime} , -4*60*60*1000),",
						"          {DH TimeStamp Within 4 Hours} = iif(({DH TimeStamp} >= add({MH T_Put DateTime} , -4*60*60*1000)) && ({DH TimeStamp} <= {MH T_Put DateTime}), 1, 0),",
						"          {MH ToPosName Short} = split({To Position Name}, \"-\")[3],",
						"          {MH ToPosName Short 5Char} = iif(length(split({To Position Name}, \"-\")[3]) == 8, substring(split({To Position Name}, \"-\")[3], 0, 7), split({To Position Name}, \"-\")[3]),",
						"          {DH ToPosName Shorrt} = split(to_pos_name, \"-\")[3],",
						"          {DH ToPosName Short 5Char} = iif(length(split(to_pos_name, \"-\")[3]) == 8, substring(split(to_pos_name, \"-\")[3], 0, 7), split(to_pos_name, \"-\")[3])) ~> derivedColumn3",
						"derivedColumn3 filter({DH TimeStamp Within 4 Hours} == 1 && {DH ToPosName Short 5Char} != \"FLD\") ~> filter3",
						"filter3 aggregate(groupBy({Unit Nbr},",
						"          {Move Kind},",
						"          {Category Id},",
						"          {MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime},",
						"          {Put CHE Operator Id},",
						"          mve_gkey,",
						"          {Put CHE Id},",
						"          {Freight Kind Id}),",
						"     MaxDHTime = max({DH TimeStamp})) ~> aggregate1",
						"filter3, aggregate1 join(aggregate3@{Unit Nbr} == aggregate1@{Unit Nbr}",
						"     && aggregate3@{Move Kind} == aggregate1@{Move Kind}",
						"     && aggregate3@{Category Id} == aggregate1@{Category Id}",
						"     && derivedColumn3@{MH ToPosName Short 5Char} == aggregate1@{MH ToPosName Short 5Char}",
						"     && derivedColumn1@{MH T_Put DateTime} == aggregate1@{MH T_Put DateTime}",
						"     && aggregate3@{Put CHE Operator Id} == aggregate1@{Put CHE Operator Id}",
						"     && aggregate3@mve_gkey == aggregate1@mve_gkey",
						"     && aggregate3@{Put CHE Id} == aggregate1@{Put CHE Id}",
						"     && aggregate3@{Freight Kind Id} == aggregate1@{Freight Kind Id}",
						"     && {DH TimeStamp} == MaxDHTime,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join2",
						"join2 select(mapColumn(",
						"          {MH Event Type Id} = {Event Type Id},",
						"          {From Location},",
						"          {MH To Position Name} = {To Position Name},",
						"          ufv_gkey,",
						"          gkey,",
						"          unit_id,",
						"          {D H TimeStamp} = {DH TimeStamp},",
						"          {D H Decking Type} = Decking_Type,",
						"          {D H To Pos Name} = to_pos_name,",
						"          Year_Month = derivedColumn2@Year_Month,",
						"          Year_Week = derivedColumn2@Year_Week,",
						"          {MH TPut Less 4 hours},",
						"          {DH TimeStamp Within 4 Hours},",
						"          {MH ToPosName Short},",
						"          {MH ToPosName Short 5Char} = derivedColumn3@{MH ToPosName Short 5Char},",
						"          {DH ToPosName Shorrt},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr} = aggregate1@{Unit Nbr},",
						"          {MH Move Kind} = aggregate1@{Move Kind},",
						"          {Category Id} = aggregate1@{Category Id},",
						"          {MH ToPosName Short 5Char} = aggregate1@{MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime} = aggregate1@{MH T_Put DateTime},",
						"          {MH Put CHE Operator Id} = aggregate1@{Put CHE Operator Id},",
						"          mve_gkey = aggregate1@mve_gkey,",
						"          {MH Put CHE Id} = aggregate1@{Put CHE Id},",
						"          {Freight Kind Id} = aggregate1@{Freight Kind Id},",
						"          MaxDHTime",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select3",
						"select3 derive({Location Match or Not} = iif(substring({MH ToPosName Short 5Char},1, 9) == substring({DH ToPosName Short 5Char},1,9), 'Position Followed', 'Position Not Followed'),",
						"          Shift_Date = toDate({MH T_Put DateTime}),",
						"          {T Put Time} = MaxDHTime,",
						"          {T Put Hour} = hour(MaxDHTime),",
						"          {T Put Minute} = minute(MaxDHTime),",
						"          {T Put Second} = second(MaxDHTime)) ~> derivedColumn4",
						"derivedColumn6 select(mapColumn(",
						"          {MH Event Type Id},",
						"          {D H Decking Type},",
						"          gkey = select3@gkey,",
						"          Year_Month,",
						"          Year_Week,",
						"          {MH ToPosName Short 5Char},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr},",
						"          {MH Move Kind},",
						"          {Category Id},",
						"          {MH T_Put DateTime},",
						"          {MH Put CHE Operator Id},",
						"          mve_gkey,",
						"          {MH Put CHE Id},",
						"          {Freight Kind Id},",
						"          MaxDHTime,",
						"          Block_To_Block_Violation,",
						"          Same_Block_Violation,",
						"          Stack_Violation,",
						"          {Location Match or Not},",
						"          user_id,",
						"          {User Name} = name,",
						"          Shift_Date",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select4",
						"derivedColumn4, XpsEcUser join(lower({MH Put CHE Operator Id}) == lower(user_id),",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join6",
						"select4 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select5",
						"select5 alterRow(upsertIf(true())) ~> alterRow1",
						"select6 alterRow(upsertIf(true())) ~> AlterRow2",
						"select7 alterRow(upsertIf(true())) ~> alterRow3",
						"derivedColumn2 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select6",
						"derivedColumn1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select7",
						"filter5 aggregate(groupBy(gkey),",
						"     each(match(name!='gkey'), $$ = first($$))) ~> aggregate2",
						"select1 filter(not(isNull(mve_gkey))) ~> filter4",
						"filter4 aggregate(groupBy(mve_gkey),",
						"     each(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate3",
						"select2 filter(not(isNull(gkey))) ~> filter5",
						"join6 derive(Block_To_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 2) != substring({DH ToPosName Short 5Char}, 1, 2), true(), false()),",
						"          Same_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 6) != substring({DH ToPosName Short 5Char}, 1, 6), true(), false()),",
						"          Stack_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 9) != substring({DH ToPosName Short 5Char}, 1, 9), true(), false())) ~> derivedColumn6",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'agct',",
						"     folderPath: 'gold/violation',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> violation",
						"AlterRow2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'agct',",
						"     folderPath: 'gold/decking',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> decking",
						"alterRow3 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'agct',",
						"     folderPath: 'gold/move',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> move"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/violations_chcl')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "DeckingHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "XpsEcUser"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "violation"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "decking"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "move"
						}
					],
					"transformations": [
						{
							"name": "select1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "join1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter3"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join2"
						},
						{
							"name": "select3"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "select4"
						},
						{
							"name": "join6"
						},
						{
							"name": "select5"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "AlterRow2"
						},
						{
							"name": "alterRow3"
						},
						{
							"name": "select6"
						},
						{
							"name": "select7"
						},
						{
							"name": "aggregate2"
						},
						{
							"name": "filter4"
						},
						{
							"name": "aggregate3"
						},
						{
							"name": "filter5"
						},
						{
							"name": "derivedColumn6"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Unit Nbr} as string,",
						"          {Facility Id} as string,",
						"          {Complex Id} as string,",
						"          {Yard Id} as string,",
						"          {Carrier Visit Key} as long,",
						"          {Event Type Id} as string,",
						"          {Move Kind} as string,",
						"          {From Location} as string,",
						"          {To Location} as string,",
						"          {From Position Name} as string,",
						"          {To Position Name} as string,",
						"          {Carry CHE Operator Id} as string,",
						"          {Fetch CHE Operator Id} as string,",
						"          {Put CHE Operator Id} as string,",
						"          {Fetch CHE Id} as short,",
						"          {Fetch CHE Kind} as string,",
						"          {Carry CHE Id} as short,",
						"          {Carry CHE Kind} as string,",
						"          {Put CHE Id} as short,",
						"          {Put CHE Kind} as string,",
						"          {QC CHE Id} as short,",
						"          {QC CHE Kind} as string,",
						"          t_carry_complete as string,",
						"          t_put as string,",
						"          t_fetch as string,",
						"          t_dispatch as string,",
						"          t_discharge as string,",
						"          t_carry_dispatch as string,",
						"          t_carry_fetch_ready as string,",
						"          t_carry_put_ready as string,",
						"          dist_carry as short,",
						"          dist_start as short,",
						"          {Twin Fetch} as boolean,",
						"          {Twin Carry} as boolean,",
						"          {Twin Put} as boolean,",
						"          {Category Id} as string,",
						"          {Freight Kind Id} as string,",
						"          to_pos_gkey as string,",
						"          fm_pos_gkey as long,",
						"          {Restow Reason} as string,",
						"          {Container Line Id} as string,",
						"          {Container Line Role} as string,",
						"          pow as string,",
						"          mve_gkey as long,",
						"          ufv_gkey as long,",
						"          {Berth Id} as string,",
						"          {Goods And Ctr Wt Kg} as integer,",
						"          active_ufv as long,",
						"          {Requires Power Flag} as boolean,",
						"          {OOG Flag} as boolean,",
						"          {Shipper Id} as string,",
						"          {Consignee Id} as string,",
						"          {Commodity Id} as string,",
						"          ATA as string,",
						"          ATD as string,",
						"          Rehandles as boolean",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/movehistory/load','bronze/moves/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'chcl',",
						"     folderPath: 'bronze/movehistory/load/',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> MoveHistory",
						"source(output(",
						"          GKEY as integer,",
						"          UYV_GKEY as integer,",
						"          UNIT_ID as string,",
						"          TIME_STAMP as string,",
						"          DECKING_TYPE as string,",
						"          NODE_ID as string,",
						"          YARD as integer,",
						"          FROM_POS_LOCTYPE as string,",
						"          FROM_POS_LOCID as string,",
						"          FROM_POS_LOC_GKEY as integer,",
						"          FROM_POS_SLOT as string,",
						"          FROM_POS_NAME as string,",
						"          FROM_POS_BIN as integer,",
						"          FROM_POS_TIER as short,",
						"          TO_POS_LOCTYPE as string,",
						"          TO_POS_LOCID as string,",
						"          TO_POS_LOC_GKEY as integer,",
						"          TO_POS_SLOT as string,",
						"          TO_POS_NAME as string,",
						"          TO_POS_BIN as integer,",
						"          TO_POS_TIER as short,",
						"          TOTAL_SCORE as integer,",
						"          EXECUTION_TIME as short,",
						"          DETAILS as string,",
						"          PHASE as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/deckinghistory/load','bronze/deckinghistory/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'chcl',",
						"     folderPath: 'bronze/deckinghistory/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> DeckingHistory",
						"source(output(",
						"          GKEY as string,",
						"          USER_ID as string,",
						"          NAME as string,",
						"          YARD as integer",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'chcl',",
						"     folderPath: 'bronze/xpsecuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> XpsEcUser",
						"MoveHistory select(mapColumn(",
						"          mve_gkey,",
						"          {Unit Nbr},",
						"          {Event Type Id},",
						"          {Move Kind},",
						"          {From Location},",
						"          {To Position Name},",
						"          {Put CHE Operator Id},",
						"          {Put CHE Id},",
						"          {MH T_Put DateTime} = t_put,",
						"          {Freight Kind Id},",
						"          {Category Id},",
						"          ufv_gkey",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"aggregate3 derive(Year_Month = (year(coalesce(toTimestamp(concat(substring({MH T_Put DateTime}, 1, 21), ' ', substring({MH T_Put DateTime}, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd.MM.yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm')))*100) + month(coalesce(toTimestamp(concat(substring({MH T_Put DateTime}, 1, 21), ' ', substring({MH T_Put DateTime}, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd.MM.yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm'))),",
						"          Year_Week = (year(coalesce(toTimestamp(concat(substring({MH T_Put DateTime}, 1, 21), ' ', substring({MH T_Put DateTime}, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd.MM.yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm')))*100) + weekOfYear(coalesce(toTimestamp(concat(substring({MH T_Put DateTime}, 1, 21), ' ', substring({MH T_Put DateTime}, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd.MM.yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm'))),",
						"          {MH T_Put DateTime} = coalesce(toTimestamp(concat(substring({MH T_Put DateTime}, 1, 21), ' ', substring({MH T_Put DateTime}, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd.MM.yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm'))) ~> derivedColumn1",
						"DeckingHistory select(mapColumn(",
						"          gkey = GKEY,",
						"          unit_id = UNIT_ID,",
						"          {DH TimeStamp} = TIME_STAMP,",
						"          Decking_Type = DECKING_TYPE,",
						"          to_pos_name = TO_POS_NAME",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"aggregate2 filter(Decking_Type == 'Bump Intruder' || Decking_Type == 'Vessel Discharge' || Decking_Type == 'Vessel Discharge - Twin' || Decking_Type == 'XD Drop if Floating Refine' || Decking_Type == 'XD Refine Request' || Decking_Type == 'XD Rehandle Request') ~> filter1",
						"filter1 derive(Year_Month = (year(coalesce(toTimestamp(concat(substring({DH TimeStamp}, 1, 21), ' ', substring({DH TimeStamp}, 29, 2)), 'dd/MM/yy hh:mm:ss.SSS a'),toTimestamp(trim({DH TimeStamp}), 'dd/MM/yy HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'MM/dd/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yyyy HH:mm:ss')))*100) + month(coalesce(toTimestamp(concat(substring({DH TimeStamp}, 1, 21), ' ', substring({DH TimeStamp}, 29, 2)), 'dd/MM/yy hh:mm:ss.SSS a'),toTimestamp(trim({DH TimeStamp}), 'dd/MM/yy HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'MM/dd/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yyyy HH:mm:ss'))),",
						"          Year_Week = (year(coalesce(toTimestamp(concat(substring({DH TimeStamp}, 1, 21), ' ', substring({DH TimeStamp}, 29, 2)), 'dd/MM/yy hh:mm:ss.SSS a'),toTimestamp(trim({DH TimeStamp}), 'dd/MM/yy HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'MM/dd/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yyyy HH:mm:ss')))*100) + weekOfYear(coalesce(toTimestamp(concat(substring({DH TimeStamp}, 1, 21), ' ', substring({DH TimeStamp}, 29, 2)), 'dd/MM/yy hh:mm:ss.SSS a'),toTimestamp(trim({DH TimeStamp}), 'dd/MM/yy HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'MM/dd/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yyyy HH:mm:ss'))),",
						"          {DH TimeStamp} = coalesce(toTimestamp(concat(substring({DH TimeStamp}, 1, 21), ' ', substring({DH TimeStamp}, 29, 2)), 'dd/MM/yy hh:mm:ss.SSS a'),toTimestamp(trim({DH TimeStamp}), 'dd/MM/yy HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'MM/dd/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yyyy HH:mm:ss'))) ~> derivedColumn2",
						"derivedColumn1, derivedColumn2 join({Unit Nbr} == unit_id,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 filter({From Location} != 'YARD' && unit_id != '' && not(isNull(unit_id)) && !startsWith(split({To Position Name}, \"-\")[3], 'CR') && {MH T_Put DateTime} > addDays({DH TimeStamp}, -15)) ~> filter2",
						"filter2 derive({MH TPut Less 4 hours} = add({MH T_Put DateTime} , -4*60*60*1000),",
						"          {DH TimeStamp Within 4 Hours} = iif(({DH TimeStamp} >= add({MH T_Put DateTime} , -4*60*60*1000)) && ({DH TimeStamp} <= {MH T_Put DateTime}), 1, 0),",
						"          {MH ToPosName Short} = split({To Position Name}, \"-\")[3],",
						"          {MH ToPosName Short 5Char} = iif(length(split({To Position Name}, \"-\")[3]) == 8, substring(split({To Position Name}, \"-\")[3], 0, 7), split({To Position Name}, \"-\")[3]),",
						"          {DH ToPosName Shorrt} = split(to_pos_name, \"-\")[3],",
						"          {DH ToPosName Short 5Char} = iif(length(split(to_pos_name, \"-\")[3]) == 8, substring(split(to_pos_name, \"-\")[3], 0, 7), split(to_pos_name, \"-\")[3])) ~> derivedColumn3",
						"derivedColumn3 filter({DH TimeStamp Within 4 Hours} == 1 && {DH ToPosName Short 5Char} != \"FLD\" && not(like({DH ToPosName Short 5Char}, \"Fail%\"))) ~> filter3",
						"filter3 aggregate(groupBy({Unit Nbr},",
						"          {Move Kind},",
						"          {Category Id},",
						"          {MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime},",
						"          {Put CHE Operator Id},",
						"          mve_gkey,",
						"          {Put CHE Id},",
						"          {Freight Kind Id}),",
						"     MaxDHTime = max({DH TimeStamp})) ~> aggregate1",
						"filter3, aggregate1 join(aggregate3@{Unit Nbr} == aggregate1@{Unit Nbr}",
						"     && aggregate3@{Move Kind} == aggregate1@{Move Kind}",
						"     && aggregate3@{Category Id} == aggregate1@{Category Id}",
						"     && derivedColumn3@{MH ToPosName Short 5Char} == aggregate1@{MH ToPosName Short 5Char}",
						"     && derivedColumn1@{MH T_Put DateTime} == aggregate1@{MH T_Put DateTime}",
						"     && aggregate3@{Put CHE Operator Id} == aggregate1@{Put CHE Operator Id}",
						"     && aggregate3@mve_gkey == aggregate1@mve_gkey",
						"     && aggregate3@{Put CHE Id} == aggregate1@{Put CHE Id}",
						"     && aggregate3@{Freight Kind Id} == aggregate1@{Freight Kind Id}",
						"     && {DH TimeStamp} == MaxDHTime,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join2",
						"join2 select(mapColumn(",
						"          {MH Event Type Id} = {Event Type Id},",
						"          {From Location},",
						"          {MH To Position Name} = {To Position Name},",
						"          ufv_gkey,",
						"          gkey,",
						"          unit_id,",
						"          {D H TimeStamp} = {DH TimeStamp},",
						"          {D H Decking Type} = Decking_Type,",
						"          {D H To Pos Name} = to_pos_name,",
						"          Year_Month = derivedColumn2@Year_Month,",
						"          Year_Week = derivedColumn2@Year_Week,",
						"          {MH TPut Less 4 hours},",
						"          {DH TimeStamp Within 4 Hours},",
						"          {MH ToPosName Short},",
						"          {MH ToPosName Short 5Char} = derivedColumn3@{MH ToPosName Short 5Char},",
						"          {DH ToPosName Shorrt},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr} = aggregate1@{Unit Nbr},",
						"          {MH Move Kind} = aggregate1@{Move Kind},",
						"          {Category Id} = aggregate1@{Category Id},",
						"          {MH ToPosName Short 5Char} = aggregate1@{MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime} = aggregate1@{MH T_Put DateTime},",
						"          {MH Put CHE Operator Id} = aggregate1@{Put CHE Operator Id},",
						"          mve_gkey = aggregate1@mve_gkey,",
						"          {MH Put CHE Id} = aggregate1@{Put CHE Id},",
						"          {Freight Kind Id} = aggregate1@{Freight Kind Id},",
						"          MaxDHTime",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select3",
						"select3 derive({Location Match or Not} = iif(substring({MH ToPosName Short 5Char}, 1, 6) == substring({DH ToPosName Short 5Char}, 1, 6), 'Position Followed', 'Position Not Followed'),",
						"          Shift_Date = toDate({MH T_Put DateTime}),",
						"          {T Put Time} = MaxDHTime,",
						"          {T Put Hour} = hour(MaxDHTime),",
						"          {T Put Minute} = minute(MaxDHTime),",
						"          {T Put Second} = second(MaxDHTime)) ~> derivedColumn4",
						"derivedColumn6 select(mapColumn(",
						"          {D H Decking Type},",
						"          {MH ToPosName Short 5Char},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr},",
						"          {MH Move Kind},",
						"          {Category Id},",
						"          {MH T_Put DateTime},",
						"          {MH Put CHE Operator Id},",
						"          mve_gkey,",
						"          {MH Put CHE Id},",
						"          {Freight Kind Id},",
						"          MaxDHTime,",
						"          {Location Match or Not},",
						"          operator_name = NAME,",
						"          Block_To_Block_Violation,",
						"          Same_Block_Violation,",
						"          Stack_Violation,",
						"          Date = Shift_Date,",
						"          Year_Month,",
						"          Year_Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select4",
						"derivedColumn4, XpsEcUser join(lower({MH Put CHE Operator Id}) == lower(USER_ID),",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join6",
						"select4 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select5",
						"select5 alterRow(upsertIf(true())) ~> alterRow1",
						"select6 alterRow(upsertIf(true())) ~> AlterRow2",
						"select7 alterRow(upsertIf(true())) ~> alterRow3",
						"derivedColumn2 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select6",
						"derivedColumn1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select7",
						"filter5 aggregate(groupBy(gkey),",
						"     each(match(name!='gkey'), $$ = first($$))) ~> aggregate2",
						"select1 filter(not(isNull(mve_gkey))) ~> filter4",
						"filter4 aggregate(groupBy(mve_gkey),",
						"     each(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate3",
						"select2 filter(not(isNull(gkey))) ~> filter5",
						"join6 derive(Block_To_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 3) != substring({DH ToPosName Short 5Char}, 1, 3), true(), false()),",
						"          Same_Block_Violation = iif( (substring({MH ToPosName Short 5Char}, 1, 3) == substring({DH ToPosName Short 5Char}, 1, 3)) && (substring({MH ToPosName Short 5Char}, 5, 2) == substring({DH ToPosName Short 5Char}, 5, 2)), false(), true()),",
						"          Stack_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 6) != substring({DH ToPosName Short 5Char}, 1, 6), true(), false())) ~> derivedColumn6",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'chcl',",
						"     folderPath: 'gold/violation',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> violation",
						"AlterRow2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'chcl',",
						"     folderPath: 'gold/decking',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> decking",
						"alterRow3 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'chcl',",
						"     folderPath: 'gold/move',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> move"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/violations_gpa')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "DeckingHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "XpsEcUser"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "violation"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "decking"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "move"
						}
					],
					"transformations": [
						{
							"name": "select1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "join1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter3"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join2"
						},
						{
							"name": "select3"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "select4"
						},
						{
							"name": "join6"
						},
						{
							"name": "select5"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "AlterRow2"
						},
						{
							"name": "alterRow3"
						},
						{
							"name": "select6"
						},
						{
							"name": "select7"
						},
						{
							"name": "aggregate2"
						},
						{
							"name": "filter4"
						},
						{
							"name": "aggregate3"
						},
						{
							"name": "filter5"
						},
						{
							"name": "derivedColumn6"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Unit Nbr} as string,",
						"          {Facility Id} as string,",
						"          {Complex Id} as string,",
						"          {Yard Id} as string,",
						"          {Carrier Visit Key} as string,",
						"          {Event Type Id} as string,",
						"          {Move Kind} as string,",
						"          {From Location} as string,",
						"          {To Location} as string,",
						"          {From Position Name} as string,",
						"          {To Position Name} as string,",
						"          {Carry CHE Operator Id} as string,",
						"          {Fetch CHE Operator Id} as string,",
						"          {Put CHE Operator Id} as string,",
						"          {Fetch CHE Id} as string,",
						"          {Fetch CHE Kind} as string,",
						"          {Carry CHE Id} as string,",
						"          {Carry CHE Kind} as string,",
						"          {Put CHE Id} as string,",
						"          {Put CHE Kind} as string,",
						"          {QC CHE Id} as string,",
						"          {QC CHE Kind} as string,",
						"          t_carry_complete as string,",
						"          t_put as string,",
						"          t_fetch as string,",
						"          t_dispatch as string,",
						"          t_discharge as string,",
						"          t_carry_dispatch as string,",
						"          t_carry_fetch_ready as string,",
						"          t_carry_put_ready as string,",
						"          dist_carry as string,",
						"          dist_start as string,",
						"          {Twin Fetch} as boolean,",
						"          {Twin Carry} as boolean,",
						"          {Twin Put} as boolean,",
						"          {Category Id} as string,",
						"          {Freight Kind Id} as string,",
						"          to_pos_gkey as string,",
						"          fm_pos_gkey as string,",
						"          {Restow Reason} as string,",
						"          {Container Line Id} as string,",
						"          {Container Line Role} as string,",
						"          pow as string,",
						"          mve_gkey as long,",
						"          ufv_gkey as long,",
						"          {Berth Id} as string,",
						"          {Goods And Ctr Wt Kg} as double,",
						"          active_ufv as long,",
						"          {Requires Power Flag} as boolean,",
						"          {OOG Flag} as boolean,",
						"          {Shipper Id} as string,",
						"          {Consignee Id} as string,",
						"          {Commodity Id} as string,",
						"          ATA as string,",
						"          ATD as string,",
						"          Rehandles as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/movehistory/load','bronze/moves/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'gpa',",
						"     folderPath: 'bronze/movehistory/load/',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> MoveHistory",
						"source(output(",
						"          GKEY as long,",
						"          UYV_GKEY as long,",
						"          UNIT_ID as string,",
						"          TIME_STAMP as string,",
						"          DECKING_TYPE as string,",
						"          NODE_ID as string,",
						"          YARD as integer,",
						"          FROM_POS_LOCTYPE as string,",
						"          FROM_POS_LOCID as string,",
						"          FROM_POS_LOC_GKEY as long,",
						"          FROM_POS_SLOT as string,",
						"          FROM_POS_NAME as string,",
						"          FROM_POS_BIN as string,",
						"          FROM_POS_TIER as short,",
						"          TO_POS_LOCTYPE as string,",
						"          TO_POS_LOCID as string,",
						"          TO_POS_LOC_GKEY as integer,",
						"          TO_POS_SLOT as string,",
						"          TO_POS_NAME as string,",
						"          TO_POS_BIN as string,",
						"          TO_POS_TIER as boolean,",
						"          TOTAL_SCORE as short,",
						"          EXECUTION_TIME as short,",
						"          DETAILS as string,",
						"          PHASE as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/deckinghistory/load','bronze/deckinghistory/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'gpa',",
						"     folderPath: 'bronze/deckinghistory/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> DeckingHistory",
						"source(output(",
						"          GKEY as string,",
						"          USER_ID as string,",
						"          NAME as string,",
						"          YARD as integer",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'gpa',",
						"     folderPath: 'bronze/xpsecuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> XpsEcUser",
						"MoveHistory select(mapColumn(",
						"          mve_gkey,",
						"          {Unit Nbr},",
						"          {Event Type Id},",
						"          {Move Kind},",
						"          {From Location},",
						"          {To Position Name},",
						"          {Put CHE Operator Id},",
						"          {Put CHE Id},",
						"          {MH T_Put DateTime} = t_put,",
						"          {Freight Kind Id},",
						"          {Category Id},",
						"          ufv_gkey",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"aggregate3 derive(Year_Month = (year(coalesce(toTimestamp(concat(substring({MH T_Put DateTime}, 1, 21), ' ', substring({MH T_Put DateTime}, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd.MM.yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm')))*100) + month(coalesce(toTimestamp(concat(substring({MH T_Put DateTime}, 1, 21), ' ', substring({MH T_Put DateTime}, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd.MM.yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm'))),",
						"          Year_Week = (year(coalesce(toTimestamp(concat(substring({MH T_Put DateTime}, 1, 21), ' ', substring({MH T_Put DateTime}, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd.MM.yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm')))*100) + weekOfYear(coalesce(toTimestamp(concat(substring({MH T_Put DateTime}, 1, 21), ' ', substring({MH T_Put DateTime}, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd.MM.yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm'))),",
						"          {MH T_Put DateTime} = coalesce(toTimestamp(concat(substring({MH T_Put DateTime}, 1, 21), ' ', substring({MH T_Put DateTime}, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd.MM.yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm'))) ~> derivedColumn1",
						"DeckingHistory select(mapColumn(",
						"          gkey = GKEY,",
						"          unit_id = UNIT_ID,",
						"          {DH TimeStamp} = TIME_STAMP,",
						"          Decking_Type = DECKING_TYPE,",
						"          to_pos_name = TO_POS_NAME",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"aggregate2 filter(Decking_Type == 'Bump Intruder' || Decking_Type == 'Vessel Discharge' || Decking_Type == 'Vessel Discharge - Twin' || Decking_Type == 'XD Drop if Floating Refine' || Decking_Type == 'XD Refine Request' || Decking_Type == 'XD Rehandle Request') ~> filter1",
						"filter1 derive(Year_Month = (year(coalesce(toTimestamp(concat(substring({DH TimeStamp}, 1, 21), ' ', substring({DH TimeStamp}, 29, 2)), 'dd/MM/yy hh:mm:ss.SSS a'),toTimestamp(trim({DH TimeStamp}), 'dd/MM/yy HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'MM/dd/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yyyy HH:mm:ss')))*100) + month(coalesce(toTimestamp(concat(substring({DH TimeStamp}, 1, 21), ' ', substring({DH TimeStamp}, 29, 2)), 'dd/MM/yy hh:mm:ss.SSS a'),toTimestamp(trim({DH TimeStamp}), 'dd/MM/yy HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'MM/dd/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yyyy HH:mm:ss'))),",
						"          Year_Week = (year(coalesce(toTimestamp(concat(substring({DH TimeStamp}, 1, 21), ' ', substring({DH TimeStamp}, 29, 2)), 'dd/MM/yy hh:mm:ss.SSS a'),toTimestamp(trim({DH TimeStamp}), 'dd/MM/yy HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'MM/dd/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yyyy HH:mm:ss')))*100) + weekOfYear(coalesce(toTimestamp(concat(substring({DH TimeStamp}, 1, 21), ' ', substring({DH TimeStamp}, 29, 2)), 'dd/MM/yy hh:mm:ss.SSS a'),toTimestamp(trim({DH TimeStamp}), 'dd/MM/yy HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'MM/dd/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yyyy HH:mm:ss'))),",
						"          {DH TimeStamp} = coalesce(toTimestamp(concat(substring({DH TimeStamp}, 1, 21), ' ', substring({DH TimeStamp}, 29, 2)), 'dd/MM/yy hh:mm:ss.SSS a'),toTimestamp(trim({DH TimeStamp}), 'dd/MM/yy HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'MM/dd/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp(trim({DH TimeStamp}),'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp(trim({DH TimeStamp}),'dd/MM/yyyy HH:mm:ss'),toTimestamp(trim({DH TimeStamp}),'dd-MM-yyyy HH:mm:ss'))) ~> derivedColumn2",
						"derivedColumn1, derivedColumn2 join({Unit Nbr} == unit_id,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 filter({From Location} != 'YARD' && unit_id != '' && not(isNull(unit_id)) && !startsWith(split({To Position Name}, \"-\")[3], 'CR') && {MH T_Put DateTime} > addDays({DH TimeStamp}, -15)) ~> filter2",
						"filter2 derive({MH TPut Less 4 hours} = add({MH T_Put DateTime} , -4*60*60*1000),",
						"          {DH TimeStamp Within 4 Hours} = iif(({DH TimeStamp} >= add({MH T_Put DateTime} , -4*60*60*1000)) && ({DH TimeStamp} <= {MH T_Put DateTime}), 1, 0),",
						"          {MH ToPosName Short} = split({To Position Name}, \"-\")[3],",
						"          {MH ToPosName Short 5Char} = iif(length(split({To Position Name}, \"-\")[3]) == 8, substring(split({To Position Name}, \"-\")[3], 0, 7), split({To Position Name}, \"-\")[3]),",
						"          {DH ToPosName Shorrt} = split(to_pos_name, \"-\")[3],",
						"          {DH ToPosName Short 5Char} = iif(length(split(to_pos_name, \"-\")[3]) == 8, substring(split(to_pos_name, \"-\")[3], 0, 7), split(to_pos_name, \"-\")[3])) ~> derivedColumn3",
						"derivedColumn3 filter({DH TimeStamp Within 4 Hours} == 1 && {DH ToPosName Short 5Char} != \"FLD\" && not(like({DH ToPosName Short 5Char}, \"Fail%\"))) ~> filter3",
						"filter3 aggregate(groupBy({Unit Nbr},",
						"          {Move Kind},",
						"          {Category Id},",
						"          {MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime},",
						"          {Put CHE Operator Id},",
						"          mve_gkey,",
						"          {Put CHE Id},",
						"          {Freight Kind Id}),",
						"     MaxDHTime = max({DH TimeStamp})) ~> aggregate1",
						"filter3, aggregate1 join(aggregate3@{Unit Nbr} == aggregate1@{Unit Nbr}",
						"     && aggregate3@{Move Kind} == aggregate1@{Move Kind}",
						"     && aggregate3@{Category Id} == aggregate1@{Category Id}",
						"     && derivedColumn3@{MH ToPosName Short 5Char} == aggregate1@{MH ToPosName Short 5Char}",
						"     && derivedColumn1@{MH T_Put DateTime} == aggregate1@{MH T_Put DateTime}",
						"     && aggregate3@{Put CHE Operator Id} == aggregate1@{Put CHE Operator Id}",
						"     && aggregate3@mve_gkey == aggregate1@mve_gkey",
						"     && aggregate3@{Put CHE Id} == aggregate1@{Put CHE Id}",
						"     && aggregate3@{Freight Kind Id} == aggregate1@{Freight Kind Id}",
						"     && {DH TimeStamp} == MaxDHTime,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join2",
						"join2 select(mapColumn(",
						"          {MH Event Type Id} = {Event Type Id},",
						"          {From Location},",
						"          {MH To Position Name} = {To Position Name},",
						"          ufv_gkey,",
						"          gkey,",
						"          unit_id,",
						"          {D H TimeStamp} = {DH TimeStamp},",
						"          {D H Decking Type} = Decking_Type,",
						"          {D H To Pos Name} = to_pos_name,",
						"          Year_Month = derivedColumn2@Year_Month,",
						"          Year_Week = derivedColumn2@Year_Week,",
						"          {MH TPut Less 4 hours},",
						"          {DH TimeStamp Within 4 Hours},",
						"          {MH ToPosName Short},",
						"          {MH ToPosName Short 5Char} = derivedColumn3@{MH ToPosName Short 5Char},",
						"          {DH ToPosName Shorrt},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr} = aggregate1@{Unit Nbr},",
						"          {MH Move Kind} = aggregate1@{Move Kind},",
						"          {Category Id} = aggregate1@{Category Id},",
						"          {MH ToPosName Short 5Char} = aggregate1@{MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime} = aggregate1@{MH T_Put DateTime},",
						"          {MH Put CHE Operator Id} = aggregate1@{Put CHE Operator Id},",
						"          mve_gkey = aggregate1@mve_gkey,",
						"          {MH Put CHE Id} = aggregate1@{Put CHE Id},",
						"          {Freight Kind Id} = aggregate1@{Freight Kind Id},",
						"          MaxDHTime",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select3",
						"select3 derive({Location Match or Not} = iif(substring({MH ToPosName Short 5Char}, 1, 6) == substring({DH ToPosName Short 5Char}, 1, 6), 'Position Followed', 'Position Not Followed'),",
						"          Shift_Date = toDate({MH T_Put DateTime}),",
						"          {T Put Time} = MaxDHTime,",
						"          {T Put Hour} = hour(MaxDHTime),",
						"          {T Put Minute} = minute(MaxDHTime),",
						"          {T Put Second} = second(MaxDHTime)) ~> derivedColumn4",
						"derivedColumn6 select(mapColumn(",
						"          {D H Decking Type},",
						"          {MH ToPosName Short 5Char},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr},",
						"          {MH Move Kind},",
						"          {Category Id},",
						"          {MH T_Put DateTime},",
						"          {MH Put CHE Operator Id},",
						"          mve_gkey,",
						"          {MH Put CHE Id},",
						"          {Freight Kind Id},",
						"          MaxDHTime,",
						"          {Location Match or Not},",
						"          operator_name = NAME,",
						"          Block_To_Block_Violation,",
						"          Same_Block_Violation,",
						"          Stack_Violation,",
						"          Date = Shift_Date,",
						"          Year_Month,",
						"          Year_Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select4",
						"derivedColumn4, XpsEcUser join(lower({MH Put CHE Operator Id}) == lower(USER_ID),",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join6",
						"select4 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select5",
						"select5 alterRow(upsertIf(true())) ~> alterRow1",
						"select6 alterRow(upsertIf(true())) ~> AlterRow2",
						"select7 alterRow(upsertIf(true())) ~> alterRow3",
						"derivedColumn2 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select6",
						"derivedColumn1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select7",
						"filter5 aggregate(groupBy(gkey),",
						"     each(match(name!='gkey'), $$ = first($$))) ~> aggregate2",
						"select1 filter(not(isNull(mve_gkey))) ~> filter4",
						"filter4 aggregate(groupBy(mve_gkey),",
						"     each(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate3",
						"select2 filter(not(isNull(gkey))) ~> filter5",
						"join6 derive(Block_To_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 3) != substring({DH ToPosName Short 5Char}, 1, 3), true(), false()),",
						"          Same_Block_Violation = iif( (substring({MH ToPosName Short 5Char}, 1, 3) == substring({DH ToPosName Short 5Char}, 1, 3)) && (substring({MH ToPosName Short 5Char}, 5, 2) == substring({DH ToPosName Short 5Char}, 5, 2)), false(), true()),",
						"          Stack_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 6) != substring({DH ToPosName Short 5Char}, 1, 6), true(), false())) ~> derivedColumn6",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'gpa',",
						"     folderPath: 'gold/violation',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> violation",
						"AlterRow2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'gpa',",
						"     folderPath: 'gold/decking',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> decking",
						"alterRow3 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'gpa',",
						"     folderPath: 'gold/move',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> move"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/violations_hazira')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "DeckingHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "XpsEcUser"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "violation"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "decking"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "move"
						}
					],
					"transformations": [
						{
							"name": "select1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "join1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter3"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join2"
						},
						{
							"name": "select3"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "select4"
						},
						{
							"name": "join6"
						},
						{
							"name": "select5"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "AlterRow2"
						},
						{
							"name": "alterRow3"
						},
						{
							"name": "select6"
						},
						{
							"name": "select7"
						},
						{
							"name": "aggregate2"
						},
						{
							"name": "filter4"
						},
						{
							"name": "aggregate3"
						},
						{
							"name": "filter5"
						},
						{
							"name": "derivedColumn6"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Unit Nbr} as string,",
						"          {Facility Id} as string,",
						"          {Complex Id} as string,",
						"          {Yard Id} as string,",
						"          {Carrier Visit Key} as string,",
						"          {Event Type Id} as string,",
						"          {Move Kind} as string,",
						"          {From Location} as string,",
						"          {To Location} as string,",
						"          {From Position Name} as string,",
						"          {To Position Name} as string,",
						"          {Carry CHE Operator Id} as string,",
						"          {Fetch CHE Operator Id} as string,",
						"          {Put CHE Operator Id} as string,",
						"          {Fetch CHE Id} as string,",
						"          {Fetch CHE Kind} as string,",
						"          {Carry CHE Id} as string,",
						"          {Carry CHE Kind} as string,",
						"          {Put CHE Id} as string,",
						"          {Put CHE Kind} as string,",
						"          {QC CHE Id} as string,",
						"          {QC CHE Kind} as string,",
						"          t_carry_complete as string,",
						"          t_put as string,",
						"          t_fetch as string,",
						"          t_dispatch as string,",
						"          t_discharge as string,",
						"          t_carry_dispatch as string,",
						"          t_carry_fetch_ready as string,",
						"          t_carry_put_ready as string,",
						"          dist_carry as string,",
						"          dist_start as string,",
						"          {Twin Fetch} as boolean,",
						"          {Twin Carry} as boolean,",
						"          {Twin Put} as boolean,",
						"          {Category Id} as string,",
						"          {Freight Kind Id} as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          {Restow Reason} as string,",
						"          {Container Line Id} as string,",
						"          {Container Line Role} as string,",
						"          pow as string,",
						"          mve_gkey as integer,",
						"          ufv_gkey as integer,",
						"          {Berth Id} as string,",
						"          {Goods And Ctr Wt Kg} as double,",
						"          active_ufv as integer,",
						"          {Requires Power Flag} as boolean,",
						"          {OOG Flag} as boolean,",
						"          {Shipper Id} as string,",
						"          {Consignee Id} as string,",
						"          {Commodity Id} as string,",
						"          ATA as string,",
						"          ATD as string,",
						"          Rehandles as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/movehistory/load','bronze/moves/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'hazira',",
						"     folderPath: 'bronze/movehistory/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> MoveHistory",
						"source(output(",
						"          gkey as integer,",
						"          uyv_gkey as integer,",
						"          unit_id as string,",
						"          time_stamp as string,",
						"          decking_type as string,",
						"          node_id as string,",
						"          yard as string,",
						"          from_pos_loctype as string,",
						"          from_pos_locid as string,",
						"          from_pos_loc_gkey as integer,",
						"          from_pos_slot as string,",
						"          from_pos_name as string,",
						"          from_pos_bin as string,",
						"          from_pos_tier as short,",
						"          to_pos_loctype as string,",
						"          to_pos_locid as string,",
						"          to_pos_loc_gkey as string,",
						"          to_pos_slot as string,",
						"          to_pos_name as string,",
						"          to_pos_bin as string,",
						"          to_pos_tier as string,",
						"          total_score as integer,",
						"          execution_time as short,",
						"          details as string,",
						"          phase as string,",
						"          tbd_unit_gkey as string,",
						"          cas_unit_reference as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/deckinghistory/load','bronze/deckinghistory/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'hazira',",
						"     folderPath: 'bronze/deckinghistory/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> DeckingHistory",
						"source(output(",
						"          gkey as short,",
						"          user_id as string,",
						"          name as string,",
						"          yard as short",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'hazira',",
						"     folderPath: 'bronze/xpsecuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> XpsEcUser",
						"MoveHistory select(mapColumn(",
						"          mve_gkey,",
						"          {Unit Nbr},",
						"          {Event Type Id},",
						"          {Move Kind},",
						"          {From Location},",
						"          {To Position Name},",
						"          {Put CHE Operator Id},",
						"          {Put CHE Id},",
						"          {MH T_Put DateTime} = t_put,",
						"          {Freight Kind Id},",
						"          {Category Id},",
						"          ufv_gkey",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"aggregate3 derive(Year_Month = (year(:datetime) * 100) + month(:datetime),",
						"          Year_Week = (year(:datetime) * 100) + weekOfYear(:datetime),",
						"          {MH T_Put DateTime} = :datetime,",
						"          datetime := coalesce(toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss'))) ~> derivedColumn1",
						"DeckingHistory select(mapColumn(",
						"          gkey,",
						"          unit_id,",
						"          {DH TimeStamp} = time_stamp,",
						"          Decking_Type = decking_type,",
						"          to_pos_name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"aggregate2 filter(Decking_Type == 'Bump Intruder' || Decking_Type == 'Vessel Discharge' || Decking_Type == 'Vessel Discharge - Twin' || Decking_Type == 'XD Drop if Floating Refine' || Decking_Type == 'XD Refine Request' || Decking_Type == 'XD Rehandle Request') ~> filter1",
						"filter1 derive(Year_Month = (year(:datetime_dh) * 100) + month(:datetime_dh),",
						"          Year_Week = (year(:datetime_dh) * 100) + weekOfYear(:datetime_dh),",
						"          {DH TimeStamp} = :datetime_dh,",
						"          datetime_dh := coalesce(toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm'), toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss'))) ~> derivedColumn2",
						"derivedColumn1, derivedColumn2 join({Unit Nbr} == unit_id,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 filter({From Location} != 'YARD' && unit_id != '' && not(isNull(unit_id)) && !startsWith(split({To Position Name}, \"-\")[3], 'CR') && {MH T_Put DateTime} > addDays({DH TimeStamp}, -15)) ~> filter2",
						"filter2 derive({MH TPut Less 4 hours} = add({MH T_Put DateTime} , -4*60*60*1000),",
						"          {DH TimeStamp Within 4 Hours} = iif(({DH TimeStamp} >= add({MH T_Put DateTime} , -4*60*60*1000)) && ({DH TimeStamp} <= {MH T_Put DateTime}), 1, 0),",
						"          {MH ToPosName Short} = split({To Position Name}, \"-\")[3],",
						"          {MH ToPosName Short 5Char} = iif(length(split({To Position Name}, \"-\")[3]) == 8, substring(split({To Position Name}, \"-\")[3], 0, 7), split({To Position Name}, \"-\")[3]),",
						"          {DH ToPosName Shorrt} = split(to_pos_name, \"-\")[3],",
						"          {DH ToPosName Short 5Char} = iif(length(split(to_pos_name, \"-\")[3]) == 8, substring(split(to_pos_name, \"-\")[3], 0, 7), split(to_pos_name, \"-\")[3])) ~> derivedColumn3",
						"derivedColumn3 filter({DH TimeStamp Within 4 Hours} == 1 && {DH ToPosName Short 5Char} != \"FLD\") ~> filter3",
						"filter3 aggregate(groupBy({Unit Nbr},",
						"          {Move Kind},",
						"          {Category Id},",
						"          {MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime},",
						"          {Put CHE Operator Id},",
						"          mve_gkey,",
						"          {Put CHE Id},",
						"          {Freight Kind Id}),",
						"     MaxDHTime = max({DH TimeStamp})) ~> aggregate1",
						"filter3, aggregate1 join(aggregate3@{Unit Nbr} == aggregate1@{Unit Nbr}",
						"     && aggregate3@{Move Kind} == aggregate1@{Move Kind}",
						"     && aggregate3@{Category Id} == aggregate1@{Category Id}",
						"     && derivedColumn3@{MH ToPosName Short 5Char} == aggregate1@{MH ToPosName Short 5Char}",
						"     && derivedColumn1@{MH T_Put DateTime} == aggregate1@{MH T_Put DateTime}",
						"     && aggregate3@{Put CHE Operator Id} == aggregate1@{Put CHE Operator Id}",
						"     && aggregate3@mve_gkey == aggregate1@mve_gkey",
						"     && aggregate3@{Put CHE Id} == aggregate1@{Put CHE Id}",
						"     && aggregate3@{Freight Kind Id} == aggregate1@{Freight Kind Id}",
						"     && {DH TimeStamp} == MaxDHTime,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join2",
						"join2 select(mapColumn(",
						"          {MH Event Type Id} = {Event Type Id},",
						"          {From Location},",
						"          {MH To Position Name} = {To Position Name},",
						"          ufv_gkey,",
						"          gkey,",
						"          unit_id,",
						"          {D H TimeStamp} = {DH TimeStamp},",
						"          {D H Decking Type} = Decking_Type,",
						"          {D H To Pos Name} = to_pos_name,",
						"          Year_Month = derivedColumn2@Year_Month,",
						"          Year_Week = derivedColumn2@Year_Week,",
						"          {MH TPut Less 4 hours},",
						"          {DH TimeStamp Within 4 Hours},",
						"          {MH ToPosName Short},",
						"          {MH ToPosName Short 5Char} = derivedColumn3@{MH ToPosName Short 5Char},",
						"          {DH ToPosName Shorrt},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr} = aggregate1@{Unit Nbr},",
						"          {MH Move Kind} = aggregate1@{Move Kind},",
						"          {Category Id} = aggregate1@{Category Id},",
						"          {MH ToPosName Short 5Char} = aggregate1@{MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime} = aggregate1@{MH T_Put DateTime},",
						"          {MH Put CHE Operator Id} = aggregate1@{Put CHE Operator Id},",
						"          mve_gkey = aggregate1@mve_gkey,",
						"          {MH Put CHE Id} = aggregate1@{Put CHE Id},",
						"          {Freight Kind Id} = aggregate1@{Freight Kind Id},",
						"          MaxDHTime",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select3",
						"select3 derive({Location Match or Not} = iif(substring({MH ToPosName Short 5Char},1, 5) == substring({DH ToPosName Short 5Char},1,5), 'Position Followed', 'Position Not Followed'),",
						"          Shift_Date = toDate({MH T_Put DateTime}),",
						"          {T Put Time} = MaxDHTime,",
						"          {T Put Hour} = hour(MaxDHTime),",
						"          {T Put Minute} = minute(MaxDHTime),",
						"          {T Put Second} = second(MaxDHTime)) ~> derivedColumn4",
						"derivedColumn6 select(mapColumn(",
						"          {MH Event Type Id},",
						"          {D H Decking Type},",
						"          gkey = select3@gkey,",
						"          Year_Month,",
						"          Year_Week,",
						"          {MH ToPosName Short 5Char},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr},",
						"          {MH Move Kind},",
						"          {Category Id},",
						"          {MH T_Put DateTime},",
						"          {MH Put CHE Operator Id},",
						"          mve_gkey,",
						"          {MH Put CHE Id},",
						"          {Freight Kind Id},",
						"          MaxDHTime,",
						"          Block_To_Block_Violation,",
						"          Same_Block_Violation,",
						"          Stack_Violation,",
						"          {Location Match or Not},",
						"          user_id,",
						"          {User Name} = name,",
						"          Shift_Date",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select4",
						"derivedColumn4, XpsEcUser join(lower({MH Put CHE Operator Id}) == lower(user_id),",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join6",
						"select4 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select5",
						"select5 alterRow(upsertIf(true())) ~> alterRow1",
						"select6 alterRow(upsertIf(true())) ~> AlterRow2",
						"select7 alterRow(upsertIf(true())) ~> alterRow3",
						"derivedColumn2 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select6",
						"derivedColumn1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select7",
						"filter5 aggregate(groupBy(gkey),",
						"     each(match(name!='gkey'), $$ = first($$))) ~> aggregate2",
						"select1 filter(not(isNull(mve_gkey))) ~> filter4",
						"filter4 aggregate(groupBy(mve_gkey),",
						"     each(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate3",
						"select2 filter(not(isNull(gkey))) ~> filter5",
						"join6 derive(Block_To_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 2) != substring({DH ToPosName Short 5Char}, 1, 2), true(), false()),",
						"          Same_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 4) != substring({DH ToPosName Short 5Char}, 1, 4), true(), false()),",
						"          Stack_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 5) != substring({DH ToPosName Short 5Char}, 1, 5), true(), false())) ~> derivedColumn6",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'hazira',",
						"     folderPath: 'gold/violation',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> violation",
						"AlterRow2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'hazira',",
						"     folderPath: 'gold/decking',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> decking",
						"alterRow3 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'hazira',",
						"     folderPath: 'gold/move',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> move"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/violations_malta')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "DeckingHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ShiftData"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ShiftInfo"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "XpsEcUser"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "violation"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "decking"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "move"
						}
					],
					"transformations": [
						{
							"name": "select1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "join1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter3"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join2"
						},
						{
							"name": "select3"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "join3"
						},
						{
							"name": "join4"
						},
						{
							"name": "derivedColumn5"
						},
						{
							"name": "select4"
						},
						{
							"name": "join6"
						},
						{
							"name": "select5"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "AlterRow2"
						},
						{
							"name": "alterRow3"
						},
						{
							"name": "select6"
						},
						{
							"name": "select7"
						},
						{
							"name": "aggregate2"
						},
						{
							"name": "filter4"
						},
						{
							"name": "aggregate3"
						},
						{
							"name": "filter5"
						},
						{
							"name": "derivedColumn6"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Unit Nbr} as string,",
						"          {Facility Id} as string,",
						"          {Complex Id} as string,",
						"          {Yard Id} as string,",
						"          {Carrier Visit Key} as long,",
						"          {Event Type Id} as string,",
						"          {Move Kind} as string,",
						"          {From Location} as string,",
						"          {To Location} as string,",
						"          {From Position Name} as string,",
						"          {To Position Name} as string,",
						"          {Carry CHE Operator Id} as string,",
						"          {Fetch CHE Operator Id} as string,",
						"          {Put CHE Operator Id} as string,",
						"          {Fetch CHE Id} as short,",
						"          {Fetch CHE Kind} as string,",
						"          {Carry CHE Id} as short,",
						"          {Carry CHE Kind} as string,",
						"          {Put CHE Id} as short,",
						"          {Put CHE Kind} as string,",
						"          {QC CHE Id} as short,",
						"          {QC CHE Kind} as string,",
						"          t_carry_complete as string,",
						"          t_put as string,",
						"          t_fetch as string,",
						"          t_dispatch as string,",
						"          t_discharge as string,",
						"          t_carry_dispatch as string,",
						"          t_carry_fetch_ready as string,",
						"          t_carry_put_ready as string,",
						"          dist_carry as short,",
						"          dist_start as short,",
						"          {Twin Fetch} as boolean,",
						"          {Twin Carry} as boolean,",
						"          {Twin Put} as boolean,",
						"          {Category Id} as string,",
						"          {Freight Kind Id} as string,",
						"          to_pos_gkey as long,",
						"          fm_pos_gkey as long,",
						"          {Restow Reason} as string,",
						"          {Container Line Id} as string,",
						"          {Container Line Role} as string,",
						"          pow as string,",
						"          mve_gkey as long,",
						"          ufv_gkey as long,",
						"          {Berth Id} as string,",
						"          {Goods And Ctr Wt Kg} as integer,",
						"          active_ufv as long,",
						"          {Requires Power Flag} as boolean,",
						"          {OOG Flag} as boolean,",
						"          {Shipper Id} as string,",
						"          {Consignee Id} as string,",
						"          {Commodity Id} as string,",
						"          ATA as string,",
						"          ATD as string,",
						"          Rehandles as short,",
						"          {_c56} as string,",
						"          {_c57} as string,",
						"          {_c58} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/moves/load','bronze/moves/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'malta',",
						"     folderPath: 'bronze/moves/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> MoveHistory",
						"source(output(",
						"          GKEY as long,",
						"          UYV_GKEY as long,",
						"          UNIT_ID as string,",
						"          TIME_STAMP as string,",
						"          DECKING_TYPE as string,",
						"          NODE_ID as string,",
						"          YARD as integer,",
						"          FROM_POS_LOCTYPE as string,",
						"          FROM_POS_LOCID as string,",
						"          FROM_POS_LOC_GKEY as long,",
						"          FROM_POS_SLOT as string,",
						"          FROM_POS_NAME as string,",
						"          FROM_POS_BIN as long,",
						"          FROM_POS_TIER as short,",
						"          TO_POS_LOCTYPE as string,",
						"          TO_POS_LOCID as string,",
						"          TO_POS_LOC_GKEY as integer,",
						"          TO_POS_SLOT as string,",
						"          TO_POS_NAME as string,",
						"          TO_POS_BIN as integer,",
						"          TO_POS_TIER as boolean,",
						"          TOTAL_SCORE as integer,",
						"          EXECUTION_TIME as short,",
						"          DETAILS as string,",
						"          PHASE as string,",
						"          {_c25} as string,",
						"          {_c26} as string,",
						"          {_c27} as string,",
						"          {_c28} as string,",
						"          {_c29} as string,",
						"          {_c30} as string,",
						"          {_c31} as string,",
						"          {_c32} as string,",
						"          {_c33} as string,",
						"          {_c34} as string,",
						"          {_c35} as string,",
						"          {_c36} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/deckinghistory/load','bronze/deckinghistory/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'malta',",
						"     folderPath: 'bronze/deckinghistory/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> DeckingHistory",
						"source(output(",
						"          {Shift Id} as string,",
						"          Hour as integer,",
						"          Minute as integer",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'malta',",
						"     folderPath: 'bronze/shiftdata',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> ShiftData",
						"source(output(",
						"          {Shift Name} as string,",
						"          {Shift Start Hour} as integer,",
						"          {Shift Start Minute} as integer,",
						"          {Shift Start} as string,",
						"          {Shift End Hour} as integer,",
						"          {Shift End Minute} as integer,",
						"          {Shift End} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delimited',",
						"     fileSystem: 'malta',",
						"     folderPath: 'bronze/shiftinfo',",
						"     fileName: 'shift-info.csv',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> ShiftInfo",
						"source(output(",
						"          {User ID} as short,",
						"          {User Name} as string,",
						"          Programs as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'malta',",
						"     folderPath: 'bronze/xpsecuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> XpsEcUser",
						"MoveHistory select(mapColumn(",
						"          mve_gkey,",
						"          {Unit Nbr},",
						"          {Event Type Id},",
						"          {Move Kind},",
						"          {From Location},",
						"          {To Position Name},",
						"          {Put CHE Operator Id},",
						"          {Put CHE Id},",
						"          {MH T_Put DateTime} = t_put,",
						"          {Freight Kind Id},",
						"          {Category Id},",
						"          ufv_gkey",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"aggregate3 derive(Year_Month = (year(coalesce(toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss'))\r",
						") * 100) + month(coalesce(toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss'))\r",
						"),",
						"          Year_Week = (year(coalesce(toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss'))\r",
						") * 100) + weekOfYear(coalesce(toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss'))\r",
						"),",
						"          {MH T_Put DateTime} = coalesce(toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss'))) ~> derivedColumn1",
						"DeckingHistory select(mapColumn(",
						"          gkey = GKEY,",
						"          unit_id = UNIT_ID,",
						"          {DH TimeStamp} = TIME_STAMP,",
						"          Decking_Type = DECKING_TYPE,",
						"          to_pos_name = TO_POS_NAME",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"aggregate2 filter(Decking_Type == 'Bump Intruder' || Decking_Type == 'Vessel Discharge' || Decking_Type == 'Vessel Discharge - Twin' || Decking_Type == 'XD Drop if Floating Refine' || Decking_Type == 'XD Refine Request' || Decking_Type == 'XD Rehandle Request') ~> filter1",
						"filter1 derive(Year_Month = (year(coalesce(toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss')) ) * 100) + month(coalesce(toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss')) ),",
						"          Year_Week = (year(coalesce(toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss')) ) * 100) + weekOfYear(coalesce(toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss')) ),",
						"          {DH TimeStamp} = coalesce(toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss'))) ~> derivedColumn2",
						"derivedColumn1, derivedColumn2 join({Unit Nbr} == unit_id,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 filter({From Location} != 'YARD' && unit_id != '' && not(isNull(unit_id)) && !startsWith(split({To Position Name}, \"-\")[3], 'CR') && {MH T_Put DateTime} > addDays({DH TimeStamp}, -15)) ~> filter2",
						"filter2 derive({MH TPut Less 4 hours} = add({MH T_Put DateTime} , -4*60*60*1000),",
						"          {DH TimeStamp Within 4 Hours} = iif(({DH TimeStamp} >= add({MH T_Put DateTime} , -4*60*60*1000)) && ({DH TimeStamp} <= {MH T_Put DateTime}), 1, 0),",
						"          {MH ToPosName Short} = split({To Position Name}, \"-\")[3],",
						"          {MH ToPosName Short 5Char} = iif(length(split({To Position Name}, \"-\")[3]) == 8, substring(split({To Position Name}, \"-\")[3], 0, 7), split({To Position Name}, \"-\")[3]),",
						"          {DH ToPosName Shorrt} = split(to_pos_name, \"-\")[3],",
						"          {DH ToPosName Short 5Char} = iif(length(split(to_pos_name, \"-\")[3]) == 8, substring(split(to_pos_name, \"-\")[3], 0, 7), split(to_pos_name, \"-\")[3])) ~> derivedColumn3",
						"derivedColumn3 filter({DH TimeStamp Within 4 Hours} == 1 && {DH ToPosName Short 5Char} != \"FLD\") ~> filter3",
						"filter3 aggregate(groupBy({Unit Nbr},",
						"          {Move Kind},",
						"          {Category Id},",
						"          {MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime},",
						"          {Put CHE Operator Id},",
						"          mve_gkey,",
						"          {Put CHE Id},",
						"          {Freight Kind Id}),",
						"     MaxDHTime = max({DH TimeStamp})) ~> aggregate1",
						"filter3, aggregate1 join(aggregate3@{Unit Nbr} == aggregate1@{Unit Nbr}",
						"     && aggregate3@{Move Kind} == aggregate1@{Move Kind}",
						"     && aggregate3@{Category Id} == aggregate1@{Category Id}",
						"     && derivedColumn3@{MH ToPosName Short 5Char} == aggregate1@{MH ToPosName Short 5Char}",
						"     && derivedColumn1@{MH T_Put DateTime} == aggregate1@{MH T_Put DateTime}",
						"     && aggregate3@{Put CHE Operator Id} == aggregate1@{Put CHE Operator Id}",
						"     && aggregate3@mve_gkey == aggregate1@mve_gkey",
						"     && aggregate3@{Put CHE Id} == aggregate1@{Put CHE Id}",
						"     && aggregate3@{Freight Kind Id} == aggregate1@{Freight Kind Id}",
						"     && {DH TimeStamp} == MaxDHTime,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join2",
						"join2 select(mapColumn(",
						"          {MH Event Type Id} = {Event Type Id},",
						"          {From Location},",
						"          {MH To Position Name} = {To Position Name},",
						"          ufv_gkey,",
						"          gkey,",
						"          unit_id,",
						"          {D H TimeStamp} = {DH TimeStamp},",
						"          {D H Decking Type} = Decking_Type,",
						"          {D H To Pos Name} = to_pos_name,",
						"          Year_Month = derivedColumn2@Year_Month,",
						"          Year_Week = derivedColumn2@Year_Week,",
						"          {MH TPut Less 4 hours},",
						"          {DH TimeStamp Within 4 Hours},",
						"          {MH ToPosName Short},",
						"          {MH ToPosName Short 5Char} = derivedColumn3@{MH ToPosName Short 5Char},",
						"          {DH ToPosName Shorrt},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr} = aggregate1@{Unit Nbr},",
						"          {MH Move Kind} = aggregate1@{Move Kind},",
						"          {Category Id} = aggregate1@{Category Id},",
						"          {MH ToPosName Short 5Char} = aggregate1@{MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime} = aggregate1@{MH T_Put DateTime},",
						"          {MH Put CHE Operator Id} = aggregate1@{Put CHE Operator Id},",
						"          mve_gkey = aggregate1@mve_gkey,",
						"          {MH Put CHE Id} = aggregate1@{Put CHE Id},",
						"          {Freight Kind Id} = aggregate1@{Freight Kind Id},",
						"          MaxDHTime",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select3",
						"select3 derive({Location Match or Not} = iif(substring({MH ToPosName Short 5Char},1, 9) == substring({DH ToPosName Short 5Char},1,9), 'Position Followed', 'Position Not Followed'),",
						"          Shift_Date = toDate({MH T_Put DateTime}),",
						"          {T Put Time} = MaxDHTime,",
						"          {T Put Hour} = hour(MaxDHTime),",
						"          {T Put Minute} = minute(MaxDHTime),",
						"          {T Put Second} = second(MaxDHTime)) ~> derivedColumn4",
						"derivedColumn4, ShiftData join({T Put Hour} == Hour",
						"     && {T Put Minute} == Minute,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join3",
						"join3, ShiftInfo join({Shift Id} == {Shift Name},",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join4",
						"join4 derive({Shift Date} = iif({MH T_Put DateTime} - toTimestamp(toString(Shift_Date) + {Shift End}) > 0, addDays(Shift_Date, -1), Shift_Date),",
						"          Week_of_Year = year(iif({MH T_Put DateTime} - toTimestamp(toString(Shift_Date) + {Shift End}) > 0, addDays(Shift_Date, -1), Shift_Date))*100 + weekOfYear(iif({MH T_Put DateTime} - toTimestamp(toString(Shift_Date) + {Shift End}) > 0, addDays(Shift_Date, -1), Shift_Date))) ~> derivedColumn5",
						"derivedColumn6 select(mapColumn(",
						"          {D H Decking Type},",
						"          {MH ToPosName Short 5Char},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr},",
						"          {MH Move Kind},",
						"          {Category Id},",
						"          {MH T_Put DateTime},",
						"          {MH Put CHE Operator Id},",
						"          mve_gkey,",
						"          {MH Put CHE Id},",
						"          {Freight Kind Id},",
						"          MaxDHTime,",
						"          {Location Match or Not},",
						"          {Shift Id},",
						"          {Shift Date},",
						"          Week_of_Year,",
						"          {XPS_ECUser.name} = {User Name},",
						"          Block_To_Block_Violation,",
						"          Same_Block_Violation,",
						"          Stack_Violation",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select4",
						"derivedColumn5, XpsEcUser join(toInteger({MH Put CHE Operator Id}) == {User ID},",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join6",
						"select4 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select5",
						"select5 alterRow(upsertIf(true())) ~> alterRow1",
						"select6 alterRow(upsertIf(true())) ~> AlterRow2",
						"select7 alterRow(upsertIf(true())) ~> alterRow3",
						"derivedColumn2 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select6",
						"derivedColumn1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select7",
						"filter5 aggregate(groupBy(gkey),",
						"     each(match(name!='gkey'), $$ = first($$))) ~> aggregate2",
						"select1 filter(not(isNull(mve_gkey))) ~> filter4",
						"filter4 aggregate(groupBy(mve_gkey),",
						"     each(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate3",
						"select2 filter(not(isNull(gkey))) ~> filter5",
						"join6 derive(Block_To_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 2) != substring({DH ToPosName Short 5Char}, 1, 2), true(), false()),",
						"          Same_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 6) != substring({DH ToPosName Short 5Char}, 1, 6), true(), false()),",
						"          Stack_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 9) != substring({DH ToPosName Short 5Char}, 1, 9), true(), false())) ~> derivedColumn6",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'malta',",
						"     folderPath: 'gold/violation',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> violation",
						"AlterRow2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'malta',",
						"     folderPath: 'gold/decking',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> decking",
						"alterRow3 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'malta',",
						"     folderPath: 'gold/move',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> move"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/violations_mict')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "DeckingHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ShiftData"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ShiftInfo"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "XpsEcUser"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "violation"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "decking"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "move"
						}
					],
					"transformations": [
						{
							"name": "select1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "join1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter3"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join2"
						},
						{
							"name": "select3"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "join3"
						},
						{
							"name": "join4"
						},
						{
							"name": "derivedColumn5"
						},
						{
							"name": "select4"
						},
						{
							"name": "join6"
						},
						{
							"name": "select5"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "AlterRow2"
						},
						{
							"name": "alterRow3"
						},
						{
							"name": "select6"
						},
						{
							"name": "select7"
						},
						{
							"name": "aggregate2"
						},
						{
							"name": "filter4"
						},
						{
							"name": "aggregate3"
						},
						{
							"name": "filter5"
						},
						{
							"name": "derivedColumn6"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Unit Nbr} as string,",
						"          {Facility Id} as string,",
						"          {Complex Id} as string,",
						"          {Yard Id} as string,",
						"          {Carrier Visit Key} as integer,",
						"          {Event Type Id} as string,",
						"          {Move Kind} as string,",
						"          {From Location} as string,",
						"          {To Location} as string,",
						"          {From Position Name} as string,",
						"          {To Position Name} as string,",
						"          {Carry CHE Operator Id} as string,",
						"          {Fetch CHE Operator Id} as string,",
						"          {Put CHE Operator Id} as string,",
						"          {Fetch CHE Id} as short,",
						"          {Fetch CHE Kind} as string,",
						"          {Carry CHE Id} as short,",
						"          {Carry CHE Kind} as string,",
						"          {Put CHE Id} as short,",
						"          {Put CHE Kind} as string,",
						"          {QC CHE Id} as short,",
						"          {QC CHE Kind} as string,",
						"          t_carry_complete as timestamp,",
						"          t_put as timestamp,",
						"          t_fetch as timestamp,",
						"          t_dispatch as timestamp,",
						"          t_discharge as timestamp,",
						"          t_carry_dispatch as timestamp,",
						"          t_carry_fetch_ready as timestamp,",
						"          t_carry_put_ready as timestamp,",
						"          dist_carry as short,",
						"          dist_start as short,",
						"          {Twin Fetch} as boolean,",
						"          {Twin Carry} as boolean,",
						"          {Twin Put} as boolean,",
						"          {Category Id} as string,",
						"          {Freight Kind Id} as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          {Restow Reason} as string,",
						"          {Container Line Id} as string,",
						"          {Container Line Role} as string,",
						"          pow as string,",
						"          mve_gkey as integer,",
						"          ufv_gkey as integer,",
						"          {Berth Id} as string,",
						"          {Goods And Ctr Wt Kg} as double,",
						"          active_ufv as integer,",
						"          {Requires Power Flag} as boolean,",
						"          {OOG Flag} as boolean,",
						"          {Shipper Id} as string,",
						"          {Consignee Id} as string,",
						"          {Commodity Id} as string,",
						"          ATA as timestamp,",
						"          ATD as timestamp,",
						"          Rehandles as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['bronze/movehistory/load','bronze/moves/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'mict',",
						"     folderPath: 'bronze/movehistory/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> MoveHistory",
						"source(output(",
						"          Gkey as integer,",
						"          uyv_gkey as integer,",
						"          unit_id as string,",
						"          time_stamp as timestamp,",
						"          decking_type as string,",
						"          node_id as string,",
						"          Yard as string,",
						"          from_pos_loctype as string,",
						"          from_pos_locid as string,",
						"          from_pos_loc_gkey as integer,",
						"          from_pos_slot as string,",
						"          from_pos_name as string,",
						"          from_pos_bin as integer,",
						"          from_pos_tier as short,",
						"          to_pos_loctype as string,",
						"          to_pos_locid as string,",
						"          to_pos_loc_gkey as integer,",
						"          to_pos_slot as string,",
						"          to_pos_name as string,",
						"          to_pos_bin as short,",
						"          to_pos_tier as string,",
						"          total_score as short,",
						"          execution_time as short,",
						"          Details as string,",
						"          Phase as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/deckinghistory/load','bronze/deckinghistory/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'mict',",
						"     folderPath: 'bronze/deckinghistory/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> DeckingHistory",
						"source(output(",
						"          {Shift Id} as string,",
						"          Hour as integer,",
						"          Minute as integer",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'mict-shift-data',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> ShiftData",
						"source(output(",
						"          {Shift Name} as string,",
						"          {Shift Start Hour} as integer,",
						"          {Shift Start Minute} as integer,",
						"          {Shift Start} as string,",
						"          {Shift End Hour} as integer,",
						"          {Shift End Minute} as integer,",
						"          {Shift End} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'mict-shift-info',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> ShiftInfo",
						"source(output(",
						"          gkey as short,",
						"          user_id as string,",
						"          name as string,",
						"          yard as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'mict-xps-ecuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> XpsEcUser",
						"MoveHistory select(mapColumn(",
						"          mve_gkey,",
						"          {Unit Nbr},",
						"          {Event Type Id},",
						"          {Move Kind},",
						"          {From Location},",
						"          {To Position Name},",
						"          {Put CHE Operator Id},",
						"          {Put CHE Id},",
						"          {MH T_Put DateTime} = t_put,",
						"          {Freight Kind Id},",
						"          {Category Id},",
						"          ufv_gkey",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"aggregate3 derive(Year_Month = (year({MH T_Put DateTime}) * 100) + month({MH T_Put DateTime}),",
						"          Year_Week = (year({MH T_Put DateTime}) * 100) + weekOfYear({MH T_Put DateTime})) ~> derivedColumn1",
						"DeckingHistory select(mapColumn(",
						"          gkey = Gkey,",
						"          unit_id,",
						"          {DH TimeStamp} = time_stamp,",
						"          Decking_Type = decking_type,",
						"          to_pos_name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"aggregate2 filter(Decking_Type == 'Bump Intruder' || Decking_Type == 'Vessel Discharge' || Decking_Type == 'Vessel Discharge - Twin' || Decking_Type == 'XD Drop if Floating Refine' || Decking_Type == 'XD Refine Request' || Decking_Type == 'XD Rehandle Request') ~> filter1",
						"filter1 derive(Year_Month = (year({DH TimeStamp}) * 100) + month({DH TimeStamp}),",
						"          Year_Week = (year({DH TimeStamp}) * 100) + weekOfYear({DH TimeStamp})) ~> derivedColumn2",
						"derivedColumn1, derivedColumn2 join({Unit Nbr} == unit_id,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 filter({From Location} != 'YARD' && unit_id != '' && not(isNull(unit_id)) && !startsWith(split({To Position Name}, \"-\")[3], 'CR') && {MH T_Put DateTime} > addDays({DH TimeStamp}, -15)) ~> filter2",
						"filter2 derive({MH TPut Less 4 hours} = add({MH T_Put DateTime} , -4*60*60*1000),",
						"          {DH TimeStamp Within 4 Hours} = iif(({DH TimeStamp} >= add({MH T_Put DateTime} , -4*60*60*1000)) && ({DH TimeStamp} <= {MH T_Put DateTime}), 1, 0),",
						"          {MH ToPosName Short} = split({To Position Name}, \"-\")[3],",
						"          {MH ToPosName Short 5Char} = iif(length(split({To Position Name}, \"-\")[3]) == 8, substring(split({To Position Name}, \"-\")[3], 0, 7), split({To Position Name}, \"-\")[3]),",
						"          {DH ToPosName Shorrt} = split(to_pos_name, \"-\")[3],",
						"          {DH ToPosName Short 5Char} = iif(length(split(to_pos_name, \"-\")[3]) == 8, substring(split(to_pos_name, \"-\")[3], 0, 7), split(to_pos_name, \"-\")[3])) ~> derivedColumn3",
						"derivedColumn3 filter({DH TimeStamp Within 4 Hours} == 1 && {DH ToPosName Short 5Char} != \"FLD\") ~> filter3",
						"filter3 aggregate(groupBy({Unit Nbr},",
						"          {Move Kind},",
						"          {Category Id},",
						"          {MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime},",
						"          {Put CHE Operator Id},",
						"          mve_gkey,",
						"          {Put CHE Id},",
						"          {Freight Kind Id}),",
						"     MaxDHTime = max({DH TimeStamp})) ~> aggregate1",
						"filter3, aggregate1 join(aggregate3@{Unit Nbr} == aggregate1@{Unit Nbr}",
						"     && aggregate3@{Move Kind} == aggregate1@{Move Kind}",
						"     && aggregate3@{Category Id} == aggregate1@{Category Id}",
						"     && derivedColumn3@{MH ToPosName Short 5Char} == aggregate1@{MH ToPosName Short 5Char}",
						"     && aggregate3@{MH T_Put DateTime} == aggregate1@{MH T_Put DateTime}",
						"     && aggregate3@{Put CHE Operator Id} == aggregate1@{Put CHE Operator Id}",
						"     && aggregate3@mve_gkey == aggregate1@mve_gkey",
						"     && aggregate3@{Put CHE Id} == aggregate1@{Put CHE Id}",
						"     && aggregate3@{Freight Kind Id} == aggregate1@{Freight Kind Id}",
						"     && {DH TimeStamp} == MaxDHTime,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join2",
						"join2 select(mapColumn(",
						"          {MH Event Type Id} = {Event Type Id},",
						"          {From Location},",
						"          {MH To Position Name} = {To Position Name},",
						"          ufv_gkey,",
						"          gkey,",
						"          unit_id,",
						"          {D H TimeStamp} = {DH TimeStamp},",
						"          {D H Decking Type} = Decking_Type,",
						"          {D H To Pos Name} = to_pos_name,",
						"          Year_Month = derivedColumn2@Year_Month,",
						"          Year_Week = derivedColumn2@Year_Week,",
						"          {MH TPut Less 4 hours},",
						"          {DH TimeStamp Within 4 Hours},",
						"          {MH ToPosName Short},",
						"          {MH ToPosName Short 5Char} = derivedColumn3@{MH ToPosName Short 5Char},",
						"          {DH ToPosName Shorrt},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr} = aggregate1@{Unit Nbr},",
						"          {MH Move Kind} = aggregate1@{Move Kind},",
						"          {Category Id} = aggregate1@{Category Id},",
						"          {MH ToPosName Short 5Char} = aggregate1@{MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime} = aggregate1@{MH T_Put DateTime},",
						"          {MH Put CHE Operator Id} = aggregate1@{Put CHE Operator Id},",
						"          mve_gkey = aggregate1@mve_gkey,",
						"          {MH Put CHE Id} = aggregate1@{Put CHE Id},",
						"          {Freight Kind Id} = aggregate1@{Freight Kind Id},",
						"          MaxDHTime",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select3",
						"select3 derive({Location Match or Not} = iif({MH ToPosName Short 5Char} == {DH ToPosName Short 5Char}, 'Position Followed', 'Position Not Followed'),",
						"          Shift_Date = toDate({MH T_Put DateTime}),",
						"          {T Put Time} = MaxDHTime,",
						"          {T Put Hour} = hour(MaxDHTime),",
						"          {T Put Minute} = minute(MaxDHTime),",
						"          {T Put Second} = second(MaxDHTime)) ~> derivedColumn4",
						"derivedColumn4, ShiftData join({T Put Hour} == Hour",
						"     && {T Put Minute} == Minute,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join3",
						"join3, ShiftInfo join({Shift Id} == {Shift Name},",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join4",
						"join4 derive({Shift Date} = iif({MH T_Put DateTime} - toTimestamp(toString(Shift_Date) + {Shift End}) > 0, addDays(Shift_Date, -1), Shift_Date),",
						"          Week_of_Year = year(iif({MH T_Put DateTime} - toTimestamp(toString(Shift_Date) + {Shift End}) > 0, addDays(Shift_Date, -1), Shift_Date))*100 + weekOfYear(iif({MH T_Put DateTime} - toTimestamp(toString(Shift_Date) + {Shift End}) > 0, addDays(Shift_Date, -1), Shift_Date))) ~> derivedColumn5",
						"derivedColumn6 select(mapColumn(",
						"          {D H Decking Type},",
						"          {MH ToPosName Short 5Char},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr},",
						"          {MH Move Kind},",
						"          {Category Id},",
						"          {MH T_Put DateTime},",
						"          {MH Put CHE Operator Id},",
						"          mve_gkey,",
						"          {MH Put CHE Id},",
						"          {Freight Kind Id},",
						"          MaxDHTime,",
						"          {Location Match or Not},",
						"          {Shift Id},",
						"          {Shift Date},",
						"          Week_of_Year,",
						"          {XPS_ECUser.name} = name,",
						"          Block_To_Block_Violation,",
						"          Same_Block_Violation,",
						"          Stack_Violation",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select4",
						"derivedColumn5, XpsEcUser join({MH Put CHE Operator Id} == user_id,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join6",
						"select4 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select5",
						"select5 alterRow(upsertIf(true())) ~> alterRow1",
						"select6 alterRow(upsertIf(true())) ~> AlterRow2",
						"select7 alterRow(upsertIf(true())) ~> alterRow3",
						"derivedColumn2 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select6",
						"derivedColumn1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select7",
						"filter5 aggregate(groupBy(gkey),",
						"     each(match(name!='gkey'), $$ = first($$))) ~> aggregate2",
						"select1 filter(not(isNull(mve_gkey))) ~> filter4",
						"filter4 aggregate(groupBy(mve_gkey),",
						"     each(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate3",
						"select2 filter(not(isNull(gkey))) ~> filter5",
						"join6 derive(Block_To_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 2) != substring({DH ToPosName Short 5Char}, 1, 2), true(), false()),",
						"          Same_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 4) != substring({DH ToPosName Short 5Char}, 1, 4), true(), false()),",
						"          Stack_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 7) != substring({DH ToPosName Short 5Char}, 1, 7), true(), false())) ~> derivedColumn6",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mict',",
						"     folderPath: 'gold/violation',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> violation",
						"AlterRow2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mict',",
						"     folderPath: 'gold/decking',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> decking",
						"alterRow3 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mict',",
						"     folderPath: 'gold/move',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> move"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/violations_mnhpi')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "DeckingHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ShiftData"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ShiftInfo"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "XpsEcUser"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "violation"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "decking"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "move"
						}
					],
					"transformations": [
						{
							"name": "select1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "join1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter3"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join2"
						},
						{
							"name": "select3"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "join3"
						},
						{
							"name": "join4"
						},
						{
							"name": "derivedColumn5"
						},
						{
							"name": "select4"
						},
						{
							"name": "join6"
						},
						{
							"name": "select5"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "AlterRow2"
						},
						{
							"name": "alterRow3"
						},
						{
							"name": "select6"
						},
						{
							"name": "select7"
						},
						{
							"name": "aggregate2"
						},
						{
							"name": "filter4"
						},
						{
							"name": "aggregate3"
						},
						{
							"name": "filter5"
						},
						{
							"name": "derivedColumn6"
						},
						{
							"name": "derivedColumn7"
						},
						{
							"name": "derivedColumn8"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Unit Nbr} as string,",
						"          {Facility Id} as string,",
						"          {Complex Id} as string,",
						"          {Yard Id} as string,",
						"          {Carrier Visit Key} as integer,",
						"          {Event Type Id} as string,",
						"          {Move Kind} as string,",
						"          {From Location} as string,",
						"          {To Location} as string,",
						"          {From Position Name} as string,",
						"          {To Position Name} as string,",
						"          {Carry CHE Operator Id} as string,",
						"          {Fetch CHE Operator Id} as string,",
						"          {Put CHE Operator Id} as string,",
						"          {Fetch CHE Id} as short,",
						"          {Fetch CHE Kind} as string,",
						"          {Carry CHE Id} as short,",
						"          {Carry CHE Kind} as string,",
						"          {Put CHE Id} as short,",
						"          {Put CHE Kind} as string,",
						"          {QC CHE Id} as short,",
						"          {QC CHE Kind} as string,",
						"          t_carry_complete as string,",
						"          t_put as string,",
						"          t_fetch as string,",
						"          t_dispatch as string,",
						"          t_discharge as string,",
						"          t_carry_dispatch as string,",
						"          t_carry_fetch_ready as string,",
						"          t_carry_put_ready as string,",
						"          dist_carry as short,",
						"          dist_start as short,",
						"          {Twin Fetch} as boolean,",
						"          {Twin Carry} as boolean,",
						"          {Twin Put} as boolean,",
						"          {Category Id} as string,",
						"          {Freight Kind Id} as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          {Restow Reason} as string,",
						"          {Container Line Id} as string,",
						"          {Container Line Role} as string,",
						"          pow as string,",
						"          mve_gkey as integer,",
						"          ufv_gkey as integer,",
						"          {Berth Id} as string,",
						"          {Goods And Ctr Wt Kg} as double,",
						"          active_ufv as integer,",
						"          {Requires Power Flag} as boolean,",
						"          {OOG Flag} as boolean,",
						"          {Shipper Id} as string,",
						"          {Consignee Id} as string,",
						"          {Commodity Id} as string,",
						"          ATA as string,",
						"          ATD as string,",
						"          Rehandles as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['bronze/movehistory/load','bronze/moves/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'bronze/movehistory/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true,",
						"     timestampFormats: ['MM/dd/yyyy hh:mm:ss a','MM/dd/yyyy HH:mm:ss','MM-dd-yyyy hh:mm:ss a','MM-dd-yyyy HH:mm:ss','yyyy.MM.dd hh:mm:ss a','yyyy.MM.dd HH:mm:ss','yyyy-MM-dd\\'T\\'HH:mm:ss','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'','yyyy-MM-dd\\'T\\'HH:mm:ss.SSS\\'Z\\'']) ~> MoveHistory",
						"source(output(",
						"          gkey as integer,",
						"          uyv_gkey as integer,",
						"          unit_id as string,",
						"          time_stamp as string,",
						"          decking_type as string,",
						"          node_id as string,",
						"          yard as boolean,",
						"          from_pos_loctype as string,",
						"          from_pos_locid as string,",
						"          from_pos_loc_gkey as integer,",
						"          from_pos_slot as string,",
						"          from_pos_name as string,",
						"          from_pos_bin as integer,",
						"          from_pos_tier as short,",
						"          to_pos_loctype as string,",
						"          to_pos_locid as string,",
						"          to_pos_loc_gkey as boolean,",
						"          to_pos_slot as string,",
						"          to_pos_name as string,",
						"          to_pos_bin as integer,",
						"          to_pos_tier as boolean,",
						"          total_score as integer,",
						"          execution_time as short,",
						"          details as string,",
						"          phase as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/deckinghistory/load','bronze/deckinghistory/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'bronze/deckinghistory/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> DeckingHistory",
						"source(output(",
						"          {Shift Id} as string,",
						"          Hour as integer,",
						"          Minute as integer",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'mnhpi-shiftinfo',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> ShiftData",
						"source(output(",
						"          {Shift Name} as string,",
						"          {Shift Start Hour} as integer,",
						"          {Shift Start Minute} as integer,",
						"          {Shift Start} as string,",
						"          {Shift End Hour} as integer,",
						"          {Shift End Minute} as integer,",
						"          {Shift End} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'mnhpi-shiftdata',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> ShiftInfo",
						"source(output(",
						"          gkey as short,",
						"          user_id as string,",
						"          name as string,",
						"          yard as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'mnhpi-xpsuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> XpsEcUser",
						"MoveHistory select(mapColumn(",
						"          mve_gkey,",
						"          {Unit Nbr},",
						"          {Event Type Id},",
						"          {Move Kind},",
						"          {From Location},",
						"          {To Position Name},",
						"          {Put CHE Operator Id},",
						"          {Put CHE Id},",
						"          {MH T_Put DateTime} = t_put,",
						"          {Freight Kind Id},",
						"          {Category Id},",
						"          ufv_gkey",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"derivedColumn8 derive(Year_Month = (year({MH T_Put DateTime}) * 100) + month({MH T_Put DateTime}),",
						"          Year_Week = (year({MH T_Put DateTime}) * 100) + weekOfYear({MH T_Put DateTime})) ~> derivedColumn1",
						"DeckingHistory select(mapColumn(",
						"          gkey,",
						"          unit_id,",
						"          {DH TimeStamp} = time_stamp,",
						"          Decking_Type = decking_type,",
						"          to_pos_name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"aggregate2 filter(Decking_Type == 'Bump Intruder' || Decking_Type == 'Vessel Discharge' || Decking_Type == 'Vessel Discharge - Twin' || Decking_Type == 'XD Drop if Floating Refine' || Decking_Type == 'XD Refine Request' || Decking_Type == 'XD Rehandle Request') ~> filter1",
						"derivedColumn7 derive(Year_Month = (year({DH TimeStamp}) * 100) + month({DH TimeStamp}),",
						"          Year_Week = (year({DH TimeStamp}) * 100) + weekOfYear({DH TimeStamp})) ~> derivedColumn2",
						"derivedColumn1, derivedColumn2 join({Unit Nbr} == unit_id,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 filter({From Location} != 'YARD' && unit_id != '' && not(isNull(unit_id)) && !startsWith(split({To Position Name}, \"-\")[3], 'CR') && {MH T_Put DateTime} > addDays({DH TimeStamp}, -15)) ~> filter2",
						"filter2 derive({MH TPut Less 4 hours} = add({MH T_Put DateTime} , -4*60*60*1000),",
						"          {DH TimeStamp Within 4 Hours} = iif(({DH TimeStamp} >= add({MH T_Put DateTime} , -4*60*60*1000)) && ({DH TimeStamp} <= {MH T_Put DateTime}), 1, 0),",
						"          {MH ToPosName Short} = split({To Position Name}, \"-\")[3],",
						"          {MH ToPosName Short 5Char} = iif(length(split({To Position Name}, \"-\")[3]) == 6, substring(split({To Position Name}, \"-\")[3], 0, 5), split({To Position Name}, \"-\")[3]),",
						"          {DH ToPosName Shorrt} = split(to_pos_name, \"-\")[3],",
						"          {DH ToPosName Short 5Char} = iif(length(split(to_pos_name, \"-\")[3]) == 6, substring(split(to_pos_name, \"-\")[3], 0, 5), split(to_pos_name, \"-\")[3])) ~> derivedColumn3",
						"derivedColumn3 filter({DH TimeStamp Within 4 Hours} == 1 && {DH ToPosName Short 5Char} != \"FLD\") ~> filter3",
						"filter3 aggregate(groupBy({Unit Nbr},",
						"          {Move Kind},",
						"          {Category Id},",
						"          {MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime},",
						"          {Put CHE Operator Id},",
						"          mve_gkey,",
						"          {Put CHE Id},",
						"          {Freight Kind Id}),",
						"     MaxDHTime = max({DH TimeStamp})) ~> aggregate1",
						"filter3, aggregate1 join(aggregate3@{Unit Nbr} == aggregate1@{Unit Nbr}",
						"     && aggregate3@{Move Kind} == aggregate1@{Move Kind}",
						"     && aggregate3@{Category Id} == aggregate1@{Category Id}",
						"     && derivedColumn3@{MH ToPosName Short 5Char} == aggregate1@{MH ToPosName Short 5Char}",
						"     && derivedColumn8@{MH T_Put DateTime} == aggregate1@{MH T_Put DateTime}",
						"     && aggregate3@{Put CHE Operator Id} == aggregate1@{Put CHE Operator Id}",
						"     && aggregate3@mve_gkey == aggregate1@mve_gkey",
						"     && aggregate3@{Put CHE Id} == aggregate1@{Put CHE Id}",
						"     && aggregate3@{Freight Kind Id} == aggregate1@{Freight Kind Id}",
						"     && {DH TimeStamp} == MaxDHTime,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join2",
						"join2 select(mapColumn(",
						"          {MH Event Type Id} = {Event Type Id},",
						"          {From Location},",
						"          {MH To Position Name} = {To Position Name},",
						"          ufv_gkey,",
						"          gkey,",
						"          unit_id,",
						"          {D H TimeStamp} = {DH TimeStamp},",
						"          {D H Decking Type} = Decking_Type,",
						"          {D H To Pos Name} = to_pos_name,",
						"          Year_Month = derivedColumn2@Year_Month,",
						"          Year_Week = derivedColumn2@Year_Week,",
						"          {MH TPut Less 4 hours},",
						"          {DH TimeStamp Within 4 Hours},",
						"          {MH ToPosName Short},",
						"          {MH ToPosName Short 5Char} = derivedColumn3@{MH ToPosName Short 5Char},",
						"          {DH ToPosName Shorrt},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr} = aggregate1@{Unit Nbr},",
						"          {MH Move Kind} = aggregate1@{Move Kind},",
						"          {Category Id} = aggregate1@{Category Id},",
						"          {MH ToPosName Short 5Char} = aggregate1@{MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime} = aggregate1@{MH T_Put DateTime},",
						"          {MH Put CHE Operator Id} = aggregate1@{Put CHE Operator Id},",
						"          mve_gkey = aggregate1@mve_gkey,",
						"          {MH Put CHE Id} = aggregate1@{Put CHE Id},",
						"          {Freight Kind Id} = aggregate1@{Freight Kind Id},",
						"          MaxDHTime",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select3",
						"select3 derive({Location Match or Not} = iif({MH ToPosName Short 5Char} == {DH ToPosName Short 5Char}, 'Position Followed', 'Position Not Followed'),",
						"          Shift_Date = toDate({MH T_Put DateTime}),",
						"          {T Put Time} = MaxDHTime,",
						"          {T Put Hour} = hour(MaxDHTime),",
						"          {T Put Minute} = minute(MaxDHTime),",
						"          {T Put Second} = second(MaxDHTime)) ~> derivedColumn4",
						"derivedColumn4, ShiftData join({T Put Hour} == Hour",
						"     && {T Put Minute} == Minute,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join3",
						"join3, ShiftInfo join({Shift Id} == {Shift Name},",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join4",
						"join4 derive({Shift Date} = iif({MH T_Put DateTime} - toTimestamp(toString(Shift_Date) + {Shift End}) > 0, addDays(Shift_Date, -1), Shift_Date),",
						"          Week_of_Year = year(iif({MH T_Put DateTime} - toTimestamp(toString(Shift_Date) + {Shift End}) > 0, addDays(Shift_Date, -1), Shift_Date))*100 + weekOfYear(iif({MH T_Put DateTime} - toTimestamp(toString(Shift_Date) + {Shift End}) > 0, addDays(Shift_Date, -1), Shift_Date))) ~> derivedColumn5",
						"derivedColumn6 select(mapColumn(",
						"          {D H Decking Type},",
						"          {MH ToPosName Short 5Char},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr},",
						"          {MH Move Kind},",
						"          {Category Id},",
						"          {MH T_Put DateTime},",
						"          {MH Put CHE Operator Id},",
						"          mve_gkey,",
						"          {MH Put CHE Id},",
						"          {Freight Kind Id},",
						"          MaxDHTime,",
						"          {Location Match or Not},",
						"          {Shift Id},",
						"          {Shift Date},",
						"          Week_of_Year,",
						"          {XPS_ECUser.name} = name,",
						"          Block_To_Block_Violation,",
						"          Same_Block_Violation,",
						"          Stack_Violation",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select4",
						"derivedColumn5, XpsEcUser join({MH Put CHE Operator Id} == user_id,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join6",
						"select4 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select5",
						"select5 alterRow(upsertIf(true()),",
						"     updateIf(true())) ~> alterRow1",
						"select6 alterRow(upsertIf(true()),",
						"     updateIf(true())) ~> AlterRow2",
						"select7 alterRow(upsertIf(true()),",
						"     updateIf(true())) ~> alterRow3",
						"derivedColumn2 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select6",
						"derivedColumn1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select7",
						"filter5 aggregate(groupBy(gkey),",
						"     each(match(name!='gkey'), $$ = first($$))) ~> aggregate2",
						"select1 filter(not(isNull(mve_gkey))) ~> filter4",
						"filter4 aggregate(groupBy(mve_gkey),",
						"     each(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate3",
						"select2 filter(not(isNull(gkey))) ~> filter5",
						"join6 derive(Block_To_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 3) != substring({DH ToPosName Short 5Char}, 1, 3), true(), false()),",
						"          Same_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 5) != substring({DH ToPosName Short 5Char}, 1, 5), true(), false()),",
						"          Stack_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 6) != substring({DH ToPosName Short 5Char}, 1, 6), true(), false())) ~> derivedColumn6",
						"filter1 derive({DH TimeStamp} = coalesce(toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'MM-dd-yyyy HH:mm'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss'))) ~> derivedColumn7",
						"aggregate3 derive({MH T_Put DateTime} = coalesce(toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss'))) ~> derivedColumn8",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'gold/violation',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     saveOrder: 1) ~> violation",
						"AlterRow2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'gold/decking',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> decking",
						"alterRow3 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mnhpi',",
						"     folderPath: 'gold/move',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> move"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/violations_mundra_ct04')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "DeckingHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "XpsEcUser"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "violation"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "decking"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "move"
						}
					],
					"transformations": [
						{
							"name": "select1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "join1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter3"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join2"
						},
						{
							"name": "select3"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "select4"
						},
						{
							"name": "join6"
						},
						{
							"name": "select5"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "AlterRow2"
						},
						{
							"name": "alterRow3"
						},
						{
							"name": "select6"
						},
						{
							"name": "select7"
						},
						{
							"name": "aggregate2"
						},
						{
							"name": "filter4"
						},
						{
							"name": "aggregate3"
						},
						{
							"name": "filter5"
						},
						{
							"name": "derivedColumn6"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Unit Nbr} as string,",
						"          {Facility Id} as string,",
						"          {Complex Id} as string,",
						"          {Yard Id} as string,",
						"          {Carrier Visit Key} as string,",
						"          {Event Type Id} as string,",
						"          {Move Kind} as string,",
						"          {From Location} as string,",
						"          {To Location} as string,",
						"          {From Position Name} as string,",
						"          {To Position Name} as string,",
						"          {Carry CHE Operator Id} as string,",
						"          {Fetch CHE Operator Id} as string,",
						"          {Put CHE Operator Id} as string,",
						"          {Fetch CHE Id} as string,",
						"          {Fetch CHE Kind} as string,",
						"          {Carry CHE Id} as string,",
						"          {Carry CHE Kind} as string,",
						"          {Put CHE Id} as string,",
						"          {Put CHE Kind} as string,",
						"          {QC CHE Id} as string,",
						"          {QC CHE Kind} as string,",
						"          t_carry_complete as string,",
						"          t_put as string,",
						"          t_fetch as string,",
						"          t_dispatch as string,",
						"          t_discharge as string,",
						"          t_carry_dispatch as string,",
						"          t_carry_fetch_ready as string,",
						"          t_carry_put_ready as string,",
						"          dist_carry as string,",
						"          dist_start as string,",
						"          {Twin Fetch} as boolean,",
						"          {Twin Carry} as boolean,",
						"          {Twin Put} as boolean,",
						"          {Category Id} as string,",
						"          {Freight Kind Id} as string,",
						"          to_pos_gkey as integer,",
						"          fm_pos_gkey as integer,",
						"          {Restow Reason} as string,",
						"          {Container Line Id} as string,",
						"          {Container Line Role} as string,",
						"          pow as string,",
						"          mve_gkey as integer,",
						"          ufv_gkey as integer,",
						"          {Berth Id} as string,",
						"          {Goods And Ctr Wt Kg} as double,",
						"          active_ufv as integer,",
						"          {Requires Power Flag} as boolean,",
						"          {OOG Flag} as boolean,",
						"          {Shipper Id} as string,",
						"          {Consignee Id} as string,",
						"          {Commodity Id} as string,",
						"          ATA as string,",
						"          ATD as string,",
						"          Rehandles as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/movehistory/load','bronze/moves/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'mundra-ct04',",
						"     folderPath: 'bronze/movehistory/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> MoveHistory",
						"source(output(",
						"          gkey as integer,",
						"          uyv_gkey as integer,",
						"          unit_id as string,",
						"          time_stamp as string,",
						"          decking_type as string,",
						"          node_id as string,",
						"          yard as string,",
						"          from_pos_loctype as string,",
						"          from_pos_locid as string,",
						"          from_pos_loc_gkey as integer,",
						"          from_pos_slot as string,",
						"          from_pos_name as string,",
						"          from_pos_bin as string,",
						"          from_pos_tier as short,",
						"          to_pos_loctype as string,",
						"          to_pos_locid as string,",
						"          to_pos_loc_gkey as boolean,",
						"          to_pos_slot as string,",
						"          to_pos_name as string,",
						"          to_pos_bin as string,",
						"          to_pos_tier as boolean,",
						"          total_score as integer,",
						"          execution_time as short,",
						"          details as string,",
						"          phase as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/deckinghistory/load','bronze/deckinghistory/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'mundra-ct04',",
						"     folderPath: 'bronze/deckinghistory/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> DeckingHistory",
						"source(output(",
						"          gkey as short,",
						"          user_id as string,",
						"          name as string,",
						"          yard as short",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'mundra-ct04',",
						"     folderPath: 'bronze/xpsecuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> XpsEcUser",
						"MoveHistory select(mapColumn(",
						"          mve_gkey,",
						"          {Unit Nbr},",
						"          {Event Type Id},",
						"          {Move Kind},",
						"          {From Location},",
						"          {To Position Name},",
						"          {Put CHE Operator Id},",
						"          {Put CHE Id},",
						"          {MH T_Put DateTime} = t_put,",
						"          {Freight Kind Id},",
						"          {Category Id},",
						"          ufv_gkey",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"aggregate3 derive(Year_Month = (year(:datetime) * 100) + month(:datetime),",
						"          Year_Week = (year(:datetime) * 100) + weekOfYear(:datetime),",
						"          {MH T_Put DateTime} = :datetime,",
						"          datetime := coalesce(toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss'))) ~> derivedColumn1",
						"DeckingHistory select(mapColumn(",
						"          gkey,",
						"          unit_id,",
						"          {DH TimeStamp} = time_stamp,",
						"          Decking_Type = decking_type,",
						"          to_pos_name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"aggregate2 filter(Decking_Type == 'Bump Intruder' || Decking_Type == 'Vessel Discharge' || Decking_Type == 'Vessel Discharge - Twin' || Decking_Type == 'XD Drop if Floating Refine' || Decking_Type == 'XD Refine Request' || Decking_Type == 'XD Rehandle Request') ~> filter1",
						"filter1 derive(Year_Month = (year(:datetime_dh) * 100) + month(:datetime_dh),",
						"          Year_Week = (year(:datetime_dh) * 100) + weekOfYear(:datetime_dh),",
						"          {DH TimeStamp} = :datetime_dh,",
						"          datetime_dh := coalesce(toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm'), toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss'))) ~> derivedColumn2",
						"derivedColumn1, derivedColumn2 join({Unit Nbr} == unit_id,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 filter({From Location} != 'YARD' && unit_id != '' && not(isNull(unit_id)) && !startsWith(split({To Position Name}, \"-\")[3], 'CR') && {MH T_Put DateTime} > addDays({DH TimeStamp}, -15)) ~> filter2",
						"filter2 derive({MH TPut Less 4 hours} = add({MH T_Put DateTime} , -4*60*60*1000),",
						"          {DH TimeStamp Within 4 Hours} = iif(({DH TimeStamp} >= add({MH T_Put DateTime} , -4*60*60*1000)) && ({DH TimeStamp} <= {MH T_Put DateTime}), 1, 0),",
						"          {MH ToPosName Short} = split({To Position Name}, \"-\")[3],",
						"          {MH ToPosName Short 5Char} = iif(length(split({To Position Name}, \"-\")[3]) == 8, substring(split({To Position Name}, \"-\")[3], 0, 7), split({To Position Name}, \"-\")[3]),",
						"          {DH ToPosName Shorrt} = split(to_pos_name, \"-\")[3],",
						"          {DH ToPosName Short 5Char} = iif(length(split(to_pos_name, \"-\")[3]) == 8, substring(split(to_pos_name, \"-\")[3], 0, 7), split(to_pos_name, \"-\")[3])) ~> derivedColumn3",
						"derivedColumn3 filter({DH TimeStamp Within 4 Hours} == 1 && {DH ToPosName Short 5Char} != \"FLD\") ~> filter3",
						"filter3 aggregate(groupBy({Unit Nbr},",
						"          {Move Kind},",
						"          {Category Id},",
						"          {MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime},",
						"          {Put CHE Operator Id},",
						"          mve_gkey,",
						"          {Put CHE Id},",
						"          {Freight Kind Id}),",
						"     MaxDHTime = max({DH TimeStamp})) ~> aggregate1",
						"filter3, aggregate1 join(aggregate3@{Unit Nbr} == aggregate1@{Unit Nbr}",
						"     && aggregate3@{Move Kind} == aggregate1@{Move Kind}",
						"     && aggregate3@{Category Id} == aggregate1@{Category Id}",
						"     && derivedColumn3@{MH ToPosName Short 5Char} == aggregate1@{MH ToPosName Short 5Char}",
						"     && derivedColumn1@{MH T_Put DateTime} == aggregate1@{MH T_Put DateTime}",
						"     && aggregate3@{Put CHE Operator Id} == aggregate1@{Put CHE Operator Id}",
						"     && aggregate3@mve_gkey == aggregate1@mve_gkey",
						"     && aggregate3@{Put CHE Id} == aggregate1@{Put CHE Id}",
						"     && aggregate3@{Freight Kind Id} == aggregate1@{Freight Kind Id}",
						"     && {DH TimeStamp} == MaxDHTime,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join2",
						"join2 select(mapColumn(",
						"          {MH Event Type Id} = {Event Type Id},",
						"          {From Location},",
						"          {MH To Position Name} = {To Position Name},",
						"          ufv_gkey,",
						"          gkey,",
						"          unit_id,",
						"          {D H TimeStamp} = {DH TimeStamp},",
						"          {D H Decking Type} = Decking_Type,",
						"          {D H To Pos Name} = to_pos_name,",
						"          Year_Month = derivedColumn2@Year_Month,",
						"          Year_Week = derivedColumn2@Year_Week,",
						"          {MH TPut Less 4 hours},",
						"          {DH TimeStamp Within 4 Hours},",
						"          {MH ToPosName Short},",
						"          {MH ToPosName Short 5Char} = derivedColumn3@{MH ToPosName Short 5Char},",
						"          {DH ToPosName Shorrt},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr} = aggregate1@{Unit Nbr},",
						"          {MH Move Kind} = aggregate1@{Move Kind},",
						"          {Category Id} = aggregate1@{Category Id},",
						"          {MH ToPosName Short 5Char} = aggregate1@{MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime} = aggregate1@{MH T_Put DateTime},",
						"          {MH Put CHE Operator Id} = aggregate1@{Put CHE Operator Id},",
						"          mve_gkey = aggregate1@mve_gkey,",
						"          {MH Put CHE Id} = aggregate1@{Put CHE Id},",
						"          {Freight Kind Id} = aggregate1@{Freight Kind Id},",
						"          MaxDHTime",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select3",
						"select3 derive({Location Match or Not} = iif(substring({MH ToPosName Short 5Char},1, 5) == substring({DH ToPosName Short 5Char},1,5), 'Position Followed', 'Position Not Followed'),",
						"          Shift_Date = toDate({MH T_Put DateTime}),",
						"          {T Put Time} = MaxDHTime,",
						"          {T Put Hour} = hour(MaxDHTime),",
						"          {T Put Minute} = minute(MaxDHTime),",
						"          {T Put Second} = second(MaxDHTime)) ~> derivedColumn4",
						"derivedColumn6 select(mapColumn(",
						"          {MH Event Type Id},",
						"          {D H Decking Type},",
						"          gkey = select3@gkey,",
						"          Year_Month,",
						"          Year_Week,",
						"          {MH ToPosName Short 5Char},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr},",
						"          {MH Move Kind},",
						"          {Category Id},",
						"          {MH T_Put DateTime},",
						"          {MH Put CHE Operator Id},",
						"          mve_gkey,",
						"          {MH Put CHE Id},",
						"          {Freight Kind Id},",
						"          MaxDHTime,",
						"          Block_To_Block_Violation,",
						"          Same_Block_Violation,",
						"          Stack_Violation,",
						"          {Location Match or Not},",
						"          user_id,",
						"          {User Name} = name,",
						"          Shift_Date",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select4",
						"derivedColumn4, XpsEcUser join(lower({MH Put CHE Operator Id}) == lower(user_id),",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join6",
						"select4 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select5",
						"select5 alterRow(upsertIf(true())) ~> alterRow1",
						"select6 alterRow(upsertIf(true())) ~> AlterRow2",
						"select7 alterRow(upsertIf(true())) ~> alterRow3",
						"derivedColumn2 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select6",
						"derivedColumn1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select7",
						"filter5 aggregate(groupBy(gkey),",
						"     each(match(name!='gkey'), $$ = first($$))) ~> aggregate2",
						"select1 filter(not(isNull(mve_gkey))) ~> filter4",
						"filter4 aggregate(groupBy(mve_gkey),",
						"     each(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate3",
						"select2 filter(not(isNull(gkey))) ~> filter5",
						"join6 derive(Block_To_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 2) != substring({DH ToPosName Short 5Char}, 1, 2), true(), false()),",
						"          Same_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 4) != substring({DH ToPosName Short 5Char}, 1, 4), true(), false()),",
						"          Stack_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 5) != substring({DH ToPosName Short 5Char}, 1, 5), true(), false())) ~> derivedColumn6",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mundra-ct04',",
						"     folderPath: 'gold/violation',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> violation",
						"AlterRow2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mundra-ct04',",
						"     folderPath: 'gold/decking',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> decking",
						"alterRow3 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'mundra-ct04',",
						"     folderPath: 'gold/move',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> move"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/violations_ptp')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "DeckingHistory"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "violation"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "decking"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "move"
						}
					],
					"transformations": [
						{
							"name": "select1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "join1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter3"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join2"
						},
						{
							"name": "select3"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "select4"
						},
						{
							"name": "select5"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "AlterRow2"
						},
						{
							"name": "alterRow3"
						},
						{
							"name": "select6"
						},
						{
							"name": "select7"
						},
						{
							"name": "aggregate2"
						},
						{
							"name": "filter4"
						},
						{
							"name": "aggregate3"
						},
						{
							"name": "filter5"
						},
						{
							"name": "derivedColumn6"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Unit Nbr} as string,",
						"          {Facility Id} as string,",
						"          {Complex Id} as string,",
						"          {Yard Id} as string,",
						"          {Carrier Visit Key} as string,",
						"          {Event Type Id} as string,",
						"          {Move Kind} as string,",
						"          {From Location} as string,",
						"          {To Location} as string,",
						"          {From Position Name} as string,",
						"          {To Position Name} as string,",
						"          {Carry CHE Operator Id} as string,",
						"          {Fetch CHE Operator Id} as string,",
						"          {Put CHE Operator Id} as string,",
						"          {Fetch CHE Id} as string,",
						"          {Fetch CHE Kind} as string,",
						"          {Carry CHE Id} as string,",
						"          {Carry CHE Kind} as string,",
						"          {Put CHE Id} as string,",
						"          {Put CHE Kind} as string,",
						"          {QC CHE Id} as string,",
						"          {QC CHE Kind} as string,",
						"          t_carry_complete as string,",
						"          t_put as string,",
						"          t_fetch as string,",
						"          t_dispatch as string,",
						"          t_discharge as string,",
						"          t_carry_dispatch as string,",
						"          t_carry_fetch_ready as string,",
						"          t_carry_put_ready as string,",
						"          dist_carry as integer,",
						"          dist_start as integer,",
						"          {Twin Fetch} as boolean,",
						"          {Twin Carry} as boolean,",
						"          {Twin Put} as boolean,",
						"          {Category Id} as string,",
						"          {Freight Kind Id} as string,",
						"          to_pos_gkey as string,",
						"          fm_pos_gkey as string,",
						"          {Restow Reason} as string,",
						"          {Container Line Id} as string,",
						"          {Container Line Role} as string,",
						"          pow as string,",
						"          mve_gkey as integer,",
						"          ufv_gkey as integer,",
						"          {Berth Id} as string,",
						"          {Goods And Ctr Wt Kg} as integer,",
						"          active_ufv as integer,",
						"          {Requires Power Flag} as boolean,",
						"          {OOG Flag} as boolean,",
						"          {Shipper Id} as string,",
						"          {Consignee Id} as string,",
						"          {Commodity Id} as string,",
						"          ATA as string,",
						"          ATD as string,",
						"          Rehandles as short",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/movehistory/load','bronze/moves/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'ptp',",
						"     folderPath: 'bronze/movehistory/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> MoveHistory",
						"source(output(",
						"          gkey as integer,",
						"          uyv_gkey as integer,",
						"          unit_id as string,",
						"          time_stamp as string,",
						"          decking_type as string,",
						"          node_id as string,",
						"          yard as string,",
						"          from_pos_loctype as string,",
						"          from_pos_locid as string,",
						"          from_pos_loc_gkey as integer,",
						"          from_pos_slot as string,",
						"          from_pos_name as string,",
						"          from_pos_bin as string,",
						"          from_pos_tier as short,",
						"          to_pos_loctype as string,",
						"          to_pos_locid as string,",
						"          to_pos_loc_gkey as string,",
						"          to_pos_slot as string,",
						"          to_pos_name as string,",
						"          to_pos_bin as string,",
						"          to_pos_tier as short,",
						"          total_score as short,",
						"          execution_time as short,",
						"          details as string,",
						"          phase as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/deckinghistory/load','bronze/deckinghistory/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'ptp',",
						"     folderPath: 'bronze/deckinghistory/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> DeckingHistory",
						"MoveHistory select(mapColumn(",
						"          mve_gkey,",
						"          {Unit Nbr},",
						"          {Event Type Id},",
						"          {Move Kind},",
						"          {From Location},",
						"          {To Position Name},",
						"          {Put CHE Operator Id},",
						"          {Put CHE Id},",
						"          {MH T_Put DateTime} = t_put,",
						"          {Freight Kind Id},",
						"          {Category Id},",
						"          ufv_gkey",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"aggregate3 derive(Year_Month = (year(:datetime) * 100) + month(:datetime),",
						"          Year_Week = (year(:datetime) * 100) + weekOfYear(:datetime),",
						"          {MH T_Put DateTime} = :datetime,",
						"          datetime := coalesce(toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm'))) ~> derivedColumn1",
						"DeckingHistory select(mapColumn(",
						"          gkey,",
						"          unit_id,",
						"          {DH TimeStamp} = time_stamp,",
						"          Decking_Type = decking_type,",
						"          to_pos_name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"aggregate2 filter(Decking_Type == 'Bump Intruder' || Decking_Type == 'Vessel Discharge' || Decking_Type == 'Vessel Discharge - Twin' || Decking_Type == 'XD Drop if Floating Refine' || Decking_Type == 'XD Refine Request' || Decking_Type == 'XD Rehandle Request') ~> filter1",
						"filter1 derive(Year_Month = (year(:datetime_dh) * 100) + month(:datetime_dh),",
						"          Year_Week = (year(:datetime_dh) * 100) + weekOfYear(:datetime_dh),",
						"          {DH TimeStamp} = :datetime_dh,",
						"          datetime_dh := coalesce(toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss'), toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm'))) ~> derivedColumn2",
						"derivedColumn1, derivedColumn2 join({Unit Nbr} == unit_id,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 filter({From Location} != 'YARD' && unit_id != '' && not(isNull(unit_id)) && !startsWith(split({To Position Name}, \"-\")[3], 'CR') && {MH T_Put DateTime} > addDays({DH TimeStamp}, -15)) ~> filter2",
						"filter2 derive({MH TPut Less 4 hours} = add({MH T_Put DateTime} , -4*60*60*1000),",
						"          {DH TimeStamp Within 4 Hours} = iif(({DH TimeStamp} >= add({MH T_Put DateTime} , -4*60*60*1000)) && ({DH TimeStamp} <= {MH T_Put DateTime}), 1, 0),",
						"          {MH ToPosName Short} = split({To Position Name}, \"-\")[3],",
						"          {MH ToPosName Short 5Char} = iif(length(split({To Position Name}, \"-\")[3]) == 8, substring(split({To Position Name}, \"-\")[3], 0, 7), split({To Position Name}, \"-\")[3]),",
						"          {DH ToPosName Shorrt} = split(to_pos_name, \"-\")[3],",
						"          {DH ToPosName Short 5Char} = iif(length(split(to_pos_name, \"-\")[3]) == 8, substring(split(to_pos_name, \"-\")[3], 0, 7), split(to_pos_name, \"-\")[3])) ~> derivedColumn3",
						"derivedColumn3 filter({DH TimeStamp Within 4 Hours} == 1 && {DH ToPosName Short 5Char} != \"FLD\") ~> filter3",
						"filter3 aggregate(groupBy({Unit Nbr},",
						"          {Move Kind},",
						"          {Category Id},",
						"          {MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime},",
						"          {Put CHE Operator Id},",
						"          mve_gkey,",
						"          {Put CHE Id},",
						"          {Freight Kind Id}),",
						"     MaxDHTime = max({DH TimeStamp})) ~> aggregate1",
						"filter3, aggregate1 join(aggregate3@{Unit Nbr} == aggregate1@{Unit Nbr}",
						"     && aggregate3@{Move Kind} == aggregate1@{Move Kind}",
						"     && aggregate3@{Category Id} == aggregate1@{Category Id}",
						"     && derivedColumn3@{MH ToPosName Short 5Char} == aggregate1@{MH ToPosName Short 5Char}",
						"     && derivedColumn1@{MH T_Put DateTime} == aggregate1@{MH T_Put DateTime}",
						"     && aggregate3@{Put CHE Operator Id} == aggregate1@{Put CHE Operator Id}",
						"     && aggregate3@mve_gkey == aggregate1@mve_gkey",
						"     && aggregate3@{Put CHE Id} == aggregate1@{Put CHE Id}",
						"     && aggregate3@{Freight Kind Id} == aggregate1@{Freight Kind Id}",
						"     && {DH TimeStamp} == MaxDHTime,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join2",
						"join2 select(mapColumn(",
						"          {MH Event Type Id} = {Event Type Id},",
						"          {From Location},",
						"          {MH To Position Name} = {To Position Name},",
						"          ufv_gkey,",
						"          gkey,",
						"          unit_id,",
						"          {D H TimeStamp} = {DH TimeStamp},",
						"          {D H Decking Type} = Decking_Type,",
						"          {D H To Pos Name} = to_pos_name,",
						"          Year_Month = derivedColumn2@Year_Month,",
						"          Year_Week = derivedColumn2@Year_Week,",
						"          {MH TPut Less 4 hours},",
						"          {DH TimeStamp Within 4 Hours},",
						"          {MH ToPosName Short},",
						"          {MH ToPosName Short 5Char} = derivedColumn3@{MH ToPosName Short 5Char},",
						"          {DH ToPosName Shorrt},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr} = aggregate1@{Unit Nbr},",
						"          {MH Move Kind} = aggregate1@{Move Kind},",
						"          {Category Id} = aggregate1@{Category Id},",
						"          {MH ToPosName Short 5Char} = aggregate1@{MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime} = aggregate1@{MH T_Put DateTime},",
						"          {MH Put CHE Operator Id} = aggregate1@{Put CHE Operator Id},",
						"          mve_gkey = aggregate1@mve_gkey,",
						"          {MH Put CHE Id} = aggregate1@{Put CHE Id},",
						"          {Freight Kind Id} = aggregate1@{Freight Kind Id},",
						"          MaxDHTime",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select3",
						"select3 derive({Location Match or Not} = iif(substring({MH ToPosName Short 5Char},1, 5) == substring({DH ToPosName Short 5Char},1,5), 'Position Followed', 'Position Not Followed'),",
						"          Shift_Date = toDate({MH T_Put DateTime}),",
						"          {T Put Time} = MaxDHTime,",
						"          {T Put Hour} = hour(MaxDHTime),",
						"          {T Put Minute} = minute(MaxDHTime),",
						"          {T Put Second} = second(MaxDHTime)) ~> derivedColumn4",
						"derivedColumn6 select(mapColumn(",
						"          {MH Event Type Id},",
						"          {D H Decking Type},",
						"          gkey,",
						"          Year_Month,",
						"          Year_Week,",
						"          {MH ToPosName Short 5Char},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr},",
						"          {MH Move Kind},",
						"          {Category Id},",
						"          {MH T_Put DateTime},",
						"          {MH Put CHE Operator Id},",
						"          mve_gkey,",
						"          {MH Put CHE Id},",
						"          {Freight Kind Id},",
						"          MaxDHTime,",
						"          Block_To_Block_Violation,",
						"          Same_Block_Violation,",
						"          Stack_Violation,",
						"          {Location Match or Not},",
						"          Shift_Date",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select4",
						"select4 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select5",
						"select5 alterRow(upsertIf(true())) ~> alterRow1",
						"select6 alterRow(upsertIf(true())) ~> AlterRow2",
						"select7 alterRow(upsertIf(true())) ~> alterRow3",
						"derivedColumn2 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select6",
						"derivedColumn1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select7",
						"filter5 aggregate(groupBy(gkey),",
						"     each(match(name!='gkey'), $$ = first($$))) ~> aggregate2",
						"select1 filter(not(isNull(mve_gkey))) ~> filter4",
						"filter4 aggregate(groupBy(mve_gkey),",
						"     each(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate3",
						"select2 filter(not(isNull(gkey))) ~> filter5",
						"derivedColumn4 derive(Block_To_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 2) != substring({DH ToPosName Short 5Char}, 1, 2), true(), false()),",
						"          Same_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 4) != substring({DH ToPosName Short 5Char}, 1, 4), true(), false()),",
						"          Stack_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 5) != substring({DH ToPosName Short 5Char}, 1, 5), true(), false())) ~> derivedColumn6",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'ptp',",
						"     folderPath: 'gold/violation',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> violation",
						"AlterRow2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'ptp',",
						"     folderPath: 'gold/decking',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> decking",
						"alterRow3 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'ptp',",
						"     folderPath: 'gold/move',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> move"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/violations_rio')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "DeckingHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ShiftData"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ShiftInfo"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "XpsEcUser"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "violation"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "decking"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "move"
						}
					],
					"transformations": [
						{
							"name": "select1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "join1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter3"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join2"
						},
						{
							"name": "select3"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "join3"
						},
						{
							"name": "join4"
						},
						{
							"name": "derivedColumn5"
						},
						{
							"name": "select4"
						},
						{
							"name": "join6"
						},
						{
							"name": "select5"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "AlterRow2"
						},
						{
							"name": "alterRow3"
						},
						{
							"name": "select6"
						},
						{
							"name": "select7"
						},
						{
							"name": "aggregate2"
						},
						{
							"name": "filter4"
						},
						{
							"name": "aggregate3"
						},
						{
							"name": "filter5"
						},
						{
							"name": "derivedColumn6"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Unit Nbr} as string,",
						"          {Facility Id} as string,",
						"          {Complex Id} as string,",
						"          {Yard Id} as string,",
						"          {Carrier Visit Key} as string,",
						"          {Event Type Id} as string,",
						"          {Move Kind} as string,",
						"          {From Location} as string,",
						"          {To Location} as string,",
						"          {From Position Name} as string,",
						"          {To Position Name} as string,",
						"          {Carry CHE Operator Id} as string,",
						"          {Fetch CHE Operator Id} as string,",
						"          {Put CHE Operator Id} as string,",
						"          {Fetch CHE Id} as string,",
						"          {Fetch CHE Kind} as string,",
						"          {Carry CHE Id} as string,",
						"          {Carry CHE Kind} as string,",
						"          {Put CHE Id} as string,",
						"          {Put CHE Kind} as string,",
						"          {QC CHE Id} as string,",
						"          {QC CHE Kind} as string,",
						"          t_carry_complete as string,",
						"          t_put as string,",
						"          t_fetch as string,",
						"          t_dispatch as string,",
						"          t_discharge as string,",
						"          t_carry_dispatch as string,",
						"          t_carry_fetch_ready as string,",
						"          t_carry_put_ready as string,",
						"          dist_carry as string,",
						"          dist_start as string,",
						"          {Twin Fetch} as boolean,",
						"          {Twin Carry} as boolean,",
						"          {Twin Put} as boolean,",
						"          {Category Id} as string,",
						"          {Freight Kind Id} as string,",
						"          to_pos_gkey as string,",
						"          fm_pos_gkey as string,",
						"          {Restow Reason} as string,",
						"          {Container Line Id} as string,",
						"          {Container Line Role} as string,",
						"          pow as string,",
						"          mve_gkey as integer,",
						"          ufv_gkey as integer,",
						"          {Berth Id} as string,",
						"          {Goods And Ctr Wt Kg} as string,",
						"          active_ufv as integer,",
						"          {Requires Power Flag} as string,",
						"          {OOG Flag} as boolean,",
						"          {Shipper Id} as string,",
						"          {Consignee Id} as string,",
						"          {Commodity Id} as string,",
						"          ATA as string,",
						"          ATD as string,",
						"          Rehandles as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/moves/load','bronze/moves/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'rio',",
						"     folderPath: 'bronze/moves/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> MoveHistory",
						"source(output(",
						"          gkey as integer,",
						"          uyv_gkey as integer,",
						"          unit_id as string,",
						"          time_stamp as string,",
						"          decking_type as string,",
						"          node_id as string,",
						"          yard as boolean,",
						"          from_pos_loctype as string,",
						"          from_pos_locid as string,",
						"          from_pos_loc_gkey as integer,",
						"          from_pos_slot as string,",
						"          from_pos_name as string,",
						"          from_pos_bin as string,",
						"          from_pos_tier as short,",
						"          to_pos_loctype as string,",
						"          to_pos_locid as string,",
						"          to_pos_loc_gkey as boolean,",
						"          to_pos_slot as string,",
						"          to_pos_name as string,",
						"          to_pos_bin as string,",
						"          to_pos_tier as boolean,",
						"          total_score as short,",
						"          execution_time as short,",
						"          details as string,",
						"          phase as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/deckinghistory/load','bronze/deckinghistory/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'rio',",
						"     folderPath: 'bronze/deckinghistory/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> DeckingHistory",
						"source(output(",
						"          {Shift Id} as string,",
						"          Hour as integer,",
						"          Minute as integer",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'rio',",
						"     folderPath: 'bronze/shiftdata',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> ShiftData",
						"source(output(",
						"          {Shift Name} as string,",
						"          {Shift Start Hour} as integer,",
						"          {Shift Start Minute} as integer,",
						"          {Shift Start} as string,",
						"          {Shift End Hour} as integer,",
						"          {Shift End Minute} as integer,",
						"          {Shift End} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delimited',",
						"     fileSystem: 'rio',",
						"     folderPath: 'bronze/shiftinfo',",
						"     fileName: 'shift-info.csv',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> ShiftInfo",
						"source(output(",
						"          gkey as short,",
						"          user_id as string,",
						"          name as string,",
						"          yard as boolean",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'rio',",
						"     folderPath: 'bronze/xpsecuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> XpsEcUser",
						"MoveHistory select(mapColumn(",
						"          mve_gkey,",
						"          {Unit Nbr},",
						"          {Event Type Id},",
						"          {Move Kind},",
						"          {From Location},",
						"          {To Position Name},",
						"          {Put CHE Operator Id},",
						"          {Put CHE Id},",
						"          {MH T_Put DateTime} = t_put,",
						"          {Freight Kind Id},",
						"          {Category Id},",
						"          ufv_gkey",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"aggregate3 derive(Year_Month = (year(coalesce(toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss'))\r",
						") * 100) + month(coalesce(toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss'))\r",
						"),",
						"          Year_Week = (year(coalesce(toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss'))\r",
						") * 100) + weekOfYear(coalesce(toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss'))\r",
						"),",
						"          {MH T_Put DateTime} = coalesce(toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm:ss'))) ~> derivedColumn1",
						"DeckingHistory select(mapColumn(",
						"          gkey,",
						"          unit_id,",
						"          {DH TimeStamp} = time_stamp,",
						"          Decking_Type = decking_type,",
						"          to_pos_name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"aggregate2 filter(Decking_Type == 'Bump Intruder' || Decking_Type == 'Vessel Discharge' || Decking_Type == 'Vessel Discharge - Twin' || Decking_Type == 'XD Drop if Floating Refine' || Decking_Type == 'XD Refine Request' || Decking_Type == 'XD Rehandle Request') ~> filter1",
						"filter1 derive(Year_Month = (year(coalesce(toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss')) ) * 100) + month(coalesce(toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss')) ),",
						"          Year_Week = (year(coalesce(toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss')) ) * 100) + weekOfYear(coalesce(toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss')) ),",
						"          {DH TimeStamp} = coalesce(toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss'))) ~> derivedColumn2",
						"derivedColumn1, derivedColumn2 join({Unit Nbr} == unit_id,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 filter({From Location} != 'YARD' && unit_id != '' && not(isNull(unit_id)) && !startsWith(split({To Position Name}, \"-\")[3], 'CR') && {MH T_Put DateTime} > addDays({DH TimeStamp}, -15)) ~> filter2",
						"filter2 derive({MH TPut Less 4 hours} = add({MH T_Put DateTime} , -4*60*60*1000),",
						"          {DH TimeStamp Within 4 Hours} = iif(({DH TimeStamp} >= add({MH T_Put DateTime} , -4*60*60*1000)) && ({DH TimeStamp} <= {MH T_Put DateTime}), 1, 0),",
						"          {MH ToPosName Short} = split({To Position Name}, \"-\")[3],",
						"          {MH ToPosName Short 5Char} = iif(length(split({To Position Name}, \"-\")[3]) == 8, substring(split({To Position Name}, \"-\")[3], 0, 7), split({To Position Name}, \"-\")[3]),",
						"          {DH ToPosName Shorrt} = split(to_pos_name, \"-\")[3],",
						"          {DH ToPosName Short 5Char} = iif(length(split(to_pos_name, \"-\")[3]) == 8, substring(split(to_pos_name, \"-\")[3], 0, 7), split(to_pos_name, \"-\")[3])) ~> derivedColumn3",
						"derivedColumn3 filter({DH TimeStamp Within 4 Hours} == 1 && {DH ToPosName Short 5Char} != \"FLD\" && not(like({DH ToPosName Short 5Char}, \"Fail%\"))) ~> filter3",
						"filter3 aggregate(groupBy({Unit Nbr},",
						"          {Move Kind},",
						"          {Category Id},",
						"          {MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime},",
						"          {Put CHE Operator Id},",
						"          mve_gkey,",
						"          {Put CHE Id},",
						"          {Freight Kind Id}),",
						"     MaxDHTime = max({DH TimeStamp})) ~> aggregate1",
						"filter3, aggregate1 join(aggregate3@{Unit Nbr} == aggregate1@{Unit Nbr}",
						"     && aggregate3@{Move Kind} == aggregate1@{Move Kind}",
						"     && aggregate3@{Category Id} == aggregate1@{Category Id}",
						"     && derivedColumn3@{MH ToPosName Short 5Char} == aggregate1@{MH ToPosName Short 5Char}",
						"     && derivedColumn1@{MH T_Put DateTime} == aggregate1@{MH T_Put DateTime}",
						"     && aggregate3@{Put CHE Operator Id} == aggregate1@{Put CHE Operator Id}",
						"     && aggregate3@mve_gkey == aggregate1@mve_gkey",
						"     && aggregate3@{Put CHE Id} == aggregate1@{Put CHE Id}",
						"     && aggregate3@{Freight Kind Id} == aggregate1@{Freight Kind Id}",
						"     && {DH TimeStamp} == MaxDHTime,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join2",
						"join2 select(mapColumn(",
						"          {MH Event Type Id} = {Event Type Id},",
						"          {From Location},",
						"          {MH To Position Name} = {To Position Name},",
						"          ufv_gkey,",
						"          gkey,",
						"          unit_id,",
						"          {D H TimeStamp} = {DH TimeStamp},",
						"          {D H Decking Type} = Decking_Type,",
						"          {D H To Pos Name} = to_pos_name,",
						"          Year_Month = derivedColumn2@Year_Month,",
						"          Year_Week = derivedColumn2@Year_Week,",
						"          {MH TPut Less 4 hours},",
						"          {DH TimeStamp Within 4 Hours},",
						"          {MH ToPosName Short},",
						"          {MH ToPosName Short 5Char} = derivedColumn3@{MH ToPosName Short 5Char},",
						"          {DH ToPosName Shorrt},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr} = aggregate1@{Unit Nbr},",
						"          {MH Move Kind} = aggregate1@{Move Kind},",
						"          {Category Id} = aggregate1@{Category Id},",
						"          {MH ToPosName Short 5Char} = aggregate1@{MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime} = aggregate1@{MH T_Put DateTime},",
						"          {MH Put CHE Operator Id} = aggregate1@{Put CHE Operator Id},",
						"          mve_gkey = aggregate1@mve_gkey,",
						"          {MH Put CHE Id} = aggregate1@{Put CHE Id},",
						"          {Freight Kind Id} = aggregate1@{Freight Kind Id},",
						"          MaxDHTime",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select3",
						"select3 derive({Location Match or Not} = iif(substring({MH ToPosName Short 5Char}, 1, 6) == substring({DH ToPosName Short 5Char}, 1, 6), 'Position Followed', 'Position Not Followed'),",
						"          Shift_Date = toDate({MH T_Put DateTime}),",
						"          {T Put Time} = MaxDHTime,",
						"          {T Put Hour} = hour(MaxDHTime),",
						"          {T Put Minute} = minute(MaxDHTime),",
						"          {T Put Second} = second(MaxDHTime)) ~> derivedColumn4",
						"derivedColumn4, ShiftData join({T Put Hour} == Hour",
						"     && {T Put Minute} == Minute,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join3",
						"join3, ShiftInfo join({Shift Id} == {Shift Name},",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join4",
						"join4 derive({Shift Date} = iif({MH T_Put DateTime} - toTimestamp(toString(Shift_Date) + {Shift End}) > 0, addDays(Shift_Date, -1), Shift_Date),",
						"          Week_of_Year = year(iif({MH T_Put DateTime} - toTimestamp(toString(Shift_Date) + {Shift End}) > 0, addDays(Shift_Date, -1), Shift_Date))*100 + weekOfYear(iif({MH T_Put DateTime} - toTimestamp(toString(Shift_Date) + {Shift End}) > 0, addDays(Shift_Date, -1), Shift_Date))) ~> derivedColumn5",
						"derivedColumn6 select(mapColumn(",
						"          {D H Decking Type},",
						"          {MH ToPosName Short 5Char},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr},",
						"          {MH Move Kind},",
						"          {Category Id},",
						"          {MH T_Put DateTime},",
						"          {MH Put CHE Operator Id},",
						"          mve_gkey,",
						"          {MH Put CHE Id},",
						"          {Freight Kind Id},",
						"          MaxDHTime,",
						"          {Location Match or Not},",
						"          {Shift Id},",
						"          {Shift Date},",
						"          Week_of_Year,",
						"          {XPS_ECUser.name} = name,",
						"          Block_To_Block_Violation,",
						"          Same_Block_Violation,",
						"          Stack_Violation",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select4",
						"derivedColumn5, XpsEcUser join({MH Put CHE Operator Id} == user_id,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join6",
						"select4 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select5",
						"select5 alterRow(upsertIf(true())) ~> alterRow1",
						"select6 alterRow(upsertIf(true())) ~> AlterRow2",
						"select7 alterRow(upsertIf(true())) ~> alterRow3",
						"derivedColumn2 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select6",
						"derivedColumn1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select7",
						"filter5 aggregate(groupBy(gkey),",
						"     each(match(name!='gkey'), $$ = first($$))) ~> aggregate2",
						"select1 filter(not(isNull(mve_gkey))) ~> filter4",
						"filter4 aggregate(groupBy(mve_gkey),",
						"     each(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate3",
						"select2 filter(not(isNull(gkey))) ~> filter5",
						"join6 derive(Block_To_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 3) != substring({DH ToPosName Short 5Char}, 1, 3), true(), false()),",
						"          Same_Block_Violation = iif( (substring({MH ToPosName Short 5Char}, 1, 3) == substring({DH ToPosName Short 5Char}, 1, 3)) && (substring({MH ToPosName Short 5Char}, 5, 2) == substring({DH ToPosName Short 5Char}, 5, 2)), false(), true()),",
						"          Stack_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 6) != substring({DH ToPosName Short 5Char}, 1, 6), true(), false())) ~> derivedColumn6",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'rio',",
						"     folderPath: 'gold/violation',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> violation",
						"AlterRow2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'rio',",
						"     folderPath: 'gold/decking',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> decking",
						"alterRow3 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'rio',",
						"     folderPath: 'gold/move',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: false,",
						"     insertable: false,",
						"     updateable: false,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> move"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/violations_sgtd')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "DeckingHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ShiftData"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "ShiftInfo"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "XpsEcUser"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "violation"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "decking"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "move"
						}
					],
					"transformations": [
						{
							"name": "select1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "join1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter3"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join2"
						},
						{
							"name": "select3"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "join3"
						},
						{
							"name": "join4"
						},
						{
							"name": "derivedColumn5"
						},
						{
							"name": "select4"
						},
						{
							"name": "join6"
						},
						{
							"name": "select5"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "AlterRow2"
						},
						{
							"name": "alterRow3"
						},
						{
							"name": "select6"
						},
						{
							"name": "select7"
						},
						{
							"name": "aggregate2"
						},
						{
							"name": "filter4"
						},
						{
							"name": "aggregate3"
						},
						{
							"name": "filter5"
						},
						{
							"name": "derivedColumn6"
						},
						{
							"name": "removableFilter3"
						},
						{
							"name": "Removablefilter2"
						},
						{
							"name": "Removablefilter1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Unit Nbr} as string,",
						"          {Facility Id} as string,",
						"          {Complex Id} as string,",
						"          {Yard Id} as string,",
						"          {Carrier Visit Key} as string,",
						"          {Event Type Id} as string,",
						"          {Move Kind} as string,",
						"          {From Location} as string,",
						"          {To Location} as string,",
						"          {From Position Name} as string,",
						"          {To Position Name} as string,",
						"          {Carry CHE Operator Id} as string,",
						"          {Fetch CHE Operator Id} as string,",
						"          {Put CHE Operator Id} as string,",
						"          {Fetch CHE Id} as string,",
						"          {Fetch CHE Kind} as string,",
						"          {Carry CHE Id} as string,",
						"          {Carry CHE Kind} as string,",
						"          {Put CHE Id} as string,",
						"          {Put CHE Kind} as string,",
						"          {QC CHE Id} as string,",
						"          {QC CHE Kind} as string,",
						"          t_carry_complete as string,",
						"          t_put as string,",
						"          t_fetch as string,",
						"          t_dispatch as string,",
						"          t_discharge as string,",
						"          t_carry_dispatch as string,",
						"          t_carry_fetch_ready as string,",
						"          t_carry_put_ready as string,",
						"          dist_carry as string,",
						"          dist_start as string,",
						"          {Twin Fetch} as boolean,",
						"          {Twin Carry} as boolean,",
						"          {Twin Put} as boolean,",
						"          {Category Id} as string,",
						"          {Freight Kind Id} as string,",
						"          to_pos_gkey as string,",
						"          fm_pos_gkey as string,",
						"          {Restow Reason} as string,",
						"          {Container Line Id} as string,",
						"          {Container Line Role} as string,",
						"          pow as string,",
						"          mve_gkey as integer,",
						"          ufv_gkey as integer,",
						"          {Berth Id} as string,",
						"          {Goods And Ctr Wt Kg} as string,",
						"          active_ufv as integer,",
						"          {Requires Power Flag} as string,",
						"          {OOG Flag} as boolean,",
						"          {Shipper Id} as string,",
						"          {Consignee Id} as string,",
						"          {Commodity Id} as string,",
						"          ATA as string,",
						"          ATD as string,",
						"          Rehandles as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['bronze/movehistory/load','bronze/moves/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'bronze/movehistory/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> MoveHistory",
						"source(output(",
						"          GKEY as integer,",
						"          UYV_GKEY as integer,",
						"          UNIT_ID as string,",
						"          TIME_STAMP as string,",
						"          DECKING_TYPE as string,",
						"          NODE_ID as string,",
						"          YARD as integer,",
						"          FROM_POS_LOCTYPE as string,",
						"          FROM_POS_LOCID as string,",
						"          FROM_POS_LOC_GKEY as integer,",
						"          FROM_POS_SLOT as string,",
						"          FROM_POS_NAME as string,",
						"          FROM_POS_BIN as integer,",
						"          FROM_POS_TIER as short,",
						"          TO_POS_LOCTYPE as string,",
						"          TO_POS_LOCID as string,",
						"          TO_POS_LOC_GKEY as integer,",
						"          TO_POS_SLOT as string,",
						"          TO_POS_NAME as string,",
						"          TO_POS_BIN as integer,",
						"          TO_POS_TIER as boolean,",
						"          TOTAL_SCORE as integer,",
						"          EXECUTION_TIME as short,",
						"          DETAILS as string,",
						"          PHASE as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/deckinghistory/load','bronze/deckinghistory/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'bronze/deckinghistory/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> DeckingHistory",
						"source(output(",
						"          {Shift Id} as string,",
						"          Hour as integer,",
						"          Minute as integer",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'bronze/shiftdata',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> ShiftData",
						"source(output(",
						"          {Shift Name} as string,",
						"          {Shift Start Hour} as integer,",
						"          {Shift Start Minute} as integer,",
						"          {Shift Start} as string,",
						"          {Shift End Hour} as integer,",
						"          {Shift End Minute} as integer,",
						"          {Shift End} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     format: 'delimited',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'bronze/shiftinfo',",
						"     fileName: 'shift-info.csv',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> ShiftInfo",
						"source(output(",
						"          GKEY as integer,",
						"          USER_ID as string,",
						"          NAME as string,",
						"          YARD as integer",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'bronze/xpsecuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> XpsEcUser",
						"MoveHistory select(mapColumn(",
						"          mve_gkey,",
						"          {Unit Nbr},",
						"          {Event Type Id},",
						"          {Move Kind},",
						"          {From Location},",
						"          {To Position Name},",
						"          {Put CHE Operator Id},",
						"          {Put CHE Id},",
						"          {MH T_Put DateTime} = t_put,",
						"          {Freight Kind Id},",
						"          {Category Id},",
						"          ufv_gkey",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"aggregate3 derive(Year_Month = (year(\r",
						"    coalesce(toTimestamp(dropRight({MH T_Put DateTime}, 3),'yyyy-MM-dd HH:mm:ss.SSS'),\r",
						"    toTimestamp(concat(substring({MH T_Put DateTime}, 1, 22), ' ', substring({MH T_Put DateTime}, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'MM/dd/yyyy HH:mm:ss'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'dd-MM-yy HH:mm:ss'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'yyyy-MM-dd HH:mm:ss.SSS'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'dd/MM/yyyy HH:mm:ss'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'dd-MM-yyyy HH:mm:ss')\r",
						")\r",
						"\r",
						") * 100) + month(\r",
						"    coalesce(\r",
						"    toTimestamp(dropRight({MH T_Put DateTime}, 3),'yyyy-MM-dd HH:mm:ss.SSS'),\r",
						"    toTimestamp(concat(substring({MH T_Put DateTime}, 1, 22), ' ', substring({MH T_Put DateTime}, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'MM/dd/yyyy HH:mm:ss'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'dd-MM-yy HH:mm:ss'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'yyyy-MM-dd HH:mm:ss.SSS'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'dd/MM/yyyy HH:mm:ss'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'dd-MM-yyyy HH:mm:ss')\r",
						")\r",
						"\r",
						"),",
						"          Year_Week = (year(\r",
						"    coalesce(\r",
						"    toTimestamp(dropRight({MH T_Put DateTime}, 3),'yyyy-MM-dd HH:mm:ss.SSS'),\r",
						"    toTimestamp(concat(substring({MH T_Put DateTime}, 1, 22), ' ', substring({MH T_Put DateTime}, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'MM/dd/yyyy HH:mm:ss'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'dd-MM-yy HH:mm:ss'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'yyyy-MM-dd HH:mm:ss.SSS'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'dd/MM/yyyy HH:mm:ss'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'dd-MM-yyyy HH:mm:ss')\r",
						")\r",
						"\r",
						") * 100) + weekOfYear(\r",
						"coalesce(\r",
						"    toTimestamp(dropRight({MH T_Put DateTime}, 3),'yyyy-MM-dd HH:mm:ss.SSS'),\r",
						"    toTimestamp(concat(substring({MH T_Put DateTime}, 1, 22), ' ', substring({MH T_Put DateTime}, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'MM/dd/yyyy HH:mm:ss'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'dd-MM-yy HH:mm:ss'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'yyyy-MM-dd HH:mm:ss.SSS'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'dd/MM/yyyy HH:mm:ss'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'dd-MM-yyyy HH:mm:ss')\r",
						")\r",
						"\r",
						"),",
						"          {MH T_Put DateTime} = coalesce(\r",
						"    toTimestamp(dropRight({MH T_Put DateTime}, 3),'yyyy-MM-dd HH:mm:ss.SSS'),\r",
						"    toTimestamp(concat(substring({MH T_Put DateTime}, 1, 22), ' ', substring({MH T_Put DateTime}, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'MM/dd/yyyy HH:mm:ss'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'dd-MM-yy HH:mm:ss'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'dd/MM/yyyy\\'T\\'HH:mm:ss'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'yyyy-MM-dd HH:mm:ss.SSS'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'dd/MM/yyyy HH:mm:ss'),\r",
						"    toTimestamp({MH T_Put DateTime}, 'dd-MM-yyyy HH:mm:ss')\r",
						")) ~> derivedColumn1",
						"DeckingHistory select(mapColumn(",
						"          gkey = GKEY,",
						"          unit_id = UNIT_ID,",
						"          {DH TimeStamp} = TIME_STAMP,",
						"          Decking_Type = DECKING_TYPE,",
						"          to_pos_name = TO_POS_NAME",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"aggregate2 filter(Decking_Type == 'Bump Intruder' || Decking_Type == 'Vessel Discharge' || Decking_Type == 'Vessel Discharge - Twin' || Decking_Type == 'XD Drop if Floating Refine' || Decking_Type == 'XD Refine Request' || Decking_Type == 'XD Rehandle Request') ~> filter1",
						"filter1 derive(Year_Month = (year(coalesce(toTimestamp(dropRight({DH TimeStamp}, 3),'yyyy-MM-dd HH:mm:ss.SSS'), toTimestamp(concat(substring({DH TimeStamp}, 1, 22), ' ', substring({DH TimeStamp}, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'), toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss')) ) * 100) + month(coalesce(toTimestamp(dropRight({DH TimeStamp}, 3),'yyyy-MM-dd HH:mm:ss.SSS'), toTimestamp(concat(substring({DH TimeStamp}, 1, 22), ' ', substring({DH TimeStamp}, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'), toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss')) ),",
						"          Year_Week = (year(coalesce(toTimestamp(dropRight({DH TimeStamp}, 3),'yyyy-MM-dd HH:mm:ss.SSS'), toTimestamp(concat(substring({DH TimeStamp}, 1, 22), ' ', substring({DH TimeStamp}, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'), toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss')) ) * 100) + weekOfYear(coalesce(toTimestamp(dropRight({DH TimeStamp}, 3),'yyyy-MM-dd HH:mm:ss.SSS'), toTimestamp(concat(substring({DH TimeStamp}, 1, 22), ' ', substring({DH TimeStamp}, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'), toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss')) ),",
						"          {DH TimeStamp} = coalesce(toTimestamp(dropRight({DH TimeStamp}, 3),'yyyy-MM-dd HH:mm:ss.SSS'), toTimestamp(concat(substring({DH TimeStamp}, 1, 22), ' ', substring({DH TimeStamp}, 30, 2)), 'dd-MMM-yy hh.mm.ss.SSS a'), toTimestamp({DH TimeStamp},'MM/dd/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({DH TimeStamp},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({DH TimeStamp},'dd/MM/yyyy HH:mm:ss'),toTimestamp({DH TimeStamp},'dd-MM-yyyy HH:mm:ss'))) ~> derivedColumn2",
						"derivedColumn1, derivedColumn2 join({Unit Nbr} == unit_id,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 filter({From Location} != 'YARD' && unit_id != '' && not(isNull(unit_id)) && !startsWith(split({To Position Name}, \"-\")[3], 'CR') && {MH T_Put DateTime} > addDays({DH TimeStamp}, -15)) ~> filter2",
						"filter2 derive({MH TPut Less 4 hours} = add({MH T_Put DateTime} , -4*60*60*1000),",
						"          {DH TimeStamp Within 4 Hours} = iif(({DH TimeStamp} >= add({MH T_Put DateTime} , -4*60*60*1000)) && ({DH TimeStamp} <= {MH T_Put DateTime}), 1, 0),",
						"          {MH ToPosName Short} = split({To Position Name}, \"-\")[3],",
						"          {MH ToPosName Short 5Char} = iif(length(split({To Position Name}, \"-\")[3]) == 8, substring(split({To Position Name}, \"-\")[3], 0, 7), split({To Position Name}, \"-\")[3]),",
						"          {DH ToPosName Shorrt} = split(to_pos_name, \"-\")[3],",
						"          {DH ToPosName Short 5Char} = iif(length(split(to_pos_name, \"-\")[3]) == 8, substring(split(to_pos_name, \"-\")[3], 0, 7), split(to_pos_name, \"-\")[3])) ~> derivedColumn3",
						"derivedColumn3 filter({DH TimeStamp Within 4 Hours} == 1 && {DH ToPosName Short 5Char} != \"FLD\" && not(like({DH ToPosName Short 5Char}, \"Fail%\"))) ~> filter3",
						"filter3 aggregate(groupBy({Unit Nbr},",
						"          {Move Kind},",
						"          {Category Id},",
						"          {MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime},",
						"          {Put CHE Operator Id},",
						"          mve_gkey,",
						"          {Put CHE Id},",
						"          {Freight Kind Id}),",
						"     MaxDHTime = max({DH TimeStamp})) ~> aggregate1",
						"filter3, aggregate1 join(aggregate3@{Unit Nbr} == aggregate1@{Unit Nbr}",
						"     && aggregate3@{Move Kind} == aggregate1@{Move Kind}",
						"     && aggregate3@{Category Id} == aggregate1@{Category Id}",
						"     && derivedColumn3@{MH ToPosName Short 5Char} == aggregate1@{MH ToPosName Short 5Char}",
						"     && derivedColumn1@{MH T_Put DateTime} == aggregate1@{MH T_Put DateTime}",
						"     && aggregate3@{Put CHE Operator Id} == aggregate1@{Put CHE Operator Id}",
						"     && aggregate3@mve_gkey == aggregate1@mve_gkey",
						"     && aggregate3@{Put CHE Id} == aggregate1@{Put CHE Id}",
						"     && aggregate3@{Freight Kind Id} == aggregate1@{Freight Kind Id}",
						"     && {DH TimeStamp} == MaxDHTime,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join2",
						"join2 select(mapColumn(",
						"          {MH Event Type Id} = {Event Type Id},",
						"          {From Location},",
						"          {MH To Position Name} = {To Position Name},",
						"          ufv_gkey,",
						"          gkey,",
						"          unit_id,",
						"          {D H TimeStamp} = {DH TimeStamp},",
						"          {D H Decking Type} = Decking_Type,",
						"          {D H To Pos Name} = to_pos_name,",
						"          Year_Month = derivedColumn2@Year_Month,",
						"          Year_Week = derivedColumn2@Year_Week,",
						"          {MH TPut Less 4 hours},",
						"          {DH TimeStamp Within 4 Hours},",
						"          {MH ToPosName Short},",
						"          {MH ToPosName Short 5Char} = derivedColumn3@{MH ToPosName Short 5Char},",
						"          {DH ToPosName Shorrt},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr} = aggregate1@{Unit Nbr},",
						"          {MH Move Kind} = aggregate1@{Move Kind},",
						"          {Category Id} = aggregate1@{Category Id},",
						"          {MH ToPosName Short 5Char} = aggregate1@{MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime} = aggregate1@{MH T_Put DateTime},",
						"          {MH Put CHE Operator Id} = aggregate1@{Put CHE Operator Id},",
						"          mve_gkey = aggregate1@mve_gkey,",
						"          {MH Put CHE Id} = aggregate1@{Put CHE Id},",
						"          {Freight Kind Id} = aggregate1@{Freight Kind Id},",
						"          MaxDHTime",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select3",
						"select3 derive({Location Match or Not} = iif(substring({MH ToPosName Short 5Char}, 1, 6) == substring({DH ToPosName Short 5Char}, 1, 6), 'Position Followed', 'Position Not Followed'),",
						"          Shift_Date = toDate({MH T_Put DateTime}),",
						"          {T Put Time} = MaxDHTime,",
						"          {T Put Hour} = hour(MaxDHTime),",
						"          {T Put Minute} = minute(MaxDHTime),",
						"          {T Put Second} = second(MaxDHTime)) ~> derivedColumn4",
						"derivedColumn4, ShiftData join({T Put Hour} == Hour",
						"     && {T Put Minute} == Minute,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join3",
						"join3, ShiftInfo join({Shift Id} == {Shift Name},",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join4",
						"join4 derive({Shift Date} = iif({MH T_Put DateTime} - toTimestamp(toString(Shift_Date) + {Shift End}) > 0, addDays(Shift_Date, -1), Shift_Date),",
						"          Week_of_Year = year(iif({MH T_Put DateTime} - toTimestamp(toString(Shift_Date) + {Shift End}) > 0, addDays(Shift_Date, -1), Shift_Date))*100 + weekOfYear(iif({MH T_Put DateTime} - toTimestamp(toString(Shift_Date) + {Shift End}) > 0, addDays(Shift_Date, -1), Shift_Date))) ~> derivedColumn5",
						"derivedColumn6 select(mapColumn(",
						"          {D H Decking Type},",
						"          {MH ToPosName Short 5Char},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr},",
						"          {MH Move Kind},",
						"          {Category Id},",
						"          {MH T_Put DateTime},",
						"          {MH Put CHE Operator Id},",
						"          mve_gkey,",
						"          {MH Put CHE Id},",
						"          {Freight Kind Id},",
						"          MaxDHTime,",
						"          {Location Match or Not},",
						"          {Shift Id},",
						"          {Shift Date},",
						"          Week_of_Year,",
						"          {XPS_ECUser.name} = NAME,",
						"          Block_To_Block_Violation,",
						"          Same_Block_Violation,",
						"          Stack_Violation",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select4",
						"derivedColumn5, XpsEcUser join({MH Put CHE Operator Id} == USER_ID,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join6",
						"select4 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select5",
						"Removablefilter2 alterRow(upsertIf(true()),",
						"     updateIf(true())) ~> alterRow1",
						"removableFilter3 alterRow(upsertIf(true()),",
						"     updateIf(true())) ~> AlterRow2",
						"Removablefilter1 alterRow(upsertIf(true()),",
						"     updateIf(true())) ~> alterRow3",
						"derivedColumn2 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select6",
						"derivedColumn1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select7",
						"filter5 aggregate(groupBy(gkey),",
						"     each(match(name!='gkey'), $$ = first($$))) ~> aggregate2",
						"select1 filter(not(isNull(mve_gkey))) ~> filter4",
						"filter4 aggregate(groupBy(mve_gkey),",
						"     each(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate3",
						"select2 filter(not(isNull(gkey))) ~> filter5",
						"join6 derive(Block_To_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 3) != substring({DH ToPosName Short 5Char}, 1, 3), true(), false()),",
						"          Same_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 5) != substring({DH ToPosName Short 5Char}, 1, 5), true(), false()),",
						"          Stack_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 6) != substring({DH ToPosName Short 5Char}, 1, 6), true(), false())) ~> derivedColumn6",
						"select6 filter(Year_Week > 202510) ~> removableFilter3",
						"select5 filter(Week_of_Year> 202510) ~> Removablefilter2",
						"select7 filter(Year_Week> 202510) ~> Removablefilter1",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'gold/violation',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> violation",
						"AlterRow2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'gold/decking',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> decking",
						"alterRow3 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'sgtd',",
						"     folderPath: 'gold/move',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> move"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/violations_teagtl')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "MoveHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "DeckingHistory"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "XpsEcUser"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "violation"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "decking"
						},
						{
							"linkedService": {
								"referenceName": "linkedService2",
								"type": "LinkedServiceReference"
							},
							"name": "move"
						}
					],
					"transformations": [
						{
							"name": "select1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "join1"
						},
						{
							"name": "filter2"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter3"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "join2"
						},
						{
							"name": "select3"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "select4"
						},
						{
							"name": "join6"
						},
						{
							"name": "select5"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "AlterRow2"
						},
						{
							"name": "alterRow3"
						},
						{
							"name": "select6"
						},
						{
							"name": "select7"
						},
						{
							"name": "aggregate2"
						},
						{
							"name": "filter4"
						},
						{
							"name": "aggregate3"
						},
						{
							"name": "filter5"
						},
						{
							"name": "derivedColumn6"
						},
						{
							"name": "select8"
						}
					],
					"scriptLines": [
						"source(output(",
						"          {Unit Nbr} as string,",
						"          {Facility Id} as string,",
						"          {Complex Id} as string,",
						"          {Yard Id} as string,",
						"          {Carrier Visit Key} as long,",
						"          {Event Type Id} as string,",
						"          {Move Kind} as string,",
						"          {From Location} as string,",
						"          {To Location} as string,",
						"          {From Position Name} as string,",
						"          {To Position Name} as string,",
						"          {Carry CHE Operator Id} as string,",
						"          {Fetch CHE Operator Id} as string,",
						"          {Put CHE Operator Id} as string,",
						"          {Fetch CHE Id} as short,",
						"          {Fetch CHE Kind} as string,",
						"          {Carry CHE Id} as short,",
						"          {Carry CHE Kind} as string,",
						"          {Put CHE Id} as short,",
						"          {Put CHE Kind} as string,",
						"          {QC CHE Id} as short,",
						"          {QC CHE Kind} as string,",
						"          t_carry_complete as string,",
						"          t_put as string,",
						"          t_fetch as string,",
						"          t_dispatch as string,",
						"          t_discharge as string,",
						"          t_carry_dispatch as string,",
						"          t_carry_fetch_ready as string,",
						"          t_carry_put_ready as string,",
						"          dist_carry as short,",
						"          dist_start as short,",
						"          {Twin Fetch} as boolean,",
						"          {Twin Carry} as boolean,",
						"          {Twin Put} as boolean,",
						"          {Category Id} as string,",
						"          {Freight Kind Id} as string,",
						"          to_pos_gkey as string,",
						"          fm_pos_gkey as long,",
						"          {Restow Reason} as string,",
						"          {Container Line Id} as string,",
						"          {Container Line Role} as string,",
						"          pow as string,",
						"          mve_gkey as long,",
						"          ufv_gkey as long,",
						"          {Berth Id} as string,",
						"          {Goods And Ctr Wt Kg} as integer,",
						"          active_ufv as long,",
						"          {Requires Power Flag} as boolean,",
						"          {OOG Flag} as boolean,",
						"          {Shipper Id} as string,",
						"          {Consignee Id} as string,",
						"          {Commodity Id} as string,",
						"          ATA as string,",
						"          ATD as string,",
						"          Rehandles as boolean",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     inferDriftedColumnTypes: true,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/movehistory/load','bronze/moves/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'bronze/movehistory/load/',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> MoveHistory",
						"source(output(",
						"          gkey as integer,",
						"          uyv_gkey as integer,",
						"          unit_id as string,",
						"          time_stamp as string,",
						"          decking_type as string,",
						"          node_id as string,",
						"          yard as boolean,",
						"          from_pos_loctype as string,",
						"          from_pos_locid as string,",
						"          from_pos_loc_gkey as integer,",
						"          from_pos_slot as string,",
						"          from_pos_name as string,",
						"          from_pos_bin as string,",
						"          from_pos_tier as short,",
						"          to_pos_loctype as string,",
						"          to_pos_locid as string,",
						"          to_pos_loc_gkey as boolean,",
						"          to_pos_slot as string,",
						"          to_pos_name as string,",
						"          to_pos_bin as string,",
						"          to_pos_tier as boolean,",
						"          total_score as short,",
						"          execution_time as short,",
						"          details as string,",
						"          phase as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: true,",
						"     moveFiles: ['/bronze/deckinghistory/load','bronze/deckinghistory/archive'],",
						"     format: 'delimited',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'bronze/deckinghistory/load',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> DeckingHistory",
						"source(output(",
						"          gkey as short,",
						"          user_id as string,",
						"          name as string,",
						"          yard as string,",
						"          {_c4} as string,",
						"          {_c5} as string,",
						"          {_c6} as string,",
						"          {_c7} as string,",
						"          {_c8} as string,",
						"          {_c9} as string,",
						"          {_c10} as string,",
						"          {_c11} as string,",
						"          {_c12} as string,",
						"          {_c13} as string,",
						"          {_c14} as string,",
						"          {_c15} as string,",
						"          {_c16} as string,",
						"          {_c17} as string,",
						"          {_c18} as string,",
						"          {_c19} as string,",
						"          {_c20} as string,",
						"          {_c21} as string,",
						"          {_c22} as string",
						"     ),",
						"     useSchema: false,",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delimited',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'bronze/xpsecuser',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true) ~> XpsEcUser",
						"MoveHistory select(mapColumn(",
						"          mve_gkey,",
						"          {Unit Nbr},",
						"          {Event Type Id},",
						"          {Move Kind},",
						"          {From Location},",
						"          {To Position Name},",
						"          {Put CHE Operator Id},",
						"          {Put CHE Id},",
						"          {MH T_Put DateTime} = t_put,",
						"          {Freight Kind Id},",
						"          {Category Id},",
						"          ufv_gkey",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"aggregate3 derive(Year_Month = (year(coalesce(toTimestamp(concat(substring({MH T_Put DateTime}, 1, 21), ' ', substring({MH T_Put DateTime}, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd.MM.yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm')))*100) + month(coalesce(toTimestamp(concat(substring({MH T_Put DateTime}, 1, 21), ' ', substring({MH T_Put DateTime}, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd.MM.yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm'))),",
						"          Year_Week = (year(coalesce(toTimestamp(concat(substring({MH T_Put DateTime}, 1, 21), ' ', substring({MH T_Put DateTime}, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd.MM.yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm')))*100) + weekOfYear(coalesce(toTimestamp(concat(substring({MH T_Put DateTime}, 1, 21), ' ', substring({MH T_Put DateTime}, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd.MM.yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm'))),",
						"          {MH T_Put DateTime} = coalesce(toTimestamp(concat(substring({MH T_Put DateTime}, 1, 21), ' ', substring({MH T_Put DateTime}, 29, 2)), 'dd/MM/yy hh:mm:ss,SSS a'),toTimestamp({MH T_Put DateTime},'yyyy-MM-dd HH:mm:ss.SSS'),toTimestamp({MH T_Put DateTime},'MM/dd/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd.MM.yy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd/MM/yyyy\\'T\\'HH:mm:ss'), toTimestamp({MH T_Put DateTime},'dd/MM/yyyy HH:mm:ss'),toTimestamp({MH T_Put DateTime},'dd-MM-yyyy HH:mm'))) ~> derivedColumn1",
						"DeckingHistory select(mapColumn(",
						"          gkey,",
						"          unit_id,",
						"          {DH TimeStamp} = time_stamp,",
						"          Decking_Type = decking_type,",
						"          to_pos_name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"aggregate2 filter(Decking_Type == 'Bump Intruder' || Decking_Type == 'Vessel Discharge' || Decking_Type == 'Vessel Discharge - Twin' || Decking_Type == 'XD Drop if Floating Refine' || Decking_Type == 'XD Refine Request' || Decking_Type == 'XD Rehandle Request') ~> filter1",
						"filter1 derive(Year_Month = (year((coalesce(toTimestamp(trim({DH TimeStamp}),'dd-MM-yyyy HH:mm'))))*100) + month((coalesce(toTimestamp(trim({DH TimeStamp}),'dd-MM-yyyy HH:mm')))),",
						"          Year_Week = (year((coalesce(toTimestamp(trim({DH TimeStamp}),'dd-MM-yyyy HH:mm'))))*100) +  weekOfYear((coalesce(toTimestamp(trim({DH TimeStamp}),'dd-MM-yyyy HH:mm')))),",
						"          {DH TimeStamp} = coalesce(toTimestamp(trim({DH TimeStamp}),'dd-MM-yyyy HH:mm'))) ~> derivedColumn2",
						"derivedColumn1, derivedColumn2 join({Unit Nbr} == unit_id,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 filter({From Location} != 'YARD' && unit_id != '' && not(isNull(unit_id)) && !startsWith(split({To Position Name}, \"-\")[3], 'CR') && {MH T_Put DateTime} > addDays({DH TimeStamp}, -15)) ~> filter2",
						"filter2 derive({MH TPut Less 4 hours} = add({MH T_Put DateTime} , -4*60*60*1000),",
						"          {DH TimeStamp Within 4 Hours} = iif(({DH TimeStamp} >= add({MH T_Put DateTime} , -4*60*60*1000)) && ({DH TimeStamp} <= {MH T_Put DateTime}), 1, 0),",
						"          {MH ToPosName Short} = split({To Position Name}, \"-\")[3],",
						"          {MH ToPosName Short 5Char} = iif(length(split({To Position Name}, \"-\")[3]) == 8, substring(split({To Position Name}, \"-\")[3], 0, 7), split({To Position Name}, \"-\")[3]),",
						"          {DH ToPosName Shorrt} = split(to_pos_name, \"-\")[3],",
						"          {DH ToPosName Short 5Char} = iif(length(split(to_pos_name, \"-\")[3]) == 8, substring(split(to_pos_name, \"-\")[3], 0, 7), split(to_pos_name, \"-\")[3])) ~> derivedColumn3",
						"derivedColumn3 filter({DH TimeStamp Within 4 Hours} == 1 && {DH ToPosName Short 5Char} != \"FLD\" && not(like({DH ToPosName Short 5Char}, \"Fail%\"))) ~> filter3",
						"filter3 aggregate(groupBy({Unit Nbr},",
						"          {Move Kind},",
						"          {Category Id},",
						"          {MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime},",
						"          {Put CHE Operator Id},",
						"          mve_gkey,",
						"          {Put CHE Id},",
						"          {Freight Kind Id}),",
						"     MaxDHTime = max({DH TimeStamp})) ~> aggregate1",
						"filter3, aggregate1 join(aggregate3@{Unit Nbr} == aggregate1@{Unit Nbr}",
						"     && aggregate3@{Move Kind} == aggregate1@{Move Kind}",
						"     && aggregate3@{Category Id} == aggregate1@{Category Id}",
						"     && derivedColumn3@{MH ToPosName Short 5Char} == aggregate1@{MH ToPosName Short 5Char}",
						"     && derivedColumn1@{MH T_Put DateTime} == aggregate1@{MH T_Put DateTime}",
						"     && aggregate3@{Put CHE Operator Id} == aggregate1@{Put CHE Operator Id}",
						"     && aggregate3@mve_gkey == aggregate1@mve_gkey",
						"     && aggregate3@{Put CHE Id} == aggregate1@{Put CHE Id}",
						"     && aggregate3@{Freight Kind Id} == aggregate1@{Freight Kind Id}",
						"     && {DH TimeStamp} == MaxDHTime,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join2",
						"join2 select(mapColumn(",
						"          {MH Event Type Id} = {Event Type Id},",
						"          {From Location},",
						"          {MH To Position Name} = {To Position Name},",
						"          ufv_gkey,",
						"          gkey,",
						"          unit_id,",
						"          {D H TimeStamp} = {DH TimeStamp},",
						"          {D H Decking Type} = Decking_Type,",
						"          {D H To Pos Name} = to_pos_name,",
						"          Year_Month = derivedColumn2@Year_Month,",
						"          Year_Week = derivedColumn2@Year_Week,",
						"          {MH TPut Less 4 hours},",
						"          {DH TimeStamp Within 4 Hours},",
						"          {MH ToPosName Short},",
						"          {MH ToPosName Short 5Char} = derivedColumn3@{MH ToPosName Short 5Char},",
						"          {DH ToPosName Shorrt},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr} = aggregate1@{Unit Nbr},",
						"          {MH Move Kind} = aggregate1@{Move Kind},",
						"          {Category Id} = aggregate1@{Category Id},",
						"          {MH ToPosName Short 5Char} = aggregate1@{MH ToPosName Short 5Char},",
						"          {MH T_Put DateTime} = aggregate1@{MH T_Put DateTime},",
						"          {MH Put CHE Operator Id} = aggregate1@{Put CHE Operator Id},",
						"          mve_gkey = aggregate1@mve_gkey,",
						"          {MH Put CHE Id} = aggregate1@{Put CHE Id},",
						"          {Freight Kind Id} = aggregate1@{Freight Kind Id},",
						"          MaxDHTime",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select3",
						"select3 derive({Location Match or Not} = iif(substring({MH ToPosName Short 5Char}, 1, 6) == substring({DH ToPosName Short 5Char}, 1, 6), 'Position Followed', 'Position Not Followed'),",
						"          Shift_Date = toDate({MH T_Put DateTime}),",
						"          {T Put Time} = MaxDHTime,",
						"          {T Put Hour} = hour(MaxDHTime),",
						"          {T Put Minute} = minute(MaxDHTime),",
						"          {T Put Second} = second(MaxDHTime)) ~> derivedColumn4",
						"derivedColumn6 select(mapColumn(",
						"          {D H Decking Type},",
						"          {MH ToPosName Short 5Char},",
						"          {DH ToPosName Short 5Char},",
						"          {MH Unit Nbr},",
						"          {MH Move Kind},",
						"          {Category Id},",
						"          {MH T_Put DateTime},",
						"          {MH Put CHE Operator Id},",
						"          mve_gkey,",
						"          {MH Put CHE Id},",
						"          {Freight Kind Id},",
						"          MaxDHTime,",
						"          {Location Match or Not},",
						"          operator_name = name,",
						"          Block_To_Block_Violation,",
						"          Same_Block_Violation,",
						"          Stack_Violation,",
						"          Date = Shift_Date,",
						"          Year_Month,",
						"          Year_Week",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select4",
						"derivedColumn4, XpsEcUser join(lower({MH Put CHE Operator Id}) == lower(user_id),",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join6",
						"select4 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select5",
						"select5 alterRow(upsertIf(true())) ~> alterRow1",
						"select6 alterRow(upsertIf(true())) ~> AlterRow2",
						"select7 alterRow(upsertIf(true())) ~> alterRow3",
						"derivedColumn2 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select6",
						"derivedColumn1 select(mapColumn(",
						"          each(match(true()),",
						"               regexReplace($$,' ','_') = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select7",
						"filter5 aggregate(groupBy(gkey),",
						"     each(match(name!='gkey'), $$ = first($$))) ~> aggregate2",
						"select1 filter(not(isNull(mve_gkey))) ~> filter4",
						"filter4 aggregate(groupBy(mve_gkey),",
						"     each(match(name!='mve_gkey'), $$ = first($$))) ~> aggregate3",
						"select2 filter(not(isNull(gkey))) ~> filter5",
						"join6 derive(Block_To_Block_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 3) != substring({DH ToPosName Short 5Char}, 1, 3), true(), false()),",
						"          Same_Block_Violation = iif( (substring({MH ToPosName Short 5Char}, 1, 3) == substring({DH ToPosName Short 5Char}, 1, 3)) && (substring({MH ToPosName Short 5Char}, 5, 2) == substring({DH ToPosName Short 5Char}, 5, 2)), false(), true()),",
						"          Stack_Violation = iif(substring({MH ToPosName Short 5Char}, 1, 6) != substring({DH ToPosName Short 5Char}, 1, 6), true(), false())) ~> derivedColumn6",
						"XpsEcUser select(mapColumn(",
						"          gkey,",
						"          user_id,",
						"          name,",
						"          yard",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select8",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'gold/violation',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> violation",
						"AlterRow2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'gold/decking',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> decking",
						"alterRow3 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delta',",
						"     fileSystem: 'teagtl',",
						"     folderPath: 'gold/move',",
						"     mergeSchema: false,",
						"     autoCompact: true,",
						"     optimizedWrite: true,",
						"     vacuum: 0,",
						"     deletable: true,",
						"     insertable: false,",
						"     updateable: true,",
						"     upsertable: true,",
						"     keys:['mve_gkey'],",
						"     umask: 0777,",
						"     preCommands: [],",
						"     postCommands: [],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> move"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/linkedService2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/WorkspaceSystemIdentity')]",
			"type": "Microsoft.Synapse/workspaces/credentials",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "ManagedIdentity",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Aarhus views')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "SELECT count([ecEventGkey])   \n --, min([EcEventTime])  ,  max(EcEventTime)\n FROM [dbo].[ecevents]\n where  [moveKind] = 'LOAD' and typeDescription='CMPL' \n \n SELECT count(distinct [unitIdName])   \n FROM [dbo].[ecevents]\n where  [moveKind] = 'LOAD' and typeDescription='CMPL' \n \n\n\nselect  Top 20 *   FROM [dbo].[ecevents] where  [moveKind] = 'LOAD'\n\n SELECT   count([ecEventGkey]) \n FROM [dbo].[ecevents] where [Event_Type_Id] IN ( 'UNIT_LOAD' ,'UNIT_PAYLOAD_LOAD' ) \n group by [Event_Type_Id]\n order by 2",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "aarhus",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Create View')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "create view MoveSrc\nAS\nSELECT\n    *\nFROM\n    OPENROWSET(\n        BULK 'https://powerbianalyticsdata.dfs.core.windows.net/ptpbianalyticsdata/RawData/MoveSrc/2021/202110/',\n        FORMAT='PARQUET'\n    ) AS [result]\n\nCREATE DATABASE \"PTP\"",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "PTP",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/External Table Creation')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "IF NOT EXISTS (SELECT * FROM sys.external_file_formats WHERE name = 'SynapseDeltaFormat') \n\tCREATE EXTERNAL FILE FORMAT [SynapseDeltaFormat] \n\tWITH ( FORMAT_TYPE = DELTA)\nGO\n\nIF NOT EXISTS (SELECT * FROM sys.external_data_sources WHERE name = 'congo_powerbianalyticsdata_dfs_core_windows_net') \n\tCREATE EXTERNAL DATA SOURCE [congo_powerbianalyticsdata_dfs_core_windows_net] \n\tWITH (\n\t\tLOCATION = 'abfss://congo@powerbianalyticsdata.dfs.core.windows.net' \n\t)\nGO\n\ndrop EXTERNAL table EcEvents_t\n\nCREATE EXTERNAL TABLE EcEvents_t (\n\t[ecEventGkey] bigint,\n\t[yardGkey] nvarchar(4000),\n\t[YardID] nvarchar(4000),\n\t[FcyID] nvarchar(4000),\n\t[cheKind] nvarchar(4000),\n\t[cheShortName] nvarchar(4000),\n\t[cheID] bigint,\n\t[EcEventTime] datetime2(7),\n\t[type] smallint,\n\t[subType] smallint,\n\t[typeDescription] nvarchar(4000),\n\t[fromCheIdName] nvarchar(4000),\n\t[ToCheIdName] nvarchar(4000),\n\t[unitIdName] nvarchar(4000),\n\t[powName] nvarchar(4000),\n\t[poolName] nvarchar(4000),\n\t[workQueue] nvarchar(4000),\n\t[travelDistance] nvarchar(4000),\n\t[moveKind] nvarchar(4000),\n\t[isTwinMove] nvarchar(4000),\n\t[startDistance] nvarchar(4000),\n\t[workAssignmentGkey] nvarchar(4000),\n\t[workAssignmentId] float,\n\t[unitReference] nvarchar(4000),\n\t[tranId] nvarchar(4000),\n\t[locType] nvarchar(4000),\n\t[locId] nvarchar(4000),\n\t[locSlot] nvarchar(4000),\n\t[opsPosId] nvarchar(4000),\n\t[unladenLoctype] nvarchar(4000),\n\t[unladenLocid] nvarchar(4000),\n\t[unladenLocSlot] nvarchar(4000),\n\t[ladenLoctype] nvarchar(4000),\n\t[ladenLocid] nvarchar(4000),\n\t[ladenLocSlot] nvarchar(4000),\n\t[lastEstMoveTime] nvarchar(4000),\n\t[waMovePurpose] nvarchar(4000),\n\t[waErrorDetails] nvarchar(4000)\n\t)\n\tWITH (\n\tLOCATION = 'silver/ecevents',\n\tDATA_SOURCE = [congo_powerbianalyticsdata_dfs_core_windows_net],\n\tFILE_FORMAT = [SynapseDeltaFormat]\n\t)\nGO\n\n\nSELECT TOP 100 * FROM dbo.EcEvents_t\nGO",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "Congo",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/External Table')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "IF NOT EXISTS (SELECT * FROM sys.external_file_formats WHERE name = 'SynapseParquetFormat') \n\tCREATE EXTERNAL FILE FORMAT [SynapseParquetFormat] \n\tWITH ( FORMAT_TYPE = PARQUET)\nGO\n\nIF NOT EXISTS (SELECT * FROM sys.external_data_sources WHERE name = 'pdports') \n\tCREATE EXTERNAL DATA SOURCE [pdports] \n\tWITH (\n\t\tLOCATION   = 'https://navispowerbidatastorage1.dfs.core.windows.net/pdports', \n\t)\nGo\n\nCREATE EXTERNAL TABLE EcEvents (\n\t[ecEventGkey] varchar(8000),\n\t[yardGkey] varchar(8000),\n\t[pKey] varchar(8000),\n\t[TimeStamp] varchar(8000),\n\t[eventType] varchar(8000),\n\t[CHE_ID] varchar(8000),\n\t[CHE_Name] varchar(8000),\n\t[Operator] varchar(8000),\n\t[eventSubType] varchar(8000),\n\t[eventTypeDescription] varchar(8000),\n\t[fromCheIdName] varchar(8000),\n\t[toCheIdName] varchar(8000),\n\t[unit] varchar(8000),\n\t[Pow] varchar(8000),\n\t[Pool] varchar(8000),\n\t[workQueue] varchar(8000),\n\t[travelDistance] varchar(8000),\n\t[moveKind] varchar(8000),\n\t[isTwin] varchar(8000),\n\t[startDistance] varchar(8000),\n\t[waGkey] varchar(8000),\n\t[workAssignment] varchar(8000),\n\t[unitRef] varchar(8000),\n\t[train_ID] varchar(8000),\n\t[locType] varchar(8000),\n\t[LocID] varchar(8000),\n\t[locSlot] varchar(8000),\n\t[opsPosID] varchar(8000),\n\t[unladenLocType] varchar(8000),\n\t[unladenLocID] varchar(8000),\n\t[unladenLocSlot] varchar(8000),\n\t[ladenLocType] varchar(8000),\n\t[ladenLocID] varchar(8000),\n\t[laden_LocSlot] varchar(8000),\n\t[lastEstMoveTime] varchar(8000),\n\t[waMovePurpose] varchar(8000),\n\t[waError_details] varchar(8000)\n\t)\n\tWITH (\n\tLOCATION = 'RawData/EcEvents/2021/202110/EcEvents_1.parquet',\n\tDATA_SOURCE = [ptpbianalyticsdata_powerbianalyticsdata_dfs_core_windows_net],\n\tFILE_FORMAT = [SynapseParquetFormat]\n\t)\nGO\n\nCREATE EXTERNAL TABLE EcEvents_Final  \nWITH (  \n       LOCATION = 'RawData/EcEvents/2021/202110/EcEvents_1.parquet',\n\tDATA_SOURCE = [ptpbianalyticsdata_powerbianalyticsdata_dfs_core_windows_net],\n\tFILE_FORMAT = [SynapseParquetFormat]  \n) AS SELECT DISTINCT(ecEventGkey),[yardGkey]\n,[TimeStamp]\n,[eventType]\n,[CHE_ID]\n,[CHE_Name]\n,[eventTypeDescription]\n,[unit]\n,[moveKind]\n,[locSlot]\n,[unladenLocSlot]\n,[laden_LocSlot] FROM dbo.EcEvents;  \n\nselec\n\nSELECT TOP 100 * FROM EcEvents_Final\nGO\n\n",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "pdports",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ITV')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "-- This is auto-generated code\ndrop view RTG_EcEvents\n\ncreate view RTG_EcEvents\nas \n\nSELECT\n DISTINCT Week\nFROM\n    OPENROWSET(\n        BULK 'PTP/silver/EcEvents',\n        FORMAT = 'DELTA',\n        data_source='ptpbianalyticsdata_powerbianalyticsdata_dfs_core_windows_net'\n    ) AS [result]\nWHERE [cheKind]='ITV'\nAND [moveKind] = 'DSCH'\nAND ([eventTypeDescription] = 'AYDR' or [eventTypeDescription] = 'CMPL')\nand [Week] in (47,46,45,44)\nGROUP by [ecEventGkey]\nhaving count(*)>1\n\nselect \n--top 10 *\nmax(([TimeStamp])),MIN((TimeStamp))\nfrom OPENROWSET(\n        BULK 'https://powerbianalyticsdata.dfs.core.windows.net/ptpbianalyticsdata/PTP/silver/EcEvents/Year=2021/Month=10/Week=43/*.parquet',\n        FORMAT = 'PARQUET'\n    ) AS [result]\nWHERE [cheKind]='RTG'",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "PTP",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Malta_EcEvents')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "IF NOT EXISTS (SELECT * FROM sys.external_file_formats WHERE name = 'SynapseParquetFormat') \n\tCREATE EXTERNAL FILE FORMAT [SynapseParquetFormat] \n\tWITH ( FORMAT_TYPE = PARQUET)\nGO\n\nIF NOT EXISTS (SELECT * FROM sys.external_data_sources WHERE name = 'malta_powerbianalyticsdata_dfs_core_windows_net') \n\tCREATE EXTERNAL DATA SOURCE [malta_powerbianalyticsdata_dfs_core_windows_net] \n\tWITH (\n\t\tLOCATION   = 'https://powerbianalyticsdata.dfs.core.windows.net/malta', \n\t)\nGo\n\nCREATE EXTERNAL TABLE EcEvents (\n\t[ecEventGkey] bigint,\n\t[yardGkey] varchar(8000),\n\t[YARDID] varchar(8000),\n\t[FCYID] varchar(8000),\n\t[cheKind] varchar(8000),\n\t[cheShortName] varchar(8000),\n\t[cheID] bigint,\n\t[EcEventTime] datetime2(7),\n\t[type] varchar(8000),\n\t[subType] varchar(8000),\n\t[typeDescription] varchar(8000),\n\t[fromCheIdName] varchar(8000),\n\t[ToCheIdName] varchar(8000),\n\t[unitIdName] varchar(8000),\n\t[powName] varchar(8000),\n\t[poolName] varchar(8000),\n\t[workQueue] varchar(8000),\n\t[travelDistance] varchar(8000),\n\t[moveKind] varchar(8000),\n\t[isTwinMove] varchar(8000),\n\t[startDistance] varchar(8000),\n\t[workAssignmentId] varchar(8000),\n\t[unitReference] varchar(8000),\n\t[tranId] varchar(8000),\n\t[locType] varchar(8000),\n\t[locId] varchar(8000),\n\t[locSlot] varchar(8000),\n\t[opsPosId] varchar(8000),\n\t[unladenLoctype] varchar(8000),\n\t[unladenLocid] varchar(8000),\n\t[unladenLocSlot] varchar(8000),\n\t[ladenLoctype] varchar(8000),\n\t[ladenLocid] varchar(8000),\n\t[ladenLocSlot] varchar(8000),\n\t[lastEstMoveTime] varchar(8000)\n\t)\n\tWITH (\n\tLOCATION = 'EcEvents/2021/202110/*.snappy.parquet',\n\tDATA_SOURCE = [malta_powerbianalyticsdata_dfs_core_windows_net],\n\tFILE_FORMAT = [SynapseParquetFormat]\n\t)\nGO\n\nSELECT TOP 100 * FROM EcEvents\nGO\n\n",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "Malta",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Malta_MoveSrc')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "IF NOT EXISTS (SELECT * FROM sys.external_file_formats WHERE name = 'SynapseParquetFormat') \n\tCREATE EXTERNAL FILE FORMAT [SynapseParquetFormat] \n\tWITH ( FORMAT_TYPE = PARQUET)\nGO\n\nIF NOT EXISTS (SELECT * FROM sys.external_data_sources WHERE name = 'malta_powerbianalyticsdata_dfs_core_windows_net') \n\tCREATE EXTERNAL DATA SOURCE [malta_powerbianalyticsdata_dfs_core_windows_net] \n\tWITH (\n\t\tLOCATION   = 'https://powerbianalyticsdata.dfs.core.windows.net/malta', \n\t)\nGo\n\nCREATE EXTERNAL TABLE MoveSrc (\n\t[UnitNbr] varchar(8000),\n\t[FacilityId] varchar(8000),\n\t[ComplexId] varchar(8000),\n\t[YardId] varchar(8000),\n\t[CarrierVisitKey] varchar(8000),\n\t[EventTypeId] varchar(8000),\n\t[MoveKind] varchar(8000),\n\t[FromLocation] varchar(8000),\n\t[ToLocation] varchar(8000),\n\t[FromPositionName] varchar(8000),\n\t[ToPositionName] varchar(8000),\n\t[CarryCHEOperatorId] varchar(8000),\n\t[FetchCHEOperatorId] varchar(8000),\n\t[PutCHEOperatorId] varchar(8000),\n\t[FetchCHEId] bigint,\n\t[FetchCHEKind] varchar(8000),\n\t[CarryCHEId] bigint,\n\t[CarryCHEKind] varchar(8000),\n\t[PutCHEId] bigint,\n\t[PutCHEKind] varchar(8000),\n\t[QCCHEId] bigint,\n\t[QCCHEKind] varchar(8000),\n\t[t_carry_complete] datetime2(7),\n\t[t_put] datetime2(7),\n\t[t_fetch] datetime2(7),\n\t[t_dispatch] varchar(8000),\n\t[t_discharge] datetime2(7),\n\t[t_carry_dispatch] varchar(8000),\n\t[t_carry_fetch_ready] varchar(8000),\n\t[t_carry_put_ready] varchar(8000),\n\t[dist_carry] varchar(8000),\n\t[dist_start] varchar(8000),\n\t[TwinFetch] varchar(8000),\n\t[TwinCarry] varchar(8000),\n\t[TwinPut] varchar(8000),\n\t[CategoryId] varchar(8000),\n\t[FreightKindId] varchar(8000),\n\t[to_pos_gkey] varchar(8000),\n\t[fm_pos_gkey] varchar(8000),\n\t[RestowReason] varchar(8000),\n\t[ContainerLineId] varchar(8000),\n\t[ContainerLineRole] varchar(8000),\n\t[pow] varchar(8000),\n\t[mve_gkey] varchar(8000),\n\t[ufv_gkey] varchar(8000),\n\t[BerthId] varchar(8000),\n\t[GoodsAndCtrWtKg] varchar(8000),\n\t[active_ufv] varchar(8000),\n\t[RequiresPowerFlag] varchar(8000),\n\t[OOGFlag] varchar(8000),\n\t[ShipperId] varchar(8000),\n\t[ConsigneeId] varchar(8000),\n\t[CommodityId] varchar(8000),\n\t[ATD] varchar(8000),\n\t[Rehandles] varchar(8000)\n\t)\n\tWITH (\n\tLOCATION = 'MoveSrc/2021/202110/*.snappy.parquet',\n\tDATA_SOURCE = [malta_powerbianalyticsdata_dfs_core_windows_net],\n\tFILE_FORMAT = [SynapseParquetFormat]\n\t)\nGO\n\nSELECT TOP 100 * FROM MoveSrc\nGO\n\n",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "Malta",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Moves_EcEvents View Creation Script')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "if db_name() = 'master'\n    throw 50001, 'This script cannot be executed in master database. Create new database and run the script there.', 1;\n\nif SERVERPROPERTY('EngineEdition') <> 11\n    throw 50001, 'This script must be executed on Azure Synapse - SQL serverless endpoint.', 1;\n\n\nIF NOT EXISTS (SELECT * FROM sys.external_file_formats WHERE name = 'SynapseDeltaFormat') \n\tCREATE EXTERNAL FILE FORMAT [SynapseDeltaFormat] \n\tWITH ( FORMAT_TYPE = DELTA)\nGO\n\nIF NOT EXISTS (SELECT * FROM sys.external_data_sources WHERE name = 'congo_powerbianalyticsdata_dfs_core_windows_net') \n\tCREATE EXTERNAL DATA SOURCE [congo_powerbianalyticsdata_dfs_core_windows_net] \n\tWITH (\n\t\tLOCATION   = 'https://powerbianalyticsdata.dfs.core.windows.net/congo', \n\t)\nGo\n\n\ncreate or alter view Moves\nas\nselect *\nfrom openrowset(\n           bulk 'silver/movesrc',\n           data_source = 'congo_powerbianalyticsdata_dfs_core_windows_net',\n           FORMAT = 'DELTA'\n    ) as moves\n\ncreate or alter view EcEvents\nas\nselect *\nfrom openrowset(\n           bulk 'silver/ecevents',\n           data_source = 'congo_powerbianalyticsdata_dfs_core_windows_net',\n           FORMAT = 'DELTA'\n    ) as ecevents\n\n\nSELECT TOP 100 * FROM Moves\n\nSELECT TOP 100 * FROM EcEvents\nGO\n\n",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "Congo",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PTP_RTG')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "-- This is auto-generated code\ncreate or alter view rtg_ecevents\nas\nselect max(Week)\nFROM\n    OPENROWSET(\n        BULK 'PTP/gold/rtg_ecevents_v2',\n        data_source = 'ptpbianalyticsdata_powerbianalyticsdata_dfs_core_windows_net',\n        FORMAT = 'DELTA'\n    ) AS [rtg_ecevents]\n\nselect top 10* from rtg_ecevents\n\ncreate or alter view rtg_workhours\nas\nselect *\nfrom openrowset(\n           bulk 'PTP/gold/rtg_workhours_v2',\n           data_source = 'ptpbianalyticsdata_powerbianalyticsdata_dfs_core_windows_net',\n           FORMAT = 'DELTA'\n    ) as rtg_workhours\n\nselect top 10 * from rtg_workhours\n",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "PTP",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/R1_NewEquipmentRunningHrs')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "summary WorkingHours",
				"content": {
					"query": "CREATE OR ALTER PROCEDURE ExecuteR1Query AS\nBEGIN\n    -- R1 Query Logic\n    WITH NextEvent AS (\n        SELECT x1.cheID,\n               x1.operatorName,\n               x1.typeDescription AS EcEventType,\n               x1.EcEventTime,\n               x1.ecEventGkey,\n               x1.Year,\n               x1.Month,\n               x1.Week,\n               x2.operatorName AS NextOperator,\n               x2.typeDescription AS NextEcEvent,\n               x2.EcEventTime AS NextEcEventEcEventTime,\n               CASE \n                   WHEN x1.typeDescription = x2.typeDescription THEN 'NO' \n                   ELSE 'YES'\n               END AS CorrectCycle,\n                (SELECT TOP 1 ime.t_put\n                FROM dbo.move_history ime\n                WHERE (ime.Fetch_CHE_Id = x1.cheID or ime.Put_CHE_Id = x1.cheID)\n                    AND ime.t_put < x2.EcEventTime\n                ORDER BY ime.t_put DESC)\n               AS LastMoveEventEcEventTime,\n\t\t\t   ROW_NUMBER() OVER (PARTITION BY x2.cheID ORDER BY x2.EcEventTime ASC) as row_num\n        FROM dbo.ecevents x1\n        LEFT JOIN dbo.ecevents x2\n\t\tON x1.cheID = x2.cheID\n        AND x2.EcEventTime > x1.EcEventTime\n        WHERE x1.typeDescription = 'LGON'\n        AND x2.typeDescription IN ('LGON', 'LGOF')\n\t\tAND x1.cheKind Like 'RTG%'\n    )\n    INSERT INTO dbo.EquipmentRunningHours\n    SELECT\n        ne.ecEventGkey,\n        ne.cheID,\n        ne.operatorName,\n        ne.EcEventType,\n        ne.EcEventTime,\n        ne.NextOperator,\n        ne.NextEcEvent,\n        ne.NextEcEventEcEventTime,\n        ne.CorrectCycle,\n        ne.LastMoveEventEcEventTime,\n        CASE\n            WHEN ne.CorrectCycle = 'YES' \n            THEN DATEDIFF(MINUTE, ne.EcEventTime, ne.NextEcEventEcEventTime) / 60.0\n            ELSE DATEDIFF(MINUTE, ne.EcEventTime, ne.LastMoveEventEcEventTime) / 60.0\n        END AS TotalWorkinghrs,\n        ne.Year,\n        ne.Month,\n        ne.Week\n    FROM NextEvent ne\n\tWHERE row_num = 1\n    ORDER BY ne.cheID, ne.EcEventTime;\nEND;\n\n\n",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "navispowerbidata2",
						"poolName": "navispowerbidata2"
					},
					"resultLimit": -1
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 1')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "create or alter view rehandle\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/rehandle',\n        data_source = 'mict',\n        FORMAT = 'DELTA'\n    ) AS [rehandle];\n\ncreate or alter view tt_productivity\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/tt_productivity',\n        data_source = 'vizingham',\n        FORMAT = 'DELTA'\n    ) AS [tt_productivity];\n\ncreate or Alter view dual_cycling\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/dual_cycling',\n        data_source = 'vizingham',\n        FORMAT = 'DELTA'\n    ) AS [dual_cycling];\n\ncreate or alter view yard_che_productivity\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/yard_che_productivity',\n        data_source = 'mict',\n        FORMAT = 'DELTA'\n    ) AS [yard_che_productivity];\n ",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "vizingham",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 10')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "SELECT\n[unitIdName]\n,[moveKind]\n,[cheID]\n,max([EcEventTime]) as time\n,[typeDescription]\n FROM [dbo].[ecevents]\n    WHERE Year = 2023 AND Month = 4 AND unitIdName = 'MNBU3858867'\n    AND moveKind in ('LOAD' , 'DSCH') AND typeDescription in ('DSPT' , 'DROP', 'EARW','EASH') AND cheKind = 'SC'\n    GROUP By unitIdName, moveKind, typeDescription, cheId\n    ORDER BY time desc",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "tauranga",
						"poolName": "Built-in"
					},
					"resultLimit": -1
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 11')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "SELECT [unitIdName]\n,[typeDescription]\n,[ecEventGkey]\n,[yardGkey]\n,[YardID]\n,[FcyID]\n,[Week]\n,[Total_cycle_time]\n,[Total_cycle_time_range]\n,[Date]\n,[moveKind]\n,[isTwinMove]\n,[startDistance]\n,[workAssignmentId]\n,[Year]\n,[Month]\n,[fromCheIdName]\n,[ToCheIdName]\n,[powName]\n,[poolName]\n,[workQueue]\n,[travelDistance]\n,[cheKind]\n,[cheName]\n,[cheID]\n,[EcEventTime]\n,[type]\n,[subType]\n FROM [dbo].[sc_full_time]\n ORDER BY Total_cycle_time ASC",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "tauranga",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 12')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "create or alter view ecevents\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'silver/ecevents',\n        data_source = 'mct',\n        FORMAT = 'DELTA'\n    ) AS [ecevents];\n\ncreate or alter view move_history\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'silver/moves',\n        data_source = 'mct',\n        FORMAT = 'DELTA'\n    ) AS [move_history];",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "mct",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 13')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "SELECT TOP (100) [D_H_Decking_Type]\n,[MH_ToPosName_Short_5Char]\n,[DH_ToPosName_Short_5Char]\n,[MH_Unit_Nbr]\n,[Same_Block_Violation]\n,[Stack_Violation]\n,[Location_Match_or_Not]\n,[Shift_Date]\n,[Week_of_Year]\n,[XPS_ECUser.name]\n,[Block_To_Block_Violation]\n FROM [dbo].[violation]\n order by Shift_Date desc",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "rio",
						"poolName": "Built-in"
					},
					"resultLimit": -1
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 14')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "SELECT count(*)\n FROM [dbo].[sc_dsch_time]\n where Week = 48",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "tauranga",
						"poolName": "Built-in"
					},
					"resultLimit": -1
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 15')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "SELECT [ecEventGkey]\n,[cheKind]\n,[cheName]\n,[Month]\n,[Week]\n,[lastEstMoveTime]\n,[Year]\n,[moveKind]\n,[unitIdName]\n,[cheID]\n,[EcEventTime]\n,[type]\n,[subType]\n,[typeDescription]\n FROM [dbo].[ecevents]\n Where Week = 46 and Year = 2024 and unitIdName = 'CGMU5140040'\n order by [EcEventTime] asc",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "tauranga",
						"poolName": "Built-in"
					},
					"resultLimit": -1
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 19')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "SELECT TOP (100) [unitIdName]\n,[GroupNumber]\n,[moveKind]\n,[UnladenDistance]\n,[LadenDistance]\n,[Timestamp]\n,[Date]\n,[Year]\n,[Month]\n,[Week]\n FROM [dbo].[sc_laden_unladen]",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "tauranga",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 2')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "CREATE OR ALTER VIEW vesselvisits_t\nAS SELECT *\nFROM  \n    OPENROWSET(\n        BULK 'silver/vessel_visits',\n        data_source='eurogatectb',\n        FORMAT='DELTA'\n    ) vesselvisits_t\n\n\n    select * from vesselvisits_t\n\n    CREATE EXTERNAL DATA SOURCE [eurogatectb] \n\tWITH (\n\t\tLOCATION   = 'https://navispowerbidatastorage1.dfs.core.windows.net/eurogatectb', \n\t)",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "eurogatectb",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 20')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "Select DISTINCT OperatorID from [dbo].[jobstep]\n Where OperatorID is not null\n and OperatorName is NULL\n\n select Top(10) EcEventTime from dbo.ecevents ORDER by EcEventTime DESC",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "dpw-peru",
						"poolName": "Built-in"
					},
					"resultLimit": -1
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 21')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "create view laden_unladen as select * FROM OPENROWSET( BULK 'gold/laden_unladen', data_source = 'mundra-ct02', FORMAT = 'DELTA' ) AS [laden_unladen];",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "mundra-ct02",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 22')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "SELECT [ecEventGkey]\n,[cheKind]\n,[CHE_Name]\n,[CHE_ID]\n,[eventTypeDescription]\n,[unit]\n,[pow]\n,[pool]\n,[workQueue]\n,[travelDistance]\n,[moveKind]\n,[startDistance]\n,[operator_name]\n,[EcEventTime]\n,[Year]\n,[Month]\n,[Week]\n FROM [dbo].[ecevents]\n Where Year=2025 AND Month=10 AND Week = 42 AND DAY(EcEventTime) >=11 and DAY(EcEventTime) <=14\n ORDER by [EcEventTime] ASC, [ecEventGkey] ASC;",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "mct",
						"poolName": "Built-in"
					},
					"resultLimit": -1
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 3')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "\nIF NOT EXISTS (SELECT * FROM sys.external_data_sources WHERE name = 'mundra-ct02')  \n\n    CREATE EXTERNAL DATA SOURCE [mundra-ct02]  \n\n    WITH ( \n\n        LOCATION   = 'https://navispowerbidatastorage2.dfs.core.windows.net/mundra-ct02',  \n\n    ) \n\nGo \nSELECT * FROM sys.external_data_sources\nDrop EXTERNAL DATA SOURCE [mundra_ct04] \n\ncreate or alter view laden_unladen\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/laden_unladen',\n        data_source = 'kattupalli',\n        FORMAT = 'DELTA'\n    ) AS [laden_unladen];\n\ncreate view itv_violation\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/itv_violation',\n        data_source = 'teagtl',\n        FORMAT = 'DELTA'\n    ) AS [itv_violation];",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "mundra-ct02",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 4')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "create or alter view itv_workhours\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/itv_workhours',\n        data_source = 'mnhpi',\n        FORMAT = 'DELTA'\n    ) AS [itv_workhours];\n\nIF NOT EXISTS (SELECT * FROM sys.external_data_sources WHERE name = 'cit_ivory_coast')  \n\n    CREATE EXTERNAL DATA SOURCE [cit_ivory_coast]  \n\n    WITH ( \n\n        LOCATION   = 'https://navispowerbidatastorage2.dfs.core.windows.net/cit-ivory-coast',  \n\n    ) \n\nGo \n\nDrop view stack_confirmity\n\ncreate or alter view stack_confirmity\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/stack_confirmity',\n        data_source = 'mundra-ct02',\n        FORMAT = 'DELTA'\n    ) AS [stack_confirmity];\n\ncreate or alter view section_conformity\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/section_conformity',\n        data_source = 'cit_ivory_coast',\n        FORMAT = 'DELTA'\n    ) AS [section_conformity];",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "mundra-ct02",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 5')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "IF NOT EXISTS (SELECT * FROM sys.external_data_sources WHERE name = 'rio')  \n\n    CREATE EXTERNAL DATA SOURCE [rio]  \n\n    WITH ( \n\n        LOCATION   = 'https://navispowerbidatastorage2.dfs.core.windows.net/rio',  \n\n    ) \n\nGo \n\n\n\ncreate or ALTER  view  laden_unladen\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/laden_unladen',\n        data_source = 'rio',\n        FORMAT = 'DELTA'\n    ) AS [laden_unladen];\n\n\ncreate or ALTER  view  move_history\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/move',\n        data_source = 'mundra_ct04',\n        FORMAT = 'DELTA'\n    ) AS [move_history];\n\ncreate or ALTER  view  decking_history\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/decking',\n        data_source = 'mundra_ct04',\n        FORMAT = 'DELTA'\n    ) AS [decking_history];\n\ncreate or ALTER  view  violation\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/violation',\n        data_source = 'mundra_ct04',\n        FORMAT = 'DELTA'\n    ) AS [violation];\n\ncreate or ALTER view dual_cycling\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/dual_cycling',\n        data_source = 'mundra_ct04',\n        FORMAT = 'DELTA'\n    ) AS [dual_cycling];\n\ncreate or ALTER view dual_cycling_yard_test\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/dual_cycling_yard_test',\n        data_source = 'sgtd',\n        FORMAT = 'DELTA'\n    ) AS [dual_cycling_yard_test];\n\ncreate view load_time_delta\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/load_time_delta',\n        data_source = 'rio',\n        FORMAT = 'DELTA'\n    ) AS [load_time_delta];\n\ncreate view dsch_time_delta\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/dsch_time_delta',\n        data_source = 'rio',\n        FORMAT = 'DELTA'\n    ) AS [dsch_time_delta];\n\ncreate or ALTER view jobstep\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/jobstep',\n        data_source = 'mict',\n        FORMAT = 'DELTA'\n    ) AS [jobstep];\n\ncreate view rehandle_test\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/rehandle_test',\n        data_source = 'sgtd',\n        FORMAT = 'DELTA'\n    ) AS [rehandle_test];\n\ncreate view tt_productivity_test\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/tt_productivity_test',\n        data_source = 'sgtd',\n        FORMAT = 'DELTA'\n    ) AS [tt_productivity_test];\n\ncreate view section_confirmity\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/section_conformity',\n        data_source = 'agct',\n        FORMAT = 'DELTA'\n    ) AS [section_confirmity];",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "mict",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 6')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "SELECT TOP (100) [mve_gkey]\n,[Unit_Nbr]\n,[Yard_Id]\n,[Event_Type_Id]\n,[Move_Kind]\n,[t_carry_complete]\n,[Year]\n,[Month]\n,[Week]\n,[Date]\n,[Year_Week]\n,[t_put]\n,[Category_Id]\n,[Freight_Kind_Id]\n,[pow]\n,[active_ufv]\n,[Rehandles]\n FROM [dbo].[rehandle]",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "mnhpi",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 7')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "SELECT OBJECT_DEFINITION(OBJECT_ID('[dbo].[stack_confirmity]')) AS ViewDefinition;\n\nDrop VIEW dbo.rtg_ecevents\nDrop VIEW dbo.rtg_workhours\n\ncreate or ALTER view rtg_ecevents\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/rtg_ecevents',\n        data_source = 'mict',\n        FORMAT = 'DELTA'\n    ) AS [rtg_ecevents];\n\ncreate or ALTER view rtg_workhours\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/rtg_workhours',\n        data_source = 'mict',\n        FORMAT = 'DELTA'\n    ) AS [rtg_workhours];",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "mict",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 8')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "\nSelect *\n FROM [dbo].[violation]\n WHERE Block_To_Block_Violation = 'False'\n And Same_Block_Violation = 'False'\n And Stack_Violation = 'False'\n And Location_Match_or_Not = 'Position Not Followed'",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "mict",
						"poolName": "Built-in"
					},
					"resultLimit": -1
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 9')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "SELECT [Fetch_CHE_Id]\n,[Put_CHE_Id]\n,[CarryCompleteDate]\n,[First_Lift]\n,[Last_Lift]\n,[Move_Count]\n,[WorkTime]\n,[Year]\n,[Month]\n,[Week]\n FROM [dbo].[yard_che_productivity]\n WHERE (Fetch_CHE_Id = 47\n or Put_CHE_Id = 47)\n AND DATEPART(\"day\",CarryCompleteDate) = 1 And Year= 2022 and Month = 10\n order by [CarryCompleteDate]",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "mict",
						"poolName": "Built-in"
					},
					"resultLimit": -1
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/eurogatectb')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "-- This is auto-generated code \ncreate or alter view  rehandle_rdsc_export\nas\nselect *\nFROM\n    OPENROWSET(\n        BULK 'gold/rehandle_rdsc_export',\n        data_source = 'gpa',\n        FORMAT = 'DELTA'\n    ) AS [rehandle_rdsc_export]   \nwhere t_put is NULL\nand MONTH(t_put)=09\nand DAY(t_put)=25\norder by t_put DESC\n    GROUP by ecEventGkey\n    having count(*)>1\n\nselect   count(mve_gkey),  Requires_Power_Flag, Year,Month, Week\n from moves where Move_Kind='RECV' and Category_Id='EXPRT' and Freight_Kind_Id='FCL'\n group by  Requires_Power_Flag, Year,Month, Week\n order by Week\n\nselect count(mve_gkey),count(DISTINCT mve_gkey)  from rehandle_export where Year=2023 and Move_Kind='LOAD'\n\nselect top 5 *  from moves where move_kind='RDSC' and year=2022\nselect top 20 *  from rehandle_export where Unit_Nbr='BSIU9921765' order by IB_mve_gkey,RNumber  --APHU6563570  AMFU8783903 APHU6563570 ACLU9729899\nselect * from moves where Unit_Nbr ='MRKU7614004' and Category_Id='EXPRT' order by t_put --BSIU9921765 , GMCU3062480 ,'UACU5213095'  GAOU6031329\nselect * from ecevents where unitIdName='MRKU7614004'   order by EcEventTime \nselect * from rehandle_rdsc_export where Unit_Nbr ='ACSU2965389'\norder by Unit_Nbr ,t_put\n-- create view without Year, Month, Week fields to get around nvarchar to int conversion\ncreate or alter view laden_unladen\nAS \nSELECt [Yard_Id]\n,[Carrier_Visit_Key]\n,[Event_Type_Id]\n,[Move_Kind]\n,[From_Location]\n,[To_Location]\n,[Carry_CHE_Id]\n,[Carry_CHE_Kind]\n,[Unladen]\n,[Laden]\n,[Carrier_Name]\n,[Unit_Nbr]\n,[mve_gkey]\n,[Put_CHE_Id]\n,[Put_CHE_Kind]\n,[Fetch_CHE_Id]\n,[Fetch_CHE_Kind]\n,[t_fetch]\n,[t_dispatch]\n,[t_discharge]\n,[pow]\n,[From_Position_Name]\n,[To_Position_Name]\n,[QC_CHE_Id]\n,[QC_CHE_Kind]\n,[t_carry_complete]\n,[t_put]\nFROM\n    OPENROWSET(\n        BULK 'gold/laden_unladen',\n        data_source = 'valencia',\n        FORMAT = 'DELTA'\n    ) AS [laden_unladen] \n\nselect TOP 3 t_put\nFROM\n    OPENROWSET(\n        BULK 'silver/moves',\n        data_source = 'valencia',\n        FORMAT = 'DELTA'\n    ) AS [moves]\norder by  t_put  DESC    \n\nselect TOP 3  EcEventTime\nFROM\n    OPENROWSET(\n        BULK 'silver/ecevents',\n        data_source = 'valencia',\n        FORMAT = 'DELTA'\n    ) AS [ecevents]\norder by  EcEventTime DESC\n\nselect  DISTINCT cheID,cheName,FcyID\nFROM\n    OPENROWSET(\n        BULK 'silver/ecevents',\n        data_source = 'gpa',\n        FORMAT = 'DELTA'\n    ) AS [ecevents] \n    where cheKind='RTG' order by 3,1 \n\nselect  count(*), ecEventGkey\nFROM\n    OPENROWSET(\n        BULK 'silver/ecevents',\n        data_source = 'gpa',\n        FORMAT = 'DELTA'\n    ) AS [ecevents]\ngroup by  ecEventGkey having count(*) > 1   \n\nselect count(*)  from \n  OPENROWSET(\n        BULK 'silver/cranedelays',\n        data_source = 'valencia',\n        FORMAT = 'DELTA'\n    ) AS [cranedelays]\n\nselect * from moves\nwhere week=31\nwhere ecEventGkey<>587\nwhere year=2022 and Month=8\n--where mve_gkey=2147467606\nwhere ecEventGkey=2177318184\nwhere year=2021\nand month =9\n--order by year, month\n\nselect count(*), week,year from truckturntime group by week,year order by year, week\n\nselect top 10 * from  truckturntime  where carrier_Visit_Key IN (3076046590,3076048349, 3076056090, 2940853576,3065675895 )  order by Trk_Yard_Entered_Time\n\n    select distinct cheName from ecevents\n    where cheKind = 'RTG'\n    where unitIdName='HLXU8312630'\n\nselect distinct month(ATA) from vesselvisits    where year(ATA)=2022\n\nselect Top 10* from  qc_idle_time a\nselect  count(*) , month, IDle_time_Range  from  qc_idle_time where month in (11,10) group by month , IDle_time_Range  order by 2 ,3\n\nselect DISTINCT LEN(From_Position_Name) from moves\nwhere event_type_id='UNIT_YARD_SHIFT'\ncreate or alter view moves\nas\nselect *\nfrom openrowset(\n           bulk 'silver/moves',\n           data_source = 'eurogatectb_powerbianalyticsdata_dfs_core_windows_net',\n           FORMAT = 'DELTA'\n    ) as moves",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "gpa",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/test')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "create or alter view vessel_visits\n AS \nselect *\nfrom \n    OPENROWSET(\n        BULK 'silver/vessel_visits',\n        data_source = 'arica_powerbianalyticsdata_dfs_core_windows_net',\n        FORMAT = 'DELTA'\n    ) AS [vessel_visits]\nGROUP by carrier_visit_key\nhaving count(*)>1\n\n    where carrier_visit_key=null\n    order by date_of_gang\nwhere \nEcEventTime>'2021-07-01T00:00:00.0000000'\n\n--and \nWeek=49\nand event_type_id='UNIT_DISCH'\n\n    group by ecEventGkey\n    having count(*)>1\n\n\n    where year=2022 and Week=1\n    where move_kind<>'DSCH' and EVENT_TYPE_ID='UNIT_LOAD'\n    \nselect mve_gkey,count(*) from dbo.moves\ngroup by mve_gkey\nhaving count(*)>1\n2396477\n\n\nDual Cycle\n2021-11-16T12:59:47.0000000\n2021-01-19T03:38:45.0000000",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "ARICA",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/yard_che_mict')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "SELECT SUM(WorkTime) as WorkTime, SUM(MoveCount) as MoveCount, sum([IdleTimeFL]) as IdleTimeFL\n, sum([RTGIdleTime]) as RTGIdleTime, SUM(WorkTime)/ SUM(MoveCount) as yard_che_prod, Date\n FROM [dbo].[rtg_ecevents]\n    WHERE Year = 2024 and Month = 6\n Group by [Year] ,[Month], Date\n ORDER BY [Year] ,[Month], Date\n ",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "mict",
						"poolName": "Built-in"
					},
					"resultLimit": -1
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/CMSA_ECEVENTS')]",
			"type": "Microsoft.Synapse/workspaces/notebooks",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"nbformat": 4,
				"nbformat_minor": 2,
				"bigDataPool": {
					"referenceName": "pbixpool",
					"type": "BigDataPoolReference"
				},
				"sessionProperties": {
					"driverMemory": "28g",
					"driverCores": 4,
					"executorMemory": "28g",
					"executorCores": 4,
					"numExecutors": 2,
					"conf": {
						"spark.dynamicAllocation.enabled": "false",
						"spark.dynamicAllocation.minExecutors": "2",
						"spark.dynamicAllocation.maxExecutors": "2",
						"spark.autotune.trackingId": "fdced68f-0c16-41c0-a65d-dd94c4a54c1c"
					}
				},
				"metadata": {
					"saveOutput": true,
					"enableDebugMode": false,
					"kernelspec": {
						"name": "synapse_pyspark",
						"display_name": "Synapse PySpark"
					},
					"language_info": {
						"name": "python"
					},
					"a365ComputeOptions": {
						"id": "/subscriptions/095c0f82-6a29-4db3-9f53-6808ff55fa13/resourceGroups/NavisBIAnalyticsPowerBiData2/providers/Microsoft.Synapse/workspaces/navispowerbidata2/bigDataPools/pbixpool",
						"name": "pbixpool",
						"type": "Spark",
						"endpoint": "https://navispowerbidata2.dev.azuresynapse.net/livyApi/versions/2019-11-01-preview/sparkPools/pbixpool",
						"auth": {
							"type": "AAD",
							"authResource": "https://dev.azuresynapse.net"
						},
						"sparkVersion": "3.4",
						"nodeCount": 10,
						"cores": 8,
						"memory": 56
					},
					"sessionKeepAliveTimeout": 30
				},
				"cells": [
					{
						"cell_type": "code",
						"source": [
							"from pyspark.sql import SparkSession\n",
							"from pyspark.sql.functions import col, year, month, weekofyear, to_timestamp, row_number, lit\n",
							"from pyspark.sql.window import Window\n",
							"from delta.tables import DeltaTable"
						],
						"outputs": [],
						"execution_count": 24
					},
					{
						"cell_type": "code",
						"source": [
							"# === Spark session ===\n",
							"spark = SparkSession.builder.appName(\"ECEVENTS_Transform\").getOrCreate()\n",
							"\n",
							"spark.conf.set(\"spark.sql.legacy.timeParserPolicy\", \"LEGACY\")\n",
							"spark.conf.set(\"spark.databricks.delta.schema.autoMerge.enabled\", \"true\")\n",
							"\n",
							"\n",
							"# Configure storage credentials (if needed)\n",
							"# spark.conf.set(\n",
							"#     \"fs.azure.account.key.navispowerbidatastorage2.dfs.core.windows.net\",\n",
							"#     \"<storage-account-key>\"\n",
							"# )\n",
							"\n",
							"# Paths\n",
							"input_path   = \"abfss://cmsa@navispowerbidatastorage2.dfs.core.windows.net/bronze/ecevents/load/\"\n",
							"output_path  = \"abfss://cmsa@navispowerbidatastorage2.dfs.core.windows.net/silver/ecevents/\"\n",
							"archive_path = \"abfss://cmsa@navispowerbidatastorage2.dfs.core.windows.net/bronze/ecevents/archive/\"\n",
							"\n",
							"# Updated headers\n",
							"headers = [\"ecEventGkey\",\"yardGkey\",\"YardID\",\"FcyID\",\"cheKind\",\"CHE_Name\",\"CHE_ID\",\"TimeStamp\",\"eventType\",\"eventSubType\",\"eventTypeDescription\",\"fromCheIdName\",\"ToCheIdName\",\"unit\",\"pow\",\"pool\",\"workQueue\",\"travelDistance\",\"moveKind\",\"isTwin\",\"startDistance\",\"unitRef\",\"tran_ID\",\"locType\",\"locID\",\"locSlot\",\"opsPosID\",\"unladenLoctype\",\"unladenLocID\",\"unladenLocSlot\",\"ladenLoctype\",\"ladenLocID\",\"laden_LocSlot\",\"operator_name\"]\n",
							"\n",
							"# Read CSV without header\n",
							"df = spark.read.option(\"header\", \"false\").option(\"delimiter\", \",\").csv(input_path)"
						],
						"outputs": [],
						"execution_count": 25
					},
					{
						"cell_type": "code",
						"source": [
							"len(headers)"
						],
						"outputs": [],
						"execution_count": 26
					},
					{
						"cell_type": "code",
						"metadata": {
							"collapsed": false
						},
						"source": [
							"len(df.columns)"
						],
						"outputs": [],
						"execution_count": 27
					},
					{
						"cell_type": "code",
						"metadata": {
							"collapsed": false
						},
						"source": [
							"display(df)"
						],
						"outputs": [],
						"execution_count": 28
					},
					{
						"cell_type": "code",
						"source": [
							"# Apply updated headers\n",
							"df = df.toDF(*headers)\n",
							"\n",
							"# Add constant client_id\n",
							"df = df.withColumn(\"client_id\", lit(\"CMSA\"))\n",
							"\n",
							"# Convert TimeStamp to proper timestamp\n",
							"df = df.withColumn(\"EcEventTime\", to_timestamp(col(\"TimeStamp\"), \"dd-MM-yyyy HH:mm:ss\"))\n",
							"\n",
							"# Derive date parts\n",
							"df = df.withColumn(\"Year\", year(col(\"EcEventTime\"))) \\\n",
							"       .withColumn(\"Month\", month(col(\"EcEventTime\"))) \\\n",
							"       .withColumn(\"Week\", weekofyear(col(\"EcEventTime\")))\n",
							"\n",
							"# Window to get LAST row by EcEventTime\n",
							"windowSpec = Window.partitionBy(\"ecEventGkey\").orderBy(col(\"EcEventTime\").desc())\n",
							"\n",
							"df = df.withColumn(\"rn\", row_number().over(windowSpec)) \\\n",
							"            .filter(col(\"rn\") == 1) \\\n",
							"            .drop(\"rn\")\n",
							"\n",
							"# Write to Delta\n",
							"# df_last.write.format(\"delta\").mode(\"overwrite\").save(output_path)\n",
							"\n",
							""
						],
						"outputs": [],
						"execution_count": 29
					},
					{
						"cell_type": "code",
						"source": [
							"\n",
							"# Check if Delta table already exists at the path\n",
							"if DeltaTable.isDeltaTable(spark, output_path):\n",
							"    delta_table = DeltaTable.forPath(spark, output_path)\n",
							"\n",
							"    (\n",
							"        delta_table.alias(\"t\")\n",
							"        .merge(\n",
							"            df.alias(\"s\"),\n",
							"            \"t.ecEventGkey = s.ecEventGkey\"  # match condition\n",
							"        )\n",
							"        .whenMatchedUpdateAll()  # update all columns on match\n",
							"        .whenNotMatchedInsertAll()  # insert new row when not matched\n",
							"        .execute()\n",
							"    )\n",
							"else:\n",
							"    # First-time write\n",
							"    (\n",
							"        df.write\n",
							"        .format(\"delta\")\n",
							"        .mode(\"overwrite\")\n",
							"        .save(output_path)\n",
							"    )\n",
							"\n",
							"# Move processed files to dated archive\n",
							"# input_files = dbutils.fs.ls(input_path)\n",
							"# for file_info in input_files:\n",
							"#     file_name = file_info.name\n",
							"#     dbutils.fs.mv(file_info.path, archive_path + file_name)\n",
							"\n",
							"print(\" Transformation complete with updated headers, client_id added, and files archived.\")\n",
							""
						],
						"outputs": [],
						"execution_count": 30
					},
					{
						"cell_type": "code",
						"source": [
							""
						],
						"outputs": [],
						"execution_count": null
					}
				]
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/CMSA_MOVES')]",
			"type": "Microsoft.Synapse/workspaces/notebooks",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"nbformat": 4,
				"nbformat_minor": 2,
				"bigDataPool": {
					"referenceName": "pbixpool",
					"type": "BigDataPoolReference"
				},
				"sessionProperties": {
					"driverMemory": "28g",
					"driverCores": 4,
					"executorMemory": "28g",
					"executorCores": 4,
					"numExecutors": 2,
					"conf": {
						"spark.dynamicAllocation.enabled": "false",
						"spark.dynamicAllocation.minExecutors": "2",
						"spark.dynamicAllocation.maxExecutors": "2",
						"spark.autotune.trackingId": "4a81a548-9c44-4cf2-a677-65474cd612e2"
					}
				},
				"metadata": {
					"saveOutput": true,
					"enableDebugMode": false,
					"kernelspec": {
						"name": "synapse_pyspark",
						"display_name": "Synapse PySpark"
					},
					"language_info": {
						"name": "python"
					},
					"a365ComputeOptions": {
						"id": "/subscriptions/095c0f82-6a29-4db3-9f53-6808ff55fa13/resourceGroups/NavisBIAnalyticsPowerBiData2/providers/Microsoft.Synapse/workspaces/navispowerbidata2/bigDataPools/pbixpool",
						"name": "pbixpool",
						"type": "Spark",
						"endpoint": "https://navispowerbidata2.dev.azuresynapse.net/livyApi/versions/2019-11-01-preview/sparkPools/pbixpool",
						"auth": {
							"type": "AAD",
							"authResource": "https://dev.azuresynapse.net"
						},
						"sparkVersion": "3.4",
						"nodeCount": 10,
						"cores": 8,
						"memory": 56
					},
					"sessionKeepAliveTimeout": 30
				},
				"cells": [
					{
						"cell_type": "code",
						"source": [
							"from pyspark.sql import SparkSession\n",
							"from pyspark.sql.functions import col, year, month, weekofyear, to_timestamp, row_number\n",
							"from pyspark.sql.window import Window\n",
							"\n",
							"spark.conf.set(\"spark.sql.legacy.timeParserPolicy\", \"LEGACY\")"
						],
						"outputs": [],
						"execution_count": 44
					},
					{
						"cell_type": "code",
						"source": [
							"from pyspark.sql import functions as F\n",
							"from pyspark.sql import SparkSession, Window\n",
							"\n",
							"spark = SparkSession.builder.getOrCreate()\n",
							"\n",
							"# Paths\n",
							"input_path   = \"abfss://cmsa@navispowerbidatastorage2.dfs.core.windows.net/bronze/moves/load/\"\n",
							"output_path  = \"abfss://cmsa@navispowerbidatastorage2.dfs.core.windows.net/silver/moves/\"\n",
							"archive_path = \"abfss://cmsa@navispowerbidatastorage2.dfs.core.windows.net/bronze/moves/archive/\"\n",
							"\n",
							"\n",
							"# Load CSVs (header = True/False depending on files)\n",
							"df_all = (\n",
							"    spark.read\n",
							"    .option(\"header\", True)  # Will be False if no header in CSV\n",
							"    .option(\"inferSchema\", True)\n",
							"    .csv(input_path)\n",
							")\n",
							"\n",
							"# Force header names (because some files have no headers)\n",
							"new_headers = [\n",
							"    \"Unit Nbr\",\"Facility Id\",\"Complex Id\",\"Yard Id\",\"Carrier Visit Key\",\"Event Type Id\",\"Move Kind\",\n",
							"    \"From Location\",\"To Location\",\"From Position Name\",\"To Position Name\",\"Carry CHE Operator Id\",\n",
							"    \"Fetch CHE Operator Id\",\"Put CHE Operator Id\",\"Fetch CHE Id\",\"Fetch CHE Kind\",\"Carry CHE Id\",\n",
							"    \"Carry CHE Kind\",\"Put CHE Id\",\"Put CHE Kind\",\"QC CHE Id\",\"QC CHE Kind\",\"t_carry_complete\",\"t_put\",\n",
							"    \"t_fetch\",\"t_dispatch\",\"t_discharge\",\"t_carry_dispatch\",\"t_carry_fetch_ready\",\"t_carry_put_ready\",\n",
							"    \"dist_carry\",\"dist_start\",\"Twin Fetch\",\"Twin Carry\",\"Twin Put\",\"Category Id\",\"Freight Kind Id\",\n",
							"    \"to_pos_gkey\",\"fm_pos_gkey\",\"Restow Reason\",\"Container Line Id\",\"Container Line Role\",\"pow\",\n",
							"    \"mve_gkey\",\"ufv_gkey\",\"Berth Id\",\"Goods And Ctr Wt Kg\",\"active_ufv\",\"Requires Power Flag\",\"OOG Flag\",\n",
							"    \"Shipper Id\",\"Consignee Id\",\"Commodity Id\",\"ATA\",\"ATD\",\"Rehandles\"\n",
							"]\n",
							"\n",
							"df_all = df_all.toDF(*new_headers)"
						],
						"outputs": [],
						"execution_count": 45
					},
					{
						"cell_type": "code",
						"source": [
							"# Convert timestamp columns\n",
							"timestamp_cols = [\n",
							"    \"t_carry_complete\",\"t_put\",\"t_fetch\",\"t_dispatch\",\"t_discharge\",\n",
							"    \"t_carry_dispatch\",\"t_carry_fetch_ready\",\"t_carry_put_ready\",\"ATA\",\"ATD\"\n",
							"]\n",
							"for col_name in timestamp_cols:\n",
							"    df_all = df_all.withColumn(col_name, F.to_timestamp(col_name, \"yyyy-MM-dd HH:mm:ss\"))\n",
							"\n",
							"# Derive Year, Month, Week from t_put\n",
							"df_all = (\n",
							"    df_all.withColumn(\"Year\", F.year(\"t_put\"))\n",
							"          .withColumn(\"Month\", F.month(\"t_put\"))\n",
							"          .withColumn(\"Week\", F.weekofyear(\"t_put\"))\n",
							")\n",
							"\n",
							"# Latest record per mve_gkey\n",
							"window_spec = Window.partitionBy(\"mve_gkey\").orderBy(F.col(\"t_put\").desc())\n",
							"df_latest = df_all.withColumn(\"rn\", F.row_number().over(window_spec)).filter(F.col(\"rn\") == 1).drop(\"rn\")\n",
							"\n",
							"# Replace spaces with underscores for Delta\n",
							"for col_name in df_latest.columns:\n",
							"    df_latest = df_latest.withColumnRenamed(col_name, col_name.replace(\" \", \"_\"))"
						],
						"outputs": [],
						"execution_count": 46
					},
					{
						"cell_type": "code",
						"source": [
							"# from delta.tables import DeltaTable\n",
							"\n",
							"# # Path to your delta table\n",
							"# output_path = \"abfss://cmsa@navispowerbidatastorage2.dfs.core.windows.net/silver/moves\"\n",
							"\n",
							"# # Load table\n",
							"# delta_tbl = DeltaTable.forPath(spark, output_path)\n",
							"\n",
							"# # Current dataframe\n",
							"# df = delta_tbl.toDF()\n",
							"\n",
							"# # Drop the unwanted columns if they exist\n",
							"# cols_to_drop = {\"Hazardous_Flag\", \"Service_Id\"}\n",
							"# df_clean = df.drop(*[c for c in cols_to_drop if c in df.columns])\n",
							"\n",
							"# # Overwrite table with cleaned schema\n",
							"# df_clean.write.format(\"delta\").mode(\"overwrite\").option(\"overwriteSchema\", \"true\").save(output_path)\n",
							"\n",
							"# print(\" Dropped missing cols and rewrote Delta table with clean schema.\")\n",
							"\n",
							"# # Get target schema\n",
							"# silver_delta = DeltaTable.forPath(spark, output_path)\n",
							"# target_cols = [f.name for f in silver_delta.toDF().schema.fields]\n",
							"# source_cols = df_latest.columns\n",
							"# miss_col = []\n",
							"# # Add missing cols with null\n",
							"# for col in target_cols:\n",
							"#     if col not in source_cols:\n",
							"#         miss_col.append(col)\n",
							"# print(miss_col)"
						],
						"outputs": [],
						"execution_count": 52
					},
					{
						"cell_type": "code",
						"metadata": {
							"collapsed": false
						},
						"source": [
							"display(df_latest)"
						],
						"outputs": [],
						"execution_count": 22
					},
					{
						"cell_type": "code",
						"source": [
							"from delta.tables import DeltaTable\n",
							"\n",
							"if DeltaTable.isDeltaTable(spark, output_path):\n",
							"    silver_delta = DeltaTable.forPath(spark, output_path)\n",
							"    \n",
							"    (\n",
							"        silver_delta.alias(\"t\")\n",
							"        .merge(\n",
							"            df_latest.alias(\"s\"),\n",
							"            \"t.mve_gkey = s.mve_gkey\"\n",
							"        )\n",
							"        .whenMatchedUpdateAll()\n",
							"        .whenNotMatchedInsertAll()\n",
							"        .execute()\n",
							"    )\n",
							"    print(\"Merged\")\n",
							"else:\n",
							"    print(\"Overwriting...\")\n",
							"    # df_latest.write.format(\"delta\").mode(\"overwrite\").save(output_path)\n",
							""
						],
						"outputs": [],
						"execution_count": 55
					},
					{
						"cell_type": "code",
						"source": [
							""
						],
						"outputs": [],
						"execution_count": null
					}
				]
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/checkpoint_restore')]",
			"type": "Microsoft.Synapse/workspaces/notebooks",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"nbformat": 4,
				"nbformat_minor": 2,
				"bigDataPool": {
					"referenceName": "pbixpool",
					"type": "BigDataPoolReference"
				},
				"sessionProperties": {
					"driverMemory": "56g",
					"driverCores": 8,
					"executorMemory": "56g",
					"executorCores": 8,
					"numExecutors": 1,
					"conf": {
						"spark.dynamicAllocation.enabled": "true",
						"spark.dynamicAllocation.minExecutors": "1",
						"spark.dynamicAllocation.maxExecutors": "8",
						"spark.autotune.trackingId": "4433cfd2-699b-4b7e-9f25-a5c16d6a0e00"
					}
				},
				"metadata": {
					"saveOutput": true,
					"enableDebugMode": false,
					"kernelspec": {
						"name": "synapse_pyspark",
						"display_name": "Synapse PySpark"
					},
					"language_info": {
						"name": "python"
					},
					"a365ComputeOptions": {
						"id": "/subscriptions/095c0f82-6a29-4db3-9f53-6808ff55fa13/resourceGroups/NavisBIAnalyticsPowerBiData2/providers/Microsoft.Synapse/workspaces/navispowerbidata2/bigDataPools/pbixpool",
						"name": "pbixpool",
						"type": "Spark",
						"endpoint": "https://navispowerbidata2.dev.azuresynapse.net/livyApi/versions/2019-11-01-preview/sparkPools/pbixpool",
						"auth": {
							"type": "AAD",
							"authResource": "https://dev.azuresynapse.net"
						},
						"sparkVersion": "3.4",
						"nodeCount": 10,
						"cores": 8,
						"memory": 56
					},
					"sessionKeepAliveTimeout": 30
				},
				"cells": [
					{
						"cell_type": "code",
						"source": [
							"from delta.tables import DeltaTable"
						],
						"outputs": [],
						"execution_count": 2
					},
					{
						"cell_type": "code",
						"source": [
							"# Read Delta-tracked data (from current _delta_log)\n",
							"# delta_df = spark.read.format(\"delta\").load(\"abfss://sgtd@navispowerbidata2.dfs.core.windows.net/sgtd/silver/ecevents\")\n",
							"delta_df = spark.read.format(\"delta\").load(\"abfss://sgtd@navispowerbidatastorage2.dfs.core.windows.net/silver/moves\")"
						],
						"outputs": [],
						"execution_count": 38
					},
					{
						"cell_type": "code",
						"source": [
							"# Read all Parquet files manually (includes everything even if not in _delta_log)\n",
							"raw_df = spark.read.parquet(\"abfss://sgtd@navispowerbidatastorage2.dfs.core.windows.net/silver/moves\")"
						],
						"outputs": [],
						"execution_count": 39
					},
					{
						"cell_type": "code",
						"source": [
							"# Compare row counts\n",
							"print(\"Delta:\", delta_df.count(), \"Raw:\", raw_df.count())"
						],
						"outputs": [],
						"execution_count": 40
					},
					{
						"cell_type": "code",
						"source": [
							"merged_df = raw_df.unionByName(delta_df).dropDuplicates([\"mve_gkey\"])\n",
							"print(merged_df.count())"
						],
						"outputs": [],
						"execution_count": 44
					},
					{
						"cell_type": "code",
						"source": [
							"raw_df = raw_df.na.drop(subset=[\"Year\", \"Month\", \"Week\"])\n",
							"print(raw_df.count())"
						],
						"outputs": [],
						"execution_count": 41
					},
					{
						"cell_type": "code",
						"source": [
							"merged_df = merged_df.na.drop(subset=[\"Year\", \"Month\", \"Week\"])\n",
							"print(merged_df.count())"
						],
						"outputs": [],
						"execution_count": 48
					},
					{
						"cell_type": "code",
						"source": [
							"merged_df = merged_df.dropDuplicates()\n",
							"print(merged_df.count())"
						],
						"outputs": [],
						"execution_count": 46
					},
					{
						"cell_type": "code",
						"source": [
							"raw_df = raw_df.dropDuplicates(subset=[\"mve_gkey\"])\n",
							"print(raw_df.count())"
						],
						"outputs": [],
						"execution_count": 42
					},
					{
						"cell_type": "code",
						"source": [
							"merged_df.columns"
						],
						"outputs": [],
						"execution_count": 50
					},
					{
						"cell_type": "code",
						"source": [
							"merged_df = merged_df.filter(\"t_put >= '2024-01-01 00:00:00'\")"
						],
						"outputs": [],
						"execution_count": 51
					},
					{
						"cell_type": "code",
						"source": [
							"print(merged_df.count())"
						],
						"outputs": [],
						"execution_count": 52
					},
					{
						"cell_type": "code",
						"source": [
							"spark.conf.set(\"spark.sql.parquet.int96RebaseModeInWrite\", \"CORRECTED\")\n",
							"spark.conf.set(\"spark.sql.datetimeRebaseModeInWrite\", \"CORRECTED\")"
						],
						"outputs": [],
						"execution_count": 54
					},
					{
						"cell_type": "code",
						"source": [
							"merged_df.write.format(\"delta\").mode(\"overwrite\").save(\"abfss://sgtd@navispowerbidatastorage2.dfs.core.windows.net/silver/moves_new\")"
						],
						"outputs": [],
						"execution_count": 55
					},
					{
						"cell_type": "code",
						"source": [
							"print(raw_df.count())"
						],
						"outputs": [],
						"execution_count": 18
					},
					{
						"cell_type": "code",
						"source": [
							"raw_df.write.format(\"delta\").mode(\"overwrite\").save(\"abfss://sgtd@navispowerbidatastorage2.dfs.core.windows.net/gold/jobstep_new\")"
						],
						"outputs": [],
						"execution_count": 37
					},
					{
						"cell_type": "code",
						"source": [
							""
						],
						"outputs": [],
						"execution_count": null
					}
				]
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/dpw_peru_deckinghistory_preproces')]",
			"type": "Microsoft.Synapse/workspaces/notebooks",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"nbformat": 4,
				"nbformat_minor": 2,
				"bigDataPool": {
					"referenceName": "pbixpool",
					"type": "BigDataPoolReference"
				},
				"sessionProperties": {
					"driverMemory": "56g",
					"driverCores": 8,
					"executorMemory": "56g",
					"executorCores": 8,
					"numExecutors": 1,
					"conf": {
						"spark.dynamicAllocation.enabled": "true",
						"spark.dynamicAllocation.minExecutors": "1",
						"spark.dynamicAllocation.maxExecutors": "10",
						"spark.autotune.trackingId": "b59c7a21-0ac5-4bc1-b223-749acb75ef08"
					}
				},
				"metadata": {
					"saveOutput": true,
					"enableDebugMode": true,
					"kernelspec": {
						"name": "synapse_pyspark",
						"display_name": "Synapse PySpark"
					},
					"language_info": {
						"name": "python"
					},
					"a365ComputeOptions": {
						"id": "/subscriptions/095c0f82-6a29-4db3-9f53-6808ff55fa13/resourceGroups/NavisBIAnalyticsPowerBiData2/providers/Microsoft.Synapse/workspaces/navispowerbidata2/bigDataPools/pbixpool",
						"name": "pbixpool",
						"type": "Spark",
						"endpoint": "https://navispowerbidata2.dev.azuresynapse.net/livyApi/versions/2019-11-01-preview/sparkPools/pbixpool",
						"auth": {
							"type": "AAD",
							"authResource": "https://dev.azuresynapse.net"
						},
						"sparkVersion": "3.4",
						"nodeCount": 10,
						"cores": 8,
						"memory": 56
					},
					"sessionKeepAliveTimeout": 30
				},
				"cells": [
					{
						"cell_type": "code",
						"source": [
							"from delta.tables import DeltaTable\n",
							"from pyspark.sql.functions import *\n",
							"from pyspark.sql.types import *\n",
							"from pyspark.sql.window import Window"
						],
						"outputs": [],
						"execution_count": 73
					},
					{
						"cell_type": "code",
						"source": [
							"# === CONFIG ===\n",
							"input_path = \"abfss://dpw-peru@navispowerbidatastorage2.dfs.core.windows.net/bronze/deckinghistory/raw\"\n",
							"output_path = \"abfss://dpw-peru@navispowerbidatastorage2.dfs.core.windows.net/bronze/deckinghistory/load\"\n",
							""
						],
						"outputs": [],
						"execution_count": 70
					},
					{
						"cell_type": "code",
						"source": [
							"#=== STEP 1: Read CSVs without header ===\n",
							"raw_df = spark.read \\\n",
							"    .option(\"header\", \"false\") \\\n",
							"    .option(\"inferSchema\", \"false\") \\\n",
							"    .option(\"quote\", '\"') \\\n",
							"    .option(\"escape\", '\"') \\\n",
							"    .csv(input_path) \\\n",
							"    .withColumn(\"row_num\", row_number().over(Window.partitionBy(input_file_name()).orderBy(monotonically_increasing_id())))\n",
							"\n",
							"# === STEP 2: Remove first line from each file ===\n",
							"raw_df = raw_df.filter(col(\"row_num\") > 1).drop(\"row_num\")\n",
							"\n",
							"# List of base columns\n",
							"columns = [col(f\"_c{i}\") for i in range(24)]\n",
							"\n",
							"# === Rename columns directly without any concat ===\n",
							"df = df_temp.select(\n",
							"    col(\"_c0\").alias(\"GKEY\"),\n",
							"    col(\"_c1\").alias(\"UYV_GKEY\"),\n",
							"    col(\"_c2\").alias(\"UNIT_ID\"),\n",
							"    col(\"_c3\").alias(\"TIMESTAMP\"),       # timestamp is whole now\n",
							"    col(\"_c4\").alias(\"NODE_ID\"),\n",
							"    col(\"_c5\").alias(\"DECKING_TYPE\"),\n",
							"    col(\"_c6\").alias(\"YARD\"),\n",
							"    col(\"_c7\").alias(\"FROM_POS_LOCTYPE\"),\n",
							"    col(\"_c8\").alias(\"FROM_POS_LOCID\"),\n",
							"    col(\"_c9\").alias(\"FROM_POS_LOC_GKEY\"),\n",
							"    col(\"_c10\").alias(\"FROM_POS_SLOT\"),\n",
							"    col(\"_c11\").alias(\"FROM_POS_NAME\"),\n",
							"    col(\"_c12\").alias(\"FROM_POS_BIN\"),\n",
							"    col(\"_c13\").alias(\"FROM_POS_TIER\"),\n",
							"    col(\"_c14\").alias(\"TO_POS_LOCTYPE\"),\n",
							"    col(\"_c15\").alias(\"TO_POS_LOCID\"),\n",
							"    col(\"_c16\").alias(\"TO_POS_LOC_GKEY\"),\n",
							"    col(\"_c17\").alias(\"TO_POS_SLOT\"),\n",
							"    col(\"_c18\").alias(\"TO_POS_NAME\"),\n",
							"    col(\"_c19\").alias(\"TO_POS_BIN\"),\n",
							"    col(\"_c20\").alias(\"TO_POS_TIER\"),\n",
							"    col(\"_c21\").alias(\"TOTAL_SCORE\"),\n",
							"    col(\"_c22\").alias(\"EXECUTION_TIME\"),\n",
							"    col(\"_c23\").alias(\"DETAILS\"),\n",
							"    col(\"_c24\").alias(\"PHASE\")\n",
							")\n",
							"final_df = df.withColumn(\n",
							"    \"TIMESTAMP\",\n",
							"    regexp_replace(col(\"TIMESTAMP\"), \",\", \".\")\n",
							")\n",
							""
						],
						"outputs": [],
						"execution_count": 71
					},
					{
						"cell_type": "code",
						"metadata": {
							"collapsed": false
						},
						"source": [
							"display(final_df)"
						],
						"outputs": [],
						"execution_count": 68
					},
					{
						"cell_type": "code",
						"source": [
							"final_df.write \\\n",
							"    .mode(\"overwrite\") \\\n",
							"    .option(\"header\", True) \\\n",
							"    .csv(output_path)"
						],
						"outputs": [],
						"execution_count": 72
					},
					{
						"cell_type": "code",
						"source": [
							""
						],
						"outputs": [],
						"execution_count": null
					}
				]
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/sc_file correction')]",
			"type": "Microsoft.Synapse/workspaces/notebooks",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"nbformat": 4,
				"nbformat_minor": 2,
				"bigDataPool": {
					"referenceName": "pbixpool",
					"type": "BigDataPoolReference"
				},
				"sessionProperties": {
					"driverMemory": "56g",
					"driverCores": 8,
					"executorMemory": "56g",
					"executorCores": 8,
					"numExecutors": 1,
					"conf": {
						"spark.dynamicAllocation.enabled": "true",
						"spark.dynamicAllocation.minExecutors": "1",
						"spark.dynamicAllocation.maxExecutors": "3",
						"spark.autotune.trackingId": "ab224b99-38c2-4092-abe4-fc445a389fc2"
					}
				},
				"metadata": {
					"saveOutput": true,
					"enableDebugMode": false,
					"kernelspec": {
						"name": "synapse_pyspark",
						"display_name": "Synapse PySpark"
					},
					"language_info": {
						"name": "python"
					},
					"a365ComputeOptions": {
						"id": "/subscriptions/095c0f82-6a29-4db3-9f53-6808ff55fa13/resourceGroups/NavisBIAnalyticsPowerBiData2/providers/Microsoft.Synapse/workspaces/navispowerbidata2/bigDataPools/pbixpool",
						"name": "pbixpool",
						"type": "Spark",
						"endpoint": "https://navispowerbidata2.dev.azuresynapse.net/livyApi/versions/2019-11-01-preview/sparkPools/pbixpool",
						"auth": {
							"type": "AAD",
							"authResource": "https://dev.azuresynapse.net"
						},
						"sparkVersion": "3.4",
						"nodeCount": 10,
						"cores": 8,
						"memory": 56
					},
					"sessionKeepAliveTimeout": 30
				},
				"cells": [
					{
						"cell_type": "code",
						"source": [
							"from pyspark.sql import SparkSession\n",
							"from pyspark.sql import functions as F\n",
							"from pyspark.sql.types import StructType, StructField, StringType"
						],
						"outputs": [],
						"execution_count": 1
					},
					{
						"cell_type": "code",
						"source": [
							"# Spark session\n",
							"spark = SparkSession.builder.getOrCreate()"
						],
						"outputs": [],
						"execution_count": 2
					},
					{
						"cell_type": "code",
						"source": [
							"\n",
							"# Input (raw) and Output (cleaned) folders\n",
							"input_path = \"abfss://cgsa@navispowerbidatastorage2.dfs.core.windows.net/bronze/stackconformity/archive/\"\n",
							"output_path = \"abfss://cgsa@navispowerbidatastorage2.dfs.core.windows.net/bronze/stackconformity/load/\"\n",
							"\n",
							"# # Define the schema explicitly\n",
							"# schema = StructType([\n",
							"#     StructField(\"Equipment ID\", StringType(), True),\n",
							"#     StructField(\"Stacking Factor\", StringType(), True),\n",
							"#     StructField(\"CHE\", StringType(), True),            # renamed from Assigned CHE\n",
							"#     StructField(\"Blk Typ\", StringType(), True),\n",
							"#     StructField(\"Type\", StringType(), True),\n",
							"#     StructField(\"Current Position\", StringType(), True),\n",
							"#     StructField(\"Yard Row\", StringType(), True),\n",
							"#     StructField(\"Cat\", StringType(), True),\n",
							"#     StructField(\"Sts\", StringType(), True),\n",
							"#     StructField(\"Section Factor\", StringType(), True)\n",
							"# ])\n",
							"\n",
							"# # Read with enforced schema (tab delimited)\n",
							"# df = spark.read.option(\"header\", True) \\\n",
							"#     .option(\"delimiter\", \"\\t\") \\\n",
							"#     .schema(schema) \\\n",
							"#     .csv(input_path)"
						],
						"outputs": [],
						"execution_count": 3
					},
					{
						"cell_type": "code",
						"source": [
							"# Read all txt files as plain text\n",
							"df = spark.read.text(input_path)"
						],
						"outputs": [],
						"execution_count": 4
					},
					{
						"cell_type": "code",
						"source": [
							"# Replace only in the first line of each file\n",
							"# We'll tag lines with an index to identify headers\n",
							"from pyspark.sql.functions import regexp_replace, row_number, input_file_name\n",
							"from pyspark.sql.window import Window\n",
							"\n",
							"\n",
							"# Read all txt files as plain text\n",
							"df = spark.read.text(input_path).withColumn(\"file\", input_file_name())\n",
							"\n",
							"# Window to identify first row (header) per file\n",
							"w = Window.partitionBy(\"file\").orderBy(\"value\")\n",
							"\n",
							"df = df.withColumn(\"row_num\", row_number().over(w))\n",
							"\n",
							"# Replace header \"Assigned CHE\" -> \"CHE\" only for first line of each file\n",
							"df = df.withColumn(\n",
							"    \"value\",\n",
							"    regexp_replace(\"value\", \"Assigned CHE\", \"CHE\")\n",
							")\n",
							"\n",
							"# Keep only the single \"value\" column so text() works\n",
							"df_out = df.select(\"value\")\n",
							"\n",
							"# Write back to cleaned folder\n",
							"df_out.write.mode(\"overwrite\").text(output_path)\n",
							"\n",
							"print(\" Cleaned files written to:\", output_path)"
						],
						"outputs": [],
						"execution_count": 6
					},
					{
						"cell_type": "code",
						"metadata": {
							"collapsed": false
						},
						"source": [
							"display(df)"
						],
						"outputs": [],
						"execution_count": 7
					},
					{
						"cell_type": "code",
						"source": [
							"\n",
							"# Rename Assigned CHE -> CHE if it exists\n",
							"if \"Assigned CHE\" in df.columns:\n",
							"    df = df.withColumnRenamed(\"Assigned CHE\", \"CHE\")\n",
							"\n",
							"# Final schema definition\n",
							"expected_columns = [\n",
							"    \"Equipment ID\", \"Stacking Factor\", \"CHE\", \"Blk Typ\", \"Type\",\n",
							"    \"Current Position\", \"Yard Row\", \"Cat\", \"Sts\", \"Section Factor\"\n",
							"]\n",
							"\n",
							"# Add missing columns if not present\n",
							"for col_name in expected_columns:\n",
							"    if col_name not in df.columns:\n",
							"        df = df.withColumn(col_name, F.lit(None))\n",
							"\n",
							"# Reorder columns\n",
							"df = df.select(expected_columns)\n",
							"\n",
							"# Write back as tab-delimited with header\n",
							"df.write.mode(\"overwrite\") \\\n",
							"    .option(\"header\", True) \\\n",
							"    .option(\"delimiter\", \"\\t\") \\\n",
							"    .csv(output_path)\n",
							"\n",
							"\n",
							"\n",
							"# Write back to cleaned folder (tab-delimited with header)\n",
							"df.write.mode(\"overwrite\").option(\"header\", True).option(\"delimiter\", \"\\t\").csv(output_path)\n",
							"\n",
							"print(\" All files cleaned and standardized to new folder:\", output_path)\n",
							""
						],
						"outputs": [],
						"execution_count": 19
					},
					{
						"cell_type": "code",
						"source": [
							""
						],
						"outputs": [],
						"execution_count": null
					}
				]
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/pbixpool')]",
			"type": "Microsoft.Synapse/workspaces/bigDataPools",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"autoPause": {
					"enabled": true,
					"delayInMinutes": 15
				},
				"autoScale": {
					"enabled": true,
					"maxNodeCount": 11,
					"minNodeCount": 3
				},
				"nodeCount": 10,
				"nodeSize": "Medium",
				"nodeSizeFamily": "MemoryOptimized",
				"sparkVersion": "3.4",
				"isComputeIsolationEnabled": false,
				"sessionLevelPackagesEnabled": true,
				"annotations": []
			},
			"dependsOn": [],
			"location": "westus"
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Sc_trigger_CGSA')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "CGSA_confirmities",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "BlobEventsTrigger",
				"typeProperties": {
					"blobPathBeginsWith": "/cgsa/blobs/bronze/stackconformity/load/",
					"blobPathEndsWith": ".txt",
					"ignoreEmptyBlobs": true,
					"scope": "[parameters('Sc_trigger_CGSA_properties_typeProperties_scope')]",
					"events": [
						"Microsoft.Storage.BlobCreated"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/CGSA_confirmities')]"
			]
		}
	]
}